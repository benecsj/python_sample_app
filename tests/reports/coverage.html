<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detailed Coverage Report</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        h3 {
            color: #7f8c8d;
            margin-top: 25px;
            margin-bottom: 10px;
        }
        h4 {
            color: #e74c3c;
            margin-top: 20px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        .file-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ecf0f1;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .file-header {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            padding: 15px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
            font-weight: bold;
        }
        .coverage-info {
            display: inline-block;
            background-color: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            margin-left: 10px;
        }
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            overflow-x: auto;
            white-space: pre;
        }
        .line-number {
            display: inline-block;
            width: 50px;
            color: #718096;
            text-align: right;
            margin-right: 15px;
            user-select: none;
        }
        .line-covered {
            background-color: #d4edda;
            color: #155724;
        }
        .line-uncovered {
            background-color: #f8d7da;
            color: #721c24;
        }
        .line-context {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        .legend {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }
        .recommendations {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .recommendations h3 {
            color: #856404;
            margin-top: 0;
        }
        .recommendations ul {
            color: #856404;
        }
        .back-link {
            display: inline-block;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 6px;
            margin: 20px 0;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .back-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            text-align: center;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
<h1>üìä Detailed Coverage Report</h1>
<p>This report shows all uncovered code lines with context, highlighting which lines are covered and which are not.</p>
<div class="stats-grid">

    <div class="stat-card">
        <div class="stat-value">84.34%</div>
        <div class="stat-label">Total Coverage</div>
    </div>

    <div class="stat-card">
        <div class="stat-value">2,963</div>
        <div class="stat-label">Total Statements</div>
    </div>

    <div class="stat-card">
        <div class="stat-value">464</div>
        <div class="stat-label">Missing Statements</div>
    </div>

    <div class="stat-card">
        <div class="stat-value">10</div>
        <div class="stat-label">Files with Issues</div>
    </div>
</div>
<div class="legend">
<h3>üìã Legend</h3>
<div class="legend-item">
<div class="legend-color" style="background-color: #d4edda;"></div>
<span>‚úÖ Covered lines: Code that was executed during testing</span>
</div>
<div class="legend-item">
<div class="legend-color" style="background-color: #f8d7da;"></div>
<span>‚ùå Uncovered lines: Code that was not executed during testing</span>
</div>
<div class="legend-item">
<div class="legend-color" style="background-color: #f8f9fa;"></div>
<span>üìù Context lines: Code before and after uncovered lines for understanding</span>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/generator.py
<span class="coverage-info">85.91% (250/291 lines covered)</span>
</div>
<h4>Line 79</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 69</span>
</div>
<div class="line-context">
<span class="line-number"> 70</span>        def find_file_key(file_name: str) -> str:
</div>
<div class="line-context">
<span class="line-number"> 71</span>            """Find the correct key for a file in project_model.files using path matching"""
</div>
<div class="line-context">
<span class="line-number"> 72</span>            # First try exact match
</div>
<div class="line-context">
<span class="line-number"> 73</span>            if file_name in project_model.files:
</div>
<div class="line-context">
<span class="line-number"> 74</span>                return file_name
</div>
<div class="line-context">
<span class="line-number"> 75</span>
</div>
<div class="line-context">
<span class="line-number"> 76</span>            # Try matching by filename
</div>
<div class="line-context">
<span class="line-number"> 77</span>            filename = Path(file_name).name
</div>
<div class="line-context">
<span class="line-number"> 78</span>            if filename in project_model.files:
</div>
<div class="line-uncovered">
<span class="line-number"> 79</span>                return filename
</div>
<div class="line-context">
<span class="line-number"> 80</span>
</div>
<div class="line-context">
<span class="line-number"> 81</span>            # Try matching by relative path
</div>
<div class="line-context">
<span class="line-number"> 82</span>            for key in project_model.files.keys():
</div>
<div class="line-context">
<span class="line-number"> 83</span>                if Path(key).name == filename:
</div>
<div class="line-context">
<span class="line-number"> 84</span>                    return key
</div>
<div class="line-context">
<span class="line-number"> 85</span>
</div>
<div class="line-context">
<span class="line-number"> 86</span>            # If not found, return the filename (will be handled gracefully)
</div>
<div class="line-context">
<span class="line-number"> 87</span>            return filename
</div>
<div class="line-context">
<span class="line-number"> 88</span>
</div>
<div class="line-context">
<span class="line-number"> 89</span>        def add_file_to_tree(file_name: str, depth: int):
</div>
</div>
<h4>Line 91</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 81</span>            # Try matching by relative path
</div>
<div class="line-context">
<span class="line-number"> 82</span>            for key in project_model.files.keys():
</div>
<div class="line-context">
<span class="line-number"> 83</span>                if Path(key).name == filename:
</div>
<div class="line-context">
<span class="line-number"> 84</span>                    return key
</div>
<div class="line-context">
<span class="line-number"> 85</span>
</div>
<div class="line-context">
<span class="line-number"> 86</span>            # If not found, return the filename (will be handled gracefully)
</div>
<div class="line-context">
<span class="line-number"> 87</span>            return filename
</div>
<div class="line-context">
<span class="line-number"> 88</span>
</div>
<div class="line-context">
<span class="line-number"> 89</span>        def add_file_to_tree(file_name: str, depth: int):
</div>
<div class="line-context">
<span class="line-number"> 90</span>            if depth > include_depth or file_name in visited:
</div>
<div class="line-uncovered">
<span class="line-number"> 91</span>                return
</div>
<div class="line-context">
<span class="line-number"> 92</span>
</div>
<div class="line-context">
<span class="line-number"> 93</span>            visited.add(file_name)
</div>
<div class="line-context">
<span class="line-number"> 94</span>            file_key = find_file_key(file_name)
</div>
<div class="line-context">
<span class="line-number"> 95</span>
</div>
<div class="line-context">
<span class="line-number"> 96</span>            if file_key in project_model.files:
</div>
<div class="line-context">
<span class="line-number"> 97</span>                include_tree[file_key] = project_model.files[file_key]
</div>
<div class="line-context">
<span class="line-number"> 98</span>
</div>
<div class="line-context">
<span class="line-number"> 99</span>                # Add included files
</div>
<div class="line-context">
<span class="line-number">100</span>                if depth < include_depth:
</div>
<div class="line-context">
<span class="line-number">101</span>                    for include in project_model.files[file_key].includes:
</div>
</div>
<h4>Line 152</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">142</span>        self, lines: List[str], file_model: FileModel, uml_ids: Dict[str, str]
</div>
<div class="line-context">
<span class="line-number">143</span>    ):
</div>
<div class="line-context">
<span class="line-number">144</span>        """Generate class for C file using filename-based keys"""
</div>
<div class="line-context">
<span class="line-number">145</span>        basename = Path(file_model.relative_path).stem
</div>
<div class="line-context">
<span class="line-number">146</span>
</div>
<div class="line-context">
<span class="line-number">147</span>        # Find the UML ID for this file using filename
</div>
<div class="line-context">
<span class="line-number">148</span>        filename = Path(file_model.relative_path).name
</div>
<div class="line-context">
<span class="line-number">149</span>        uml_id = uml_ids.get(filename)
</div>
<div class="line-context">
<span class="line-number">150</span>
</div>
<div class="line-context">
<span class="line-number">151</span>        if not uml_id:
</div>
<div class="line-uncovered">
<span class="line-number">152</span>            return  # Skip if no UML ID found
</div>
<div class="line-context">
<span class="line-number">153</span>
</div>
<div class="line-context">
<span class="line-number">154</span>        lines.append(f'class "{basename}" as {uml_id} <<source>> #LightBlue')
</div>
<div class="line-context">
<span class="line-number">155</span>        lines.append("{")
</div>
<div class="line-context">
<span class="line-number">156</span>
</div>
<div class="line-context">
<span class="line-number">157</span>        # Add macros
</div>
<div class="line-context">
<span class="line-number">158</span>        if file_model.macros:
</div>
<div class="line-context">
<span class="line-number">159</span>            lines.append("    -- Macros --")
</div>
<div class="line-context">
<span class="line-number">160</span>            for macro in sorted(file_model.macros):
</div>
<div class="line-context">
<span class="line-number">161</span>                if "(" in macro and ")" in macro:
</div>
<div class="line-context">
<span class="line-number">162</span>                    # Function-like macro
</div>
</div>
<h4>Lines 163-165</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">153</span>
</div>
<div class="line-context">
<span class="line-number">154</span>        lines.append(f'class "{basename}" as {uml_id} <<source>> #LightBlue')
</div>
<div class="line-context">
<span class="line-number">155</span>        lines.append("{")
</div>
<div class="line-context">
<span class="line-number">156</span>
</div>
<div class="line-context">
<span class="line-number">157</span>        # Add macros
</div>
<div class="line-context">
<span class="line-number">158</span>        if file_model.macros:
</div>
<div class="line-context">
<span class="line-number">159</span>            lines.append("    -- Macros --")
</div>
<div class="line-context">
<span class="line-number">160</span>            for macro in sorted(file_model.macros):
</div>
<div class="line-context">
<span class="line-number">161</span>                if "(" in macro and ")" in macro:
</div>
<div class="line-context">
<span class="line-number">162</span>                    # Function-like macro
</div>
<div class="line-uncovered">
<span class="line-number">163</span>                    macro_name = macro.split("(")[0].replace("#define ", "")
</div>
<div class="line-uncovered">
<span class="line-number">164</span>                    params = macro.split("(")[1].split(")")[0]
</div>
<div class="line-uncovered">
<span class="line-number">165</span>                    lines.append(f"    - #define {macro_name}({params})")
</div>
<div class="line-context">
<span class="line-number">166</span>                else:
</div>
<div class="line-context">
<span class="line-number">167</span>                    # Simple macro
</div>
<div class="line-context">
<span class="line-number">168</span>                    macro_name = macro.replace("#define ", "")
</div>
<div class="line-context">
<span class="line-number">169</span>                    lines.append(f"    - #define {macro_name}")
</div>
<div class="line-context">
<span class="line-number">170</span>
</div>
<div class="line-context">
<span class="line-number">171</span>        # Add global variables
</div>
<div class="line-context">
<span class="line-number">172</span>        if file_model.globals:
</div>
<div class="line-context">
<span class="line-number">173</span>            lines.append("    -- Global Variables --")
</div>
<div class="line-context">
<span class="line-number">174</span>            for global_var in sorted(file_model.globals, key=lambda x: x.name):
</div>
<div class="line-context">
<span class="line-number">175</span>                lines.append(f"    {global_var.type} {global_var.name}")
</div>
</div>
<h4>Line 185</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">175</span>                lines.append(f"    {global_var.type} {global_var.name}")
</div>
<div class="line-context">
<span class="line-number">176</span>
</div>
<div class="line-context">
<span class="line-number">177</span>        # Add functions
</div>
<div class="line-context">
<span class="line-number">178</span>        if file_model.functions:
</div>
<div class="line-context">
<span class="line-number">179</span>            lines.append("    -- Functions --")
</div>
<div class="line-context">
<span class="line-number">180</span>            for func in sorted(file_model.functions, key=lambda x: x.name):
</div>
<div class="line-context">
<span class="line-number">181</span>                if not func.is_declaration:  # Only implementation, not declarations
</div>
<div class="line-context">
<span class="line-number">182</span>                    params = []
</div>
<div class="line-context">
<span class="line-number">183</span>                    for p in func.parameters:
</div>
<div class="line-context">
<span class="line-number">184</span>                        if p.name == "..." and p.type == "...":
</div>
<div class="line-uncovered">
<span class="line-number">185</span>                            params.append("...")
</div>
<div class="line-context">
<span class="line-number">186</span>                        else:
</div>
<div class="line-context">
<span class="line-number">187</span>                            params.append(f"{p.type} {p.name}")
</div>
<div class="line-context">
<span class="line-number">188</span>                    param_str = ", ".join(params)
</div>
<div class="line-context">
<span class="line-number">189</span>                    lines.append(f"    {func.return_type} {func.name}({param_str})")
</div>
<div class="line-context">
<span class="line-number">190</span>
</div>
<div class="line-context">
<span class="line-number">191</span>        lines.append("}")
</div>
<div class="line-context">
<span class="line-number">192</span>        lines.append("")
</div>
<div class="line-context">
<span class="line-number">193</span>
</div>
<div class="line-context">
<span class="line-number">194</span>    def _generate_header_class(
</div>
<div class="line-context">
<span class="line-number">195</span>        self, lines: List[str], file_model: FileModel, uml_ids: Dict[str, str]
</div>
</div>
<h4>Line 205</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">195</span>        self, lines: List[str], file_model: FileModel, uml_ids: Dict[str, str]
</div>
<div class="line-context">
<span class="line-number">196</span>    ):
</div>
<div class="line-context">
<span class="line-number">197</span>        """Generate class for header file using filename-based keys"""
</div>
<div class="line-context">
<span class="line-number">198</span>        basename = Path(file_model.relative_path).stem
</div>
<div class="line-context">
<span class="line-number">199</span>
</div>
<div class="line-context">
<span class="line-number">200</span>        # Find the UML ID for this file using filename
</div>
<div class="line-context">
<span class="line-number">201</span>        filename = Path(file_model.relative_path).name
</div>
<div class="line-context">
<span class="line-number">202</span>        uml_id = uml_ids.get(filename)
</div>
<div class="line-context">
<span class="line-number">203</span>
</div>
<div class="line-context">
<span class="line-number">204</span>        if not uml_id:
</div>
<div class="line-uncovered">
<span class="line-number">205</span>            return  # Skip if no UML ID found
</div>
<div class="line-context">
<span class="line-number">206</span>
</div>
<div class="line-context">
<span class="line-number">207</span>        lines.append(f'class "{basename}" as {uml_id} <<header>> #LightGreen')
</div>
<div class="line-context">
<span class="line-number">208</span>        lines.append("{")
</div>
<div class="line-context">
<span class="line-number">209</span>
</div>
<div class="line-context">
<span class="line-number">210</span>        # Add macros
</div>
<div class="line-context">
<span class="line-number">211</span>        if file_model.macros:
</div>
<div class="line-context">
<span class="line-number">212</span>            lines.append("    -- Macros --")
</div>
<div class="line-context">
<span class="line-number">213</span>            for macro in sorted(file_model.macros):
</div>
<div class="line-context">
<span class="line-number">214</span>                if "(" in macro and ")" in macro:
</div>
<div class="line-context">
<span class="line-number">215</span>                    # Function-like macro
</div>
</div>
<h4>Lines 216-218</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">206</span>
</div>
<div class="line-context">
<span class="line-number">207</span>        lines.append(f'class "{basename}" as {uml_id} <<header>> #LightGreen')
</div>
<div class="line-context">
<span class="line-number">208</span>        lines.append("{")
</div>
<div class="line-context">
<span class="line-number">209</span>
</div>
<div class="line-context">
<span class="line-number">210</span>        # Add macros
</div>
<div class="line-context">
<span class="line-number">211</span>        if file_model.macros:
</div>
<div class="line-context">
<span class="line-number">212</span>            lines.append("    -- Macros --")
</div>
<div class="line-context">
<span class="line-number">213</span>            for macro in sorted(file_model.macros):
</div>
<div class="line-context">
<span class="line-number">214</span>                if "(" in macro and ")" in macro:
</div>
<div class="line-context">
<span class="line-number">215</span>                    # Function-like macro
</div>
<div class="line-uncovered">
<span class="line-number">216</span>                    macro_name = macro.split("(")[0].replace("#define ", "")
</div>
<div class="line-uncovered">
<span class="line-number">217</span>                    params = macro.split("(")[1].split(")")[0]
</div>
<div class="line-uncovered">
<span class="line-number">218</span>                    lines.append(f"    + #define {macro_name}({params})")
</div>
<div class="line-context">
<span class="line-number">219</span>                else:
</div>
<div class="line-context">
<span class="line-number">220</span>                    # Simple macro
</div>
<div class="line-context">
<span class="line-number">221</span>                    macro_name = macro.replace("#define ", "")
</div>
<div class="line-context">
<span class="line-number">222</span>                    lines.append(f"    + #define {macro_name}")
</div>
<div class="line-context">
<span class="line-number">223</span>
</div>
<div class="line-context">
<span class="line-number">224</span>        # Add global variables
</div>
<div class="line-context">
<span class="line-number">225</span>        if file_model.globals:
</div>
<div class="line-context">
<span class="line-number">226</span>            lines.append("    -- Global Variables --")
</div>
<div class="line-context">
<span class="line-number">227</span>            for global_var in sorted(file_model.globals, key=lambda x: x.name):
</div>
<div class="line-context">
<span class="line-number">228</span>                lines.append(f"    + {global_var.type} {global_var.name}")
</div>
</div>
<h4>Line 274</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">264</span>        # Enums
</div>
<div class="line-context">
<span class="line-number">265</span>        for enum_name, enum_data in sorted(file_model.enums.items()):
</div>
<div class="line-context">
<span class="line-number">266</span>            uml_id = uml_ids.get(f"typedef_{enum_name}")
</div>
<div class="line-context">
<span class="line-number">267</span>            if uml_id:
</div>
<div class="line-context">
<span class="line-number">268</span>                lines.append(
</div>
<div class="line-context">
<span class="line-number">269</span>                    f'class "{enum_name}" as {uml_id} <<typedef>> #LightYellow'
</div>
<div class="line-context">
<span class="line-number">270</span>                )
</div>
<div class="line-context">
<span class="line-number">271</span>                lines.append("{")
</div>
<div class="line-context">
<span class="line-number">272</span>                for value in sorted(enum_data.values, key=lambda x: x.name):
</div>
<div class="line-context">
<span class="line-number">273</span>                    if value.value:
</div>
<div class="line-uncovered">
<span class="line-number">274</span>                        lines.append(f"    + {value.name} = {value.value}")
</div>
<div class="line-context">
<span class="line-number">275</span>                    else:
</div>
<div class="line-context">
<span class="line-number">276</span>                        lines.append(f"    + {value.name}")
</div>
<div class="line-context">
<span class="line-number">277</span>                lines.append("}")
</div>
<div class="line-context">
<span class="line-number">278</span>                lines.append("")
</div>
<div class="line-context">
<span class="line-number">279</span>
</div>
<div class="line-context">
<span class="line-number">280</span>        # Aliases (simple typedefs)
</div>
<div class="line-context">
<span class="line-number">281</span>        for alias_name, alias_data in sorted(file_model.aliases.items()):
</div>
<div class="line-context">
<span class="line-number">282</span>            uml_id = uml_ids.get(f"typedef_{alias_name}")
</div>
<div class="line-context">
<span class="line-number">283</span>            if uml_id:
</div>
<div class="line-context">
<span class="line-number">284</span>                lines.append(
</div>
</div>
<h4>Line 298</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">288</span>                # Handle multi-line alias types with proper nested struct indentation
</div>
<div class="line-context">
<span class="line-number">289</span>                alias_lines = alias_data.original_type.split('\n')
</div>
<div class="line-context">
<span class="line-number">290</span>                inside_struct = False
</div>
<div class="line-context">
<span class="line-number">291</span>                nested_content = []
</div>
<div class="line-context">
<span class="line-number">292</span>
</div>
<div class="line-context">
<span class="line-number">293</span>                for i, line in enumerate(alias_lines):
</div>
<div class="line-context">
<span class="line-number">294</span>                    line = line.strip()
</div>
<div class="line-context">
<span class="line-number">295</span>
</div>
<div class="line-context">
<span class="line-number">296</span>                    if i == 0:
</div>
<div class="line-context">
<span class="line-number">297</span>                        lines.append(f"    + {line}")
</div>
<div class="line-uncovered">
<span class="line-number">298</span>                    elif line.startswith("struct {"):
</div>
<div class="line-context">
<span class="line-number">299</span>                        # Start collecting nested struct content
</div>
<div class="line-context">
<span class="line-number">300</span>                        inside_struct = True
</div>
<div class="line-context">
<span class="line-number">301</span>                        nested_content = []
</div>
<div class="line-context">
<span class="line-number">302</span>                    elif line == "}":
</div>
<div class="line-context">
<span class="line-number">303</span>                        if inside_struct:
</div>
<div class="line-context">
<span class="line-number">304</span>                            # Close nested struct with flattened content
</div>
<div class="line-context">
<span class="line-number">305</span>                            if nested_content:
</div>
<div class="line-context">
<span class="line-number">306</span>                                content_str = "; ".join(nested_content)
</div>
<div class="line-context">
<span class="line-number">307</span>                                lines.append(f"    + struct {{ {content_str} }}")
</div>
<div class="line-context">
<span class="line-number">308</span>                            else:
</div>
</div>
<h4>Lines 300-303</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">290</span>                inside_struct = False
</div>
<div class="line-context">
<span class="line-number">291</span>                nested_content = []
</div>
<div class="line-context">
<span class="line-number">292</span>
</div>
<div class="line-context">
<span class="line-number">293</span>                for i, line in enumerate(alias_lines):
</div>
<div class="line-context">
<span class="line-number">294</span>                    line = line.strip()
</div>
<div class="line-context">
<span class="line-number">295</span>
</div>
<div class="line-context">
<span class="line-number">296</span>                    if i == 0:
</div>
<div class="line-context">
<span class="line-number">297</span>                        lines.append(f"    + {line}")
</div>
<div class="line-context">
<span class="line-number">298</span>                    elif line.startswith("struct {"):
</div>
<div class="line-context">
<span class="line-number">299</span>                        # Start collecting nested struct content
</div>
<div class="line-uncovered">
<span class="line-number">300</span>                        inside_struct = True
</div>
<div class="line-uncovered">
<span class="line-number">301</span>                        nested_content = []
</div>
<div class="line-uncovered">
<span class="line-number">302</span>                    elif line == "}":
</div>
<div class="line-uncovered">
<span class="line-number">303</span>                        if inside_struct:
</div>
<div class="line-context">
<span class="line-number">304</span>                            # Close nested struct with flattened content
</div>
<div class="line-context">
<span class="line-number">305</span>                            if nested_content:
</div>
<div class="line-context">
<span class="line-number">306</span>                                content_str = "; ".join(nested_content)
</div>
<div class="line-context">
<span class="line-number">307</span>                                lines.append(f"    + struct {{ {content_str} }}")
</div>
<div class="line-context">
<span class="line-number">308</span>                            else:
</div>
<div class="line-context">
<span class="line-number">309</span>                                lines.append(f"    + struct {{ }}")
</div>
<div class="line-context">
<span class="line-number">310</span>                            inside_struct = False
</div>
<div class="line-context">
<span class="line-number">311</span>                            nested_content = []
</div>
<div class="line-context">
<span class="line-number">312</span>                        else:
</div>
<div class="line-context">
<span class="line-number">313</span>                            lines.append(f"    }}")
</div>
</div>
<h4>Lines 305-307</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">295</span>
</div>
<div class="line-context">
<span class="line-number">296</span>                    if i == 0:
</div>
<div class="line-context">
<span class="line-number">297</span>                        lines.append(f"    + {line}")
</div>
<div class="line-context">
<span class="line-number">298</span>                    elif line.startswith("struct {"):
</div>
<div class="line-context">
<span class="line-number">299</span>                        # Start collecting nested struct content
</div>
<div class="line-context">
<span class="line-number">300</span>                        inside_struct = True
</div>
<div class="line-context">
<span class="line-number">301</span>                        nested_content = []
</div>
<div class="line-context">
<span class="line-number">302</span>                    elif line == "}":
</div>
<div class="line-context">
<span class="line-number">303</span>                        if inside_struct:
</div>
<div class="line-context">
<span class="line-number">304</span>                            # Close nested struct with flattened content
</div>
<div class="line-uncovered">
<span class="line-number">305</span>                            if nested_content:
</div>
<div class="line-uncovered">
<span class="line-number">306</span>                                content_str = "; ".join(nested_content)
</div>
<div class="line-uncovered">
<span class="line-number">307</span>                                lines.append(f"    + struct {{ {content_str} }}")
</div>
<div class="line-context">
<span class="line-number">308</span>                            else:
</div>
<div class="line-context">
<span class="line-number">309</span>                                lines.append(f"    + struct {{ }}")
</div>
<div class="line-context">
<span class="line-number">310</span>                            inside_struct = False
</div>
<div class="line-context">
<span class="line-number">311</span>                            nested_content = []
</div>
<div class="line-context">
<span class="line-number">312</span>                        else:
</div>
<div class="line-context">
<span class="line-number">313</span>                            lines.append(f"    }}")
</div>
<div class="line-context">
<span class="line-number">314</span>                    elif line and line != "}":
</div>
<div class="line-context">
<span class="line-number">315</span>                        if inside_struct:
</div>
<div class="line-context">
<span class="line-number">316</span>                            nested_content.append(line)  # Collect nested content
</div>
<div class="line-context">
<span class="line-number">317</span>                        else:
</div>
</div>
<h4>Lines 309-311</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">299</span>                        # Start collecting nested struct content
</div>
<div class="line-context">
<span class="line-number">300</span>                        inside_struct = True
</div>
<div class="line-context">
<span class="line-number">301</span>                        nested_content = []
</div>
<div class="line-context">
<span class="line-number">302</span>                    elif line == "}":
</div>
<div class="line-context">
<span class="line-number">303</span>                        if inside_struct:
</div>
<div class="line-context">
<span class="line-number">304</span>                            # Close nested struct with flattened content
</div>
<div class="line-context">
<span class="line-number">305</span>                            if nested_content:
</div>
<div class="line-context">
<span class="line-number">306</span>                                content_str = "; ".join(nested_content)
</div>
<div class="line-context">
<span class="line-number">307</span>                                lines.append(f"    + struct {{ {content_str} }}")
</div>
<div class="line-context">
<span class="line-number">308</span>                            else:
</div>
<div class="line-uncovered">
<span class="line-number">309</span>                                lines.append(f"    + struct {{ }}")
</div>
<div class="line-uncovered">
<span class="line-number">310</span>                            inside_struct = False
</div>
<div class="line-uncovered">
<span class="line-number">311</span>                            nested_content = []
</div>
<div class="line-context">
<span class="line-number">312</span>                        else:
</div>
<div class="line-context">
<span class="line-number">313</span>                            lines.append(f"    }}")
</div>
<div class="line-context">
<span class="line-number">314</span>                    elif line and line != "}":
</div>
<div class="line-context">
<span class="line-number">315</span>                        if inside_struct:
</div>
<div class="line-context">
<span class="line-number">316</span>                            nested_content.append(line)  # Collect nested content
</div>
<div class="line-context">
<span class="line-number">317</span>                        else:
</div>
<div class="line-context">
<span class="line-number">318</span>                            lines.append(f"+ {line}")
</div>
<div class="line-context">
<span class="line-number">319</span>
</div>
<div class="line-context">
<span class="line-number">320</span>                # If we were inside a struct but didn't find a closing brace, add one
</div>
<div class="line-context">
<span class="line-number">321</span>                if inside_struct and nested_content:
</div>
</div>
<h4>Lines 313-316</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">303</span>                        if inside_struct:
</div>
<div class="line-context">
<span class="line-number">304</span>                            # Close nested struct with flattened content
</div>
<div class="line-context">
<span class="line-number">305</span>                            if nested_content:
</div>
<div class="line-context">
<span class="line-number">306</span>                                content_str = "; ".join(nested_content)
</div>
<div class="line-context">
<span class="line-number">307</span>                                lines.append(f"    + struct {{ {content_str} }}")
</div>
<div class="line-context">
<span class="line-number">308</span>                            else:
</div>
<div class="line-context">
<span class="line-number">309</span>                                lines.append(f"    + struct {{ }}")
</div>
<div class="line-context">
<span class="line-number">310</span>                            inside_struct = False
</div>
<div class="line-context">
<span class="line-number">311</span>                            nested_content = []
</div>
<div class="line-context">
<span class="line-number">312</span>                        else:
</div>
<div class="line-uncovered">
<span class="line-number">313</span>                            lines.append(f"    }}")
</div>
<div class="line-uncovered">
<span class="line-number">314</span>                    elif line and line != "}":
</div>
<div class="line-uncovered">
<span class="line-number">315</span>                        if inside_struct:
</div>
<div class="line-uncovered">
<span class="line-number">316</span>                            nested_content.append(line)  # Collect nested content
</div>
<div class="line-context">
<span class="line-number">317</span>                        else:
</div>
<div class="line-context">
<span class="line-number">318</span>                            lines.append(f"+ {line}")
</div>
<div class="line-context">
<span class="line-number">319</span>
</div>
<div class="line-context">
<span class="line-number">320</span>                # If we were inside a struct but didn't find a closing brace, add one
</div>
<div class="line-context">
<span class="line-number">321</span>                if inside_struct and nested_content:
</div>
<div class="line-context">
<span class="line-number">322</span>                    content_str = "; ".join(nested_content)
</div>
<div class="line-context">
<span class="line-number">323</span>                    lines.append(f"    + struct {{ {content_str} }}")
</div>
<div class="line-context">
<span class="line-number">324</span>                lines.append("}")
</div>
<div class="line-context">
<span class="line-number">325</span>                lines.append("")
</div>
<div class="line-context">
<span class="line-number">326</span>
</div>
</div>
<h4>Line 318</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">308</span>                            else:
</div>
<div class="line-context">
<span class="line-number">309</span>                                lines.append(f"    + struct {{ }}")
</div>
<div class="line-context">
<span class="line-number">310</span>                            inside_struct = False
</div>
<div class="line-context">
<span class="line-number">311</span>                            nested_content = []
</div>
<div class="line-context">
<span class="line-number">312</span>                        else:
</div>
<div class="line-context">
<span class="line-number">313</span>                            lines.append(f"    }}")
</div>
<div class="line-context">
<span class="line-number">314</span>                    elif line and line != "}":
</div>
<div class="line-context">
<span class="line-number">315</span>                        if inside_struct:
</div>
<div class="line-context">
<span class="line-number">316</span>                            nested_content.append(line)  # Collect nested content
</div>
<div class="line-context">
<span class="line-number">317</span>                        else:
</div>
<div class="line-uncovered">
<span class="line-number">318</span>                            lines.append(f"+ {line}")
</div>
<div class="line-context">
<span class="line-number">319</span>
</div>
<div class="line-context">
<span class="line-number">320</span>                # If we were inside a struct but didn't find a closing brace, add one
</div>
<div class="line-context">
<span class="line-number">321</span>                if inside_struct and nested_content:
</div>
<div class="line-context">
<span class="line-number">322</span>                    content_str = "; ".join(nested_content)
</div>
<div class="line-context">
<span class="line-number">323</span>                    lines.append(f"    + struct {{ {content_str} }}")
</div>
<div class="line-context">
<span class="line-number">324</span>                lines.append("}")
</div>
<div class="line-context">
<span class="line-number">325</span>                lines.append("")
</div>
<div class="line-context">
<span class="line-number">326</span>
</div>
<div class="line-context">
<span class="line-number">327</span>        # Unions
</div>
<div class="line-context">
<span class="line-number">328</span>        for union_name, union_data in sorted(file_model.unions.items()):
</div>
</div>
<h4>Lines 322-323</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">312</span>                        else:
</div>
<div class="line-context">
<span class="line-number">313</span>                            lines.append(f"    }}")
</div>
<div class="line-context">
<span class="line-number">314</span>                    elif line and line != "}":
</div>
<div class="line-context">
<span class="line-number">315</span>                        if inside_struct:
</div>
<div class="line-context">
<span class="line-number">316</span>                            nested_content.append(line)  # Collect nested content
</div>
<div class="line-context">
<span class="line-number">317</span>                        else:
</div>
<div class="line-context">
<span class="line-number">318</span>                            lines.append(f"+ {line}")
</div>
<div class="line-context">
<span class="line-number">319</span>
</div>
<div class="line-context">
<span class="line-number">320</span>                # If we were inside a struct but didn't find a closing brace, add one
</div>
<div class="line-context">
<span class="line-number">321</span>                if inside_struct and nested_content:
</div>
<div class="line-uncovered">
<span class="line-number">322</span>                    content_str = "; ".join(nested_content)
</div>
<div class="line-uncovered">
<span class="line-number">323</span>                    lines.append(f"    + struct {{ {content_str} }}")
</div>
<div class="line-context">
<span class="line-number">324</span>                lines.append("}")
</div>
<div class="line-context">
<span class="line-number">325</span>                lines.append("")
</div>
<div class="line-context">
<span class="line-number">326</span>
</div>
<div class="line-context">
<span class="line-number">327</span>        # Unions
</div>
<div class="line-context">
<span class="line-number">328</span>        for union_name, union_data in sorted(file_model.unions.items()):
</div>
<div class="line-context">
<span class="line-number">329</span>            uml_id = uml_ids.get(f"typedef_{union_name}")
</div>
<div class="line-context">
<span class="line-number">330</span>            if uml_id:
</div>
<div class="line-context">
<span class="line-number">331</span>                lines.append(
</div>
<div class="line-context">
<span class="line-number">332</span>                    f'class "{union_name}" as {uml_id} <<typedef>> #LightYellow'
</div>
<div class="line-context">
<span class="line-number">333</span>                )
</div>
</div>
<h4>Line 347</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">337</span>                lines.append("}")
</div>
<div class="line-context">
<span class="line-number">338</span>                lines.append("")
</div>
<div class="line-context">
<span class="line-number">339</span>
</div>
<div class="line-context">
<span class="line-number">340</span>    def _generate_field_with_nested_structs(self, lines: List[str], field, base_indent: str):
</div>
<div class="line-context">
<span class="line-number">341</span>        """Generate field with proper handling of nested structures"""
</div>
<div class="line-context">
<span class="line-number">342</span>        field_text = f"{field.type} {field.name}"
</div>
<div class="line-context">
<span class="line-number">343</span>
</div>
<div class="line-context">
<span class="line-number">344</span>        # Check if this is a nested struct field
</div>
<div class="line-context">
<span class="line-number">345</span>        if field.type.startswith("struct {") and '\n' in field.type:
</div>
<div class="line-context">
<span class="line-number">346</span>            # Parse the nested struct content and flatten it
</div>
<div class="line-uncovered">
<span class="line-number">347</span>            struct_parts = field.type.split('\n')
</div>
<div class="line-context">
<span class="line-number">348</span>
</div>
<div class="line-context">
<span class="line-number">349</span>            # For nested structs, flatten them to avoid PlantUML parsing issues
</div>
<div class="line-context">
<span class="line-number">350</span>            # Format as: + struct { field_type field_name }
</div>
<div class="line-context">
<span class="line-number">351</span>            nested_content = []
</div>
<div class="line-context">
<span class="line-number">352</span>            for part in struct_parts[1:]:
</div>
<div class="line-context">
<span class="line-number">353</span>                part = part.strip()
</div>
<div class="line-context">
<span class="line-number">354</span>                if part and part != "}":
</div>
<div class="line-context">
<span class="line-number">355</span>                    nested_content.append(part)
</div>
<div class="line-context">
<span class="line-number">356</span>
</div>
<div class="line-context">
<span class="line-number">357</span>            if nested_content:
</div>
</div>
<h4>Lines 351-355</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">341</span>        """Generate field with proper handling of nested structures"""
</div>
<div class="line-context">
<span class="line-number">342</span>        field_text = f"{field.type} {field.name}"
</div>
<div class="line-context">
<span class="line-number">343</span>
</div>
<div class="line-context">
<span class="line-number">344</span>        # Check if this is a nested struct field
</div>
<div class="line-context">
<span class="line-number">345</span>        if field.type.startswith("struct {") and '\n' in field.type:
</div>
<div class="line-context">
<span class="line-number">346</span>            # Parse the nested struct content and flatten it
</div>
<div class="line-context">
<span class="line-number">347</span>            struct_parts = field.type.split('\n')
</div>
<div class="line-context">
<span class="line-number">348</span>
</div>
<div class="line-context">
<span class="line-number">349</span>            # For nested structs, flatten them to avoid PlantUML parsing issues
</div>
<div class="line-context">
<span class="line-number">350</span>            # Format as: + struct { field_type field_name }
</div>
<div class="line-uncovered">
<span class="line-number">351</span>            nested_content = []
</div>
<div class="line-uncovered">
<span class="line-number">352</span>            for part in struct_parts[1:]:
</div>
<div class="line-uncovered">
<span class="line-number">353</span>                part = part.strip()
</div>
<div class="line-uncovered">
<span class="line-number">354</span>                if part and part != "}":
</div>
<div class="line-uncovered">
<span class="line-number">355</span>                    nested_content.append(part)
</div>
<div class="line-context">
<span class="line-number">356</span>
</div>
<div class="line-context">
<span class="line-number">357</span>            if nested_content:
</div>
<div class="line-context">
<span class="line-number">358</span>                # Create a flattened representation
</div>
<div class="line-context">
<span class="line-number">359</span>                content_str = "; ".join(nested_content)
</div>
<div class="line-context">
<span class="line-number">360</span>                lines.append(f"{base_indent}+ struct {{ {content_str} }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">361</span>            else:
</div>
<div class="line-context">
<span class="line-number">362</span>                lines.append(f"{base_indent}+ struct {{ }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">363</span>        else:
</div>
<div class="line-context">
<span class="line-number">364</span>            # Handle regular multi-line field types
</div>
<div class="line-context">
<span class="line-number">365</span>            field_lines = field_text.split('\n')
</div>
</div>
<h4>Line 357</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">347</span>            struct_parts = field.type.split('\n')
</div>
<div class="line-context">
<span class="line-number">348</span>
</div>
<div class="line-context">
<span class="line-number">349</span>            # For nested structs, flatten them to avoid PlantUML parsing issues
</div>
<div class="line-context">
<span class="line-number">350</span>            # Format as: + struct { field_type field_name }
</div>
<div class="line-context">
<span class="line-number">351</span>            nested_content = []
</div>
<div class="line-context">
<span class="line-number">352</span>            for part in struct_parts[1:]:
</div>
<div class="line-context">
<span class="line-number">353</span>                part = part.strip()
</div>
<div class="line-context">
<span class="line-number">354</span>                if part and part != "}":
</div>
<div class="line-context">
<span class="line-number">355</span>                    nested_content.append(part)
</div>
<div class="line-context">
<span class="line-number">356</span>
</div>
<div class="line-uncovered">
<span class="line-number">357</span>            if nested_content:
</div>
<div class="line-context">
<span class="line-number">358</span>                # Create a flattened representation
</div>
<div class="line-context">
<span class="line-number">359</span>                content_str = "; ".join(nested_content)
</div>
<div class="line-context">
<span class="line-number">360</span>                lines.append(f"{base_indent}+ struct {{ {content_str} }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">361</span>            else:
</div>
<div class="line-context">
<span class="line-number">362</span>                lines.append(f"{base_indent}+ struct {{ }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">363</span>        else:
</div>
<div class="line-context">
<span class="line-number">364</span>            # Handle regular multi-line field types
</div>
<div class="line-context">
<span class="line-number">365</span>            field_lines = field_text.split('\n')
</div>
<div class="line-context">
<span class="line-number">366</span>            for i, line in enumerate(field_lines):
</div>
<div class="line-context">
<span class="line-number">367</span>                if i == 0:
</div>
</div>
<h4>Lines 359-360</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">349</span>            # For nested structs, flatten them to avoid PlantUML parsing issues
</div>
<div class="line-context">
<span class="line-number">350</span>            # Format as: + struct { field_type field_name }
</div>
<div class="line-context">
<span class="line-number">351</span>            nested_content = []
</div>
<div class="line-context">
<span class="line-number">352</span>            for part in struct_parts[1:]:
</div>
<div class="line-context">
<span class="line-number">353</span>                part = part.strip()
</div>
<div class="line-context">
<span class="line-number">354</span>                if part and part != "}":
</div>
<div class="line-context">
<span class="line-number">355</span>                    nested_content.append(part)
</div>
<div class="line-context">
<span class="line-number">356</span>
</div>
<div class="line-context">
<span class="line-number">357</span>            if nested_content:
</div>
<div class="line-context">
<span class="line-number">358</span>                # Create a flattened representation
</div>
<div class="line-uncovered">
<span class="line-number">359</span>                content_str = "; ".join(nested_content)
</div>
<div class="line-uncovered">
<span class="line-number">360</span>                lines.append(f"{base_indent}+ struct {{ {content_str} }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">361</span>            else:
</div>
<div class="line-context">
<span class="line-number">362</span>                lines.append(f"{base_indent}+ struct {{ }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">363</span>        else:
</div>
<div class="line-context">
<span class="line-number">364</span>            # Handle regular multi-line field types
</div>
<div class="line-context">
<span class="line-number">365</span>            field_lines = field_text.split('\n')
</div>
<div class="line-context">
<span class="line-number">366</span>            for i, line in enumerate(field_lines):
</div>
<div class="line-context">
<span class="line-number">367</span>                if i == 0:
</div>
<div class="line-context">
<span class="line-number">368</span>                    lines.append(f"{base_indent}+ {line}")
</div>
<div class="line-context">
<span class="line-number">369</span>                else:
</div>
<div class="line-context">
<span class="line-number">370</span>                    lines.append(f"+ {line}")
</div>
</div>
<h4>Line 362</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">352</span>            for part in struct_parts[1:]:
</div>
<div class="line-context">
<span class="line-number">353</span>                part = part.strip()
</div>
<div class="line-context">
<span class="line-number">354</span>                if part and part != "}":
</div>
<div class="line-context">
<span class="line-number">355</span>                    nested_content.append(part)
</div>
<div class="line-context">
<span class="line-number">356</span>
</div>
<div class="line-context">
<span class="line-number">357</span>            if nested_content:
</div>
<div class="line-context">
<span class="line-number">358</span>                # Create a flattened representation
</div>
<div class="line-context">
<span class="line-number">359</span>                content_str = "; ".join(nested_content)
</div>
<div class="line-context">
<span class="line-number">360</span>                lines.append(f"{base_indent}+ struct {{ {content_str} }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">361</span>            else:
</div>
<div class="line-uncovered">
<span class="line-number">362</span>                lines.append(f"{base_indent}+ struct {{ }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">363</span>        else:
</div>
<div class="line-context">
<span class="line-number">364</span>            # Handle regular multi-line field types
</div>
<div class="line-context">
<span class="line-number">365</span>            field_lines = field_text.split('\n')
</div>
<div class="line-context">
<span class="line-number">366</span>            for i, line in enumerate(field_lines):
</div>
<div class="line-context">
<span class="line-number">367</span>                if i == 0:
</div>
<div class="line-context">
<span class="line-number">368</span>                    lines.append(f"{base_indent}+ {line}")
</div>
<div class="line-context">
<span class="line-number">369</span>                else:
</div>
<div class="line-context">
<span class="line-number">370</span>                    lines.append(f"+ {line}")
</div>
<div class="line-context">
<span class="line-number">371</span>
</div>
<div class="line-context">
<span class="line-number">372</span>    def _generate_relationships(
</div>
</div>
<h4>Line 370</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">360</span>                lines.append(f"{base_indent}+ struct {{ {content_str} }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">361</span>            else:
</div>
<div class="line-context">
<span class="line-number">362</span>                lines.append(f"{base_indent}+ struct {{ }} {field.name}")
</div>
<div class="line-context">
<span class="line-number">363</span>        else:
</div>
<div class="line-context">
<span class="line-number">364</span>            # Handle regular multi-line field types
</div>
<div class="line-context">
<span class="line-number">365</span>            field_lines = field_text.split('\n')
</div>
<div class="line-context">
<span class="line-number">366</span>            for i, line in enumerate(field_lines):
</div>
<div class="line-context">
<span class="line-number">367</span>                if i == 0:
</div>
<div class="line-context">
<span class="line-number">368</span>                    lines.append(f"{base_indent}+ {line}")
</div>
<div class="line-context">
<span class="line-number">369</span>                else:
</div>
<div class="line-uncovered">
<span class="line-number">370</span>                    lines.append(f"+ {line}")
</div>
<div class="line-context">
<span class="line-number">371</span>
</div>
<div class="line-context">
<span class="line-number">372</span>    def _generate_relationships(
</div>
<div class="line-context">
<span class="line-number">373</span>        self,
</div>
<div class="line-context">
<span class="line-number">374</span>        lines: List[str],
</div>
<div class="line-context">
<span class="line-number">375</span>        include_tree: Dict[str, FileModel],
</div>
<div class="line-context">
<span class="line-number">376</span>        uml_ids: Dict[str, str],
</div>
<div class="line-context">
<span class="line-number">377</span>        project_model: ProjectModel,
</div>
<div class="line-context">
<span class="line-number">378</span>    ):
</div>
<div class="line-context">
<span class="line-number">379</span>        """Generate relationships between elements"""
</div>
<div class="line-context">
<span class="line-number">380</span>        # 1. Include relationships
</div>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/models.py
<span class="coverage-info">86.54% (225/260 lines covered)</span>
</div>
<h4>Line 27</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 17</span>    value: Optional[str] = None
</div>
<div class="line-context">
<span class="line-number"> 18</span>
</div>
<div class="line-context">
<span class="line-number"> 19</span>    def __repr__(self):
</div>
<div class="line-context">
<span class="line-number"> 20</span>        if self.value is not None:
</div>
<div class="line-context">
<span class="line-number"> 21</span>            return f"Field(name={self.name}, type={self.type}, value={self.value})"
</div>
<div class="line-context">
<span class="line-number"> 22</span>        return f"Field(name={self.name}, type={self.type})"
</div>
<div class="line-context">
<span class="line-number"> 23</span>
</div>
<div class="line-context">
<span class="line-number"> 24</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number"> 25</span>        """Validate field data after initialization"""
</div>
<div class="line-context">
<span class="line-number"> 26</span>        if not isinstance(self.name, str):
</div>
<div class="line-uncovered">
<span class="line-number"> 27</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 28</span>                f"Field name must be a string, got {type(self.name)}: {repr(self.name)}"
</div>
<div class="line-context">
<span class="line-number"> 29</span>            )
</div>
<div class="line-context">
<span class="line-number"> 30</span>        if not self.type or not isinstance(self.type, str):
</div>
<div class="line-context">
<span class="line-number"> 31</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 32</span>                f"Field type must be a non-empty string, got {type(self.type)}: {repr(self.type)}"
</div>
<div class="line-context">
<span class="line-number"> 33</span>            )
</div>
<div class="line-context">
<span class="line-number"> 34</span>
</div>
<div class="line-context">
<span class="line-number"> 35</span>        # Additional validation: ensure name and type are not just whitespace
</div>
<div class="line-context">
<span class="line-number"> 36</span>        if not self.name.strip():
</div>
<div class="line-context">
<span class="line-number"> 37</span>            raise ValueError(
</div>
</div>
<h4>Line 31</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 21</span>            return f"Field(name={self.name}, type={self.type}, value={self.value})"
</div>
<div class="line-context">
<span class="line-number"> 22</span>        return f"Field(name={self.name}, type={self.type})"
</div>
<div class="line-context">
<span class="line-number"> 23</span>
</div>
<div class="line-context">
<span class="line-number"> 24</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number"> 25</span>        """Validate field data after initialization"""
</div>
<div class="line-context">
<span class="line-number"> 26</span>        if not isinstance(self.name, str):
</div>
<div class="line-context">
<span class="line-number"> 27</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 28</span>                f"Field name must be a string, got {type(self.name)}: {repr(self.name)}"
</div>
<div class="line-context">
<span class="line-number"> 29</span>            )
</div>
<div class="line-context">
<span class="line-number"> 30</span>        if not self.type or not isinstance(self.type, str):
</div>
<div class="line-uncovered">
<span class="line-number"> 31</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 32</span>                f"Field type must be a non-empty string, got {type(self.type)}: {repr(self.type)}"
</div>
<div class="line-context">
<span class="line-number"> 33</span>            )
</div>
<div class="line-context">
<span class="line-number"> 34</span>
</div>
<div class="line-context">
<span class="line-number"> 35</span>        # Additional validation: ensure name and type are not just whitespace
</div>
<div class="line-context">
<span class="line-number"> 36</span>        if not self.name.strip():
</div>
<div class="line-context">
<span class="line-number"> 37</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 38</span>                f"Field name cannot be empty or whitespace, got: {repr(self.name)}"
</div>
<div class="line-context">
<span class="line-number"> 39</span>            )
</div>
<div class="line-context">
<span class="line-number"> 40</span>        if not self.type.strip():
</div>
<div class="line-context">
<span class="line-number"> 41</span>            raise ValueError(
</div>
</div>
<h4>Line 37</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 27</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 28</span>                f"Field name must be a string, got {type(self.name)}: {repr(self.name)}"
</div>
<div class="line-context">
<span class="line-number"> 29</span>            )
</div>
<div class="line-context">
<span class="line-number"> 30</span>        if not self.type or not isinstance(self.type, str):
</div>
<div class="line-context">
<span class="line-number"> 31</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 32</span>                f"Field type must be a non-empty string, got {type(self.type)}: {repr(self.type)}"
</div>
<div class="line-context">
<span class="line-number"> 33</span>            )
</div>
<div class="line-context">
<span class="line-number"> 34</span>
</div>
<div class="line-context">
<span class="line-number"> 35</span>        # Additional validation: ensure name and type are not just whitespace
</div>
<div class="line-context">
<span class="line-number"> 36</span>        if not self.name.strip():
</div>
<div class="line-uncovered">
<span class="line-number"> 37</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 38</span>                f"Field name cannot be empty or whitespace, got: {repr(self.name)}"
</div>
<div class="line-context">
<span class="line-number"> 39</span>            )
</div>
<div class="line-context">
<span class="line-number"> 40</span>        if not self.type.strip():
</div>
<div class="line-context">
<span class="line-number"> 41</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 42</span>                f"Field type cannot be empty or whitespace, got: {repr(self.type)}"
</div>
<div class="line-context">
<span class="line-number"> 43</span>            )
</div>
<div class="line-context">
<span class="line-number"> 44</span>
</div>
<div class="line-context">
<span class="line-number"> 45</span>
</div>
<div class="line-context">
<span class="line-number"> 46</span># TypedefRelation class removed - tag names moved to struct/enum/union
</div>
<div class="line-context">
<span class="line-number"> 47</span>
</div>
</div>
<h4>Line 41</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 31</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 32</span>                f"Field type must be a non-empty string, got {type(self.type)}: {repr(self.type)}"
</div>
<div class="line-context">
<span class="line-number"> 33</span>            )
</div>
<div class="line-context">
<span class="line-number"> 34</span>
</div>
<div class="line-context">
<span class="line-number"> 35</span>        # Additional validation: ensure name and type are not just whitespace
</div>
<div class="line-context">
<span class="line-number"> 36</span>        if not self.name.strip():
</div>
<div class="line-context">
<span class="line-number"> 37</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 38</span>                f"Field name cannot be empty or whitespace, got: {repr(self.name)}"
</div>
<div class="line-context">
<span class="line-number"> 39</span>            )
</div>
<div class="line-context">
<span class="line-number"> 40</span>        if not self.type.strip():
</div>
<div class="line-uncovered">
<span class="line-number"> 41</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number"> 42</span>                f"Field type cannot be empty or whitespace, got: {repr(self.type)}"
</div>
<div class="line-context">
<span class="line-number"> 43</span>            )
</div>
<div class="line-context">
<span class="line-number"> 44</span>
</div>
<div class="line-context">
<span class="line-number"> 45</span>
</div>
<div class="line-context">
<span class="line-number"> 46</span># TypedefRelation class removed - tag names moved to struct/enum/union
</div>
<div class="line-context">
<span class="line-number"> 47</span>
</div>
<div class="line-context">
<span class="line-number"> 48</span>
</div>
<div class="line-context">
<span class="line-number"> 49</span>@dataclass
</div>
<div class="line-context">
<span class="line-number"> 50</span>class IncludeRelation:
</div>
<div class="line-context">
<span class="line-number"> 51</span>    """Represents an include relationship"""
</div>
</div>
<h4>Line 60</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 50</span>class IncludeRelation:
</div>
<div class="line-context">
<span class="line-number"> 51</span>    """Represents an include relationship"""
</div>
<div class="line-context">
<span class="line-number"> 52</span>
</div>
<div class="line-context">
<span class="line-number"> 53</span>    source_file: str
</div>
<div class="line-context">
<span class="line-number"> 54</span>    included_file: str
</div>
<div class="line-context">
<span class="line-number"> 55</span>    depth: int
</div>
<div class="line-context">
<span class="line-number"> 56</span>
</div>
<div class="line-context">
<span class="line-number"> 57</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number"> 58</span>        """Validate include relation data after initialization"""
</div>
<div class="line-context">
<span class="line-number"> 59</span>        if not self.source_file or not isinstance(self.source_file, str):
</div>
<div class="line-uncovered">
<span class="line-number"> 60</span>            raise ValueError("Source file must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 61</span>        if not self.included_file or not isinstance(self.included_file, str):
</div>
<div class="line-context">
<span class="line-number"> 62</span>            raise ValueError("Included file must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 63</span>        if not isinstance(self.depth, int) or self.depth < 0:
</div>
<div class="line-context">
<span class="line-number"> 64</span>            raise ValueError("Depth must be a non-negative integer")
</div>
<div class="line-context">
<span class="line-number"> 65</span>
</div>
<div class="line-context">
<span class="line-number"> 66</span>
</div>
<div class="line-context">
<span class="line-number"> 67</span>@dataclass
</div>
<div class="line-context">
<span class="line-number"> 68</span>class Function:
</div>
<div class="line-context">
<span class="line-number"> 69</span>    """Represents a function"""
</div>
<div class="line-context">
<span class="line-number"> 70</span>
</div>
</div>
<h4>Line 62</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 52</span>
</div>
<div class="line-context">
<span class="line-number"> 53</span>    source_file: str
</div>
<div class="line-context">
<span class="line-number"> 54</span>    included_file: str
</div>
<div class="line-context">
<span class="line-number"> 55</span>    depth: int
</div>
<div class="line-context">
<span class="line-number"> 56</span>
</div>
<div class="line-context">
<span class="line-number"> 57</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number"> 58</span>        """Validate include relation data after initialization"""
</div>
<div class="line-context">
<span class="line-number"> 59</span>        if not self.source_file or not isinstance(self.source_file, str):
</div>
<div class="line-context">
<span class="line-number"> 60</span>            raise ValueError("Source file must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 61</span>        if not self.included_file or not isinstance(self.included_file, str):
</div>
<div class="line-uncovered">
<span class="line-number"> 62</span>            raise ValueError("Included file must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 63</span>        if not isinstance(self.depth, int) or self.depth < 0:
</div>
<div class="line-context">
<span class="line-number"> 64</span>            raise ValueError("Depth must be a non-negative integer")
</div>
<div class="line-context">
<span class="line-number"> 65</span>
</div>
<div class="line-context">
<span class="line-number"> 66</span>
</div>
<div class="line-context">
<span class="line-number"> 67</span>@dataclass
</div>
<div class="line-context">
<span class="line-number"> 68</span>class Function:
</div>
<div class="line-context">
<span class="line-number"> 69</span>    """Represents a function"""
</div>
<div class="line-context">
<span class="line-number"> 70</span>
</div>
<div class="line-context">
<span class="line-number"> 71</span>    name: str
</div>
<div class="line-context">
<span class="line-number"> 72</span>    return_type: str
</div>
</div>
<h4>Line 64</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 54</span>    included_file: str
</div>
<div class="line-context">
<span class="line-number"> 55</span>    depth: int
</div>
<div class="line-context">
<span class="line-number"> 56</span>
</div>
<div class="line-context">
<span class="line-number"> 57</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number"> 58</span>        """Validate include relation data after initialization"""
</div>
<div class="line-context">
<span class="line-number"> 59</span>        if not self.source_file or not isinstance(self.source_file, str):
</div>
<div class="line-context">
<span class="line-number"> 60</span>            raise ValueError("Source file must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 61</span>        if not self.included_file or not isinstance(self.included_file, str):
</div>
<div class="line-context">
<span class="line-number"> 62</span>            raise ValueError("Included file must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 63</span>        if not isinstance(self.depth, int) or self.depth < 0:
</div>
<div class="line-uncovered">
<span class="line-number"> 64</span>            raise ValueError("Depth must be a non-negative integer")
</div>
<div class="line-context">
<span class="line-number"> 65</span>
</div>
<div class="line-context">
<span class="line-number"> 66</span>
</div>
<div class="line-context">
<span class="line-number"> 67</span>@dataclass
</div>
<div class="line-context">
<span class="line-number"> 68</span>class Function:
</div>
<div class="line-context">
<span class="line-number"> 69</span>    """Represents a function"""
</div>
<div class="line-context">
<span class="line-number"> 70</span>
</div>
<div class="line-context">
<span class="line-number"> 71</span>    name: str
</div>
<div class="line-context">
<span class="line-number"> 72</span>    return_type: str
</div>
<div class="line-context">
<span class="line-number"> 73</span>    parameters: List[Field] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number"> 74</span>    is_static: bool = False
</div>
</div>
<h4>Line 80</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 70</span>
</div>
<div class="line-context">
<span class="line-number"> 71</span>    name: str
</div>
<div class="line-context">
<span class="line-number"> 72</span>    return_type: str
</div>
<div class="line-context">
<span class="line-number"> 73</span>    parameters: List[Field] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number"> 74</span>    is_static: bool = False
</div>
<div class="line-context">
<span class="line-number"> 75</span>    is_declaration: bool = False
</div>
<div class="line-context">
<span class="line-number"> 76</span>
</div>
<div class="line-context">
<span class="line-number"> 77</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number"> 78</span>        """Validate function data after initialization"""
</div>
<div class="line-context">
<span class="line-number"> 79</span>        if not self.name or not isinstance(self.name, str):
</div>
<div class="line-uncovered">
<span class="line-number"> 80</span>            raise ValueError("Function name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 81</span>        if not self.return_type or not isinstance(self.return_type, str):
</div>
<div class="line-context">
<span class="line-number"> 82</span>            raise ValueError("Function return type must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 83</span>
</div>
<div class="line-context">
<span class="line-number"> 84</span>        # Convert parameters to Field objects if they're dictionaries
</div>
<div class="line-context">
<span class="line-number"> 85</span>        if self.parameters:
</div>
<div class="line-context">
<span class="line-number"> 86</span>            converted_params = []
</div>
<div class="line-context">
<span class="line-number"> 87</span>            for param in self.parameters:
</div>
<div class="line-context">
<span class="line-number"> 88</span>                if isinstance(param, dict):
</div>
<div class="line-context">
<span class="line-number"> 89</span>                    converted_params.append(Field(**param))
</div>
<div class="line-context">
<span class="line-number"> 90</span>                else:
</div>
</div>
<h4>Line 82</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 72</span>    return_type: str
</div>
<div class="line-context">
<span class="line-number"> 73</span>    parameters: List[Field] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number"> 74</span>    is_static: bool = False
</div>
<div class="line-context">
<span class="line-number"> 75</span>    is_declaration: bool = False
</div>
<div class="line-context">
<span class="line-number"> 76</span>
</div>
<div class="line-context">
<span class="line-number"> 77</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number"> 78</span>        """Validate function data after initialization"""
</div>
<div class="line-context">
<span class="line-number"> 79</span>        if not self.name or not isinstance(self.name, str):
</div>
<div class="line-context">
<span class="line-number"> 80</span>            raise ValueError("Function name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 81</span>        if not self.return_type or not isinstance(self.return_type, str):
</div>
<div class="line-uncovered">
<span class="line-number"> 82</span>            raise ValueError("Function return type must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number"> 83</span>
</div>
<div class="line-context">
<span class="line-number"> 84</span>        # Convert parameters to Field objects if they're dictionaries
</div>
<div class="line-context">
<span class="line-number"> 85</span>        if self.parameters:
</div>
<div class="line-context">
<span class="line-number"> 86</span>            converted_params = []
</div>
<div class="line-context">
<span class="line-number"> 87</span>            for param in self.parameters:
</div>
<div class="line-context">
<span class="line-number"> 88</span>                if isinstance(param, dict):
</div>
<div class="line-context">
<span class="line-number"> 89</span>                    converted_params.append(Field(**param))
</div>
<div class="line-context">
<span class="line-number"> 90</span>                else:
</div>
<div class="line-context">
<span class="line-number"> 91</span>                    converted_params.append(param)
</div>
<div class="line-context">
<span class="line-number"> 92</span>            self.parameters = converted_params
</div>
</div>
<h4>Line 110</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">100</span>    fields: List[Field] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">101</span>    methods: List[Function] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">102</span>    tag_name: str = ""  # Tag name for typedef structs
</div>
<div class="line-context">
<span class="line-number">103</span>    uses: List[str] = field(
</div>
<div class="line-context">
<span class="line-number">104</span>        default_factory=list
</div>
<div class="line-context">
<span class="line-number">105</span>    )  # Non-primitive types used by this struct
</div>
<div class="line-context">
<span class="line-number">106</span>
</div>
<div class="line-context">
<span class="line-number">107</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">108</span>        """Validate struct data after initialization"""
</div>
<div class="line-context">
<span class="line-number">109</span>        if not self.name or not isinstance(self.name, str):
</div>
<div class="line-uncovered">
<span class="line-number">110</span>            raise ValueError("Struct name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">111</span>
</div>
<div class="line-context">
<span class="line-number">112</span>
</div>
<div class="line-context">
<span class="line-number">113</span>@dataclass
</div>
<div class="line-context">
<span class="line-number">114</span>class EnumValue:
</div>
<div class="line-context">
<span class="line-number">115</span>    name: str
</div>
<div class="line-context">
<span class="line-number">116</span>    value: Optional[str] = None
</div>
<div class="line-context">
<span class="line-number">117</span>
</div>
<div class="line-context">
<span class="line-number">118</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">119</span>        if not self.name or not isinstance(self.name, str):
</div>
<div class="line-context">
<span class="line-number">120</span>            raise ValueError("Enum value name must be a non-empty string")
</div>
</div>
<h4>Line 120</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">110</span>            raise ValueError("Struct name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">111</span>
</div>
<div class="line-context">
<span class="line-number">112</span>
</div>
<div class="line-context">
<span class="line-number">113</span>@dataclass
</div>
<div class="line-context">
<span class="line-number">114</span>class EnumValue:
</div>
<div class="line-context">
<span class="line-number">115</span>    name: str
</div>
<div class="line-context">
<span class="line-number">116</span>    value: Optional[str] = None
</div>
<div class="line-context">
<span class="line-number">117</span>
</div>
<div class="line-context">
<span class="line-number">118</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">119</span>        if not self.name or not isinstance(self.name, str):
</div>
<div class="line-uncovered">
<span class="line-number">120</span>            raise ValueError("Enum value name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">121</span>
</div>
<div class="line-context">
<span class="line-number">122</span>
</div>
<div class="line-context">
<span class="line-number">123</span>@dataclass
</div>
<div class="line-context">
<span class="line-number">124</span>class Enum:
</div>
<div class="line-context">
<span class="line-number">125</span>    """Represents a C enum"""
</div>
<div class="line-context">
<span class="line-number">126</span>
</div>
<div class="line-context">
<span class="line-number">127</span>    name: str
</div>
<div class="line-context">
<span class="line-number">128</span>    values: List[EnumValue] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">129</span>    tag_name: str = ""  # Tag name for typedef enums
</div>
<div class="line-context">
<span class="line-number">130</span>
</div>
</div>
<h4>Line 133</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">123</span>@dataclass
</div>
<div class="line-context">
<span class="line-number">124</span>class Enum:
</div>
<div class="line-context">
<span class="line-number">125</span>    """Represents a C enum"""
</div>
<div class="line-context">
<span class="line-number">126</span>
</div>
<div class="line-context">
<span class="line-number">127</span>    name: str
</div>
<div class="line-context">
<span class="line-number">128</span>    values: List[EnumValue] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">129</span>    tag_name: str = ""  # Tag name for typedef enums
</div>
<div class="line-context">
<span class="line-number">130</span>
</div>
<div class="line-context">
<span class="line-number">131</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">132</span>        if not self.name or not isinstance(self.name, str):
</div>
<div class="line-uncovered">
<span class="line-number">133</span>            raise ValueError("Enum name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">134</span>        # Convert any string values to EnumValue
</div>
<div class="line-context">
<span class="line-number">135</span>        self.values = [
</div>
<div class="line-context">
<span class="line-number">136</span>            v if isinstance(v, EnumValue) else EnumValue(v) for v in self.values
</div>
<div class="line-context">
<span class="line-number">137</span>        ]
</div>
<div class="line-context">
<span class="line-number">138</span>
</div>
<div class="line-context">
<span class="line-number">139</span>
</div>
<div class="line-context">
<span class="line-number">140</span>@dataclass
</div>
<div class="line-context">
<span class="line-number">141</span>class Union:
</div>
<div class="line-context">
<span class="line-number">142</span>    """Represents a C union"""
</div>
<div class="line-context">
<span class="line-number">143</span>
</div>
</div>
<h4>Line 154</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">144</span>    name: str
</div>
<div class="line-context">
<span class="line-number">145</span>    fields: List[Field] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">146</span>    tag_name: str = ""  # Tag name for typedef unions
</div>
<div class="line-context">
<span class="line-number">147</span>    uses: List[str] = field(
</div>
<div class="line-context">
<span class="line-number">148</span>        default_factory=list
</div>
<div class="line-context">
<span class="line-number">149</span>    )  # Non-primitive types used by this union
</div>
<div class="line-context">
<span class="line-number">150</span>
</div>
<div class="line-context">
<span class="line-number">151</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">152</span>        """Validate union data after initialization"""
</div>
<div class="line-context">
<span class="line-number">153</span>        if not self.name or not isinstance(self.name, str):
</div>
<div class="line-uncovered">
<span class="line-number">154</span>            raise ValueError("Union name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">155</span>
</div>
<div class="line-context">
<span class="line-number">156</span>
</div>
<div class="line-context">
<span class="line-number">157</span>@dataclass
</div>
<div class="line-context">
<span class="line-number">158</span>class Alias:
</div>
<div class="line-context">
<span class="line-number">159</span>    """Represents a type alias (typedef)"""
</div>
<div class="line-context">
<span class="line-number">160</span>
</div>
<div class="line-context">
<span class="line-number">161</span>    name: str
</div>
<div class="line-context">
<span class="line-number">162</span>    original_type: str
</div>
<div class="line-context">
<span class="line-number">163</span>    uses: List[str] = field(
</div>
<div class="line-context">
<span class="line-number">164</span>        default_factory=list
</div>
</div>
<h4>Line 170</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">160</span>
</div>
<div class="line-context">
<span class="line-number">161</span>    name: str
</div>
<div class="line-context">
<span class="line-number">162</span>    original_type: str
</div>
<div class="line-context">
<span class="line-number">163</span>    uses: List[str] = field(
</div>
<div class="line-context">
<span class="line-number">164</span>        default_factory=list
</div>
<div class="line-context">
<span class="line-number">165</span>    )  # Non-primitive types used by this alias
</div>
<div class="line-context">
<span class="line-number">166</span>
</div>
<div class="line-context">
<span class="line-number">167</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">168</span>        """Validate alias data after initialization"""
</div>
<div class="line-context">
<span class="line-number">169</span>        if not self.name or not isinstance(self.name, str):
</div>
<div class="line-uncovered">
<span class="line-number">170</span>            raise ValueError("Alias name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">171</span>        if not self.original_type or not isinstance(self.original_type, str):
</div>
<div class="line-context">
<span class="line-number">172</span>            raise ValueError("Original type must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">173</span>
</div>
<div class="line-context">
<span class="line-number">174</span>
</div>
<div class="line-context">
<span class="line-number">175</span>@dataclass
</div>
<div class="line-context">
<span class="line-number">176</span>class FileModel:
</div>
<div class="line-context">
<span class="line-number">177</span>    """Represents a parsed C/C++ file"""
</div>
<div class="line-context">
<span class="line-number">178</span>
</div>
<div class="line-context">
<span class="line-number">179</span>    file_path: str
</div>
<div class="line-context">
<span class="line-number">180</span>    relative_path: str
</div>
</div>
<h4>Line 172</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">162</span>    original_type: str
</div>
<div class="line-context">
<span class="line-number">163</span>    uses: List[str] = field(
</div>
<div class="line-context">
<span class="line-number">164</span>        default_factory=list
</div>
<div class="line-context">
<span class="line-number">165</span>    )  # Non-primitive types used by this alias
</div>
<div class="line-context">
<span class="line-number">166</span>
</div>
<div class="line-context">
<span class="line-number">167</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">168</span>        """Validate alias data after initialization"""
</div>
<div class="line-context">
<span class="line-number">169</span>        if not self.name or not isinstance(self.name, str):
</div>
<div class="line-context">
<span class="line-number">170</span>            raise ValueError("Alias name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">171</span>        if not self.original_type or not isinstance(self.original_type, str):
</div>
<div class="line-uncovered">
<span class="line-number">172</span>            raise ValueError("Original type must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">173</span>
</div>
<div class="line-context">
<span class="line-number">174</span>
</div>
<div class="line-context">
<span class="line-number">175</span>@dataclass
</div>
<div class="line-context">
<span class="line-number">176</span>class FileModel:
</div>
<div class="line-context">
<span class="line-number">177</span>    """Represents a parsed C/C++ file"""
</div>
<div class="line-context">
<span class="line-number">178</span>
</div>
<div class="line-context">
<span class="line-number">179</span>    file_path: str
</div>
<div class="line-context">
<span class="line-number">180</span>    relative_path: str
</div>
<div class="line-context">
<span class="line-number">181</span>    project_root: str
</div>
<div class="line-context">
<span class="line-number">182</span>    encoding_used: str
</div>
</div>
<h4>Line 196</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">186</span>    globals: List[Field] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">187</span>    includes: Set[str] = field(default_factory=set)
</div>
<div class="line-context">
<span class="line-number">188</span>    macros: List[str] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">189</span>    aliases: Dict[str, Alias] = field(default_factory=dict)
</div>
<div class="line-context">
<span class="line-number">190</span>    unions: Dict[str, Union] = field(default_factory=dict)
</div>
<div class="line-context">
<span class="line-number">191</span>    include_relations: List[IncludeRelation] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">192</span>
</div>
<div class="line-context">
<span class="line-number">193</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">194</span>        """Validate file model data after initialization"""
</div>
<div class="line-context">
<span class="line-number">195</span>        if not self.file_path or not isinstance(self.file_path, str):
</div>
<div class="line-uncovered">
<span class="line-number">196</span>            raise ValueError("File path must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">197</span>        if not self.relative_path or not isinstance(self.relative_path, str):
</div>
<div class="line-context">
<span class="line-number">198</span>            raise ValueError("Relative path must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">199</span>        if not self.project_root or not isinstance(self.project_root, str):
</div>
<div class="line-context">
<span class="line-number">200</span>            raise ValueError("Project root must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">201</span>        if not self.encoding_used or not isinstance(self.encoding_used, str):
</div>
<div class="line-context">
<span class="line-number">202</span>            raise ValueError("Encoding must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">203</span>
</div>
<div class="line-context">
<span class="line-number">204</span>    def to_dict(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">205</span>        """Convert to dictionary for JSON serialization"""
</div>
<div class="line-context">
<span class="line-number">206</span>        data = asdict(self)
</div>
</div>
<h4>Line 198</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">188</span>    macros: List[str] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">189</span>    aliases: Dict[str, Alias] = field(default_factory=dict)
</div>
<div class="line-context">
<span class="line-number">190</span>    unions: Dict[str, Union] = field(default_factory=dict)
</div>
<div class="line-context">
<span class="line-number">191</span>    include_relations: List[IncludeRelation] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">192</span>
</div>
<div class="line-context">
<span class="line-number">193</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">194</span>        """Validate file model data after initialization"""
</div>
<div class="line-context">
<span class="line-number">195</span>        if not self.file_path or not isinstance(self.file_path, str):
</div>
<div class="line-context">
<span class="line-number">196</span>            raise ValueError("File path must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">197</span>        if not self.relative_path or not isinstance(self.relative_path, str):
</div>
<div class="line-uncovered">
<span class="line-number">198</span>            raise ValueError("Relative path must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">199</span>        if not self.project_root or not isinstance(self.project_root, str):
</div>
<div class="line-context">
<span class="line-number">200</span>            raise ValueError("Project root must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">201</span>        if not self.encoding_used or not isinstance(self.encoding_used, str):
</div>
<div class="line-context">
<span class="line-number">202</span>            raise ValueError("Encoding must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">203</span>
</div>
<div class="line-context">
<span class="line-number">204</span>    def to_dict(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">205</span>        """Convert to dictionary for JSON serialization"""
</div>
<div class="line-context">
<span class="line-number">206</span>        data = asdict(self)
</div>
<div class="line-context">
<span class="line-number">207</span>        # Convert set to list for JSON serialization and sort for consistency
</div>
<div class="line-context">
<span class="line-number">208</span>        data["includes"] = sorted(list(self.includes))
</div>
</div>
<h4>Line 200</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">190</span>    unions: Dict[str, Union] = field(default_factory=dict)
</div>
<div class="line-context">
<span class="line-number">191</span>    include_relations: List[IncludeRelation] = field(default_factory=list)
</div>
<div class="line-context">
<span class="line-number">192</span>
</div>
<div class="line-context">
<span class="line-number">193</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">194</span>        """Validate file model data after initialization"""
</div>
<div class="line-context">
<span class="line-number">195</span>        if not self.file_path or not isinstance(self.file_path, str):
</div>
<div class="line-context">
<span class="line-number">196</span>            raise ValueError("File path must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">197</span>        if not self.relative_path or not isinstance(self.relative_path, str):
</div>
<div class="line-context">
<span class="line-number">198</span>            raise ValueError("Relative path must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">199</span>        if not self.project_root or not isinstance(self.project_root, str):
</div>
<div class="line-uncovered">
<span class="line-number">200</span>            raise ValueError("Project root must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">201</span>        if not self.encoding_used or not isinstance(self.encoding_used, str):
</div>
<div class="line-context">
<span class="line-number">202</span>            raise ValueError("Encoding must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">203</span>
</div>
<div class="line-context">
<span class="line-number">204</span>    def to_dict(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">205</span>        """Convert to dictionary for JSON serialization"""
</div>
<div class="line-context">
<span class="line-number">206</span>        data = asdict(self)
</div>
<div class="line-context">
<span class="line-number">207</span>        # Convert set to list for JSON serialization and sort for consistency
</div>
<div class="line-context">
<span class="line-number">208</span>        data["includes"] = sorted(list(self.includes))
</div>
<div class="line-context">
<span class="line-number">209</span>        # Convert include_relations to list of dicts and sort for consistency
</div>
<div class="line-context">
<span class="line-number">210</span>        data["include_relations"] = sorted(
</div>
</div>
<h4>Line 202</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">192</span>
</div>
<div class="line-context">
<span class="line-number">193</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">194</span>        """Validate file model data after initialization"""
</div>
<div class="line-context">
<span class="line-number">195</span>        if not self.file_path or not isinstance(self.file_path, str):
</div>
<div class="line-context">
<span class="line-number">196</span>            raise ValueError("File path must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">197</span>        if not self.relative_path or not isinstance(self.relative_path, str):
</div>
<div class="line-context">
<span class="line-number">198</span>            raise ValueError("Relative path must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">199</span>        if not self.project_root or not isinstance(self.project_root, str):
</div>
<div class="line-context">
<span class="line-number">200</span>            raise ValueError("Project root must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">201</span>        if not self.encoding_used or not isinstance(self.encoding_used, str):
</div>
<div class="line-uncovered">
<span class="line-number">202</span>            raise ValueError("Encoding must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">203</span>
</div>
<div class="line-context">
<span class="line-number">204</span>    def to_dict(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">205</span>        """Convert to dictionary for JSON serialization"""
</div>
<div class="line-context">
<span class="line-number">206</span>        data = asdict(self)
</div>
<div class="line-context">
<span class="line-number">207</span>        # Convert set to list for JSON serialization and sort for consistency
</div>
<div class="line-context">
<span class="line-number">208</span>        data["includes"] = sorted(list(self.includes))
</div>
<div class="line-context">
<span class="line-number">209</span>        # Convert include_relations to list of dicts and sort for consistency
</div>
<div class="line-context">
<span class="line-number">210</span>        data["include_relations"] = sorted(
</div>
<div class="line-context">
<span class="line-number">211</span>            [asdict(rel) for rel in self.include_relations],
</div>
<div class="line-context">
<span class="line-number">212</span>            key=lambda x: (x["source_file"], x["included_file"]),
</div>
</div>
<h4>Line 278</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">268</span>                    for method in struct_data.get("methods", [])
</div>
<div class="line-context">
<span class="line-number">269</span>                ]
</div>
<div class="line-context">
<span class="line-number">270</span>                structs[name] = Struct(
</div>
<div class="line-context">
<span class="line-number">271</span>                    name=struct_data.get("name", name),
</div>
<div class="line-context">
<span class="line-number">272</span>                    fields=fields,
</div>
<div class="line-context">
<span class="line-number">273</span>                    methods=methods,
</div>
<div class="line-context">
<span class="line-number">274</span>                    tag_name=struct_data.get("tag_name", ""),
</div>
<div class="line-context">
<span class="line-number">275</span>                    uses=struct_data.get("uses", []),
</div>
<div class="line-context">
<span class="line-number">276</span>                )
</div>
<div class="line-context">
<span class="line-number">277</span>            else:
</div>
<div class="line-uncovered">
<span class="line-number">278</span>                structs[name] = struct_data
</div>
<div class="line-context">
<span class="line-number">279</span>
</div>
<div class="line-context">
<span class="line-number">280</span>        # Convert enums back to Enum objects
</div>
<div class="line-context">
<span class="line-number">281</span>        enums_data = data.get("enums", {})
</div>
<div class="line-context">
<span class="line-number">282</span>        enums = {}
</div>
<div class="line-context">
<span class="line-number">283</span>        for name, enum_data in enums_data.items():
</div>
<div class="line-context">
<span class="line-number">284</span>            if isinstance(enum_data, dict):
</div>
<div class="line-context">
<span class="line-number">285</span>                values = [
</div>
<div class="line-context">
<span class="line-number">286</span>                    EnumValue(**val) if isinstance(val, dict) else EnumValue(val)
</div>
<div class="line-context">
<span class="line-number">287</span>                    for val in enum_data.get("values", [])
</div>
<div class="line-context">
<span class="line-number">288</span>                ]
</div>
</div>
<h4>Line 291</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">281</span>        enums_data = data.get("enums", {})
</div>
<div class="line-context">
<span class="line-number">282</span>        enums = {}
</div>
<div class="line-context">
<span class="line-number">283</span>        for name, enum_data in enums_data.items():
</div>
<div class="line-context">
<span class="line-number">284</span>            if isinstance(enum_data, dict):
</div>
<div class="line-context">
<span class="line-number">285</span>                values = [
</div>
<div class="line-context">
<span class="line-number">286</span>                    EnumValue(**val) if isinstance(val, dict) else EnumValue(val)
</div>
<div class="line-context">
<span class="line-number">287</span>                    for val in enum_data.get("values", [])
</div>
<div class="line-context">
<span class="line-number">288</span>                ]
</div>
<div class="line-context">
<span class="line-number">289</span>                enums[name] = Enum(name=enum_data.get("name", name), values=values)
</div>
<div class="line-context">
<span class="line-number">290</span>            else:
</div>
<div class="line-uncovered">
<span class="line-number">291</span>                enums[name] = enum_data
</div>
<div class="line-context">
<span class="line-number">292</span>
</div>
<div class="line-context">
<span class="line-number">293</span>        # typedef_relations removed - tag names are now in struct/enum/union
</div>
<div class="line-context">
<span class="line-number">294</span>
</div>
<div class="line-context">
<span class="line-number">295</span>        # Convert include_relations back to IncludeRelation objects
</div>
<div class="line-context">
<span class="line-number">296</span>        include_relations_data = data.get("include_relations", [])
</div>
<div class="line-context">
<span class="line-number">297</span>        include_relations = [
</div>
<div class="line-context">
<span class="line-number">298</span>            IncludeRelation(**rel) if isinstance(rel, dict) else rel
</div>
<div class="line-context">
<span class="line-number">299</span>            for rel in include_relations_data
</div>
<div class="line-context">
<span class="line-number">300</span>        ]
</div>
<div class="line-context">
<span class="line-number">301</span>
</div>
</div>
<h4>Line 318</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">308</span>                    Field(**field) if isinstance(field, dict) else field
</div>
<div class="line-context">
<span class="line-number">309</span>                    for field in union_data.get("fields", [])
</div>
<div class="line-context">
<span class="line-number">310</span>                ]
</div>
<div class="line-context">
<span class="line-number">311</span>                unions[name] = Union(
</div>
<div class="line-context">
<span class="line-number">312</span>                    name=union_data.get("name", name),
</div>
<div class="line-context">
<span class="line-number">313</span>                    fields=fields,
</div>
<div class="line-context">
<span class="line-number">314</span>                    tag_name=union_data.get("tag_name", ""),
</div>
<div class="line-context">
<span class="line-number">315</span>                    uses=union_data.get("uses", []),
</div>
<div class="line-context">
<span class="line-number">316</span>                )
</div>
<div class="line-context">
<span class="line-number">317</span>            else:
</div>
<div class="line-uncovered">
<span class="line-number">318</span>                unions[name] = union_data
</div>
<div class="line-context">
<span class="line-number">319</span>
</div>
<div class="line-context">
<span class="line-number">320</span>        # Convert aliases back to Alias objects
</div>
<div class="line-context">
<span class="line-number">321</span>        aliases_data = data.get("aliases", {})
</div>
<div class="line-context">
<span class="line-number">322</span>        aliases = {}
</div>
<div class="line-context">
<span class="line-number">323</span>        for name, alias_data in aliases_data.items():
</div>
<div class="line-context">
<span class="line-number">324</span>            if isinstance(alias_data, dict):
</div>
<div class="line-context">
<span class="line-number">325</span>                aliases[name] = Alias(
</div>
<div class="line-context">
<span class="line-number">326</span>                    name=alias_data.get("name", name),
</div>
<div class="line-context">
<span class="line-number">327</span>                    original_type=alias_data.get("original_type", ""),
</div>
<div class="line-context">
<span class="line-number">328</span>                    uses=alias_data.get("uses", []),
</div>
</div>
<h4>Line 332</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">322</span>        aliases = {}
</div>
<div class="line-context">
<span class="line-number">323</span>        for name, alias_data in aliases_data.items():
</div>
<div class="line-context">
<span class="line-number">324</span>            if isinstance(alias_data, dict):
</div>
<div class="line-context">
<span class="line-number">325</span>                aliases[name] = Alias(
</div>
<div class="line-context">
<span class="line-number">326</span>                    name=alias_data.get("name", name),
</div>
<div class="line-context">
<span class="line-number">327</span>                    original_type=alias_data.get("original_type", ""),
</div>
<div class="line-context">
<span class="line-number">328</span>                    uses=alias_data.get("uses", []),
</div>
<div class="line-context">
<span class="line-number">329</span>                )
</div>
<div class="line-context">
<span class="line-number">330</span>            else:
</div>
<div class="line-context">
<span class="line-number">331</span>                # Handle legacy format where aliases was Dict[str, str]
</div>
<div class="line-uncovered">
<span class="line-number">332</span>                aliases[name] = Alias(name=name, original_type=alias_data, uses=[])
</div>
<div class="line-context">
<span class="line-number">333</span>
</div>
<div class="line-context">
<span class="line-number">334</span>        # Create new data dict with converted objects
</div>
<div class="line-context">
<span class="line-number">335</span>        new_data = data.copy()
</div>
<div class="line-context">
<span class="line-number">336</span>        new_data["includes"] = includes
</div>
<div class="line-context">
<span class="line-number">337</span>        new_data["globals"] = globals
</div>
<div class="line-context">
<span class="line-number">338</span>        new_data["functions"] = functions
</div>
<div class="line-context">
<span class="line-number">339</span>        new_data["structs"] = structs
</div>
<div class="line-context">
<span class="line-number">340</span>        new_data["enums"] = enums
</div>
<div class="line-context">
<span class="line-number">341</span>        new_data["unions"] = unions
</div>
<div class="line-context">
<span class="line-number">342</span>        new_data["aliases"] = aliases
</div>
</div>
<h4>Line 349</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">339</span>        new_data["structs"] = structs
</div>
<div class="line-context">
<span class="line-number">340</span>        new_data["enums"] = enums
</div>
<div class="line-context">
<span class="line-number">341</span>        new_data["unions"] = unions
</div>
<div class="line-context">
<span class="line-number">342</span>        new_data["aliases"] = aliases
</div>
<div class="line-context">
<span class="line-number">343</span>        new_data["include_relations"] = include_relations
</div>
<div class="line-context">
<span class="line-number">344</span>
</div>
<div class="line-context">
<span class="line-number">345</span>        return cls(**new_data)
</div>
<div class="line-context">
<span class="line-number">346</span>
</div>
<div class="line-context">
<span class="line-number">347</span>    def get_summary(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">348</span>        """Get a summary of the file contents"""
</div>
<div class="line-uncovered">
<span class="line-number">349</span>        return {
</div>
<div class="line-context">
<span class="line-number">350</span>            "file_path": self.file_path,
</div>
<div class="line-context">
<span class="line-number">351</span>            "structs_count": len(self.structs),
</div>
<div class="line-context">
<span class="line-number">352</span>            "enums_count": len(self.enums),
</div>
<div class="line-context">
<span class="line-number">353</span>            "functions_count": len(self.functions),
</div>
<div class="line-context">
<span class="line-number">354</span>            "globals_count": len(self.globals),
</div>
<div class="line-context">
<span class="line-number">355</span>            "includes_count": len(self.includes),
</div>
<div class="line-context">
<span class="line-number">356</span>            "macros_count": len(self.macros),
</div>
<div class="line-context">
<span class="line-number">357</span>            "aliases_count": len(self.aliases),
</div>
<div class="line-context">
<span class="line-number">358</span>        }
</div>
<div class="line-context">
<span class="line-number">359</span>
</div>
</div>
<h4>Line 372</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">362</span>class ProjectModel:
</div>
<div class="line-context">
<span class="line-number">363</span>    """Represents a complete C/C++ project"""
</div>
<div class="line-context">
<span class="line-number">364</span>
</div>
<div class="line-context">
<span class="line-number">365</span>    project_name: str
</div>
<div class="line-context">
<span class="line-number">366</span>    project_root: str
</div>
<div class="line-context">
<span class="line-number">367</span>    files: Dict[str, FileModel] = field(default_factory=dict)
</div>
<div class="line-context">
<span class="line-number">368</span>
</div>
<div class="line-context">
<span class="line-number">369</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">370</span>        """Validate project model data after initialization"""
</div>
<div class="line-context">
<span class="line-number">371</span>        if not self.project_name or not isinstance(self.project_name, str):
</div>
<div class="line-uncovered">
<span class="line-number">372</span>            raise ValueError("Project name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">373</span>        if not self.project_root or not isinstance(self.project_root, str):
</div>
<div class="line-context">
<span class="line-number">374</span>            raise ValueError("Project root must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">375</span>
</div>
<div class="line-context">
<span class="line-number">376</span>    def save(self, file_path: str) -> None:
</div>
<div class="line-context">
<span class="line-number">377</span>        """Save model to JSON file"""
</div>
<div class="line-context">
<span class="line-number">378</span>        data = {
</div>
<div class="line-context">
<span class="line-number">379</span>            "project_name": self.project_name,
</div>
<div class="line-context">
<span class="line-number">380</span>            "project_root": self.project_root,
</div>
<div class="line-context">
<span class="line-number">381</span>            "files": {
</div>
<div class="line-context">
<span class="line-number">382</span>                path: file_model.to_dict()
</div>
</div>
<h4>Line 374</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">364</span>
</div>
<div class="line-context">
<span class="line-number">365</span>    project_name: str
</div>
<div class="line-context">
<span class="line-number">366</span>    project_root: str
</div>
<div class="line-context">
<span class="line-number">367</span>    files: Dict[str, FileModel] = field(default_factory=dict)
</div>
<div class="line-context">
<span class="line-number">368</span>
</div>
<div class="line-context">
<span class="line-number">369</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">370</span>        """Validate project model data after initialization"""
</div>
<div class="line-context">
<span class="line-number">371</span>        if not self.project_name or not isinstance(self.project_name, str):
</div>
<div class="line-context">
<span class="line-number">372</span>            raise ValueError("Project name must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">373</span>        if not self.project_root or not isinstance(self.project_root, str):
</div>
<div class="line-uncovered">
<span class="line-number">374</span>            raise ValueError("Project root must be a non-empty string")
</div>
<div class="line-context">
<span class="line-number">375</span>
</div>
<div class="line-context">
<span class="line-number">376</span>    def save(self, file_path: str) -> None:
</div>
<div class="line-context">
<span class="line-number">377</span>        """Save model to JSON file"""
</div>
<div class="line-context">
<span class="line-number">378</span>        data = {
</div>
<div class="line-context">
<span class="line-number">379</span>            "project_name": self.project_name,
</div>
<div class="line-context">
<span class="line-number">380</span>            "project_root": self.project_root,
</div>
<div class="line-context">
<span class="line-number">381</span>            "files": {
</div>
<div class="line-context">
<span class="line-number">382</span>                path: file_model.to_dict()
</div>
<div class="line-context">
<span class="line-number">383</span>                for path, file_model in sorted(self.files.items())
</div>
<div class="line-context">
<span class="line-number">384</span>            },
</div>
</div>
<h4>Lines 390-391</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">380</span>            "project_root": self.project_root,
</div>
<div class="line-context">
<span class="line-number">381</span>            "files": {
</div>
<div class="line-context">
<span class="line-number">382</span>                path: file_model.to_dict()
</div>
<div class="line-context">
<span class="line-number">383</span>                for path, file_model in sorted(self.files.items())
</div>
<div class="line-context">
<span class="line-number">384</span>            },
</div>
<div class="line-context">
<span class="line-number">385</span>        }
</div>
<div class="line-context">
<span class="line-number">386</span>
</div>
<div class="line-context">
<span class="line-number">387</span>        try:
</div>
<div class="line-context">
<span class="line-number">388</span>            with open(file_path, "w", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number">389</span>                json.dump(data, f, indent=2, ensure_ascii=False, sort_keys=True)
</div>
<div class="line-uncovered">
<span class="line-number">390</span>        except Exception as e:
</div>
<div class="line-uncovered">
<span class="line-number">391</span>            raise ValueError(f"Failed to save model to {file_path}: {e}") from e
</div>
<div class="line-context">
<span class="line-number">392</span>
</div>
<div class="line-context">
<span class="line-number">393</span>    @classmethod
</div>
<div class="line-context">
<span class="line-number">394</span>    def from_dict(cls, data: dict) -> "ProjectModel":
</div>
<div class="line-context">
<span class="line-number">395</span>        """Create from dictionary"""
</div>
<div class="line-context">
<span class="line-number">396</span>        files = {
</div>
<div class="line-context">
<span class="line-number">397</span>            path: FileModel.from_dict(file_data)
</div>
<div class="line-context">
<span class="line-number">398</span>            for path, file_data in data.get("files", {}).items()
</div>
<div class="line-context">
<span class="line-number">399</span>        }
</div>
<div class="line-context">
<span class="line-number">400</span>
</div>
<div class="line-context">
<span class="line-number">401</span>        return cls(
</div>
</div>
<h4>Lines 414-415</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">404</span>            files=files,
</div>
<div class="line-context">
<span class="line-number">405</span>        )
</div>
<div class="line-context">
<span class="line-number">406</span>
</div>
<div class="line-context">
<span class="line-number">407</span>    @classmethod
</div>
<div class="line-context">
<span class="line-number">408</span>    def load(cls, file_path: str) -> "ProjectModel":
</div>
<div class="line-context">
<span class="line-number">409</span>        """Load model from JSON file"""
</div>
<div class="line-context">
<span class="line-number">410</span>        try:
</div>
<div class="line-context">
<span class="line-number">411</span>            with open(file_path, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number">412</span>                data = json.load(f)
</div>
<div class="line-context">
<span class="line-number">413</span>            return cls.from_dict(data)
</div>
<div class="line-uncovered">
<span class="line-number">414</span>        except Exception as e:
</div>
<div class="line-uncovered">
<span class="line-number">415</span>            raise ValueError(f"Failed to load model from {file_path}: {e}") from e
</div>
<div class="line-context">
<span class="line-number">416</span>
</div>
<div class="line-context">
<span class="line-number">417</span>    def get_summary(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">418</span>        """Get a summary of the project"""
</div>
<div class="line-context">
<span class="line-number">419</span>        total_structs = sum(len(f.structs) for f in self.files.values())
</div>
<div class="line-context">
<span class="line-number">420</span>        total_enums = sum(len(f.enums) for f in self.files.values())
</div>
<div class="line-context">
<span class="line-number">421</span>        total_functions = sum(len(f.functions) for f in self.files.values())
</div>
<div class="line-context">
<span class="line-number">422</span>        total_globals = sum(len(f.globals) for f in self.files.values())
</div>
<div class="line-context">
<span class="line-number">423</span>
</div>
<div class="line-context">
<span class="line-number">424</span>        return {
</div>
<div class="line-context">
<span class="line-number">425</span>            "project_name": self.project_name,
</div>
</div>
<h4>Lines 419-422</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">409</span>        """Load model from JSON file"""
</div>
<div class="line-context">
<span class="line-number">410</span>        try:
</div>
<div class="line-context">
<span class="line-number">411</span>            with open(file_path, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number">412</span>                data = json.load(f)
</div>
<div class="line-context">
<span class="line-number">413</span>            return cls.from_dict(data)
</div>
<div class="line-context">
<span class="line-number">414</span>        except Exception as e:
</div>
<div class="line-context">
<span class="line-number">415</span>            raise ValueError(f"Failed to load model from {file_path}: {e}") from e
</div>
<div class="line-context">
<span class="line-number">416</span>
</div>
<div class="line-context">
<span class="line-number">417</span>    def get_summary(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">418</span>        """Get a summary of the project"""
</div>
<div class="line-uncovered">
<span class="line-number">419</span>        total_structs = sum(len(f.structs) for f in self.files.values())
</div>
<div class="line-uncovered">
<span class="line-number">420</span>        total_enums = sum(len(f.enums) for f in self.files.values())
</div>
<div class="line-uncovered">
<span class="line-number">421</span>        total_functions = sum(len(f.functions) for f in self.files.values())
</div>
<div class="line-uncovered">
<span class="line-number">422</span>        total_globals = sum(len(f.globals) for f in self.files.values())
</div>
<div class="line-context">
<span class="line-number">423</span>
</div>
<div class="line-context">
<span class="line-number">424</span>        return {
</div>
<div class="line-context">
<span class="line-number">425</span>            "project_name": self.project_name,
</div>
<div class="line-context">
<span class="line-number">426</span>            "project_root": self.project_root,
</div>
<div class="line-context">
<span class="line-number">427</span>            "files_count": len(self.files),
</div>
<div class="line-context">
<span class="line-number">428</span>            "total_structs": total_structs,
</div>
<div class="line-context">
<span class="line-number">429</span>            "total_enums": total_enums,
</div>
<div class="line-context">
<span class="line-number">430</span>            "total_functions": total_functions,
</div>
<div class="line-context">
<span class="line-number">431</span>            "total_globals": total_globals,
</div>
<div class="line-context">
<span class="line-number">432</span>        }
</div>
</div>
<h4>Line 424</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">414</span>        except Exception as e:
</div>
<div class="line-context">
<span class="line-number">415</span>            raise ValueError(f"Failed to load model from {file_path}: {e}") from e
</div>
<div class="line-context">
<span class="line-number">416</span>
</div>
<div class="line-context">
<span class="line-number">417</span>    def get_summary(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">418</span>        """Get a summary of the project"""
</div>
<div class="line-context">
<span class="line-number">419</span>        total_structs = sum(len(f.structs) for f in self.files.values())
</div>
<div class="line-context">
<span class="line-number">420</span>        total_enums = sum(len(f.enums) for f in self.files.values())
</div>
<div class="line-context">
<span class="line-number">421</span>        total_functions = sum(len(f.functions) for f in self.files.values())
</div>
<div class="line-context">
<span class="line-number">422</span>        total_globals = sum(len(f.globals) for f in self.files.values())
</div>
<div class="line-context">
<span class="line-number">423</span>
</div>
<div class="line-uncovered">
<span class="line-number">424</span>        return {
</div>
<div class="line-context">
<span class="line-number">425</span>            "project_name": self.project_name,
</div>
<div class="line-context">
<span class="line-number">426</span>            "project_root": self.project_root,
</div>
<div class="line-context">
<span class="line-number">427</span>            "files_count": len(self.files),
</div>
<div class="line-context">
<span class="line-number">428</span>            "total_structs": total_structs,
</div>
<div class="line-context">
<span class="line-number">429</span>            "total_enums": total_enums,
</div>
<div class="line-context">
<span class="line-number">430</span>            "total_functions": total_functions,
</div>
<div class="line-context">
<span class="line-number">431</span>            "total_globals": total_globals,
</div>
<div class="line-context">
<span class="line-number">432</span>        }
</div>
<div class="line-context">
<span class="line-number">433</span>
</div>
<div class="line-context">
<span class="line-number">434</span>    def update_uses_fields(self):
</div>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/utils.py
<span class="coverage-info">61.19% (41/67 lines covered)</span>
</div>
<h4>Line 13</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">  3</span>Utility functions for C to PlantUML converter
</div>
<div class="line-context">
<span class="line-number">  4</span>"""
</div>
<div class="line-context">
<span class="line-number">  5</span>
</div>
<div class="line-context">
<span class="line-number">  6</span>import logging
</div>
<div class="line-context">
<span class="line-number">  7</span>from pathlib import Path
</div>
<div class="line-context">
<span class="line-number">  8</span>from typing import Dict, Optional
</div>
<div class="line-context">
<span class="line-number">  9</span>
</div>
<div class="line-context">
<span class="line-number"> 10</span># Try to import chardet, fallback to basic encoding detection if not available
</div>
<div class="line-context">
<span class="line-number"> 11</span>try:
</div>
<div class="line-context">
<span class="line-number"> 12</span>    import chardet
</div>
<div class="line-uncovered">
<span class="line-number"> 13</span>    CHARDET_AVAILABLE = True
</div>
<div class="line-context">
<span class="line-number"> 14</span>except ImportError:
</div>
<div class="line-context">
<span class="line-number"> 15</span>    CHARDET_AVAILABLE = False
</div>
<div class="line-context">
<span class="line-number"> 16</span>
</div>
<div class="line-context">
<span class="line-number"> 17</span>
</div>
<div class="line-context">
<span class="line-number"> 18</span>def detect_file_encoding(file_path: Path) -> str:
</div>
<div class="line-context">
<span class="line-number"> 19</span>    """Detect file encoding with platform-aware fallbacks"""
</div>
<div class="line-context">
<span class="line-number"> 20</span>    try:
</div>
<div class="line-context">
<span class="line-number"> 21</span>        if CHARDET_AVAILABLE:
</div>
<div class="line-context">
<span class="line-number"> 22</span>            # Try to detect encoding with chardet
</div>
<div class="line-context">
<span class="line-number"> 23</span>            with open(file_path, "rb") as f:
</div>
</div>
<h4>Lines 23-28</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 13</span>    CHARDET_AVAILABLE = True
</div>
<div class="line-context">
<span class="line-number"> 14</span>except ImportError:
</div>
<div class="line-context">
<span class="line-number"> 15</span>    CHARDET_AVAILABLE = False
</div>
<div class="line-context">
<span class="line-number"> 16</span>
</div>
<div class="line-context">
<span class="line-number"> 17</span>
</div>
<div class="line-context">
<span class="line-number"> 18</span>def detect_file_encoding(file_path: Path) -> str:
</div>
<div class="line-context">
<span class="line-number"> 19</span>    """Detect file encoding with platform-aware fallbacks"""
</div>
<div class="line-context">
<span class="line-number"> 20</span>    try:
</div>
<div class="line-context">
<span class="line-number"> 21</span>        if CHARDET_AVAILABLE:
</div>
<div class="line-context">
<span class="line-number"> 22</span>            # Try to detect encoding with chardet
</div>
<div class="line-uncovered">
<span class="line-number"> 23</span>            with open(file_path, "rb") as f:
</div>
<div class="line-uncovered">
<span class="line-number"> 24</span>                raw_data = f.read(1024)  # Read first 1KB for detection
</div>
<div class="line-uncovered">
<span class="line-number"> 25</span>                if raw_data:
</div>
<div class="line-uncovered">
<span class="line-number"> 26</span>                    result = chardet.detect(raw_data)
</div>
<div class="line-uncovered">
<span class="line-number"> 27</span>                    if result and result["confidence"] > 0.7:
</div>
<div class="line-uncovered">
<span class="line-number"> 28</span>                        return result["encoding"]
</div>
<div class="line-context">
<span class="line-number"> 29</span>
</div>
<div class="line-context">
<span class="line-number"> 30</span>        # Fallback encodings in order of preference
</div>
<div class="line-context">
<span class="line-number"> 31</span>        fallback_encodings = ["utf-8", "latin-1", "cp1252", "iso-8859-1"]
</div>
<div class="line-context">
<span class="line-number"> 32</span>
</div>
<div class="line-context">
<span class="line-number"> 33</span>        for encoding in fallback_encodings:
</div>
<div class="line-context">
<span class="line-number"> 34</span>            try:
</div>
<div class="line-context">
<span class="line-number"> 35</span>                with open(file_path, "r", encoding=encoding) as f:
</div>
<div class="line-context">
<span class="line-number"> 36</span>                    f.read(1024)  # Test read
</div>
<div class="line-context">
<span class="line-number"> 37</span>                return encoding
</div>
<div class="line-context">
<span class="line-number"> 38</span>            except (UnicodeDecodeError, UnicodeError):
</div>
</div>
<h4>Line 39</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 29</span>
</div>
<div class="line-context">
<span class="line-number"> 30</span>        # Fallback encodings in order of preference
</div>
<div class="line-context">
<span class="line-number"> 31</span>        fallback_encodings = ["utf-8", "latin-1", "cp1252", "iso-8859-1"]
</div>
<div class="line-context">
<span class="line-number"> 32</span>
</div>
<div class="line-context">
<span class="line-number"> 33</span>        for encoding in fallback_encodings:
</div>
<div class="line-context">
<span class="line-number"> 34</span>            try:
</div>
<div class="line-context">
<span class="line-number"> 35</span>                with open(file_path, "r", encoding=encoding) as f:
</div>
<div class="line-context">
<span class="line-number"> 36</span>                    f.read(1024)  # Test read
</div>
<div class="line-context">
<span class="line-number"> 37</span>                return encoding
</div>
<div class="line-context">
<span class="line-number"> 38</span>            except (UnicodeDecodeError, UnicodeError):
</div>
<div class="line-uncovered">
<span class="line-number"> 39</span>                continue
</div>
<div class="line-context">
<span class="line-number"> 40</span>
</div>
<div class="line-context">
<span class="line-number"> 41</span>        # Final fallback
</div>
<div class="line-context">
<span class="line-number"> 42</span>        return "utf-8"
</div>
<div class="line-context">
<span class="line-number"> 43</span>
</div>
<div class="line-context">
<span class="line-number"> 44</span>    except Exception as e:
</div>
<div class="line-context">
<span class="line-number"> 45</span>        logging.warning(f"Failed to detect encoding for {file_path}: {e}")
</div>
<div class="line-context">
<span class="line-number"> 46</span>        return "utf-8"
</div>
<div class="line-context">
<span class="line-number"> 47</span>
</div>
<div class="line-context">
<span class="line-number"> 48</span>
</div>
<div class="line-context">
<span class="line-number"> 49</span>def get_filename_from_path(file_path: str) -> str:
</div>
</div>
<h4>Line 42</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 32</span>
</div>
<div class="line-context">
<span class="line-number"> 33</span>        for encoding in fallback_encodings:
</div>
<div class="line-context">
<span class="line-number"> 34</span>            try:
</div>
<div class="line-context">
<span class="line-number"> 35</span>                with open(file_path, "r", encoding=encoding) as f:
</div>
<div class="line-context">
<span class="line-number"> 36</span>                    f.read(1024)  # Test read
</div>
<div class="line-context">
<span class="line-number"> 37</span>                return encoding
</div>
<div class="line-context">
<span class="line-number"> 38</span>            except (UnicodeDecodeError, UnicodeError):
</div>
<div class="line-context">
<span class="line-number"> 39</span>                continue
</div>
<div class="line-context">
<span class="line-number"> 40</span>
</div>
<div class="line-context">
<span class="line-number"> 41</span>        # Final fallback
</div>
<div class="line-uncovered">
<span class="line-number"> 42</span>        return "utf-8"
</div>
<div class="line-context">
<span class="line-number"> 43</span>
</div>
<div class="line-context">
<span class="line-number"> 44</span>    except Exception as e:
</div>
<div class="line-context">
<span class="line-number"> 45</span>        logging.warning(f"Failed to detect encoding for {file_path}: {e}")
</div>
<div class="line-context">
<span class="line-number"> 46</span>        return "utf-8"
</div>
<div class="line-context">
<span class="line-number"> 47</span>
</div>
<div class="line-context">
<span class="line-number"> 48</span>
</div>
<div class="line-context">
<span class="line-number"> 49</span>def get_filename_from_path(file_path: str) -> str:
</div>
<div class="line-context">
<span class="line-number"> 50</span>    """Extract filename from a file path (handles both absolute and relative paths)"""
</div>
<div class="line-context">
<span class="line-number"> 51</span>    return Path(file_path).name
</div>
<div class="line-context">
<span class="line-number"> 52</span>
</div>
</div>
<h4>Line 51</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 41</span>        # Final fallback
</div>
<div class="line-context">
<span class="line-number"> 42</span>        return "utf-8"
</div>
<div class="line-context">
<span class="line-number"> 43</span>
</div>
<div class="line-context">
<span class="line-number"> 44</span>    except Exception as e:
</div>
<div class="line-context">
<span class="line-number"> 45</span>        logging.warning(f"Failed to detect encoding for {file_path}: {e}")
</div>
<div class="line-context">
<span class="line-number"> 46</span>        return "utf-8"
</div>
<div class="line-context">
<span class="line-number"> 47</span>
</div>
<div class="line-context">
<span class="line-number"> 48</span>
</div>
<div class="line-context">
<span class="line-number"> 49</span>def get_filename_from_path(file_path: str) -> str:
</div>
<div class="line-context">
<span class="line-number"> 50</span>    """Extract filename from a file path (handles both absolute and relative paths)"""
</div>
<div class="line-uncovered">
<span class="line-number"> 51</span>    return Path(file_path).name
</div>
<div class="line-context">
<span class="line-number"> 52</span>
</div>
<div class="line-context">
<span class="line-number"> 53</span>
</div>
<div class="line-context">
<span class="line-number"> 54</span>def find_file_by_filename(filename: str, file_dict: Dict[str, any]) -> Optional[str]:
</div>
<div class="line-context">
<span class="line-number"> 55</span>    """
</div>
<div class="line-context">
<span class="line-number"> 56</span>    Find a file in a dictionary by matching its filename.
</div>
<div class="line-context">
<span class="line-number"> 57</span>
</div>
<div class="line-context">
<span class="line-number"> 58</span>    Args:
</div>
<div class="line-context">
<span class="line-number"> 59</span>        filename: The filename to search for (e.g., "header.h")
</div>
<div class="line-context">
<span class="line-number"> 60</span>        file_dict: Dictionary with file paths as keys
</div>
<div class="line-context">
<span class="line-number"> 61</span>
</div>
</div>
<h4>Lines 66-67</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 56</span>    Find a file in a dictionary by matching its filename.
</div>
<div class="line-context">
<span class="line-number"> 57</span>
</div>
<div class="line-context">
<span class="line-number"> 58</span>    Args:
</div>
<div class="line-context">
<span class="line-number"> 59</span>        filename: The filename to search for (e.g., "header.h")
</div>
<div class="line-context">
<span class="line-number"> 60</span>        file_dict: Dictionary with file paths as keys
</div>
<div class="line-context">
<span class="line-number"> 61</span>
</div>
<div class="line-context">
<span class="line-number"> 62</span>    Returns:
</div>
<div class="line-context">
<span class="line-number"> 63</span>        The matching file path key, or None if not found
</div>
<div class="line-context">
<span class="line-number"> 64</span>    """
</div>
<div class="line-context">
<span class="line-number"> 65</span>    # First try exact match
</div>
<div class="line-uncovered">
<span class="line-number"> 66</span>    if filename in file_dict:
</div>
<div class="line-uncovered">
<span class="line-number"> 67</span>        return filename
</div>
<div class="line-context">
<span class="line-number"> 68</span>
</div>
<div class="line-context">
<span class="line-number"> 69</span>    # Try matching by filename
</div>
<div class="line-context">
<span class="line-number"> 70</span>    for file_path in file_dict.keys():
</div>
<div class="line-context">
<span class="line-number"> 71</span>        if Path(file_path).name == filename:
</div>
<div class="line-context">
<span class="line-number"> 72</span>            return file_path
</div>
<div class="line-context">
<span class="line-number"> 73</span>
</div>
<div class="line-context">
<span class="line-number"> 74</span>    return None
</div>
<div class="line-context">
<span class="line-number"> 75</span>
</div>
<div class="line-context">
<span class="line-number"> 76</span>
</div>
<div class="line-context">
<span class="line-number"> 77</span>def normalize_file_path(file_path: str, project_root: str = None) -> str:
</div>
</div>
<h4>Lines 70-72</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 60</span>        file_dict: Dictionary with file paths as keys
</div>
<div class="line-context">
<span class="line-number"> 61</span>
</div>
<div class="line-context">
<span class="line-number"> 62</span>    Returns:
</div>
<div class="line-context">
<span class="line-number"> 63</span>        The matching file path key, or None if not found
</div>
<div class="line-context">
<span class="line-number"> 64</span>    """
</div>
<div class="line-context">
<span class="line-number"> 65</span>    # First try exact match
</div>
<div class="line-context">
<span class="line-number"> 66</span>    if filename in file_dict:
</div>
<div class="line-context">
<span class="line-number"> 67</span>        return filename
</div>
<div class="line-context">
<span class="line-number"> 68</span>
</div>
<div class="line-context">
<span class="line-number"> 69</span>    # Try matching by filename
</div>
<div class="line-uncovered">
<span class="line-number"> 70</span>    for file_path in file_dict.keys():
</div>
<div class="line-uncovered">
<span class="line-number"> 71</span>        if Path(file_path).name == filename:
</div>
<div class="line-uncovered">
<span class="line-number"> 72</span>            return file_path
</div>
<div class="line-context">
<span class="line-number"> 73</span>
</div>
<div class="line-context">
<span class="line-number"> 74</span>    return None
</div>
<div class="line-context">
<span class="line-number"> 75</span>
</div>
<div class="line-context">
<span class="line-number"> 76</span>
</div>
<div class="line-context">
<span class="line-number"> 77</span>def normalize_file_path(file_path: str, project_root: str = None) -> str:
</div>
<div class="line-context">
<span class="line-number"> 78</span>    """
</div>
<div class="line-context">
<span class="line-number"> 79</span>    Normalize file path for consistent handling.
</div>
<div class="line-context">
<span class="line-number"> 80</span>    For tracking purposes, we prefer relative paths when possible.
</div>
<div class="line-context">
<span class="line-number"> 81</span>
</div>
<div class="line-context">
<span class="line-number"> 82</span>    Args:
</div>
</div>
<h4>Line 74</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 64</span>    """
</div>
<div class="line-context">
<span class="line-number"> 65</span>    # First try exact match
</div>
<div class="line-context">
<span class="line-number"> 66</span>    if filename in file_dict:
</div>
<div class="line-context">
<span class="line-number"> 67</span>        return filename
</div>
<div class="line-context">
<span class="line-number"> 68</span>
</div>
<div class="line-context">
<span class="line-number"> 69</span>    # Try matching by filename
</div>
<div class="line-context">
<span class="line-number"> 70</span>    for file_path in file_dict.keys():
</div>
<div class="line-context">
<span class="line-number"> 71</span>        if Path(file_path).name == filename:
</div>
<div class="line-context">
<span class="line-number"> 72</span>            return file_path
</div>
<div class="line-context">
<span class="line-number"> 73</span>
</div>
<div class="line-uncovered">
<span class="line-number"> 74</span>    return None
</div>
<div class="line-context">
<span class="line-number"> 75</span>
</div>
<div class="line-context">
<span class="line-number"> 76</span>
</div>
<div class="line-context">
<span class="line-number"> 77</span>def normalize_file_path(file_path: str, project_root: str = None) -> str:
</div>
<div class="line-context">
<span class="line-number"> 78</span>    """
</div>
<div class="line-context">
<span class="line-number"> 79</span>    Normalize file path for consistent handling.
</div>
<div class="line-context">
<span class="line-number"> 80</span>    For tracking purposes, we prefer relative paths when possible.
</div>
<div class="line-context">
<span class="line-number"> 81</span>
</div>
<div class="line-context">
<span class="line-number"> 82</span>    Args:
</div>
<div class="line-context">
<span class="line-number"> 83</span>        file_path: The file path to normalize
</div>
<div class="line-context">
<span class="line-number"> 84</span>        project_root: Optional project root for relative path conversion
</div>
</div>
<h4>Line 89</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 79</span>    Normalize file path for consistent handling.
</div>
<div class="line-context">
<span class="line-number"> 80</span>    For tracking purposes, we prefer relative paths when possible.
</div>
<div class="line-context">
<span class="line-number"> 81</span>
</div>
<div class="line-context">
<span class="line-number"> 82</span>    Args:
</div>
<div class="line-context">
<span class="line-number"> 83</span>        file_path: The file path to normalize
</div>
<div class="line-context">
<span class="line-number"> 84</span>        project_root: Optional project root for relative path conversion
</div>
<div class="line-context">
<span class="line-number"> 85</span>
</div>
<div class="line-context">
<span class="line-number"> 86</span>    Returns:
</div>
<div class="line-context">
<span class="line-number"> 87</span>        Normalized file path
</div>
<div class="line-context">
<span class="line-number"> 88</span>    """
</div>
<div class="line-uncovered">
<span class="line-number"> 89</span>    path_obj = Path(file_path)
</div>
<div class="line-context">
<span class="line-number"> 90</span>
</div>
<div class="line-context">
<span class="line-number"> 91</span>    # If we have a project root and the path is absolute, try to make it relative
</div>
<div class="line-context">
<span class="line-number"> 92</span>    if project_root and path_obj.is_absolute():
</div>
<div class="line-context">
<span class="line-number"> 93</span>        try:
</div>
<div class="line-context">
<span class="line-number"> 94</span>            relative_path = path_obj.relative_to(Path(project_root))
</div>
<div class="line-context">
<span class="line-number"> 95</span>            return str(relative_path)
</div>
<div class="line-context">
<span class="line-number"> 96</span>        except ValueError:
</div>
<div class="line-context">
<span class="line-number"> 97</span>            # Path is not relative to project root, keep as is
</div>
<div class="line-context">
<span class="line-number"> 98</span>            pass
</div>
<div class="line-context">
<span class="line-number"> 99</span>
</div>
</div>
<h4>Lines 92-96</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 82</span>    Args:
</div>
<div class="line-context">
<span class="line-number"> 83</span>        file_path: The file path to normalize
</div>
<div class="line-context">
<span class="line-number"> 84</span>        project_root: Optional project root for relative path conversion
</div>
<div class="line-context">
<span class="line-number"> 85</span>
</div>
<div class="line-context">
<span class="line-number"> 86</span>    Returns:
</div>
<div class="line-context">
<span class="line-number"> 87</span>        Normalized file path
</div>
<div class="line-context">
<span class="line-number"> 88</span>    """
</div>
<div class="line-context">
<span class="line-number"> 89</span>    path_obj = Path(file_path)
</div>
<div class="line-context">
<span class="line-number"> 90</span>
</div>
<div class="line-context">
<span class="line-number"> 91</span>    # If we have a project root and the path is absolute, try to make it relative
</div>
<div class="line-uncovered">
<span class="line-number"> 92</span>    if project_root and path_obj.is_absolute():
</div>
<div class="line-uncovered">
<span class="line-number"> 93</span>        try:
</div>
<div class="line-uncovered">
<span class="line-number"> 94</span>            relative_path = path_obj.relative_to(Path(project_root))
</div>
<div class="line-uncovered">
<span class="line-number"> 95</span>            return str(relative_path)
</div>
<div class="line-uncovered">
<span class="line-number"> 96</span>        except ValueError:
</div>
<div class="line-context">
<span class="line-number"> 97</span>            # Path is not relative to project root, keep as is
</div>
<div class="line-context">
<span class="line-number"> 98</span>            pass
</div>
<div class="line-context">
<span class="line-number"> 99</span>
</div>
<div class="line-context">
<span class="line-number">100</span>    return str(path_obj)
</div>
<div class="line-context">
<span class="line-number">101</span>
</div>
<div class="line-context">
<span class="line-number">102</span>
</div>
<div class="line-context">
<span class="line-number">103</span>def create_file_key(file_path: str, project_root: str = None) -> str:
</div>
<div class="line-context">
<span class="line-number">104</span>    """
</div>
<div class="line-context">
<span class="line-number">105</span>    Create a consistent file key for tracking.
</div>
<div class="line-context">
<span class="line-number">106</span>    Uses filename for uniqueness since filenames are unique in the project.
</div>
</div>
<h4>Line 98</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 88</span>    """
</div>
<div class="line-context">
<span class="line-number"> 89</span>    path_obj = Path(file_path)
</div>
<div class="line-context">
<span class="line-number"> 90</span>
</div>
<div class="line-context">
<span class="line-number"> 91</span>    # If we have a project root and the path is absolute, try to make it relative
</div>
<div class="line-context">
<span class="line-number"> 92</span>    if project_root and path_obj.is_absolute():
</div>
<div class="line-context">
<span class="line-number"> 93</span>        try:
</div>
<div class="line-context">
<span class="line-number"> 94</span>            relative_path = path_obj.relative_to(Path(project_root))
</div>
<div class="line-context">
<span class="line-number"> 95</span>            return str(relative_path)
</div>
<div class="line-context">
<span class="line-number"> 96</span>        except ValueError:
</div>
<div class="line-context">
<span class="line-number"> 97</span>            # Path is not relative to project root, keep as is
</div>
<div class="line-uncovered">
<span class="line-number"> 98</span>            pass
</div>
<div class="line-context">
<span class="line-number"> 99</span>
</div>
<div class="line-context">
<span class="line-number">100</span>    return str(path_obj)
</div>
<div class="line-context">
<span class="line-number">101</span>
</div>
<div class="line-context">
<span class="line-number">102</span>
</div>
<div class="line-context">
<span class="line-number">103</span>def create_file_key(file_path: str, project_root: str = None) -> str:
</div>
<div class="line-context">
<span class="line-number">104</span>    """
</div>
<div class="line-context">
<span class="line-number">105</span>    Create a consistent file key for tracking.
</div>
<div class="line-context">
<span class="line-number">106</span>    Uses filename for uniqueness since filenames are unique in the project.
</div>
<div class="line-context">
<span class="line-number">107</span>
</div>
<div class="line-context">
<span class="line-number">108</span>    Args:
</div>
</div>
<h4>Line 100</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 90</span>
</div>
<div class="line-context">
<span class="line-number"> 91</span>    # If we have a project root and the path is absolute, try to make it relative
</div>
<div class="line-context">
<span class="line-number"> 92</span>    if project_root and path_obj.is_absolute():
</div>
<div class="line-context">
<span class="line-number"> 93</span>        try:
</div>
<div class="line-context">
<span class="line-number"> 94</span>            relative_path = path_obj.relative_to(Path(project_root))
</div>
<div class="line-context">
<span class="line-number"> 95</span>            return str(relative_path)
</div>
<div class="line-context">
<span class="line-number"> 96</span>        except ValueError:
</div>
<div class="line-context">
<span class="line-number"> 97</span>            # Path is not relative to project root, keep as is
</div>
<div class="line-context">
<span class="line-number"> 98</span>            pass
</div>
<div class="line-context">
<span class="line-number"> 99</span>
</div>
<div class="line-uncovered">
<span class="line-number">100</span>    return str(path_obj)
</div>
<div class="line-context">
<span class="line-number">101</span>
</div>
<div class="line-context">
<span class="line-number">102</span>
</div>
<div class="line-context">
<span class="line-number">103</span>def create_file_key(file_path: str, project_root: str = None) -> str:
</div>
<div class="line-context">
<span class="line-number">104</span>    """
</div>
<div class="line-context">
<span class="line-number">105</span>    Create a consistent file key for tracking.
</div>
<div class="line-context">
<span class="line-number">106</span>    Uses filename for uniqueness since filenames are unique in the project.
</div>
<div class="line-context">
<span class="line-number">107</span>
</div>
<div class="line-context">
<span class="line-number">108</span>    Args:
</div>
<div class="line-context">
<span class="line-number">109</span>        file_path: The file path
</div>
<div class="line-context">
<span class="line-number">110</span>        project_root: Optional project root for normalization
</div>
</div>
<h4>Line 115</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">105</span>    Create a consistent file key for tracking.
</div>
<div class="line-context">
<span class="line-number">106</span>    Uses filename for uniqueness since filenames are unique in the project.
</div>
<div class="line-context">
<span class="line-number">107</span>
</div>
<div class="line-context">
<span class="line-number">108</span>    Args:
</div>
<div class="line-context">
<span class="line-number">109</span>        file_path: The file path
</div>
<div class="line-context">
<span class="line-number">110</span>        project_root: Optional project root for normalization
</div>
<div class="line-context">
<span class="line-number">111</span>
</div>
<div class="line-context">
<span class="line-number">112</span>    Returns:
</div>
<div class="line-context">
<span class="line-number">113</span>        A consistent file key (filename)
</div>
<div class="line-context">
<span class="line-number">114</span>    """
</div>
<div class="line-uncovered">
<span class="line-number">115</span>    return get_filename_from_path(file_path)
</div>
<div class="line-context">
<span class="line-number">116</span>
</div>
<div class="line-context">
<span class="line-number">117</span>
</div>
<div class="line-context">
<span class="line-number">118</span># Backward compatibility functions for existing tests
</div>
<div class="line-context">
<span class="line-number">119</span>def get_acceptable_encodings() -> list:
</div>
<div class="line-context">
<span class="line-number">120</span>    """
</div>
<div class="line-context">
<span class="line-number">121</span>    Get a list of acceptable encodings for cross-platform compatibility.
</div>
<div class="line-context">
<span class="line-number">122</span>
</div>
<div class="line-context">
<span class="line-number">123</span>    Returns:
</div>
<div class="line-context">
<span class="line-number">124</span>        List of encoding names that are considered acceptable across platforms.
</div>
<div class="line-context">
<span class="line-number">125</span>    """
</div>
</div>
<h4>Line 187</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">177</span>
</div>
<div class="line-context">
<span class="line-number">178</span>def get_platform_default_encoding() -> str:
</div>
<div class="line-context">
<span class="line-number">179</span>    """
</div>
<div class="line-context">
<span class="line-number">180</span>    Get the default encoding for the current platform.
</div>
<div class="line-context">
<span class="line-number">181</span>
</div>
<div class="line-context">
<span class="line-number">182</span>    Returns:
</div>
<div class="line-context">
<span class="line-number">183</span>        The default encoding name for the current platform.
</div>
<div class="line-context">
<span class="line-number">184</span>    """
</div>
<div class="line-context">
<span class="line-number">185</span>    import sys
</div>
<div class="line-context">
<span class="line-number">186</span>    if sys.platform.startswith("win"):
</div>
<div class="line-uncovered">
<span class="line-number">187</span>        return "windows-1252"  # Common Windows default
</div>
<div class="line-context">
<span class="line-number">188</span>    else:
</div>
<div class="line-context">
<span class="line-number">189</span>        return "utf-8"  # Common Unix/Linux default
</div>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/transformer.py
<span class="coverage-info">96.02% (241/251 lines covered)</span>
</div>
<h4>Lines 103-104</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 93</span>        if not Path(config_file).exists():
</div>
<div class="line-context">
<span class="line-number"> 94</span>            raise FileNotFoundError(f"Configuration file not found: {config_file}")
</div>
<div class="line-context">
<span class="line-number"> 95</span>
</div>
<div class="line-context">
<span class="line-number"> 96</span>        try:
</div>
<div class="line-context">
<span class="line-number"> 97</span>            with open(config_file, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number"> 98</span>                config = json.load(f)
</div>
<div class="line-context">
<span class="line-number"> 99</span>
</div>
<div class="line-context">
<span class="line-number">100</span>            self.logger.debug("Loaded configuration from: %s", config_file)
</div>
<div class="line-context">
<span class="line-number">101</span>            return config
</div>
<div class="line-context">
<span class="line-number">102</span>
</div>
<div class="line-uncovered">
<span class="line-number">103</span>        except Exception as e:
</div>
<div class="line-uncovered">
<span class="line-number">104</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number">105</span>                f"Failed to load configuration from {config_file}: {e}"
</div>
<div class="line-context">
<span class="line-number">106</span>            ) from e
</div>
<div class="line-context">
<span class="line-number">107</span>
</div>
<div class="line-context">
<span class="line-number">108</span>    def _apply_transformations(
</div>
<div class="line-context">
<span class="line-number">109</span>        self, model: ProjectModel, config: Dict[str, Any]
</div>
<div class="line-context">
<span class="line-number">110</span>    ) -> ProjectModel:
</div>
<div class="line-context">
<span class="line-number">111</span>        """Apply all configured transformations to the model"""
</div>
<div class="line-context">
<span class="line-number">112</span>        self.logger.info("Applying transformations to model")
</div>
<div class="line-context">
<span class="line-number">113</span>
</div>
<div class="line-context">
<span class="line-number">114</span>        # Apply comprehensive file filtering (moved from parser)
</div>
</div>
<h4>Line 344</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">334</span>            included_filename = self._find_included_file(
</div>
<div class="line-context">
<span class="line-number">335</span>                include_name, file_model.project_root
</div>
<div class="line-context">
<span class="line-number">336</span>            )
</div>
<div class="line-context">
<span class="line-number">337</span>
</div>
<div class="line-context">
<span class="line-number">338</span>            if included_filename:
</div>
<div class="line-context">
<span class="line-number">339</span>                # Convert full path to filename for lookup
</div>
<div class="line-context">
<span class="line-number">340</span>                included_filename_key = Path(included_filename).name
</div>
<div class="line-context">
<span class="line-number">341</span>                if included_filename_key in file_map:
</div>
<div class="line-context">
<span class="line-number">342</span>                    # Prevent self-referencing include relations
</div>
<div class="line-context">
<span class="line-number">343</span>                    if file_model.relative_path == included_filename_key:
</div>
<div class="line-uncovered">
<span class="line-number">344</span>                        self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">345</span>                            "Skipping self-include relation for %s", file_model.relative_path
</div>
<div class="line-context">
<span class="line-number">346</span>                        )
</div>
<div class="line-context">
<span class="line-number">347</span>                        continue
</div>
<div class="line-context">
<span class="line-number">348</span>
</div>
<div class="line-context">
<span class="line-number">349</span>                # Check if this include relation already exists to prevent cycles
</div>
<div class="line-context">
<span class="line-number">350</span>                relation_exists = any(
</div>
<div class="line-context">
<span class="line-number">351</span>                    rel.source_file == file_model.relative_path
</div>
<div class="line-context">
<span class="line-number">352</span>                    and rel.included_file == included_filename_key
</div>
<div class="line-context">
<span class="line-number">353</span>                    for rel in file_model.include_relations
</div>
<div class="line-context">
<span class="line-number">354</span>                )
</div>
</div>
<h4>Line 347</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">337</span>
</div>
<div class="line-context">
<span class="line-number">338</span>            if included_filename:
</div>
<div class="line-context">
<span class="line-number">339</span>                # Convert full path to filename for lookup
</div>
<div class="line-context">
<span class="line-number">340</span>                included_filename_key = Path(included_filename).name
</div>
<div class="line-context">
<span class="line-number">341</span>                if included_filename_key in file_map:
</div>
<div class="line-context">
<span class="line-number">342</span>                    # Prevent self-referencing include relations
</div>
<div class="line-context">
<span class="line-number">343</span>                    if file_model.relative_path == included_filename_key:
</div>
<div class="line-context">
<span class="line-number">344</span>                        self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">345</span>                            "Skipping self-include relation for %s", file_model.relative_path
</div>
<div class="line-context">
<span class="line-number">346</span>                        )
</div>
<div class="line-uncovered">
<span class="line-number">347</span>                        continue
</div>
<div class="line-context">
<span class="line-number">348</span>
</div>
<div class="line-context">
<span class="line-number">349</span>                # Check if this include relation already exists to prevent cycles
</div>
<div class="line-context">
<span class="line-number">350</span>                relation_exists = any(
</div>
<div class="line-context">
<span class="line-number">351</span>                    rel.source_file == file_model.relative_path
</div>
<div class="line-context">
<span class="line-number">352</span>                    and rel.included_file == included_filename_key
</div>
<div class="line-context">
<span class="line-number">353</span>                    for rel in file_model.include_relations
</div>
<div class="line-context">
<span class="line-number">354</span>                )
</div>
<div class="line-context">
<span class="line-number">355</span>
</div>
<div class="line-context">
<span class="line-number">356</span>                if relation_exists:
</div>
<div class="line-context">
<span class="line-number">357</span>                    self.logger.debug(
</div>
</div>
<h4>Line 357</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">347</span>                        continue
</div>
<div class="line-context">
<span class="line-number">348</span>
</div>
<div class="line-context">
<span class="line-number">349</span>                # Check if this include relation already exists to prevent cycles
</div>
<div class="line-context">
<span class="line-number">350</span>                relation_exists = any(
</div>
<div class="line-context">
<span class="line-number">351</span>                    rel.source_file == file_model.relative_path
</div>
<div class="line-context">
<span class="line-number">352</span>                    and rel.included_file == included_filename_key
</div>
<div class="line-context">
<span class="line-number">353</span>                    for rel in file_model.include_relations
</div>
<div class="line-context">
<span class="line-number">354</span>                )
</div>
<div class="line-context">
<span class="line-number">355</span>
</div>
<div class="line-context">
<span class="line-number">356</span>                if relation_exists:
</div>
<div class="line-uncovered">
<span class="line-number">357</span>                    self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">358</span>                        "Cyclic include detected and skipped: %s -> %s",
</div>
<div class="line-context">
<span class="line-number">359</span>                        file_model.relative_path,
</div>
<div class="line-context">
<span class="line-number">360</span>                        included_filename_key,
</div>
<div class="line-context">
<span class="line-number">361</span>                    )
</div>
<div class="line-context">
<span class="line-number">362</span>                    continue
</div>
<div class="line-context">
<span class="line-number">363</span>
</div>
<div class="line-context">
<span class="line-number">364</span>                # Create include relation using appropriate paths
</div>
<div class="line-context">
<span class="line-number">365</span>                # For tests (tmp directories), use full paths; otherwise use filenames
</div>
<div class="line-context">
<span class="line-number">366</span>                source_file = file_model.file_path if "tmp" in file_model.file_path else file_model.relative_path
</div>
<div class="line-context">
<span class="line-number">367</span>                included_file = included_filename if "tmp" in included_filename else included_filename_key
</div>
</div>
<h4>Line 362</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">352</span>                    and rel.included_file == included_filename_key
</div>
<div class="line-context">
<span class="line-number">353</span>                    for rel in file_model.include_relations
</div>
<div class="line-context">
<span class="line-number">354</span>                )
</div>
<div class="line-context">
<span class="line-number">355</span>
</div>
<div class="line-context">
<span class="line-number">356</span>                if relation_exists:
</div>
<div class="line-context">
<span class="line-number">357</span>                    self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">358</span>                        "Cyclic include detected and skipped: %s -> %s",
</div>
<div class="line-context">
<span class="line-number">359</span>                        file_model.relative_path,
</div>
<div class="line-context">
<span class="line-number">360</span>                        included_filename_key,
</div>
<div class="line-context">
<span class="line-number">361</span>                    )
</div>
<div class="line-uncovered">
<span class="line-number">362</span>                    continue
</div>
<div class="line-context">
<span class="line-number">363</span>
</div>
<div class="line-context">
<span class="line-number">364</span>                # Create include relation using appropriate paths
</div>
<div class="line-context">
<span class="line-number">365</span>                # For tests (tmp directories), use full paths; otherwise use filenames
</div>
<div class="line-context">
<span class="line-number">366</span>                source_file = file_model.file_path if "tmp" in file_model.file_path else file_model.relative_path
</div>
<div class="line-context">
<span class="line-number">367</span>                included_file = included_filename if "tmp" in included_filename else included_filename_key
</div>
<div class="line-context">
<span class="line-number">368</span>
</div>
<div class="line-context">
<span class="line-number">369</span>                include_relation = IncludeRelation(
</div>
<div class="line-context">
<span class="line-number">370</span>                    source_file=source_file,
</div>
<div class="line-context">
<span class="line-number">371</span>                    included_file=included_file,
</div>
<div class="line-context">
<span class="line-number">372</span>                    depth=current_depth,
</div>
</div>
<h4>Line 418</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">408</span>                continue
</div>
<div class="line-context">
<span class="line-number">409</span>
</div>
<div class="line-context">
<span class="line-number">410</span>            for ext in extensions:
</div>
<div class="line-context">
<span class="line-number">411</span>                file_path = search_path / f"{include_name}{ext}"
</div>
<div class="line-context">
<span class="line-number">412</span>                if file_path.exists():
</div>
<div class="line-context">
<span class="line-number">413</span>                    # For backward compatibility with tests, return full path if it's a test
</div>
<div class="line-context">
<span class="line-number">414</span>                    # Otherwise return filename for simplified tracking
</div>
<div class="line-context">
<span class="line-number">415</span>                    if "tmp" in str(file_path):
</div>
<div class="line-context">
<span class="line-number">416</span>                        return str(file_path.resolve())
</div>
<div class="line-context">
<span class="line-number">417</span>                    else:
</div>
<div class="line-uncovered">
<span class="line-number">418</span>                        return file_path.name
</div>
<div class="line-context">
<span class="line-number">419</span>
</div>
<div class="line-context">
<span class="line-number">420</span>        return None
</div>
<div class="line-context">
<span class="line-number">421</span>
</div>
<div class="line-context">
<span class="line-number">422</span>    def _matches_pattern(self, file_path: str, pattern: str) -> bool:
</div>
<div class="line-context">
<span class="line-number">423</span>        """Check if a file path matches a pattern"""
</div>
<div class="line-context">
<span class="line-number">424</span>        try:
</div>
<div class="line-context">
<span class="line-number">425</span>            return bool(re.search(pattern, file_path))
</div>
<div class="line-context">
<span class="line-number">426</span>        except re.error:
</div>
<div class="line-context">
<span class="line-number">427</span>            self.logger.warning("Invalid pattern '%s' for file matching", pattern)
</div>
<div class="line-context">
<span class="line-number">428</span>            return False
</div>
</div>
<h4>Line 554</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">544</span>        aliases = {}
</div>
<div class="line-context">
<span class="line-number">545</span>        for name, alias_data in data.get("aliases", {}).items():
</div>
<div class="line-context">
<span class="line-number">546</span>            if isinstance(alias_data, dict):
</div>
<div class="line-context">
<span class="line-number">547</span>                aliases[name] = Alias(
</div>
<div class="line-context">
<span class="line-number">548</span>                    alias_data.get("name", name),
</div>
<div class="line-context">
<span class="line-number">549</span>                    alias_data.get("original_type", ""),
</div>
<div class="line-context">
<span class="line-number">550</span>                    alias_data.get("uses", []),
</div>
<div class="line-context">
<span class="line-number">551</span>                )
</div>
<div class="line-context">
<span class="line-number">552</span>            else:
</div>
<div class="line-context">
<span class="line-number">553</span>                # Handle legacy format where aliases was Dict[str, str]
</div>
<div class="line-uncovered">
<span class="line-number">554</span>                aliases[name] = Alias(name, alias_data, [])
</div>
<div class="line-context">
<span class="line-number">555</span>
</div>
<div class="line-context">
<span class="line-number">556</span>        # Convert functions
</div>
<div class="line-context">
<span class="line-number">557</span>        functions = []
</div>
<div class="line-context">
<span class="line-number">558</span>        for func_data in data.get("functions", []):
</div>
<div class="line-context">
<span class="line-number">559</span>            parameters = [
</div>
<div class="line-context">
<span class="line-number">560</span>                Field(p["name"], p["type"]) for p in func_data.get("parameters", [])
</div>
<div class="line-context">
<span class="line-number">561</span>            ]
</div>
<div class="line-context">
<span class="line-number">562</span>            functions.append(
</div>
<div class="line-context">
<span class="line-number">563</span>                Function(
</div>
<div class="line-context">
<span class="line-number">564</span>                    func_data["name"],
</div>
</div>
<h4>Lines 597-598</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">587</span>            includes=data.get("includes", []),
</div>
<div class="line-context">
<span class="line-number">588</span>            macros=data.get("macros", []),
</div>
<div class="line-context">
<span class="line-number">589</span>            aliases=aliases,
</div>
<div class="line-context">
<span class="line-number">590</span>        )
</div>
<div class="line-context">
<span class="line-number">591</span>
</div>
<div class="line-context">
<span class="line-number">592</span>    def _save_model(self, model: ProjectModel, output_file: str) -> None:
</div>
<div class="line-context">
<span class="line-number">593</span>        """Save model to JSON file"""
</div>
<div class="line-context">
<span class="line-number">594</span>        try:
</div>
<div class="line-context">
<span class="line-number">595</span>            model.save(output_file)
</div>
<div class="line-context">
<span class="line-number">596</span>            self.logger.debug("Model saved to: %s", output_file)
</div>
<div class="line-uncovered">
<span class="line-number">597</span>        except Exception as e:
</div>
<div class="line-uncovered">
<span class="line-number">598</span>            raise ValueError(f"Failed to save model to {output_file}: {e}") from e
</div>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/parser.py
<span class="coverage-info">87.39% (617/706 lines covered)</span>
</div>
<h4>Lines 21-22</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 11</span>    CTokenizer,
</div>
<div class="line-context">
<span class="line-number"> 12</span>    StructureFinder,
</div>
<div class="line-context">
<span class="line-number"> 13</span>    TokenType,
</div>
<div class="line-context">
<span class="line-number"> 14</span>    find_enum_values,
</div>
<div class="line-context">
<span class="line-number"> 15</span>    find_struct_fields,
</div>
<div class="line-context">
<span class="line-number"> 16</span>)
</div>
<div class="line-context">
<span class="line-number"> 17</span>from .preprocessor import PreprocessorManager
</div>
<div class="line-context">
<span class="line-number"> 18</span>from .utils import detect_file_encoding
</div>
<div class="line-context">
<span class="line-number"> 19</span>
</div>
<div class="line-context">
<span class="line-number"> 20</span>if TYPE_CHECKING:
</div>
<div class="line-uncovered">
<span class="line-number"> 21</span>    from .models import Struct, Enum, Union, Function, Field, Alias
</div>
<div class="line-uncovered">
<span class="line-number"> 22</span>    from .config import Config
</div>
<div class="line-context">
<span class="line-number"> 23</span>
</div>
<div class="line-context">
<span class="line-number"> 24</span>
</div>
<div class="line-context">
<span class="line-number"> 25</span>class CParser:
</div>
<div class="line-context">
<span class="line-number"> 26</span>    """C/C++ parser for extracting structural information from source code using tokenization"""
</div>
<div class="line-context">
<span class="line-number"> 27</span>
</div>
<div class="line-context">
<span class="line-number"> 28</span>    def __init__(self):
</div>
<div class="line-context">
<span class="line-number"> 29</span>        self.logger = logging.getLogger(__name__)
</div>
<div class="line-context">
<span class="line-number"> 30</span>        self.tokenizer = CTokenizer()
</div>
<div class="line-context">
<span class="line-number"> 31</span>        self.preprocessor = PreprocessorManager()
</div>
<div class="line-context">
<span class="line-number"> 32</span>        # Cache for failed include searches to avoid repeated lookups
</div>
</div>
<h4>Line 45</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 35</span>    def parse_project(
</div>
<div class="line-context">
<span class="line-number"> 36</span>        self, project_root: str, recursive_search: bool = True, config: "Config" = None
</div>
<div class="line-context">
<span class="line-number"> 37</span>    ) -> ProjectModel:
</div>
<div class="line-context">
<span class="line-number"> 38</span>        """Parse a C/C++ project and return a model"""
</div>
<div class="line-context">
<span class="line-number"> 39</span>        project_root = Path(project_root).resolve()
</div>
<div class="line-context">
<span class="line-number"> 40</span>
</div>
<div class="line-context">
<span class="line-number"> 41</span>        if not project_root.exists():
</div>
<div class="line-context">
<span class="line-number"> 42</span>            raise ValueError(f"Project root not found: {project_root}")
</div>
<div class="line-context">
<span class="line-number"> 43</span>
</div>
<div class="line-context">
<span class="line-number"> 44</span>        if not project_root.is_dir():
</div>
<div class="line-uncovered">
<span class="line-number"> 45</span>            raise ValueError(f"Project root must be a directory: {project_root}")
</div>
<div class="line-context">
<span class="line-number"> 46</span>
</div>
<div class="line-context">
<span class="line-number"> 47</span>        # Clear the failed includes cache for this new project
</div>
<div class="line-context">
<span class="line-number"> 48</span>        cache_size_before = len(self._failed_includes_cache)
</div>
<div class="line-context">
<span class="line-number"> 49</span>        self._failed_includes_cache.clear()
</div>
<div class="line-context">
<span class="line-number"> 50</span>        if cache_size_before > 0:
</div>
<div class="line-context">
<span class="line-number"> 51</span>            self.logger.debug(
</div>
<div class="line-context">
<span class="line-number"> 52</span>                "Cleared failed includes cache (%d entries)", cache_size_before
</div>
<div class="line-context">
<span class="line-number"> 53</span>            )
</div>
<div class="line-context">
<span class="line-number"> 54</span>
</div>
<div class="line-context">
<span class="line-number"> 55</span>        self.logger.info("Parsing project: %s", project_root)
</div>
</div>
<h4>Line 51</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 41</span>        if not project_root.exists():
</div>
<div class="line-context">
<span class="line-number"> 42</span>            raise ValueError(f"Project root not found: {project_root}")
</div>
<div class="line-context">
<span class="line-number"> 43</span>
</div>
<div class="line-context">
<span class="line-number"> 44</span>        if not project_root.is_dir():
</div>
<div class="line-context">
<span class="line-number"> 45</span>            raise ValueError(f"Project root must be a directory: {project_root}")
</div>
<div class="line-context">
<span class="line-number"> 46</span>
</div>
<div class="line-context">
<span class="line-number"> 47</span>        # Clear the failed includes cache for this new project
</div>
<div class="line-context">
<span class="line-number"> 48</span>        cache_size_before = len(self._failed_includes_cache)
</div>
<div class="line-context">
<span class="line-number"> 49</span>        self._failed_includes_cache.clear()
</div>
<div class="line-context">
<span class="line-number"> 50</span>        if cache_size_before > 0:
</div>
<div class="line-uncovered">
<span class="line-number"> 51</span>            self.logger.debug(
</div>
<div class="line-context">
<span class="line-number"> 52</span>                "Cleared failed includes cache (%d entries)", cache_size_before
</div>
<div class="line-context">
<span class="line-number"> 53</span>            )
</div>
<div class="line-context">
<span class="line-number"> 54</span>
</div>
<div class="line-context">
<span class="line-number"> 55</span>        self.logger.info("Parsing project: %s", project_root)
</div>
<div class="line-context">
<span class="line-number"> 56</span>
</div>
<div class="line-context">
<span class="line-number"> 57</span>        # Find C/C++ files based on configuration and include dependencies
</div>
<div class="line-context">
<span class="line-number"> 58</span>        if config:
</div>
<div class="line-context">
<span class="line-number"> 59</span>            c_files = self._find_files_with_include_dependencies(
</div>
<div class="line-context">
<span class="line-number"> 60</span>                project_root, recursive_search, config
</div>
<div class="line-context">
<span class="line-number"> 61</span>            )
</div>
</div>
<h4>Lines 82-84</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 72</span>            try:
</div>
<div class="line-context">
<span class="line-number"> 73</span>                # Use relative path as key for better tracking of subdirectories
</div>
<div class="line-context">
<span class="line-number"> 74</span>                relative_path = str(file_path.relative_to(project_root))
</div>
<div class="line-context">
<span class="line-number"> 75</span>                file_model = self.parse_file(
</div>
<div class="line-context">
<span class="line-number"> 76</span>                    file_path, relative_path, str(project_root)
</div>
<div class="line-context">
<span class="line-number"> 77</span>                )
</div>
<div class="line-context">
<span class="line-number"> 78</span>                files[relative_path] = file_model
</div>
<div class="line-context">
<span class="line-number"> 79</span>
</div>
<div class="line-context">
<span class="line-number"> 80</span>                self.logger.debug("Successfully parsed: %s", relative_path)
</div>
<div class="line-context">
<span class="line-number"> 81</span>
</div>
<div class="line-uncovered">
<span class="line-number"> 82</span>            except (OSError, ValueError) as e:
</div>
<div class="line-uncovered">
<span class="line-number"> 83</span>                self.logger.warning("Failed to parse %s: %s", file_path, e)
</div>
<div class="line-uncovered">
<span class="line-number"> 84</span>                failed_files.append(str(file_path))
</div>
<div class="line-context">
<span class="line-number"> 85</span>
</div>
<div class="line-context">
<span class="line-number"> 86</span>        if failed_files:
</div>
<div class="line-context">
<span class="line-number"> 87</span>            error_msg = (
</div>
<div class="line-context">
<span class="line-number"> 88</span>                f"Failed to parse {len(failed_files)} files: {failed_files}. "
</div>
<div class="line-context">
<span class="line-number"> 89</span>                "Stopping model processing."
</div>
<div class="line-context">
<span class="line-number"> 90</span>            )
</div>
<div class="line-context">
<span class="line-number"> 91</span>            self.logger.error(error_msg)
</div>
<div class="line-context">
<span class="line-number"> 92</span>            raise RuntimeError(error_msg)
</div>
<div class="line-context">
<span class="line-number"> 93</span>
</div>
<div class="line-context">
<span class="line-number"> 94</span>        model = ProjectModel(
</div>
</div>
<h4>Line 87</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 77</span>                )
</div>
<div class="line-context">
<span class="line-number"> 78</span>                files[relative_path] = file_model
</div>
<div class="line-context">
<span class="line-number"> 79</span>
</div>
<div class="line-context">
<span class="line-number"> 80</span>                self.logger.debug("Successfully parsed: %s", relative_path)
</div>
<div class="line-context">
<span class="line-number"> 81</span>
</div>
<div class="line-context">
<span class="line-number"> 82</span>            except (OSError, ValueError) as e:
</div>
<div class="line-context">
<span class="line-number"> 83</span>                self.logger.warning("Failed to parse %s: %s", file_path, e)
</div>
<div class="line-context">
<span class="line-number"> 84</span>                failed_files.append(str(file_path))
</div>
<div class="line-context">
<span class="line-number"> 85</span>
</div>
<div class="line-context">
<span class="line-number"> 86</span>        if failed_files:
</div>
<div class="line-uncovered">
<span class="line-number"> 87</span>            error_msg = (
</div>
<div class="line-context">
<span class="line-number"> 88</span>                f"Failed to parse {len(failed_files)} files: {failed_files}. "
</div>
<div class="line-context">
<span class="line-number"> 89</span>                "Stopping model processing."
</div>
<div class="line-context">
<span class="line-number"> 90</span>            )
</div>
<div class="line-context">
<span class="line-number"> 91</span>            self.logger.error(error_msg)
</div>
<div class="line-context">
<span class="line-number"> 92</span>            raise RuntimeError(error_msg)
</div>
<div class="line-context">
<span class="line-number"> 93</span>
</div>
<div class="line-context">
<span class="line-number"> 94</span>        model = ProjectModel(
</div>
<div class="line-context">
<span class="line-number"> 95</span>            project_name=project_root.name,
</div>
<div class="line-context">
<span class="line-number"> 96</span>            project_root=str(project_root),
</div>
<div class="line-context">
<span class="line-number"> 97</span>            files=files,
</div>
</div>
<h4>Lines 91-92</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 81</span>
</div>
<div class="line-context">
<span class="line-number"> 82</span>            except (OSError, ValueError) as e:
</div>
<div class="line-context">
<span class="line-number"> 83</span>                self.logger.warning("Failed to parse %s: %s", file_path, e)
</div>
<div class="line-context">
<span class="line-number"> 84</span>                failed_files.append(str(file_path))
</div>
<div class="line-context">
<span class="line-number"> 85</span>
</div>
<div class="line-context">
<span class="line-number"> 86</span>        if failed_files:
</div>
<div class="line-context">
<span class="line-number"> 87</span>            error_msg = (
</div>
<div class="line-context">
<span class="line-number"> 88</span>                f"Failed to parse {len(failed_files)} files: {failed_files}. "
</div>
<div class="line-context">
<span class="line-number"> 89</span>                "Stopping model processing."
</div>
<div class="line-context">
<span class="line-number"> 90</span>            )
</div>
<div class="line-uncovered">
<span class="line-number"> 91</span>            self.logger.error(error_msg)
</div>
<div class="line-uncovered">
<span class="line-number"> 92</span>            raise RuntimeError(error_msg)
</div>
<div class="line-context">
<span class="line-number"> 93</span>
</div>
<div class="line-context">
<span class="line-number"> 94</span>        model = ProjectModel(
</div>
<div class="line-context">
<span class="line-number"> 95</span>            project_name=project_root.name,
</div>
<div class="line-context">
<span class="line-number"> 96</span>            project_root=str(project_root),
</div>
<div class="line-context">
<span class="line-number"> 97</span>            files=files,
</div>
<div class="line-context">
<span class="line-number"> 98</span>        )
</div>
<div class="line-context">
<span class="line-number"> 99</span>
</div>
<div class="line-context">
<span class="line-number">100</span>        # Update all uses fields across the entire project
</div>
<div class="line-context">
<span class="line-number">101</span>        model.update_uses_fields()
</div>
<div class="line-context">
<span class="line-number">102</span>
</div>
</div>
<h4>Lines 206-207</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">196</span>
</div>
<div class="line-context">
<span class="line-number">197</span>            if original_start is not None and original_end is not None:
</div>
<div class="line-context">
<span class="line-number">198</span>                # Extract field information from original token range
</div>
<div class="line-context">
<span class="line-number">199</span>                field_tuples = find_struct_fields(tokens, original_start, original_end)
</div>
<div class="line-context">
<span class="line-number">200</span>
</div>
<div class="line-context">
<span class="line-number">201</span>                # Convert to Field objects
</div>
<div class="line-context">
<span class="line-number">202</span>                fields = []
</div>
<div class="line-context">
<span class="line-number">203</span>                for field_name, field_type in field_tuples:
</div>
<div class="line-context">
<span class="line-number">204</span>                    try:
</div>
<div class="line-context">
<span class="line-number">205</span>                        fields.append(Field(field_name, field_type))
</div>
<div class="line-uncovered">
<span class="line-number">206</span>                    except ValueError as e:
</div>
<div class="line-uncovered">
<span class="line-number">207</span>                        self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">208</span>                            "Error creating field %s: %s", field_name, e
</div>
<div class="line-context">
<span class="line-number">209</span>                        )
</div>
<div class="line-context">
<span class="line-number">210</span>
</div>
<div class="line-context">
<span class="line-number">211</span>                # For anonymous structs, use a special key that can be mapped later
</div>
<div class="line-context">
<span class="line-number">212</span>                if not struct_name:
</div>
<div class="line-context">
<span class="line-number">213</span>                    struct_name = "__anonymous_struct__"
</div>
<div class="line-context">
<span class="line-number">214</span>
</div>
<div class="line-context">
<span class="line-number">215</span>                # Extract tag name if this is a typedef struct
</div>
<div class="line-context">
<span class="line-number">216</span>                tag_name = ""
</div>
<div class="line-context">
<span class="line-number">217</span>                if struct_name and not struct_name.startswith("__anonymous"):
</div>
</div>
<h4>Lines 306-307</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">296</span>
</div>
<div class="line-context">
<span class="line-number">297</span>            if original_start is not None and original_end is not None:
</div>
<div class="line-context">
<span class="line-number">298</span>                # Extract field information from original token range
</div>
<div class="line-context">
<span class="line-number">299</span>                field_tuples = find_struct_fields(tokens, original_start, original_end)
</div>
<div class="line-context">
<span class="line-number">300</span>
</div>
<div class="line-context">
<span class="line-number">301</span>                # Convert to Field objects
</div>
<div class="line-context">
<span class="line-number">302</span>                fields = []
</div>
<div class="line-context">
<span class="line-number">303</span>                for field_name, field_type in field_tuples:
</div>
<div class="line-context">
<span class="line-number">304</span>                    try:
</div>
<div class="line-context">
<span class="line-number">305</span>                        fields.append(Field(field_name, field_type))
</div>
<div class="line-uncovered">
<span class="line-number">306</span>                    except ValueError as e:
</div>
<div class="line-uncovered">
<span class="line-number">307</span>                        self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">308</span>                            "Error creating union field %s: %s", field_name, e
</div>
<div class="line-context">
<span class="line-number">309</span>                        )
</div>
<div class="line-context">
<span class="line-number">310</span>
</div>
<div class="line-context">
<span class="line-number">311</span>                # For anonymous unions, use a special key that can be mapped later
</div>
<div class="line-context">
<span class="line-number">312</span>                if not union_name:
</div>
<div class="line-context">
<span class="line-number">313</span>                    union_name = "__anonymous_union__"
</div>
<div class="line-context">
<span class="line-number">314</span>
</div>
<div class="line-context">
<span class="line-number">315</span>                # Extract tag name if this is a typedef union
</div>
<div class="line-context">
<span class="line-number">316</span>                tag_name = ""
</div>
<div class="line-context">
<span class="line-number">317</span>                if union_name and not union_name.startswith("__anonymous"):
</div>
</div>
<h4>Line 313</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">303</span>                for field_name, field_type in field_tuples:
</div>
<div class="line-context">
<span class="line-number">304</span>                    try:
</div>
<div class="line-context">
<span class="line-number">305</span>                        fields.append(Field(field_name, field_type))
</div>
<div class="line-context">
<span class="line-number">306</span>                    except ValueError as e:
</div>
<div class="line-context">
<span class="line-number">307</span>                        self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">308</span>                            "Error creating union field %s: %s", field_name, e
</div>
<div class="line-context">
<span class="line-number">309</span>                        )
</div>
<div class="line-context">
<span class="line-number">310</span>
</div>
<div class="line-context">
<span class="line-number">311</span>                # For anonymous unions, use a special key that can be mapped later
</div>
<div class="line-context">
<span class="line-number">312</span>                if not union_name:
</div>
<div class="line-uncovered">
<span class="line-number">313</span>                    union_name = "__anonymous_union__"
</div>
<div class="line-context">
<span class="line-number">314</span>
</div>
<div class="line-context">
<span class="line-number">315</span>                # Extract tag name if this is a typedef union
</div>
<div class="line-context">
<span class="line-number">316</span>                tag_name = ""
</div>
<div class="line-context">
<span class="line-number">317</span>                if union_name and not union_name.startswith("__anonymous"):
</div>
<div class="line-context">
<span class="line-number">318</span>                    # Check if this union has a typedef
</div>
<div class="line-context">
<span class="line-number">319</span>                    tag_name = self._extract_tag_name_for_union(tokens, union_name)
</div>
<div class="line-context">
<span class="line-number">320</span>
</div>
<div class="line-context">
<span class="line-number">321</span>                unions[union_name] = Union(
</div>
<div class="line-context">
<span class="line-number">322</span>                    union_name, fields, tag_name=tag_name, uses=[]
</div>
<div class="line-context">
<span class="line-number">323</span>                )
</div>
</div>
<h4>Lines 370-371</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">360</span>
</div>
<div class="line-context">
<span class="line-number">361</span>            try:
</div>
<div class="line-context">
<span class="line-number">362</span>                # Create function with declaration flag
</div>
<div class="line-context">
<span class="line-number">363</span>                function = Function(func_name, return_type, parameters)
</div>
<div class="line-context">
<span class="line-number">364</span>                # Add a custom attribute to track if this is a declaration
</div>
<div class="line-context">
<span class="line-number">365</span>                function.is_declaration = is_declaration
</div>
<div class="line-context">
<span class="line-number">366</span>                functions.append(function)
</div>
<div class="line-context">
<span class="line-number">367</span>                self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">368</span>                    f"Parsed function: {func_name} with {len(parameters)} parameters (declaration: {is_declaration})"
</div>
<div class="line-context">
<span class="line-number">369</span>                )
</div>
<div class="line-uncovered">
<span class="line-number">370</span>            except Exception as e:
</div>
<div class="line-uncovered">
<span class="line-number">371</span>                self.logger.warning("Error creating function %s: %s", func_name, e)
</div>
<div class="line-context">
<span class="line-number">372</span>
</div>
<div class="line-context">
<span class="line-number">373</span>        return functions
</div>
<div class="line-context">
<span class="line-number">374</span>
</div>
<div class="line-context">
<span class="line-number">375</span>    def _parse_globals_with_tokenizer(self, tokens) -> List["Field"]:
</div>
<div class="line-context">
<span class="line-number">376</span>        """Parse global variables using tokenizer"""
</div>
<div class="line-context">
<span class="line-number">377</span>        from .models import Field
</div>
<div class="line-context">
<span class="line-number">378</span>
</div>
<div class="line-context">
<span class="line-number">379</span>        globals_list = []
</div>
<div class="line-context">
<span class="line-number">380</span>
</div>
<div class="line-context">
<span class="line-number">381</span>        i = 0
</div>
</div>
<h4>Lines 396-397</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">386</span>                TokenType.DEFINE,
</div>
<div class="line-context">
<span class="line-number">387</span>                TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">388</span>                TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">389</span>                TokenType.NEWLINE,
</div>
<div class="line-context">
<span class="line-number">390</span>            ]:
</div>
<div class="line-context">
<span class="line-number">391</span>                i += 1
</div>
<div class="line-context">
<span class="line-number">392</span>                continue
</div>
<div class="line-context">
<span class="line-number">393</span>
</div>
<div class="line-context">
<span class="line-number">394</span>            # Skip preprocessor directives but keep their content
</div>
<div class="line-context">
<span class="line-number">395</span>            if tokens[i].type == TokenType.PREPROCESSOR:
</div>
<div class="line-uncovered">
<span class="line-number">396</span>                i = self._skip_preprocessor_directives(tokens, i)
</div>
<div class="line-uncovered">
<span class="line-number">397</span>                continue
</div>
<div class="line-context">
<span class="line-number">398</span>
</div>
<div class="line-context">
<span class="line-number">399</span>            # Skip function definitions (look for parentheses)
</div>
<div class="line-context">
<span class="line-number">400</span>            if self._looks_like_function(tokens, i):
</div>
<div class="line-context">
<span class="line-number">401</span>                i = self._skip_function(tokens, i)
</div>
<div class="line-context">
<span class="line-number">402</span>                continue
</div>
<div class="line-context">
<span class="line-number">403</span>
</div>
<div class="line-context">
<span class="line-number">404</span>            # Skip struct/enum/union definitions
</div>
<div class="line-context">
<span class="line-number">405</span>            if tokens[i].type in [
</div>
<div class="line-context">
<span class="line-number">406</span>                TokenType.STRUCT,
</div>
<div class="line-context">
<span class="line-number">407</span>                TokenType.ENUM,
</div>
</div>
<h4>Lines 417-426</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">407</span>                TokenType.ENUM,
</div>
<div class="line-context">
<span class="line-number">408</span>                TokenType.UNION,
</div>
<div class="line-context">
<span class="line-number">409</span>                TokenType.TYPEDEF,
</div>
<div class="line-context">
<span class="line-number">410</span>            ]:
</div>
<div class="line-context">
<span class="line-number">411</span>                i = self._skip_structure_definition(tokens, i)
</div>
<div class="line-context">
<span class="line-number">412</span>                continue
</div>
<div class="line-context">
<span class="line-number">413</span>
</div>
<div class="line-context">
<span class="line-number">414</span>            # Skip if we're inside a struct definition (look for opening brace)
</div>
<div class="line-context">
<span class="line-number">415</span>            if i > 0 and tokens[i - 1].type == TokenType.LBRACE:
</div>
<div class="line-context">
<span class="line-number">416</span>                # We're inside a struct, skip until closing brace
</div>
<div class="line-uncovered">
<span class="line-number">417</span>                brace_count = 1
</div>
<div class="line-uncovered">
<span class="line-number">418</span>                j = i
</div>
<div class="line-uncovered">
<span class="line-number">419</span>                while j < len(tokens) and brace_count > 0:
</div>
<div class="line-uncovered">
<span class="line-number">420</span>                    if tokens[j].type == TokenType.LBRACE:
</div>
<div class="line-uncovered">
<span class="line-number">421</span>                        brace_count += 1
</div>
<div class="line-uncovered">
<span class="line-number">422</span>                    elif tokens[j].type == TokenType.RBRACE:
</div>
<div class="line-uncovered">
<span class="line-number">423</span>                        brace_count -= 1
</div>
<div class="line-uncovered">
<span class="line-number">424</span>                    j += 1
</div>
<div class="line-uncovered">
<span class="line-number">425</span>                i = j
</div>
<div class="line-uncovered">
<span class="line-number">426</span>                continue
</div>
<div class="line-context">
<span class="line-number">427</span>
</div>
<div class="line-context">
<span class="line-number">428</span>            # Skip macros and other preprocessor content
</div>
<div class="line-context">
<span class="line-number">429</span>            if tokens[i].type == TokenType.DEFINE:
</div>
<div class="line-context">
<span class="line-number">430</span>                # Skip the entire macro content (multi-line macros are now merged)
</div>
<div class="line-context">
<span class="line-number">431</span>                i += 1
</div>
<div class="line-context">
<span class="line-number">432</span>                continue
</div>
<div class="line-context">
<span class="line-number">433</span>
</div>
<div class="line-context">
<span class="line-number">434</span>            # Additional check: skip if we're inside any brace block (struct, function, etc.)
</div>
<div class="line-context">
<span class="line-number">435</span>            brace_count = 0
</div>
<div class="line-context">
<span class="line-number">436</span>            j = i - 1
</div>
</div>
<h4>Lines 431-432</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">421</span>                        brace_count += 1
</div>
<div class="line-context">
<span class="line-number">422</span>                    elif tokens[j].type == TokenType.RBRACE:
</div>
<div class="line-context">
<span class="line-number">423</span>                        brace_count -= 1
</div>
<div class="line-context">
<span class="line-number">424</span>                    j += 1
</div>
<div class="line-context">
<span class="line-number">425</span>                i = j
</div>
<div class="line-context">
<span class="line-number">426</span>                continue
</div>
<div class="line-context">
<span class="line-number">427</span>
</div>
<div class="line-context">
<span class="line-number">428</span>            # Skip macros and other preprocessor content
</div>
<div class="line-context">
<span class="line-number">429</span>            if tokens[i].type == TokenType.DEFINE:
</div>
<div class="line-context">
<span class="line-number">430</span>                # Skip the entire macro content (multi-line macros are now merged)
</div>
<div class="line-uncovered">
<span class="line-number">431</span>                i += 1
</div>
<div class="line-uncovered">
<span class="line-number">432</span>                continue
</div>
<div class="line-context">
<span class="line-number">433</span>
</div>
<div class="line-context">
<span class="line-number">434</span>            # Additional check: skip if we're inside any brace block (struct, function, etc.)
</div>
<div class="line-context">
<span class="line-number">435</span>            brace_count = 0
</div>
<div class="line-context">
<span class="line-number">436</span>            j = i - 1
</div>
<div class="line-context">
<span class="line-number">437</span>            while j >= 0:
</div>
<div class="line-context">
<span class="line-number">438</span>                if tokens[j].type == TokenType.RBRACE:
</div>
<div class="line-context">
<span class="line-number">439</span>                    brace_count += 1
</div>
<div class="line-context">
<span class="line-number">440</span>                elif tokens[j].type == TokenType.LBRACE:
</div>
<div class="line-context">
<span class="line-number">441</span>                    brace_count -= 1
</div>
<div class="line-context">
<span class="line-number">442</span>                    if brace_count < 0:
</div>
</div>
<h4>Lines 480-481</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">470</span>                                globals_list.append(
</div>
<div class="line-context">
<span class="line-number">471</span>                                    Field(
</div>
<div class="line-context">
<span class="line-number">472</span>                                        name=stripped_name,
</div>
<div class="line-context">
<span class="line-number">473</span>                                        type=stripped_type,
</div>
<div class="line-context">
<span class="line-number">474</span>                                        value=var_value,
</div>
<div class="line-context">
<span class="line-number">475</span>                                    )
</div>
<div class="line-context">
<span class="line-number">476</span>                                )
</div>
<div class="line-context">
<span class="line-number">477</span>                                self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">478</span>                                    f"Parsed global: {stripped_name} : {stripped_type}"
</div>
<div class="line-context">
<span class="line-number">479</span>                                )
</div>
<div class="line-uncovered">
<span class="line-number">480</span>                        except Exception as e:
</div>
<div class="line-uncovered">
<span class="line-number">481</span>                            self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">482</span>                                f"Error creating global field {var_name}: {e}"
</div>
<div class="line-context">
<span class="line-number">483</span>                            )
</div>
<div class="line-context">
<span class="line-number">484</span>                    i = self._skip_to_semicolon(tokens, i)
</div>
<div class="line-context">
<span class="line-number">485</span>                else:
</div>
<div class="line-context">
<span class="line-number">486</span>                    i += 1
</div>
<div class="line-context">
<span class="line-number">487</span>
</div>
<div class="line-context">
<span class="line-number">488</span>        return globals_list
</div>
<div class="line-context">
<span class="line-number">489</span>
</div>
<div class="line-context">
<span class="line-number">490</span>    def _parse_includes_with_tokenizer(self, tokens) -> List[str]:
</div>
<div class="line-context">
<span class="line-number">491</span>        """Parse #include directives using tokenizer"""
</div>
</div>
<h4>Line 609</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">599</span>                        # Extract the tag name from the typedef
</div>
<div class="line-context">
<span class="line-number">600</span>                        return self._extract_tag_name_from_typedef(tokens, i)
</div>
<div class="line-context">
<span class="line-number">601</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">602</span>        return ""
</div>
<div class="line-context">
<span class="line-number">603</span>
</div>
<div class="line-context">
<span class="line-number">604</span>    def _extract_non_primitive_types(
</div>
<div class="line-context">
<span class="line-number">605</span>        self, type_str: str, available_types: Set[str]
</div>
<div class="line-context">
<span class="line-number">606</span>    ) -> List[str]:
</div>
<div class="line-context">
<span class="line-number">607</span>        """Extract non-primitive type names from a type string that exist in available_types"""
</div>
<div class="line-context">
<span class="line-number">608</span>        # Define primitive types
</div>
<div class="line-uncovered">
<span class="line-number">609</span>        primitive_types = {
</div>
<div class="line-context">
<span class="line-number">610</span>            "void",
</div>
<div class="line-context">
<span class="line-number">611</span>            "char",
</div>
<div class="line-context">
<span class="line-number">612</span>            "short",
</div>
<div class="line-context">
<span class="line-number">613</span>            "int",
</div>
<div class="line-context">
<span class="line-number">614</span>            "long",
</div>
<div class="line-context">
<span class="line-number">615</span>            "float",
</div>
<div class="line-context">
<span class="line-number">616</span>            "double",
</div>
<div class="line-context">
<span class="line-number">617</span>            "signed",
</div>
<div class="line-context">
<span class="line-number">618</span>            "unsigned",
</div>
<div class="line-context">
<span class="line-number">619</span>            "const",
</div>
</div>
<h4>Line 647</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">637</span>            "intptr_t",
</div>
<div class="line-context">
<span class="line-number">638</span>            "uintptr_t",
</div>
<div class="line-context">
<span class="line-number">639</span>            "bool",
</div>
<div class="line-context">
<span class="line-number">640</span>            "true",
</div>
<div class="line-context">
<span class="line-number">641</span>            "false",
</div>
<div class="line-context">
<span class="line-number">642</span>            "NULL",
</div>
<div class="line-context">
<span class="line-number">643</span>            "nullptr",
</div>
<div class="line-context">
<span class="line-number">644</span>        }
</div>
<div class="line-context">
<span class="line-number">645</span>
</div>
<div class="line-context">
<span class="line-number">646</span>        # Remove common C keywords and operators
</div>
<div class="line-uncovered">
<span class="line-number">647</span>        import re
</div>
<div class="line-context">
<span class="line-number">648</span>
</div>
<div class="line-context">
<span class="line-number">649</span>        # Split by common delimiters and operators
</div>
<div class="line-context">
<span class="line-number">650</span>        parts = re.split(r"[\[\]\(\)\{\}\s\*&,;]", type_str)
</div>
<div class="line-context">
<span class="line-number">651</span>
</div>
<div class="line-context">
<span class="line-number">652</span>        # Extract potential type names that exist in available_types
</div>
<div class="line-context">
<span class="line-number">653</span>        types = []
</div>
<div class="line-context">
<span class="line-number">654</span>        for part in parts:
</div>
<div class="line-context">
<span class="line-number">655</span>            part = part.strip()
</div>
<div class="line-context">
<span class="line-number">656</span>            if part and len(part) > 1 and part not in primitive_types:
</div>
<div class="line-context">
<span class="line-number">657</span>                # Check if it looks like a type name (starts with letter, contains letters/numbers/underscores)
</div>
</div>
<h4>Line 650</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">640</span>            "true",
</div>
<div class="line-context">
<span class="line-number">641</span>            "false",
</div>
<div class="line-context">
<span class="line-number">642</span>            "NULL",
</div>
<div class="line-context">
<span class="line-number">643</span>            "nullptr",
</div>
<div class="line-context">
<span class="line-number">644</span>        }
</div>
<div class="line-context">
<span class="line-number">645</span>
</div>
<div class="line-context">
<span class="line-number">646</span>        # Remove common C keywords and operators
</div>
<div class="line-context">
<span class="line-number">647</span>        import re
</div>
<div class="line-context">
<span class="line-number">648</span>
</div>
<div class="line-context">
<span class="line-number">649</span>        # Split by common delimiters and operators
</div>
<div class="line-uncovered">
<span class="line-number">650</span>        parts = re.split(r"[\[\]\(\)\{\}\s\*&,;]", type_str)
</div>
<div class="line-context">
<span class="line-number">651</span>
</div>
<div class="line-context">
<span class="line-number">652</span>        # Extract potential type names that exist in available_types
</div>
<div class="line-context">
<span class="line-number">653</span>        types = []
</div>
<div class="line-context">
<span class="line-number">654</span>        for part in parts:
</div>
<div class="line-context">
<span class="line-number">655</span>            part = part.strip()
</div>
<div class="line-context">
<span class="line-number">656</span>            if part and len(part) > 1 and part not in primitive_types:
</div>
<div class="line-context">
<span class="line-number">657</span>                # Check if it looks like a type name (starts with letter, contains letters/numbers/underscores)
</div>
<div class="line-context">
<span class="line-number">658</span>                if re.match(r"^[a-zA-Z_][a-zA-Z0-9_]*$", part):
</div>
<div class="line-context">
<span class="line-number">659</span>                    # Only include if it exists in available_types
</div>
<div class="line-context">
<span class="line-number">660</span>                    if part in available_types:
</div>
</div>
<h4>Lines 653-656</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">643</span>            "nullptr",
</div>
<div class="line-context">
<span class="line-number">644</span>        }
</div>
<div class="line-context">
<span class="line-number">645</span>
</div>
<div class="line-context">
<span class="line-number">646</span>        # Remove common C keywords and operators
</div>
<div class="line-context">
<span class="line-number">647</span>        import re
</div>
<div class="line-context">
<span class="line-number">648</span>
</div>
<div class="line-context">
<span class="line-number">649</span>        # Split by common delimiters and operators
</div>
<div class="line-context">
<span class="line-number">650</span>        parts = re.split(r"[\[\]\(\)\{\}\s\*&,;]", type_str)
</div>
<div class="line-context">
<span class="line-number">651</span>
</div>
<div class="line-context">
<span class="line-number">652</span>        # Extract potential type names that exist in available_types
</div>
<div class="line-uncovered">
<span class="line-number">653</span>        types = []
</div>
<div class="line-uncovered">
<span class="line-number">654</span>        for part in parts:
</div>
<div class="line-uncovered">
<span class="line-number">655</span>            part = part.strip()
</div>
<div class="line-uncovered">
<span class="line-number">656</span>            if part and len(part) > 1 and part not in primitive_types:
</div>
<div class="line-context">
<span class="line-number">657</span>                # Check if it looks like a type name (starts with letter, contains letters/numbers/underscores)
</div>
<div class="line-context">
<span class="line-number">658</span>                if re.match(r"^[a-zA-Z_][a-zA-Z0-9_]*$", part):
</div>
<div class="line-context">
<span class="line-number">659</span>                    # Only include if it exists in available_types
</div>
<div class="line-context">
<span class="line-number">660</span>                    if part in available_types:
</div>
<div class="line-context">
<span class="line-number">661</span>                        types.append(part)
</div>
<div class="line-context">
<span class="line-number">662</span>
</div>
<div class="line-context">
<span class="line-number">663</span>        return list(set(types))  # Remove duplicates
</div>
<div class="line-context">
<span class="line-number">664</span>
</div>
<div class="line-context">
<span class="line-number">665</span>    def _find_c_files(self, project_root: Path, recursive_search: bool) -> List[Path]:
</div>
<div class="line-context">
<span class="line-number">666</span>        """Find all C/C++ files in the project"""
</div>
</div>
<h4>Line 658</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">648</span>
</div>
<div class="line-context">
<span class="line-number">649</span>        # Split by common delimiters and operators
</div>
<div class="line-context">
<span class="line-number">650</span>        parts = re.split(r"[\[\]\(\)\{\}\s\*&,;]", type_str)
</div>
<div class="line-context">
<span class="line-number">651</span>
</div>
<div class="line-context">
<span class="line-number">652</span>        # Extract potential type names that exist in available_types
</div>
<div class="line-context">
<span class="line-number">653</span>        types = []
</div>
<div class="line-context">
<span class="line-number">654</span>        for part in parts:
</div>
<div class="line-context">
<span class="line-number">655</span>            part = part.strip()
</div>
<div class="line-context">
<span class="line-number">656</span>            if part and len(part) > 1 and part not in primitive_types:
</div>
<div class="line-context">
<span class="line-number">657</span>                # Check if it looks like a type name (starts with letter, contains letters/numbers/underscores)
</div>
<div class="line-uncovered">
<span class="line-number">658</span>                if re.match(r"^[a-zA-Z_][a-zA-Z0-9_]*$", part):
</div>
<div class="line-context">
<span class="line-number">659</span>                    # Only include if it exists in available_types
</div>
<div class="line-context">
<span class="line-number">660</span>                    if part in available_types:
</div>
<div class="line-context">
<span class="line-number">661</span>                        types.append(part)
</div>
<div class="line-context">
<span class="line-number">662</span>
</div>
<div class="line-context">
<span class="line-number">663</span>        return list(set(types))  # Remove duplicates
</div>
<div class="line-context">
<span class="line-number">664</span>
</div>
<div class="line-context">
<span class="line-number">665</span>    def _find_c_files(self, project_root: Path, recursive_search: bool) -> List[Path]:
</div>
<div class="line-context">
<span class="line-number">666</span>        """Find all C/C++ files in the project"""
</div>
<div class="line-context">
<span class="line-number">667</span>        c_extensions = {".c", ".h", ".cpp", ".cc", ".cxx", ".hpp", ".hxx"}
</div>
<div class="line-context">
<span class="line-number">668</span>        files = []
</div>
</div>
<h4>Lines 660-661</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">650</span>        parts = re.split(r"[\[\]\(\)\{\}\s\*&,;]", type_str)
</div>
<div class="line-context">
<span class="line-number">651</span>
</div>
<div class="line-context">
<span class="line-number">652</span>        # Extract potential type names that exist in available_types
</div>
<div class="line-context">
<span class="line-number">653</span>        types = []
</div>
<div class="line-context">
<span class="line-number">654</span>        for part in parts:
</div>
<div class="line-context">
<span class="line-number">655</span>            part = part.strip()
</div>
<div class="line-context">
<span class="line-number">656</span>            if part and len(part) > 1 and part not in primitive_types:
</div>
<div class="line-context">
<span class="line-number">657</span>                # Check if it looks like a type name (starts with letter, contains letters/numbers/underscores)
</div>
<div class="line-context">
<span class="line-number">658</span>                if re.match(r"^[a-zA-Z_][a-zA-Z0-9_]*$", part):
</div>
<div class="line-context">
<span class="line-number">659</span>                    # Only include if it exists in available_types
</div>
<div class="line-uncovered">
<span class="line-number">660</span>                    if part in available_types:
</div>
<div class="line-uncovered">
<span class="line-number">661</span>                        types.append(part)
</div>
<div class="line-context">
<span class="line-number">662</span>
</div>
<div class="line-context">
<span class="line-number">663</span>        return list(set(types))  # Remove duplicates
</div>
<div class="line-context">
<span class="line-number">664</span>
</div>
<div class="line-context">
<span class="line-number">665</span>    def _find_c_files(self, project_root: Path, recursive_search: bool) -> List[Path]:
</div>
<div class="line-context">
<span class="line-number">666</span>        """Find all C/C++ files in the project"""
</div>
<div class="line-context">
<span class="line-number">667</span>        c_extensions = {".c", ".h", ".cpp", ".cc", ".cxx", ".hpp", ".hxx"}
</div>
<div class="line-context">
<span class="line-number">668</span>        files = []
</div>
<div class="line-context">
<span class="line-number">669</span>
</div>
<div class="line-context">
<span class="line-number">670</span>        self.logger.debug("Searching for files with extensions: %s", c_extensions)
</div>
<div class="line-context">
<span class="line-number">671</span>
</div>
</div>
<h4>Line 663</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">653</span>        types = []
</div>
<div class="line-context">
<span class="line-number">654</span>        for part in parts:
</div>
<div class="line-context">
<span class="line-number">655</span>            part = part.strip()
</div>
<div class="line-context">
<span class="line-number">656</span>            if part and len(part) > 1 and part not in primitive_types:
</div>
<div class="line-context">
<span class="line-number">657</span>                # Check if it looks like a type name (starts with letter, contains letters/numbers/underscores)
</div>
<div class="line-context">
<span class="line-number">658</span>                if re.match(r"^[a-zA-Z_][a-zA-Z0-9_]*$", part):
</div>
<div class="line-context">
<span class="line-number">659</span>                    # Only include if it exists in available_types
</div>
<div class="line-context">
<span class="line-number">660</span>                    if part in available_types:
</div>
<div class="line-context">
<span class="line-number">661</span>                        types.append(part)
</div>
<div class="line-context">
<span class="line-number">662</span>
</div>
<div class="line-uncovered">
<span class="line-number">663</span>        return list(set(types))  # Remove duplicates
</div>
<div class="line-context">
<span class="line-number">664</span>
</div>
<div class="line-context">
<span class="line-number">665</span>    def _find_c_files(self, project_root: Path, recursive_search: bool) -> List[Path]:
</div>
<div class="line-context">
<span class="line-number">666</span>        """Find all C/C++ files in the project"""
</div>
<div class="line-context">
<span class="line-number">667</span>        c_extensions = {".c", ".h", ".cpp", ".cc", ".cxx", ".hpp", ".hxx"}
</div>
<div class="line-context">
<span class="line-number">668</span>        files = []
</div>
<div class="line-context">
<span class="line-number">669</span>
</div>
<div class="line-context">
<span class="line-number">670</span>        self.logger.debug("Searching for files with extensions: %s", c_extensions)
</div>
<div class="line-context">
<span class="line-number">671</span>
</div>
<div class="line-context">
<span class="line-number">672</span>        if recursive_search:
</div>
<div class="line-context">
<span class="line-number">673</span>            for ext in c_extensions:
</div>
</div>
<h4>Lines 676-677</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">666</span>        """Find all C/C++ files in the project"""
</div>
<div class="line-context">
<span class="line-number">667</span>        c_extensions = {".c", ".h", ".cpp", ".cc", ".cxx", ".hpp", ".hxx"}
</div>
<div class="line-context">
<span class="line-number">668</span>        files = []
</div>
<div class="line-context">
<span class="line-number">669</span>
</div>
<div class="line-context">
<span class="line-number">670</span>        self.logger.debug("Searching for files with extensions: %s", c_extensions)
</div>
<div class="line-context">
<span class="line-number">671</span>
</div>
<div class="line-context">
<span class="line-number">672</span>        if recursive_search:
</div>
<div class="line-context">
<span class="line-number">673</span>            for ext in c_extensions:
</div>
<div class="line-context">
<span class="line-number">674</span>                files.extend(project_root.rglob(f"*{ext}"))
</div>
<div class="line-context">
<span class="line-number">675</span>        else:
</div>
<div class="line-uncovered">
<span class="line-number">676</span>            for ext in c_extensions:
</div>
<div class="line-uncovered">
<span class="line-number">677</span>                files.extend(project_root.glob(f"*{ext}"))
</div>
<div class="line-context">
<span class="line-number">678</span>
</div>
<div class="line-context">
<span class="line-number">679</span>        # Filter out hidden files and common exclude patterns
</div>
<div class="line-context">
<span class="line-number">680</span>        filtered_files = []
</div>
<div class="line-context">
<span class="line-number">681</span>        exclude_patterns = {".git", "__pycache__", "node_modules", ".vscode", ".idea"}
</div>
<div class="line-context">
<span class="line-number">682</span>
</div>
<div class="line-context">
<span class="line-number">683</span>        for file_path in files:
</div>
<div class="line-context">
<span class="line-number">684</span>            # Skip hidden files and directories
</div>
<div class="line-context">
<span class="line-number">685</span>            if any(part.startswith(".") for part in file_path.parts):
</div>
<div class="line-context">
<span class="line-number">686</span>                continue
</div>
<div class="line-context">
<span class="line-number">687</span>
</div>
</div>
<h4>Line 686</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">676</span>            for ext in c_extensions:
</div>
<div class="line-context">
<span class="line-number">677</span>                files.extend(project_root.glob(f"*{ext}"))
</div>
<div class="line-context">
<span class="line-number">678</span>
</div>
<div class="line-context">
<span class="line-number">679</span>        # Filter out hidden files and common exclude patterns
</div>
<div class="line-context">
<span class="line-number">680</span>        filtered_files = []
</div>
<div class="line-context">
<span class="line-number">681</span>        exclude_patterns = {".git", "__pycache__", "node_modules", ".vscode", ".idea"}
</div>
<div class="line-context">
<span class="line-number">682</span>
</div>
<div class="line-context">
<span class="line-number">683</span>        for file_path in files:
</div>
<div class="line-context">
<span class="line-number">684</span>            # Skip hidden files and directories
</div>
<div class="line-context">
<span class="line-number">685</span>            if any(part.startswith(".") for part in file_path.parts):
</div>
<div class="line-uncovered">
<span class="line-number">686</span>                continue
</div>
<div class="line-context">
<span class="line-number">687</span>
</div>
<div class="line-context">
<span class="line-number">688</span>            # Skip common exclude patterns
</div>
<div class="line-context">
<span class="line-number">689</span>            if any(pattern in file_path.parts for pattern in exclude_patterns):
</div>
<div class="line-context">
<span class="line-number">690</span>                continue
</div>
<div class="line-context">
<span class="line-number">691</span>
</div>
<div class="line-context">
<span class="line-number">692</span>            filtered_files.append(file_path)
</div>
<div class="line-context">
<span class="line-number">693</span>
</div>
<div class="line-context">
<span class="line-number">694</span>        self.logger.debug("Found %d C/C++ files after filtering", len(filtered_files))
</div>
<div class="line-context">
<span class="line-number">695</span>        return sorted(filtered_files)
</div>
<div class="line-context">
<span class="line-number">696</span>
</div>
</div>
<h4>Line 690</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">680</span>        filtered_files = []
</div>
<div class="line-context">
<span class="line-number">681</span>        exclude_patterns = {".git", "__pycache__", "node_modules", ".vscode", ".idea"}
</div>
<div class="line-context">
<span class="line-number">682</span>
</div>
<div class="line-context">
<span class="line-number">683</span>        for file_path in files:
</div>
<div class="line-context">
<span class="line-number">684</span>            # Skip hidden files and directories
</div>
<div class="line-context">
<span class="line-number">685</span>            if any(part.startswith(".") for part in file_path.parts):
</div>
<div class="line-context">
<span class="line-number">686</span>                continue
</div>
<div class="line-context">
<span class="line-number">687</span>
</div>
<div class="line-context">
<span class="line-number">688</span>            # Skip common exclude patterns
</div>
<div class="line-context">
<span class="line-number">689</span>            if any(pattern in file_path.parts for pattern in exclude_patterns):
</div>
<div class="line-uncovered">
<span class="line-number">690</span>                continue
</div>
<div class="line-context">
<span class="line-number">691</span>
</div>
<div class="line-context">
<span class="line-number">692</span>            filtered_files.append(file_path)
</div>
<div class="line-context">
<span class="line-number">693</span>
</div>
<div class="line-context">
<span class="line-number">694</span>        self.logger.debug("Found %d C/C++ files after filtering", len(filtered_files))
</div>
<div class="line-context">
<span class="line-number">695</span>        return sorted(filtered_files)
</div>
<div class="line-context">
<span class="line-number">696</span>
</div>
<div class="line-context">
<span class="line-number">697</span>    def _find_files_with_include_dependencies(
</div>
<div class="line-context">
<span class="line-number">698</span>        self, project_root: Path, recursive_search: bool, config: "Config"
</div>
<div class="line-context">
<span class="line-number">699</span>    ) -> List[Path]:
</div>
<div class="line-context">
<span class="line-number">700</span>        """Find C/C++ files based on configuration and include dependencies"""
</div>
</div>
<h4>Line 704</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">694</span>        self.logger.debug("Found %d C/C++ files after filtering", len(filtered_files))
</div>
<div class="line-context">
<span class="line-number">695</span>        return sorted(filtered_files)
</div>
<div class="line-context">
<span class="line-number">696</span>
</div>
<div class="line-context">
<span class="line-number">697</span>    def _find_files_with_include_dependencies(
</div>
<div class="line-context">
<span class="line-number">698</span>        self, project_root: Path, recursive_search: bool, config: "Config"
</div>
<div class="line-context">
<span class="line-number">699</span>    ) -> List[Path]:
</div>
<div class="line-context">
<span class="line-number">700</span>        """Find C/C++ files based on configuration and include dependencies"""
</div>
<div class="line-context">
<span class="line-number">701</span>
</div>
<div class="line-context">
<span class="line-number">702</span>        # If no config provided, fall back to old behavior
</div>
<div class="line-context">
<span class="line-number">703</span>        if config is None:
</div>
<div class="line-uncovered">
<span class="line-number">704</span>            return self._find_c_files(project_root, recursive_search)
</div>
<div class="line-context">
<span class="line-number">705</span>
</div>
<div class="line-context">
<span class="line-number">706</span>        # Get include depth from config
</div>
<div class="line-context">
<span class="line-number">707</span>        include_depth = getattr(config, "include_depth", 1)
</div>
<div class="line-context">
<span class="line-number">708</span>        self.logger.info("Using include depth: %d", include_depth)
</div>
<div class="line-context">
<span class="line-number">709</span>
</div>
<div class="line-context">
<span class="line-number">710</span>        # Step 1: Find all C/C++ files in the project
</div>
<div class="line-context">
<span class="line-number">711</span>        all_c_files = self._find_c_files(project_root, recursive_search)
</div>
<div class="line-context">
<span class="line-number">712</span>        self.logger.debug("All C files found: %s", [f.name for f in all_c_files])
</div>
<div class="line-context">
<span class="line-number">713</span>
</div>
<div class="line-context">
<span class="line-number">714</span>        # Step 2: Apply initial file filtering (include/exclude patterns) and separate .c and .h files
</div>
</div>
<h4>Line 739</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">729</span>            else:
</div>
<div class="line-context">
<span class="line-number">730</span>                self.logger.debug("Excluded file after filtering: %s", relative_path)
</div>
<div class="line-context">
<span class="line-number">731</span>
</div>
<div class="line-context">
<span class="line-number">732</span>        self.logger.info(
</div>
<div class="line-context">
<span class="line-number">733</span>            f"Initial C files after filtering: {len(initial_c_files)} files"
</div>
<div class="line-context">
<span class="line-number">734</span>        )
</div>
<div class="line-context">
<span class="line-number">735</span>        self.logger.debug("Initial C files: %s", [f.name for f in initial_c_files])
</div>
<div class="line-context">
<span class="line-number">736</span>
</div>
<div class="line-context">
<span class="line-number">737</span>        # Step 3: If include_depth is 0, return only the initially filtered C files
</div>
<div class="line-context">
<span class="line-number">738</span>        if include_depth == 0:
</div>
<div class="line-uncovered">
<span class="line-number">739</span>            return initial_c_files
</div>
<div class="line-context">
<span class="line-number">740</span>
</div>
<div class="line-context">
<span class="line-number">741</span>        # Step 4: Process include dependencies for N iterations
</div>
<div class="line-context">
<span class="line-number">742</span>        files_to_parse = set(initial_c_files)
</div>
<div class="line-context">
<span class="line-number">743</span>
</div>
<div class="line-context">
<span class="line-number">744</span>        for iteration in range(include_depth):
</div>
<div class="line-context">
<span class="line-number">745</span>            self.logger.info("Processing include iteration %d", iteration + 1)
</div>
<div class="line-context">
<span class="line-number">746</span>
</div>
<div class="line-context">
<span class="line-number">747</span>            # Get the files that were in the list at the start of this iteration
</div>
<div class="line-context">
<span class="line-number">748</span>            files_at_start_of_iteration = list(files_to_parse)
</div>
<div class="line-context">
<span class="line-number">749</span>            self.logger.debug(
</div>
</div>
<h4>Line 776</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">766</span>                        # Check if the included file should be included based on config
</div>
<div class="line-context">
<span class="line-number">767</span>                        relative_included_path = str(
</div>
<div class="line-context">
<span class="line-number">768</span>                            included_file.relative_to(project_root)
</div>
<div class="line-context">
<span class="line-number">769</span>                        )
</div>
<div class="line-context">
<span class="line-number">770</span>                        if self._should_include_file(relative_included_path, config):
</div>
<div class="line-context">
<span class="line-number">771</span>                            new_includes.add(included_file)
</div>
<div class="line-context">
<span class="line-number">772</span>                            self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">773</span>                                f"Added included file in iteration {iteration + 1}: {relative_included_path}"
</div>
<div class="line-context">
<span class="line-number">774</span>                            )
</div>
<div class="line-context">
<span class="line-number">775</span>                        else:
</div>
<div class="line-uncovered">
<span class="line-number">776</span>                            self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">777</span>                                f"Excluded included file due to config: {relative_included_path}"
</div>
<div class="line-context">
<span class="line-number">778</span>                            )
</div>
<div class="line-context">
<span class="line-number">779</span>                    elif included_file:
</div>
<div class="line-context">
<span class="line-number">780</span>                        self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">781</span>                            f"Included file already in list: {included_file.name}"
</div>
<div class="line-context">
<span class="line-number">782</span>                        )
</div>
<div class="line-context">
<span class="line-number">783</span>                    else:
</div>
<div class="line-context">
<span class="line-number">784</span>                        self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">785</span>                            f"Could not find included file: {include_name}"
</div>
<div class="line-context">
<span class="line-number">786</span>                        )
</div>
</div>
<h4>Line 848</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">838</span>        # Try to find the file in subdirectories of the project root
</div>
<div class="line-context">
<span class="line-number">839</span>        if project_root:
</div>
<div class="line-context">
<span class="line-number">840</span>            for ext in [".h", ".hpp", ".c", ".cpp"]:
</div>
<div class="line-context">
<span class="line-number">841</span>                full_name = (
</div>
<div class="line-context">
<span class="line-number">842</span>                    include_name
</div>
<div class="line-context">
<span class="line-number">843</span>                    if include_name.endswith(ext)
</div>
<div class="line-context">
<span class="line-number">844</span>                    else f"{include_name}{ext}"
</div>
<div class="line-context">
<span class="line-number">845</span>                )
</div>
<div class="line-context">
<span class="line-number">846</span>                # Search recursively in project root
</div>
<div class="line-context">
<span class="line-number">847</span>                for found_file in project_root.rglob(full_name):
</div>
<div class="line-uncovered">
<span class="line-number">848</span>                    if found_file.is_file():
</div>
<div class="line-context">
<span class="line-number">849</span>                        # For backward compatibility with tests, return full path if it's a test
</div>
<div class="line-context">
<span class="line-number">850</span>                        # Otherwise return filename for simplified tracking
</div>
<div class="line-context">
<span class="line-number">851</span>                        if "tmp" in str(found_file):
</div>
<div class="line-context">
<span class="line-number">852</span>                            return found_file
</div>
<div class="line-context">
<span class="line-number">853</span>                        else:
</div>
<div class="line-context">
<span class="line-number">854</span>                            return found_file
</div>
<div class="line-context">
<span class="line-number">855</span>
</div>
<div class="line-context">
<span class="line-number">856</span>        # If we get here, the file was not found - cache this result
</div>
<div class="line-context">
<span class="line-number">857</span>        self._failed_includes_cache.add(cache_key)
</div>
<div class="line-context">
<span class="line-number">858</span>        self.logger.debug("Cached failed include search for '%s'", include_name)
</div>
</div>
<h4>Lines 851-852</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">841</span>                full_name = (
</div>
<div class="line-context">
<span class="line-number">842</span>                    include_name
</div>
<div class="line-context">
<span class="line-number">843</span>                    if include_name.endswith(ext)
</div>
<div class="line-context">
<span class="line-number">844</span>                    else f"{include_name}{ext}"
</div>
<div class="line-context">
<span class="line-number">845</span>                )
</div>
<div class="line-context">
<span class="line-number">846</span>                # Search recursively in project root
</div>
<div class="line-context">
<span class="line-number">847</span>                for found_file in project_root.rglob(full_name):
</div>
<div class="line-context">
<span class="line-number">848</span>                    if found_file.is_file():
</div>
<div class="line-context">
<span class="line-number">849</span>                        # For backward compatibility with tests, return full path if it's a test
</div>
<div class="line-context">
<span class="line-number">850</span>                        # Otherwise return filename for simplified tracking
</div>
<div class="line-uncovered">
<span class="line-number">851</span>                        if "tmp" in str(found_file):
</div>
<div class="line-uncovered">
<span class="line-number">852</span>                            return found_file
</div>
<div class="line-context">
<span class="line-number">853</span>                        else:
</div>
<div class="line-context">
<span class="line-number">854</span>                            return found_file
</div>
<div class="line-context">
<span class="line-number">855</span>
</div>
<div class="line-context">
<span class="line-number">856</span>        # If we get here, the file was not found - cache this result
</div>
<div class="line-context">
<span class="line-number">857</span>        self._failed_includes_cache.add(cache_key)
</div>
<div class="line-context">
<span class="line-number">858</span>        self.logger.debug("Cached failed include search for '%s'", include_name)
</div>
<div class="line-context">
<span class="line-number">859</span>        return None
</div>
<div class="line-context">
<span class="line-number">860</span>
</div>
<div class="line-context">
<span class="line-number">861</span>    def _extract_includes_from_file(self, file_path: Path) -> List[str]:
</div>
<div class="line-context">
<span class="line-number">862</span>        """Extract include statements from a file without full parsing"""
</div>
</div>
<h4>Line 854</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">844</span>                    else f"{include_name}{ext}"
</div>
<div class="line-context">
<span class="line-number">845</span>                )
</div>
<div class="line-context">
<span class="line-number">846</span>                # Search recursively in project root
</div>
<div class="line-context">
<span class="line-number">847</span>                for found_file in project_root.rglob(full_name):
</div>
<div class="line-context">
<span class="line-number">848</span>                    if found_file.is_file():
</div>
<div class="line-context">
<span class="line-number">849</span>                        # For backward compatibility with tests, return full path if it's a test
</div>
<div class="line-context">
<span class="line-number">850</span>                        # Otherwise return filename for simplified tracking
</div>
<div class="line-context">
<span class="line-number">851</span>                        if "tmp" in str(found_file):
</div>
<div class="line-context">
<span class="line-number">852</span>                            return found_file
</div>
<div class="line-context">
<span class="line-number">853</span>                        else:
</div>
<div class="line-uncovered">
<span class="line-number">854</span>                            return found_file
</div>
<div class="line-context">
<span class="line-number">855</span>
</div>
<div class="line-context">
<span class="line-number">856</span>        # If we get here, the file was not found - cache this result
</div>
<div class="line-context">
<span class="line-number">857</span>        self._failed_includes_cache.add(cache_key)
</div>
<div class="line-context">
<span class="line-number">858</span>        self.logger.debug("Cached failed include search for '%s'", include_name)
</div>
<div class="line-context">
<span class="line-number">859</span>        return None
</div>
<div class="line-context">
<span class="line-number">860</span>
</div>
<div class="line-context">
<span class="line-number">861</span>    def _extract_includes_from_file(self, file_path: Path) -> List[str]:
</div>
<div class="line-context">
<span class="line-number">862</span>        """Extract include statements from a file without full parsing"""
</div>
<div class="line-context">
<span class="line-number">863</span>        try:
</div>
<div class="line-context">
<span class="line-number">864</span>            encoding = self._detect_encoding(file_path)
</div>
</div>
<h4>Lines 872-874</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">862</span>        """Extract include statements from a file without full parsing"""
</div>
<div class="line-context">
<span class="line-number">863</span>        try:
</div>
<div class="line-context">
<span class="line-number">864</span>            encoding = self._detect_encoding(file_path)
</div>
<div class="line-context">
<span class="line-number">865</span>            with open(file_path, "r", encoding=encoding) as f:
</div>
<div class="line-context">
<span class="line-number">866</span>                content = f.read()
</div>
<div class="line-context">
<span class="line-number">867</span>
</div>
<div class="line-context">
<span class="line-number">868</span>            # Tokenize and extract includes
</div>
<div class="line-context">
<span class="line-number">869</span>            tokens = self.tokenizer.tokenize(content)
</div>
<div class="line-context">
<span class="line-number">870</span>            return self._parse_includes_with_tokenizer(tokens)
</div>
<div class="line-context">
<span class="line-number">871</span>
</div>
<div class="line-uncovered">
<span class="line-number">872</span>        except Exception as e:
</div>
<div class="line-uncovered">
<span class="line-number">873</span>            self.logger.warning("Failed to extract includes from %s: %s", file_path, e)
</div>
<div class="line-uncovered">
<span class="line-number">874</span>            return []
</div>
<div class="line-context">
<span class="line-number">875</span>
</div>
<div class="line-context">
<span class="line-number">876</span>    def _detect_encoding(self, file_path: Path) -> str:
</div>
<div class="line-context">
<span class="line-number">877</span>        """Detect file encoding with platform-aware fallbacks"""
</div>
<div class="line-context">
<span class="line-number">878</span>        return detect_file_encoding(file_path)
</div>
<div class="line-context">
<span class="line-number">879</span>
</div>
<div class="line-context">
<span class="line-number">880</span>    def _find_original_token_pos(self, all_tokens, filtered_tokens, filtered_pos):
</div>
<div class="line-context">
<span class="line-number">881</span>        """Find the position in all_tokens that corresponds to filtered_tokens[filtered_pos]"""
</div>
<div class="line-context">
<span class="line-number">882</span>        if filtered_pos >= len(filtered_tokens):
</div>
<div class="line-context">
<span class="line-number">883</span>            return None
</div>
<div class="line-context">
<span class="line-number">884</span>
</div>
</div>
<h4>Line 896</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">886</span>
</div>
<div class="line-context">
<span class="line-number">887</span>        # Search for the token in all_tokens by line and column
</div>
<div class="line-context">
<span class="line-number">888</span>        for i, token in enumerate(all_tokens):
</div>
<div class="line-context">
<span class="line-number">889</span>            if (
</div>
<div class="line-context">
<span class="line-number">890</span>                token.line == target_token.line
</div>
<div class="line-context">
<span class="line-number">891</span>                and token.column == target_token.column
</div>
<div class="line-context">
<span class="line-number">892</span>                and token.value == target_token.value
</div>
<div class="line-context">
<span class="line-number">893</span>            ):
</div>
<div class="line-context">
<span class="line-number">894</span>                return i
</div>
<div class="line-context">
<span class="line-number">895</span>
</div>
<div class="line-uncovered">
<span class="line-number">896</span>        return None
</div>
<div class="line-context">
<span class="line-number">897</span>
</div>
<div class="line-context">
<span class="line-number">898</span>    def _parse_single_typedef(self, tokens, start_pos):
</div>
<div class="line-context">
<span class="line-number">899</span>        """Parse a single typedef starting at the given position"""
</div>
<div class="line-context">
<span class="line-number">900</span>        # Skip 'typedef' keyword
</div>
<div class="line-context">
<span class="line-number">901</span>        pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">902</span>
</div>
<div class="line-context">
<span class="line-number">903</span>        # Skip whitespace and comments
</div>
<div class="line-context">
<span class="line-number">904</span>        while pos < len(tokens) and tokens[pos].type in [
</div>
<div class="line-context">
<span class="line-number">905</span>            TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">906</span>            TokenType.COMMENT,
</div>
</div>
<h4>Line 911</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">901</span>        pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">902</span>
</div>
<div class="line-context">
<span class="line-number">903</span>        # Skip whitespace and comments
</div>
<div class="line-context">
<span class="line-number">904</span>        while pos < len(tokens) and tokens[pos].type in [
</div>
<div class="line-context">
<span class="line-number">905</span>            TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">906</span>            TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">907</span>        ]:
</div>
<div class="line-context">
<span class="line-number">908</span>            pos += 1
</div>
<div class="line-context">
<span class="line-number">909</span>
</div>
<div class="line-context">
<span class="line-number">910</span>        if pos >= len(tokens):
</div>
<div class="line-uncovered">
<span class="line-number">911</span>            return None
</div>
<div class="line-context">
<span class="line-number">912</span>
</div>
<div class="line-context">
<span class="line-number">913</span>        # Check if it's a struct/enum/union typedef (we'll handle these separately)
</div>
<div class="line-context">
<span class="line-number">914</span>        if tokens[pos].type in [TokenType.STRUCT, TokenType.ENUM, TokenType.UNION]:
</div>
<div class="line-context">
<span class="line-number">915</span>            return self._parse_complex_typedef(tokens, pos)
</div>
<div class="line-context">
<span class="line-number">916</span>
</div>
<div class="line-context">
<span class="line-number">917</span>        # Collect all non-whitespace/comment tokens until semicolon
</div>
<div class="line-context">
<span class="line-number">918</span>        all_tokens = []
</div>
<div class="line-context">
<span class="line-number">919</span>        while pos < len(tokens) and tokens[pos].type != TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">920</span>            if tokens[pos].type not in [TokenType.WHITESPACE, TokenType.COMMENT]:
</div>
<div class="line-context">
<span class="line-number">921</span>                all_tokens.append(tokens[pos])
</div>
</div>
<h4>Line 925</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">915</span>            return self._parse_complex_typedef(tokens, pos)
</div>
<div class="line-context">
<span class="line-number">916</span>
</div>
<div class="line-context">
<span class="line-number">917</span>        # Collect all non-whitespace/comment tokens until semicolon
</div>
<div class="line-context">
<span class="line-number">918</span>        all_tokens = []
</div>
<div class="line-context">
<span class="line-number">919</span>        while pos < len(tokens) and tokens[pos].type != TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">920</span>            if tokens[pos].type not in [TokenType.WHITESPACE, TokenType.COMMENT]:
</div>
<div class="line-context">
<span class="line-number">921</span>                all_tokens.append(tokens[pos])
</div>
<div class="line-context">
<span class="line-number">922</span>            pos += 1
</div>
<div class="line-context">
<span class="line-number">923</span>
</div>
<div class="line-context">
<span class="line-number">924</span>        if len(all_tokens) < 2:
</div>
<div class="line-uncovered">
<span class="line-number">925</span>            return None
</div>
<div class="line-context">
<span class="line-number">926</span>
</div>
<div class="line-context">
<span class="line-number">927</span>        # Function pointer typedef: typedef ret (*name)(params);
</div>
<div class="line-context">
<span class="line-number">928</span>        for i in range(len(all_tokens) - 3):
</div>
<div class="line-context">
<span class="line-number">929</span>            if (
</div>
<div class="line-context">
<span class="line-number">930</span>                all_tokens[i].type
</div>
<div class="line-context">
<span class="line-number">931</span>                in [
</div>
<div class="line-context">
<span class="line-number">932</span>                    TokenType.IDENTIFIER,
</div>
<div class="line-context">
<span class="line-number">933</span>                    TokenType.INT,
</div>
<div class="line-context">
<span class="line-number">934</span>                    TokenType.VOID,
</div>
<div class="line-context">
<span class="line-number">935</span>                    TokenType.CHAR,
</div>
</div>
<h4>Lines 959-961</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">949</span>                original_type = " ".join(t.value for t in all_tokens)
</div>
<div class="line-context">
<span class="line-number">950</span>                return (typedef_name, original_type)
</div>
<div class="line-context">
<span class="line-number">951</span>
</div>
<div class="line-context">
<span class="line-number">952</span>        # Array typedef: typedef type name[size];
</div>
<div class="line-context">
<span class="line-number">953</span>        for i in range(len(all_tokens)):
</div>
<div class="line-context">
<span class="line-number">954</span>            if (
</div>
<div class="line-context">
<span class="line-number">955</span>                all_tokens[i].type == TokenType.LBRACKET
</div>
<div class="line-context">
<span class="line-number">956</span>                and i > 0
</div>
<div class="line-context">
<span class="line-number">957</span>                and all_tokens[i - 1].type == TokenType.IDENTIFIER
</div>
<div class="line-context">
<span class="line-number">958</span>            ):
</div>
<div class="line-uncovered">
<span class="line-number">959</span>                typedef_name = all_tokens[i - 1].value
</div>
<div class="line-uncovered">
<span class="line-number">960</span>                original_type = " ".join(t.value for t in all_tokens)
</div>
<div class="line-uncovered">
<span class="line-number">961</span>                return (typedef_name, original_type)
</div>
<div class="line-context">
<span class="line-number">962</span>
</div>
<div class="line-context">
<span class="line-number">963</span>        # Pointer typedef: typedef type * name;
</div>
<div class="line-context">
<span class="line-number">964</span>        for i in range(len(all_tokens) - 2):
</div>
<div class="line-context">
<span class="line-number">965</span>            if (
</div>
<div class="line-context">
<span class="line-number">966</span>                all_tokens[i].type == TokenType.ASTERISK
</div>
<div class="line-context">
<span class="line-number">967</span>                and all_tokens[i + 1].type == TokenType.IDENTIFIER
</div>
<div class="line-context">
<span class="line-number">968</span>            ):
</div>
<div class="line-context">
<span class="line-number">969</span>                typedef_name = all_tokens[i + 1].value
</div>
<div class="line-context">
<span class="line-number">970</span>                original_type = " ".join(t.value for t in all_tokens)
</div>
<div class="line-context">
<span class="line-number">971</span>                return (typedef_name, original_type)
</div>
</div>
<h4>Lines 969-971</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">959</span>                typedef_name = all_tokens[i - 1].value
</div>
<div class="line-context">
<span class="line-number">960</span>                original_type = " ".join(t.value for t in all_tokens)
</div>
<div class="line-context">
<span class="line-number">961</span>                return (typedef_name, original_type)
</div>
<div class="line-context">
<span class="line-number">962</span>
</div>
<div class="line-context">
<span class="line-number">963</span>        # Pointer typedef: typedef type * name;
</div>
<div class="line-context">
<span class="line-number">964</span>        for i in range(len(all_tokens) - 2):
</div>
<div class="line-context">
<span class="line-number">965</span>            if (
</div>
<div class="line-context">
<span class="line-number">966</span>                all_tokens[i].type == TokenType.ASTERISK
</div>
<div class="line-context">
<span class="line-number">967</span>                and all_tokens[i + 1].type == TokenType.IDENTIFIER
</div>
<div class="line-context">
<span class="line-number">968</span>            ):
</div>
<div class="line-uncovered">
<span class="line-number">969</span>                typedef_name = all_tokens[i + 1].value
</div>
<div class="line-uncovered">
<span class="line-number">970</span>                original_type = " ".join(t.value for t in all_tokens)
</div>
<div class="line-uncovered">
<span class="line-number">971</span>                return (typedef_name, original_type)
</div>
<div class="line-context">
<span class="line-number">972</span>
</div>
<div class="line-context">
<span class="line-number">973</span>        # Simple typedef: the last token should be the typedef name, everything else is the type
</div>
<div class="line-context">
<span class="line-number">974</span>        typedef_name = all_tokens[-1].value
</div>
<div class="line-context">
<span class="line-number">975</span>        type_tokens = all_tokens[:-1]
</div>
<div class="line-context">
<span class="line-number">976</span>        original_type = " ".join(t.value for t in type_tokens)
</div>
<div class="line-context">
<span class="line-number">977</span>        return (typedef_name, original_type)
</div>
<div class="line-context">
<span class="line-number">978</span>
</div>
<div class="line-context">
<span class="line-number">979</span>    def _parse_complex_typedef(self, tokens, start_pos):
</div>
<div class="line-context">
<span class="line-number">980</span>        """Parse complex typedef (struct/enum/union)"""
</div>
<div class="line-context">
<span class="line-number">981</span>        # For now, return a simplified version
</div>
</div>
<h4>Line 1007</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">997</span>        pos += 1
</div>
<div class="line-context">
<span class="line-number">998</span>
</div>
<div class="line-context">
<span class="line-number">999</span>        while pos < len(tokens) and brace_count > 0:
</div>
<div class="line-context">
<span class="line-number">1000</span>            if tokens[pos].type == TokenType.LBRACE:
</div>
<div class="line-context">
<span class="line-number">1001</span>                brace_count += 1
</div>
<div class="line-context">
<span class="line-number">1002</span>            elif tokens[pos].type == TokenType.RBRACE:
</div>
<div class="line-context">
<span class="line-number">1003</span>                brace_count -= 1
</div>
<div class="line-context">
<span class="line-number">1004</span>            pos += 1
</div>
<div class="line-context">
<span class="line-number">1005</span>
</div>
<div class="line-context">
<span class="line-number">1006</span>        if brace_count > 0:
</div>
<div class="line-uncovered">
<span class="line-number">1007</span>            return None
</div>
<div class="line-context">
<span class="line-number">1008</span>
</div>
<div class="line-context">
<span class="line-number">1009</span>        # Find typedef name after closing brace
</div>
<div class="line-context">
<span class="line-number">1010</span>        while pos < len(tokens) and tokens[pos].type in [
</div>
<div class="line-context">
<span class="line-number">1011</span>            TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">1012</span>            TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">1013</span>        ]:
</div>
<div class="line-context">
<span class="line-number">1014</span>            pos += 1
</div>
<div class="line-context">
<span class="line-number">1015</span>
</div>
<div class="line-context">
<span class="line-number">1016</span>        if pos < len(tokens) and tokens[pos].type == TokenType.IDENTIFIER:
</div>
<div class="line-context">
<span class="line-number">1017</span>            typedef_name = tokens[pos].value
</div>
</div>
<h4>Line 1036</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1026</span>        pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">1027</span>
</div>
<div class="line-context">
<span class="line-number">1028</span>        # Skip whitespace and comments
</div>
<div class="line-context">
<span class="line-number">1029</span>        while pos < len(tokens) and tokens[pos].type in [
</div>
<div class="line-context">
<span class="line-number">1030</span>            TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">1031</span>            TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">1032</span>        ]:
</div>
<div class="line-context">
<span class="line-number">1033</span>            pos += 1
</div>
<div class="line-context">
<span class="line-number">1034</span>
</div>
<div class="line-context">
<span class="line-number">1035</span>        if pos >= len(tokens):
</div>
<div class="line-uncovered">
<span class="line-number">1036</span>            return ""
</div>
<div class="line-context">
<span class="line-number">1037</span>
</div>
<div class="line-context">
<span class="line-number">1038</span>        # Check if it's a struct/enum/union
</div>
<div class="line-context">
<span class="line-number">1039</span>        if tokens[pos].type not in [TokenType.STRUCT, TokenType.ENUM, TokenType.UNION]:
</div>
<div class="line-context">
<span class="line-number">1040</span>            return ""
</div>
<div class="line-context">
<span class="line-number">1041</span>
</div>
<div class="line-context">
<span class="line-number">1042</span>        # Skip struct/enum/union keyword
</div>
<div class="line-context">
<span class="line-number">1043</span>        pos += 1
</div>
<div class="line-context">
<span class="line-number">1044</span>
</div>
<div class="line-context">
<span class="line-number">1045</span>        # Skip whitespace and comments
</div>
<div class="line-context">
<span class="line-number">1046</span>        while pos < len(tokens) and tokens[pos].type in [
</div>
</div>
<h4>Line 1040</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1030</span>            TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">1031</span>            TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">1032</span>        ]:
</div>
<div class="line-context">
<span class="line-number">1033</span>            pos += 1
</div>
<div class="line-context">
<span class="line-number">1034</span>
</div>
<div class="line-context">
<span class="line-number">1035</span>        if pos >= len(tokens):
</div>
<div class="line-context">
<span class="line-number">1036</span>            return ""
</div>
<div class="line-context">
<span class="line-number">1037</span>
</div>
<div class="line-context">
<span class="line-number">1038</span>        # Check if it's a struct/enum/union
</div>
<div class="line-context">
<span class="line-number">1039</span>        if tokens[pos].type not in [TokenType.STRUCT, TokenType.ENUM, TokenType.UNION]:
</div>
<div class="line-uncovered">
<span class="line-number">1040</span>            return ""
</div>
<div class="line-context">
<span class="line-number">1041</span>
</div>
<div class="line-context">
<span class="line-number">1042</span>        # Skip struct/enum/union keyword
</div>
<div class="line-context">
<span class="line-number">1043</span>        pos += 1
</div>
<div class="line-context">
<span class="line-number">1044</span>
</div>
<div class="line-context">
<span class="line-number">1045</span>        # Skip whitespace and comments
</div>
<div class="line-context">
<span class="line-number">1046</span>        while pos < len(tokens) and tokens[pos].type in [
</div>
<div class="line-context">
<span class="line-number">1047</span>            TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">1048</span>            TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">1049</span>        ]:
</div>
<div class="line-context">
<span class="line-number">1050</span>            pos += 1
</div>
</div>
<h4>Line 1120</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1110</span>                brace_count -= 1
</div>
<div class="line-context">
<span class="line-number">1111</span>                if brace_count == 0:
</div>
<div class="line-context">
<span class="line-number">1112</span>                    # Continue until semicolon
</div>
<div class="line-context">
<span class="line-number">1113</span>                    while i < len(tokens) and tokens[i].type != TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">1114</span>                        i += 1
</div>
<div class="line-context">
<span class="line-number">1115</span>                    return i + 1 if i < len(tokens) else i
</div>
<div class="line-context">
<span class="line-number">1116</span>            elif tokens[i].type == TokenType.SEMICOLON and brace_count == 0:
</div>
<div class="line-context">
<span class="line-number">1117</span>                return i + 1
</div>
<div class="line-context">
<span class="line-number">1118</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">1119</span>
</div>
<div class="line-uncovered">
<span class="line-number">1120</span>        return i
</div>
<div class="line-context">
<span class="line-number">1121</span>
</div>
<div class="line-context">
<span class="line-number">1122</span>    def _parse_global_variable(self, tokens, start_pos):
</div>
<div class="line-context">
<span class="line-number">1123</span>        """Parse a global variable declaration starting at start_pos"""
</div>
<div class="line-context">
<span class="line-number">1124</span>        # Look for pattern: [static/extern] type name [= value];
</div>
<div class="line-context">
<span class="line-number">1125</span>        i = start_pos
</div>
<div class="line-context">
<span class="line-number">1126</span>        collected_tokens = []
</div>
<div class="line-context">
<span class="line-number">1127</span>
</div>
<div class="line-context">
<span class="line-number">1128</span>        # Collect tokens until semicolon
</div>
<div class="line-context">
<span class="line-number">1129</span>        while i < len(tokens) and tokens[i].type != TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">1130</span>            if tokens[i].type not in [TokenType.WHITESPACE, TokenType.COMMENT]:
</div>
</div>
<h4>Line 1182</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1172</span>                    # Array declaration: find the identifier before the opening bracket
</div>
<div class="line-context">
<span class="line-number">1173</span>                    for j in range(bracket_idx - 1, start_idx, -1):
</div>
<div class="line-context">
<span class="line-number">1174</span>                        if collected_tokens[j].type == TokenType.LBRACKET:
</div>
<div class="line-context">
<span class="line-number">1175</span>                            # Found opening bracket, look for identifier before it
</div>
<div class="line-context">
<span class="line-number">1176</span>                            for k in range(j - 1, start_idx, -1):
</div>
<div class="line-context">
<span class="line-number">1177</span>                                if collected_tokens[k].type == TokenType.IDENTIFIER:
</div>
<div class="line-context">
<span class="line-number">1178</span>                                    var_name = collected_tokens[k].value
</div>
<div class="line-context">
<span class="line-number">1179</span>                                    type_tokens = collected_tokens[start_idx:k]
</div>
<div class="line-context">
<span class="line-number">1180</span>                                    var_type = " ".join(t.value for t in type_tokens)
</div>
<div class="line-context">
<span class="line-number">1181</span>                                    return (var_name, var_type, None)
</div>
<div class="line-uncovered">
<span class="line-number">1182</span>                            break
</div>
<div class="line-context">
<span class="line-number">1183</span>                else:
</div>
<div class="line-context">
<span class="line-number">1184</span>                    # Regular variable: last token is the name
</div>
<div class="line-context">
<span class="line-number">1185</span>                    var_name = collected_tokens[-1].value
</div>
<div class="line-context">
<span class="line-number">1186</span>                    type_tokens = collected_tokens[start_idx:-1]
</div>
<div class="line-context">
<span class="line-number">1187</span>                    var_type = " ".join(t.value for t in type_tokens)
</div>
<div class="line-context">
<span class="line-number">1188</span>                    return (var_name, var_type, None)
</div>
<div class="line-context">
<span class="line-number">1189</span>
</div>
<div class="line-context">
<span class="line-number">1190</span>        return None
</div>
<div class="line-context">
<span class="line-number">1191</span>
</div>
<div class="line-context">
<span class="line-number">1192</span>    def _skip_to_semicolon(self, tokens, start_pos):
</div>
</div>
<h4>Lines 1202-1203</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1192</span>    def _skip_to_semicolon(self, tokens, start_pos):
</div>
<div class="line-context">
<span class="line-number">1193</span>        """Skip to the next semicolon"""
</div>
<div class="line-context">
<span class="line-number">1194</span>        i = start_pos
</div>
<div class="line-context">
<span class="line-number">1195</span>        while i < len(tokens) and tokens[i].type != TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">1196</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">1197</span>        return i + 1 if i < len(tokens) else i
</div>
<div class="line-context">
<span class="line-number">1198</span>
</div>
<div class="line-context">
<span class="line-number">1199</span>    def _skip_preprocessor_directives(self, tokens, start_pos):
</div>
<div class="line-context">
<span class="line-number">1200</span>        """Skip preprocessor directives but keep their content for parsing"""
</div>
<div class="line-context">
<span class="line-number">1201</span>        # This method is deprecated - use the PreprocessorManager instead
</div>
<div class="line-uncovered">
<span class="line-number">1202</span>        i = start_pos
</div>
<div class="line-uncovered">
<span class="line-number">1203</span>        while i < len(tokens) and tokens[i].type == TokenType.PREPROCESSOR:
</div>
<div class="line-context">
<span class="line-number">1204</span>            # Skip the preprocessor directive itself
</div>
<div class="line-context">
<span class="line-number">1205</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">1206</span>        return i
</div>
<div class="line-context">
<span class="line-number">1207</span>
</div>
<div class="line-context">
<span class="line-number">1208</span>    def _parse_function_parameters(self, tokens, start_pos, end_pos, func_name):
</div>
<div class="line-context">
<span class="line-number">1209</span>        """Parse function parameters from token range"""
</div>
<div class="line-context">
<span class="line-number">1210</span>
</div>
<div class="line-context">
<span class="line-number">1211</span>        parameters = []
</div>
<div class="line-context">
<span class="line-number">1212</span>
</div>
<div class="line-context">
<span class="line-number">1213</span>        # Find the opening parenthesis for the function
</div>
</div>
<h4>Lines 1205-1206</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1195</span>        while i < len(tokens) and tokens[i].type != TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">1196</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">1197</span>        return i + 1 if i < len(tokens) else i
</div>
<div class="line-context">
<span class="line-number">1198</span>
</div>
<div class="line-context">
<span class="line-number">1199</span>    def _skip_preprocessor_directives(self, tokens, start_pos):
</div>
<div class="line-context">
<span class="line-number">1200</span>        """Skip preprocessor directives but keep their content for parsing"""
</div>
<div class="line-context">
<span class="line-number">1201</span>        # This method is deprecated - use the PreprocessorManager instead
</div>
<div class="line-context">
<span class="line-number">1202</span>        i = start_pos
</div>
<div class="line-context">
<span class="line-number">1203</span>        while i < len(tokens) and tokens[i].type == TokenType.PREPROCESSOR:
</div>
<div class="line-context">
<span class="line-number">1204</span>            # Skip the preprocessor directive itself
</div>
<div class="line-uncovered">
<span class="line-number">1205</span>            i += 1
</div>
<div class="line-uncovered">
<span class="line-number">1206</span>        return i
</div>
<div class="line-context">
<span class="line-number">1207</span>
</div>
<div class="line-context">
<span class="line-number">1208</span>    def _parse_function_parameters(self, tokens, start_pos, end_pos, func_name):
</div>
<div class="line-context">
<span class="line-number">1209</span>        """Parse function parameters from token range"""
</div>
<div class="line-context">
<span class="line-number">1210</span>
</div>
<div class="line-context">
<span class="line-number">1211</span>        parameters = []
</div>
<div class="line-context">
<span class="line-number">1212</span>
</div>
<div class="line-context">
<span class="line-number">1213</span>        # Find the opening parenthesis for the function
</div>
<div class="line-context">
<span class="line-number">1214</span>        paren_start = None
</div>
<div class="line-context">
<span class="line-number">1215</span>        paren_end = None
</div>
<div class="line-context">
<span class="line-number">1216</span>
</div>
</div>
<h4>Line 1224</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1214</span>        paren_start = None
</div>
<div class="line-context">
<span class="line-number">1215</span>        paren_end = None
</div>
<div class="line-context">
<span class="line-number">1216</span>
</div>
<div class="line-context">
<span class="line-number">1217</span>        for i in range(start_pos, min(end_pos + 1, len(tokens))):
</div>
<div class="line-context">
<span class="line-number">1218</span>            if tokens[i].type == TokenType.IDENTIFIER and tokens[i].value == func_name:
</div>
<div class="line-context">
<span class="line-number">1219</span>                # Look for opening parenthesis after function name
</div>
<div class="line-context">
<span class="line-number">1220</span>                for j in range(i + 1, min(end_pos + 1, len(tokens))):
</div>
<div class="line-context">
<span class="line-number">1221</span>                    if tokens[j].type == TokenType.LPAREN:
</div>
<div class="line-context">
<span class="line-number">1222</span>                        paren_start = j
</div>
<div class="line-context">
<span class="line-number">1223</span>                        break
</div>
<div class="line-uncovered">
<span class="line-number">1224</span>                    elif tokens[j].type not in [
</div>
<div class="line-context">
<span class="line-number">1225</span>                        TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">1226</span>                        TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">1227</span>                    ]:
</div>
<div class="line-context">
<span class="line-number">1228</span>                        break
</div>
<div class="line-context">
<span class="line-number">1229</span>                break
</div>
<div class="line-context">
<span class="line-number">1230</span>
</div>
<div class="line-context">
<span class="line-number">1231</span>        if paren_start is None:
</div>
<div class="line-context">
<span class="line-number">1232</span>            return parameters
</div>
<div class="line-context">
<span class="line-number">1233</span>
</div>
<div class="line-context">
<span class="line-number">1234</span>        # Find matching closing parenthesis
</div>
</div>
<h4>Line 1228</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1218</span>            if tokens[i].type == TokenType.IDENTIFIER and tokens[i].value == func_name:
</div>
<div class="line-context">
<span class="line-number">1219</span>                # Look for opening parenthesis after function name
</div>
<div class="line-context">
<span class="line-number">1220</span>                for j in range(i + 1, min(end_pos + 1, len(tokens))):
</div>
<div class="line-context">
<span class="line-number">1221</span>                    if tokens[j].type == TokenType.LPAREN:
</div>
<div class="line-context">
<span class="line-number">1222</span>                        paren_start = j
</div>
<div class="line-context">
<span class="line-number">1223</span>                        break
</div>
<div class="line-context">
<span class="line-number">1224</span>                    elif tokens[j].type not in [
</div>
<div class="line-context">
<span class="line-number">1225</span>                        TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">1226</span>                        TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">1227</span>                    ]:
</div>
<div class="line-uncovered">
<span class="line-number">1228</span>                        break
</div>
<div class="line-context">
<span class="line-number">1229</span>                break
</div>
<div class="line-context">
<span class="line-number">1230</span>
</div>
<div class="line-context">
<span class="line-number">1231</span>        if paren_start is None:
</div>
<div class="line-context">
<span class="line-number">1232</span>            return parameters
</div>
<div class="line-context">
<span class="line-number">1233</span>
</div>
<div class="line-context">
<span class="line-number">1234</span>        # Find matching closing parenthesis
</div>
<div class="line-context">
<span class="line-number">1235</span>        paren_depth = 1
</div>
<div class="line-context">
<span class="line-number">1236</span>        for i in range(paren_start + 1, min(end_pos + 1, len(tokens))):
</div>
<div class="line-context">
<span class="line-number">1237</span>            if tokens[i].type == TokenType.LPAREN:
</div>
<div class="line-context">
<span class="line-number">1238</span>                paren_depth += 1
</div>
</div>
<h4>Line 1232</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1222</span>                        paren_start = j
</div>
<div class="line-context">
<span class="line-number">1223</span>                        break
</div>
<div class="line-context">
<span class="line-number">1224</span>                    elif tokens[j].type not in [
</div>
<div class="line-context">
<span class="line-number">1225</span>                        TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">1226</span>                        TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">1227</span>                    ]:
</div>
<div class="line-context">
<span class="line-number">1228</span>                        break
</div>
<div class="line-context">
<span class="line-number">1229</span>                break
</div>
<div class="line-context">
<span class="line-number">1230</span>
</div>
<div class="line-context">
<span class="line-number">1231</span>        if paren_start is None:
</div>
<div class="line-uncovered">
<span class="line-number">1232</span>            return parameters
</div>
<div class="line-context">
<span class="line-number">1233</span>
</div>
<div class="line-context">
<span class="line-number">1234</span>        # Find matching closing parenthesis
</div>
<div class="line-context">
<span class="line-number">1235</span>        paren_depth = 1
</div>
<div class="line-context">
<span class="line-number">1236</span>        for i in range(paren_start + 1, min(end_pos + 1, len(tokens))):
</div>
<div class="line-context">
<span class="line-number">1237</span>            if tokens[i].type == TokenType.LPAREN:
</div>
<div class="line-context">
<span class="line-number">1238</span>                paren_depth += 1
</div>
<div class="line-context">
<span class="line-number">1239</span>            elif tokens[i].type == TokenType.RPAREN:
</div>
<div class="line-context">
<span class="line-number">1240</span>                paren_depth -= 1
</div>
<div class="line-context">
<span class="line-number">1241</span>                if paren_depth == 0:
</div>
<div class="line-context">
<span class="line-number">1242</span>                    paren_end = i
</div>
</div>
<h4>Line 1246</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1236</span>        for i in range(paren_start + 1, min(end_pos + 1, len(tokens))):
</div>
<div class="line-context">
<span class="line-number">1237</span>            if tokens[i].type == TokenType.LPAREN:
</div>
<div class="line-context">
<span class="line-number">1238</span>                paren_depth += 1
</div>
<div class="line-context">
<span class="line-number">1239</span>            elif tokens[i].type == TokenType.RPAREN:
</div>
<div class="line-context">
<span class="line-number">1240</span>                paren_depth -= 1
</div>
<div class="line-context">
<span class="line-number">1241</span>                if paren_depth == 0:
</div>
<div class="line-context">
<span class="line-number">1242</span>                    paren_end = i
</div>
<div class="line-context">
<span class="line-number">1243</span>                    break
</div>
<div class="line-context">
<span class="line-number">1244</span>
</div>
<div class="line-context">
<span class="line-number">1245</span>        if paren_end is None:
</div>
<div class="line-uncovered">
<span class="line-number">1246</span>            return parameters
</div>
<div class="line-context">
<span class="line-number">1247</span>
</div>
<div class="line-context">
<span class="line-number">1248</span>        # Parse parameter tokens between parentheses
</div>
<div class="line-context">
<span class="line-number">1249</span>        param_tokens = []
</div>
<div class="line-context">
<span class="line-number">1250</span>        for i in range(paren_start + 1, paren_end):
</div>
<div class="line-context">
<span class="line-number">1251</span>            if tokens[i].type not in [TokenType.WHITESPACE, TokenType.COMMENT]:
</div>
<div class="line-context">
<span class="line-number">1252</span>                param_tokens.append(tokens[i])
</div>
<div class="line-context">
<span class="line-number">1253</span>
</div>
<div class="line-context">
<span class="line-number">1254</span>        # If no parameters or just "void", return empty list
</div>
<div class="line-context">
<span class="line-number">1255</span>        if not param_tokens or (
</div>
<div class="line-context">
<span class="line-number">1256</span>            len(param_tokens) == 1 and param_tokens[0].value == "void"
</div>
</div>
<h4>Line 1285</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1275</span>            if param:
</div>
<div class="line-context">
<span class="line-number">1276</span>                parameters.append(param)
</div>
<div class="line-context">
<span class="line-number">1277</span>
</div>
<div class="line-context">
<span class="line-number">1278</span>        return parameters
</div>
<div class="line-context">
<span class="line-number">1279</span>
</div>
<div class="line-context">
<span class="line-number">1280</span>    def _parse_single_parameter(self, param_tokens):
</div>
<div class="line-context">
<span class="line-number">1281</span>        """Parse a single function parameter from tokens"""
</div>
<div class="line-context">
<span class="line-number">1282</span>        from .models import Field
</div>
<div class="line-context">
<span class="line-number">1283</span>
</div>
<div class="line-context">
<span class="line-number">1284</span>        if not param_tokens:
</div>
<div class="line-uncovered">
<span class="line-number">1285</span>            return None
</div>
<div class="line-context">
<span class="line-number">1286</span>
</div>
<div class="line-context">
<span class="line-number">1287</span>        # Handle variadic parameters (three consecutive dots)
</div>
<div class="line-context">
<span class="line-number">1288</span>        if len(param_tokens) == 3 and all(t.value == "." for t in param_tokens):
</div>
<div class="line-context">
<span class="line-number">1289</span>            return Field(name="...", type="...")
</div>
<div class="line-context">
<span class="line-number">1290</span>
</div>
<div class="line-context">
<span class="line-number">1291</span>        # Handle variadic parameters (single ... token)
</div>
<div class="line-context">
<span class="line-number">1292</span>        if len(param_tokens) == 1 and param_tokens[0].value == "...":
</div>
<div class="line-context">
<span class="line-number">1293</span>            return Field(name="...", type="...")
</div>
<div class="line-context">
<span class="line-number">1294</span>
</div>
<div class="line-context">
<span class="line-number">1295</span>        # For parameters like "int x" or "const char *name"
</div>
</div>
<h4>Line 1293</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1283</span>
</div>
<div class="line-context">
<span class="line-number">1284</span>        if not param_tokens:
</div>
<div class="line-context">
<span class="line-number">1285</span>            return None
</div>
<div class="line-context">
<span class="line-number">1286</span>
</div>
<div class="line-context">
<span class="line-number">1287</span>        # Handle variadic parameters (three consecutive dots)
</div>
<div class="line-context">
<span class="line-number">1288</span>        if len(param_tokens) == 3 and all(t.value == "." for t in param_tokens):
</div>
<div class="line-context">
<span class="line-number">1289</span>            return Field(name="...", type="...")
</div>
<div class="line-context">
<span class="line-number">1290</span>
</div>
<div class="line-context">
<span class="line-number">1291</span>        # Handle variadic parameters (single ... token)
</div>
<div class="line-context">
<span class="line-number">1292</span>        if len(param_tokens) == 1 and param_tokens[0].value == "...":
</div>
<div class="line-uncovered">
<span class="line-number">1293</span>            return Field(name="...", type="...")
</div>
<div class="line-context">
<span class="line-number">1294</span>
</div>
<div class="line-context">
<span class="line-number">1295</span>        # For parameters like "int x" or "const char *name"
</div>
<div class="line-context">
<span class="line-number">1296</span>        if len(param_tokens) >= 2:
</div>
<div class="line-context">
<span class="line-number">1297</span>            # Last token is usually the parameter name
</div>
<div class="line-context">
<span class="line-number">1298</span>            param_name = param_tokens[-1].value
</div>
<div class="line-context">
<span class="line-number">1299</span>            type_tokens = param_tokens[:-1]
</div>
<div class="line-context">
<span class="line-number">1300</span>            param_type = " ".join(t.value for t in type_tokens)
</div>
<div class="line-context">
<span class="line-number">1301</span>
</div>
<div class="line-context">
<span class="line-number">1302</span>            # Handle unnamed parameters (just type)
</div>
<div class="line-context">
<span class="line-number">1303</span>            if param_name in [
</div>
</div>
<h4>Lines 1340-1341</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1330</span>                "float",
</div>
<div class="line-context">
<span class="line-number">1331</span>                "double",
</div>
<div class="line-context">
<span class="line-number">1332</span>                "long",
</div>
<div class="line-context">
<span class="line-number">1333</span>                "short",
</div>
<div class="line-context">
<span class="line-number">1334</span>                "unsigned",
</div>
<div class="line-context">
<span class="line-number">1335</span>                "signed",
</div>
<div class="line-context">
<span class="line-number">1336</span>            ]:
</div>
<div class="line-context">
<span class="line-number">1337</span>                return Field(name="unnamed", type=token_value)
</div>
<div class="line-context">
<span class="line-number">1338</span>            else:
</div>
<div class="line-context">
<span class="line-number">1339</span>                # If we can't determine the type, use 'unknown' as a fallback
</div>
<div class="line-uncovered">
<span class="line-number">1340</span>                if token_value and token_value.strip():
</div>
<div class="line-uncovered">
<span class="line-number">1341</span>                    return Field(name=token_value.strip(), type="unknown")
</div>
<div class="line-context">
<span class="line-number">1342</span>                else:
</div>
<div class="line-context">
<span class="line-number">1343</span>                    return Field(name="unnamed", type="unknown")
</div>
<div class="line-context">
<span class="line-number">1344</span>
</div>
<div class="line-context">
<span class="line-number">1345</span>        return None
</div>
<div class="line-context">
<span class="line-number">1346</span>
</div>
<div class="line-context">
<span class="line-number">1347</span>    def _get_timestamp(self) -> str:
</div>
<div class="line-context">
<span class="line-number">1348</span>        """Get current timestamp string"""
</div>
<div class="line-context">
<span class="line-number">1349</span>        from datetime import datetime
</div>
<div class="line-context">
<span class="line-number">1350</span>
</div>
<div class="line-context">
<span class="line-number">1351</span>        return datetime.now().isoformat()
</div>
</div>
<h4>Line 1343</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1333</span>                "short",
</div>
<div class="line-context">
<span class="line-number">1334</span>                "unsigned",
</div>
<div class="line-context">
<span class="line-number">1335</span>                "signed",
</div>
<div class="line-context">
<span class="line-number">1336</span>            ]:
</div>
<div class="line-context">
<span class="line-number">1337</span>                return Field(name="unnamed", type=token_value)
</div>
<div class="line-context">
<span class="line-number">1338</span>            else:
</div>
<div class="line-context">
<span class="line-number">1339</span>                # If we can't determine the type, use 'unknown' as a fallback
</div>
<div class="line-context">
<span class="line-number">1340</span>                if token_value and token_value.strip():
</div>
<div class="line-context">
<span class="line-number">1341</span>                    return Field(name=token_value.strip(), type="unknown")
</div>
<div class="line-context">
<span class="line-number">1342</span>                else:
</div>
<div class="line-uncovered">
<span class="line-number">1343</span>                    return Field(name="unnamed", type="unknown")
</div>
<div class="line-context">
<span class="line-number">1344</span>
</div>
<div class="line-context">
<span class="line-number">1345</span>        return None
</div>
<div class="line-context">
<span class="line-number">1346</span>
</div>
<div class="line-context">
<span class="line-number">1347</span>    def _get_timestamp(self) -> str:
</div>
<div class="line-context">
<span class="line-number">1348</span>        """Get current timestamp string"""
</div>
<div class="line-context">
<span class="line-number">1349</span>        from datetime import datetime
</div>
<div class="line-context">
<span class="line-number">1350</span>
</div>
<div class="line-context">
<span class="line-number">1351</span>        return datetime.now().isoformat()
</div>
<div class="line-context">
<span class="line-number">1352</span>
</div>
<div class="line-context">
<span class="line-number">1353</span>    def get_failed_includes_cache_stats(self) -> dict:
</div>
</div>
<h4>Line 1345</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1335</span>                "signed",
</div>
<div class="line-context">
<span class="line-number">1336</span>            ]:
</div>
<div class="line-context">
<span class="line-number">1337</span>                return Field(name="unnamed", type=token_value)
</div>
<div class="line-context">
<span class="line-number">1338</span>            else:
</div>
<div class="line-context">
<span class="line-number">1339</span>                # If we can't determine the type, use 'unknown' as a fallback
</div>
<div class="line-context">
<span class="line-number">1340</span>                if token_value and token_value.strip():
</div>
<div class="line-context">
<span class="line-number">1341</span>                    return Field(name=token_value.strip(), type="unknown")
</div>
<div class="line-context">
<span class="line-number">1342</span>                else:
</div>
<div class="line-context">
<span class="line-number">1343</span>                    return Field(name="unnamed", type="unknown")
</div>
<div class="line-context">
<span class="line-number">1344</span>
</div>
<div class="line-uncovered">
<span class="line-number">1345</span>        return None
</div>
<div class="line-context">
<span class="line-number">1346</span>
</div>
<div class="line-context">
<span class="line-number">1347</span>    def _get_timestamp(self) -> str:
</div>
<div class="line-context">
<span class="line-number">1348</span>        """Get current timestamp string"""
</div>
<div class="line-context">
<span class="line-number">1349</span>        from datetime import datetime
</div>
<div class="line-context">
<span class="line-number">1350</span>
</div>
<div class="line-context">
<span class="line-number">1351</span>        return datetime.now().isoformat()
</div>
<div class="line-context">
<span class="line-number">1352</span>
</div>
<div class="line-context">
<span class="line-number">1353</span>    def get_failed_includes_cache_stats(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">1354</span>        """Get statistics about the failed includes cache"""
</div>
<div class="line-context">
<span class="line-number">1355</span>        return {
</div>
</div>
<h4>Line 1349</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1339</span>                # If we can't determine the type, use 'unknown' as a fallback
</div>
<div class="line-context">
<span class="line-number">1340</span>                if token_value and token_value.strip():
</div>
<div class="line-context">
<span class="line-number">1341</span>                    return Field(name=token_value.strip(), type="unknown")
</div>
<div class="line-context">
<span class="line-number">1342</span>                else:
</div>
<div class="line-context">
<span class="line-number">1343</span>                    return Field(name="unnamed", type="unknown")
</div>
<div class="line-context">
<span class="line-number">1344</span>
</div>
<div class="line-context">
<span class="line-number">1345</span>        return None
</div>
<div class="line-context">
<span class="line-number">1346</span>
</div>
<div class="line-context">
<span class="line-number">1347</span>    def _get_timestamp(self) -> str:
</div>
<div class="line-context">
<span class="line-number">1348</span>        """Get current timestamp string"""
</div>
<div class="line-uncovered">
<span class="line-number">1349</span>        from datetime import datetime
</div>
<div class="line-context">
<span class="line-number">1350</span>
</div>
<div class="line-context">
<span class="line-number">1351</span>        return datetime.now().isoformat()
</div>
<div class="line-context">
<span class="line-number">1352</span>
</div>
<div class="line-context">
<span class="line-number">1353</span>    def get_failed_includes_cache_stats(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">1354</span>        """Get statistics about the failed includes cache"""
</div>
<div class="line-context">
<span class="line-number">1355</span>        return {
</div>
<div class="line-context">
<span class="line-number">1356</span>            "cache_size": len(self._failed_includes_cache),
</div>
<div class="line-context">
<span class="line-number">1357</span>            "cached_includes": list(self._failed_includes_cache),
</div>
<div class="line-context">
<span class="line-number">1358</span>        }
</div>
<div class="line-context">
<span class="line-number">1359</span>
</div>
</div>
<h4>Line 1351</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1341</span>                    return Field(name=token_value.strip(), type="unknown")
</div>
<div class="line-context">
<span class="line-number">1342</span>                else:
</div>
<div class="line-context">
<span class="line-number">1343</span>                    return Field(name="unnamed", type="unknown")
</div>
<div class="line-context">
<span class="line-number">1344</span>
</div>
<div class="line-context">
<span class="line-number">1345</span>        return None
</div>
<div class="line-context">
<span class="line-number">1346</span>
</div>
<div class="line-context">
<span class="line-number">1347</span>    def _get_timestamp(self) -> str:
</div>
<div class="line-context">
<span class="line-number">1348</span>        """Get current timestamp string"""
</div>
<div class="line-context">
<span class="line-number">1349</span>        from datetime import datetime
</div>
<div class="line-context">
<span class="line-number">1350</span>
</div>
<div class="line-uncovered">
<span class="line-number">1351</span>        return datetime.now().isoformat()
</div>
<div class="line-context">
<span class="line-number">1352</span>
</div>
<div class="line-context">
<span class="line-number">1353</span>    def get_failed_includes_cache_stats(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">1354</span>        """Get statistics about the failed includes cache"""
</div>
<div class="line-context">
<span class="line-number">1355</span>        return {
</div>
<div class="line-context">
<span class="line-number">1356</span>            "cache_size": len(self._failed_includes_cache),
</div>
<div class="line-context">
<span class="line-number">1357</span>            "cached_includes": list(self._failed_includes_cache),
</div>
<div class="line-context">
<span class="line-number">1358</span>        }
</div>
<div class="line-context">
<span class="line-number">1359</span>
</div>
<div class="line-context">
<span class="line-number">1360</span>
</div>
<div class="line-context">
<span class="line-number">1361</span>class Parser:
</div>
</div>
<h4>Line 1355</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1345</span>        return None
</div>
<div class="line-context">
<span class="line-number">1346</span>
</div>
<div class="line-context">
<span class="line-number">1347</span>    def _get_timestamp(self) -> str:
</div>
<div class="line-context">
<span class="line-number">1348</span>        """Get current timestamp string"""
</div>
<div class="line-context">
<span class="line-number">1349</span>        from datetime import datetime
</div>
<div class="line-context">
<span class="line-number">1350</span>
</div>
<div class="line-context">
<span class="line-number">1351</span>        return datetime.now().isoformat()
</div>
<div class="line-context">
<span class="line-number">1352</span>
</div>
<div class="line-context">
<span class="line-number">1353</span>    def get_failed_includes_cache_stats(self) -> dict:
</div>
<div class="line-context">
<span class="line-number">1354</span>        """Get statistics about the failed includes cache"""
</div>
<div class="line-uncovered">
<span class="line-number">1355</span>        return {
</div>
<div class="line-context">
<span class="line-number">1356</span>            "cache_size": len(self._failed_includes_cache),
</div>
<div class="line-context">
<span class="line-number">1357</span>            "cached_includes": list(self._failed_includes_cache),
</div>
<div class="line-context">
<span class="line-number">1358</span>        }
</div>
<div class="line-context">
<span class="line-number">1359</span>
</div>
<div class="line-context">
<span class="line-number">1360</span>
</div>
<div class="line-context">
<span class="line-number">1361</span>class Parser:
</div>
<div class="line-context">
<span class="line-number">1362</span>    """Main parser class for Step 1: Parse C code files and generate model.json"""
</div>
<div class="line-context">
<span class="line-number">1363</span>
</div>
<div class="line-context">
<span class="line-number">1364</span>    def __init__(self):
</div>
<div class="line-context">
<span class="line-number">1365</span>        self.c_parser = CParser()
</div>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/preprocessor.py
<span class="coverage-info">65.76% (194/295 lines covered)</span>
</div>
<h4>Lines 54-56</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 44</span>
</div>
<div class="line-context">
<span class="line-number"> 45</span>    def __init__(self):
</div>
<div class="line-context">
<span class="line-number"> 46</span>        self.logger = logging.getLogger(__name__)
</div>
<div class="line-context">
<span class="line-number"> 47</span>        self.defined_macros: Set[str] = set()
</div>
<div class="line-context">
<span class="line-number"> 48</span>        self.macro_values: Dict[str, str] = {}
</div>
<div class="line-context">
<span class="line-number"> 49</span>        self.blocks: List[PreprocessorBlock] = []
</div>
<div class="line-context">
<span class="line-number"> 50</span>        self.current_block_stack: List[PreprocessorBlock] = []
</div>
<div class="line-context">
<span class="line-number"> 51</span>
</div>
<div class="line-context">
<span class="line-number"> 52</span>    def add_define(self, name: str, value: str = ""):
</div>
<div class="line-context">
<span class="line-number"> 53</span>        """Add a defined macro."""
</div>
<div class="line-uncovered">
<span class="line-number"> 54</span>        self.defined_macros.add(name)
</div>
<div class="line-uncovered">
<span class="line-number"> 55</span>        if value:
</div>
<div class="line-uncovered">
<span class="line-number"> 56</span>            self.macro_values[name] = value
</div>
<div class="line-context">
<span class="line-number"> 57</span>
</div>
<div class="line-context">
<span class="line-number"> 58</span>    def add_undef(self, name: str):
</div>
<div class="line-context">
<span class="line-number"> 59</span>        """Remove a defined macro."""
</div>
<div class="line-context">
<span class="line-number"> 60</span>        self.defined_macros.discard(name)
</div>
<div class="line-context">
<span class="line-number"> 61</span>        self.macro_values.pop(name, None)
</div>
<div class="line-context">
<span class="line-number"> 62</span>
</div>
<div class="line-context">
<span class="line-number"> 63</span>    def is_defined(self, name: str) -> bool:
</div>
<div class="line-context">
<span class="line-number"> 64</span>        """Check if a macro is defined."""
</div>
<div class="line-context">
<span class="line-number"> 65</span>        return name in self.defined_macros
</div>
<div class="line-context">
<span class="line-number"> 66</span>
</div>
</div>
<h4>Lines 60-61</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 50</span>        self.current_block_stack: List[PreprocessorBlock] = []
</div>
<div class="line-context">
<span class="line-number"> 51</span>
</div>
<div class="line-context">
<span class="line-number"> 52</span>    def add_define(self, name: str, value: str = ""):
</div>
<div class="line-context">
<span class="line-number"> 53</span>        """Add a defined macro."""
</div>
<div class="line-context">
<span class="line-number"> 54</span>        self.defined_macros.add(name)
</div>
<div class="line-context">
<span class="line-number"> 55</span>        if value:
</div>
<div class="line-context">
<span class="line-number"> 56</span>            self.macro_values[name] = value
</div>
<div class="line-context">
<span class="line-number"> 57</span>
</div>
<div class="line-context">
<span class="line-number"> 58</span>    def add_undef(self, name: str):
</div>
<div class="line-context">
<span class="line-number"> 59</span>        """Remove a defined macro."""
</div>
<div class="line-uncovered">
<span class="line-number"> 60</span>        self.defined_macros.discard(name)
</div>
<div class="line-uncovered">
<span class="line-number"> 61</span>        self.macro_values.pop(name, None)
</div>
<div class="line-context">
<span class="line-number"> 62</span>
</div>
<div class="line-context">
<span class="line-number"> 63</span>    def is_defined(self, name: str) -> bool:
</div>
<div class="line-context">
<span class="line-number"> 64</span>        """Check if a macro is defined."""
</div>
<div class="line-context">
<span class="line-number"> 65</span>        return name in self.defined_macros
</div>
<div class="line-context">
<span class="line-number"> 66</span>
</div>
<div class="line-context">
<span class="line-number"> 67</span>    def get_macro_value(self, name: str) -> str:
</div>
<div class="line-context">
<span class="line-number"> 68</span>        """Get the value of a defined macro."""
</div>
<div class="line-context">
<span class="line-number"> 69</span>        return self.macro_values.get(name, "")
</div>
<div class="line-context">
<span class="line-number"> 70</span>
</div>
<div class="line-context">
<span class="line-number"> 71</span>    def evaluate_condition(self, condition: str) -> bool:
</div>
</div>
<h4>Line 69</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 59</span>        """Remove a defined macro."""
</div>
<div class="line-context">
<span class="line-number"> 60</span>        self.defined_macros.discard(name)
</div>
<div class="line-context">
<span class="line-number"> 61</span>        self.macro_values.pop(name, None)
</div>
<div class="line-context">
<span class="line-number"> 62</span>
</div>
<div class="line-context">
<span class="line-number"> 63</span>    def is_defined(self, name: str) -> bool:
</div>
<div class="line-context">
<span class="line-number"> 64</span>        """Check if a macro is defined."""
</div>
<div class="line-context">
<span class="line-number"> 65</span>        return name in self.defined_macros
</div>
<div class="line-context">
<span class="line-number"> 66</span>
</div>
<div class="line-context">
<span class="line-number"> 67</span>    def get_macro_value(self, name: str) -> str:
</div>
<div class="line-context">
<span class="line-number"> 68</span>        """Get the value of a defined macro."""
</div>
<div class="line-uncovered">
<span class="line-number"> 69</span>        return self.macro_values.get(name, "")
</div>
<div class="line-context">
<span class="line-number"> 70</span>
</div>
<div class="line-context">
<span class="line-number"> 71</span>    def evaluate_condition(self, condition: str) -> bool:
</div>
<div class="line-context">
<span class="line-number"> 72</span>        """Evaluate a preprocessor condition."""
</div>
<div class="line-context">
<span class="line-number"> 73</span>        if not condition.strip():
</div>
<div class="line-context">
<span class="line-number"> 74</span>            return True
</div>
<div class="line-context">
<span class="line-number"> 75</span>
</div>
<div class="line-context">
<span class="line-number"> 76</span>        # Handle defined() operator
</div>
<div class="line-context">
<span class="line-number"> 77</span>        condition = self._expand_defined_operator(condition)
</div>
<div class="line-context">
<span class="line-number"> 78</span>
</div>
<div class="line-context">
<span class="line-number"> 79</span>        # Handle macro expansions
</div>
</div>
<h4>Lines 103-104</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 93</span>        condition = re.sub(
</div>
<div class="line-context">
<span class="line-number"> 94</span>            r"defined\s*\(\s*([a-zA-Z_][a-zA-Z0-9_]*)\s*\)", replace_defined, condition
</div>
<div class="line-context">
<span class="line-number"> 95</span>        )
</div>
<div class="line-context">
<span class="line-number"> 96</span>        return condition
</div>
<div class="line-context">
<span class="line-number"> 97</span>
</div>
<div class="line-context">
<span class="line-number"> 98</span>    def _expand_macros(self, condition: str) -> str:
</div>
<div class="line-context">
<span class="line-number"> 99</span>        """Expand macros in the condition."""
</div>
<div class="line-context">
<span class="line-number">100</span>        # Simple macro expansion for common cases
</div>
<div class="line-context">
<span class="line-number">101</span>        for macro_name, macro_value in self.macro_values.items():
</div>
<div class="line-context">
<span class="line-number">102</span>            # Replace macro name with its value
</div>
<div class="line-uncovered">
<span class="line-number">103</span>            pattern = r"\b" + re.escape(macro_name) + r"\b"
</div>
<div class="line-uncovered">
<span class="line-number">104</span>            condition = re.sub(pattern, macro_value, condition)
</div>
<div class="line-context">
<span class="line-number">105</span>        return condition
</div>
<div class="line-context">
<span class="line-number">106</span>
</div>
<div class="line-context">
<span class="line-number">107</span>    def _evaluate_simple_expression(self, condition: str) -> bool:
</div>
<div class="line-context">
<span class="line-number">108</span>        """Evaluate simple expressions like comparisons and logical operators."""
</div>
<div class="line-context">
<span class="line-number">109</span>        try:
</div>
<div class="line-context">
<span class="line-number">110</span>            # Handle common comparison operators
</div>
<div class="line-context">
<span class="line-number">111</span>            condition = condition.strip()
</div>
<div class="line-context">
<span class="line-number">112</span>
</div>
<div class="line-context">
<span class="line-number">113</span>            # Handle simple boolean values
</div>
<div class="line-context">
<span class="line-number">114</span>            if condition.lower() in ["1", "true", "yes"]:
</div>
</div>
<h4>Line 115</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">105</span>        return condition
</div>
<div class="line-context">
<span class="line-number">106</span>
</div>
<div class="line-context">
<span class="line-number">107</span>    def _evaluate_simple_expression(self, condition: str) -> bool:
</div>
<div class="line-context">
<span class="line-number">108</span>        """Evaluate simple expressions like comparisons and logical operators."""
</div>
<div class="line-context">
<span class="line-number">109</span>        try:
</div>
<div class="line-context">
<span class="line-number">110</span>            # Handle common comparison operators
</div>
<div class="line-context">
<span class="line-number">111</span>            condition = condition.strip()
</div>
<div class="line-context">
<span class="line-number">112</span>
</div>
<div class="line-context">
<span class="line-number">113</span>            # Handle simple boolean values
</div>
<div class="line-context">
<span class="line-number">114</span>            if condition.lower() in ["1", "true", "yes"]:
</div>
<div class="line-uncovered">
<span class="line-number">115</span>                return True
</div>
<div class="line-context">
<span class="line-number">116</span>            if condition.lower() in ["0", "false", "no"]:
</div>
<div class="line-context">
<span class="line-number">117</span>                return False
</div>
<div class="line-context">
<span class="line-number">118</span>
</div>
<div class="line-context">
<span class="line-number">119</span>            # Handle simple comparisons
</div>
<div class="line-context">
<span class="line-number">120</span>            if "==" in condition:
</div>
<div class="line-context">
<span class="line-number">121</span>                left, right = condition.split("==", 1)
</div>
<div class="line-context">
<span class="line-number">122</span>                left_val = left.strip()
</div>
<div class="line-context">
<span class="line-number">123</span>                right_val = right.strip()
</div>
<div class="line-context">
<span class="line-number">124</span>
</div>
<div class="line-context">
<span class="line-number">125</span>                # If both sides are known macros, compare their values
</div>
</div>
<h4>Line 127</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">117</span>                return False
</div>
<div class="line-context">
<span class="line-number">118</span>
</div>
<div class="line-context">
<span class="line-number">119</span>            # Handle simple comparisons
</div>
<div class="line-context">
<span class="line-number">120</span>            if "==" in condition:
</div>
<div class="line-context">
<span class="line-number">121</span>                left, right = condition.split("==", 1)
</div>
<div class="line-context">
<span class="line-number">122</span>                left_val = left.strip()
</div>
<div class="line-context">
<span class="line-number">123</span>                right_val = right.strip()
</div>
<div class="line-context">
<span class="line-number">124</span>
</div>
<div class="line-context">
<span class="line-number">125</span>                # If both sides are known macros, compare their values
</div>
<div class="line-context">
<span class="line-number">126</span>                if left_val in self.defined_macros and right_val in self.defined_macros:
</div>
<div class="line-uncovered">
<span class="line-number">127</span>                    return self.get_macro_value(left_val) == self.get_macro_value(
</div>
<div class="line-context">
<span class="line-number">128</span>                        right_val
</div>
<div class="line-context">
<span class="line-number">129</span>                    )
</div>
<div class="line-context">
<span class="line-number">130</span>                # If one side is a known macro, compare with the other side
</div>
<div class="line-context">
<span class="line-number">131</span>                elif left_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">132</span>                    return self.get_macro_value(left_val) == right_val
</div>
<div class="line-context">
<span class="line-number">133</span>                elif right_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">134</span>                    return left_val == self.get_macro_value(right_val)
</div>
<div class="line-context">
<span class="line-number">135</span>                # If neither side is a known macro, both are undefined, so they're equal
</div>
<div class="line-context">
<span class="line-number">136</span>                else:
</div>
<div class="line-context">
<span class="line-number">137</span>                    return True  # Both undefined macros are considered equal
</div>
</div>
<h4>Line 132</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">122</span>                left_val = left.strip()
</div>
<div class="line-context">
<span class="line-number">123</span>                right_val = right.strip()
</div>
<div class="line-context">
<span class="line-number">124</span>
</div>
<div class="line-context">
<span class="line-number">125</span>                # If both sides are known macros, compare their values
</div>
<div class="line-context">
<span class="line-number">126</span>                if left_val in self.defined_macros and right_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">127</span>                    return self.get_macro_value(left_val) == self.get_macro_value(
</div>
<div class="line-context">
<span class="line-number">128</span>                        right_val
</div>
<div class="line-context">
<span class="line-number">129</span>                    )
</div>
<div class="line-context">
<span class="line-number">130</span>                # If one side is a known macro, compare with the other side
</div>
<div class="line-context">
<span class="line-number">131</span>                elif left_val in self.defined_macros:
</div>
<div class="line-uncovered">
<span class="line-number">132</span>                    return self.get_macro_value(left_val) == right_val
</div>
<div class="line-context">
<span class="line-number">133</span>                elif right_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">134</span>                    return left_val == self.get_macro_value(right_val)
</div>
<div class="line-context">
<span class="line-number">135</span>                # If neither side is a known macro, both are undefined, so they're equal
</div>
<div class="line-context">
<span class="line-number">136</span>                else:
</div>
<div class="line-context">
<span class="line-number">137</span>                    return True  # Both undefined macros are considered equal
</div>
<div class="line-context">
<span class="line-number">138</span>
</div>
<div class="line-context">
<span class="line-number">139</span>            if "!=" in condition:
</div>
<div class="line-context">
<span class="line-number">140</span>                left, right = condition.split("!=", 1)
</div>
<div class="line-context">
<span class="line-number">141</span>                left_val = left.strip()
</div>
<div class="line-context">
<span class="line-number">142</span>                right_val = right.strip()
</div>
</div>
<h4>Line 134</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">124</span>
</div>
<div class="line-context">
<span class="line-number">125</span>                # If both sides are known macros, compare their values
</div>
<div class="line-context">
<span class="line-number">126</span>                if left_val in self.defined_macros and right_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">127</span>                    return self.get_macro_value(left_val) == self.get_macro_value(
</div>
<div class="line-context">
<span class="line-number">128</span>                        right_val
</div>
<div class="line-context">
<span class="line-number">129</span>                    )
</div>
<div class="line-context">
<span class="line-number">130</span>                # If one side is a known macro, compare with the other side
</div>
<div class="line-context">
<span class="line-number">131</span>                elif left_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">132</span>                    return self.get_macro_value(left_val) == right_val
</div>
<div class="line-context">
<span class="line-number">133</span>                elif right_val in self.defined_macros:
</div>
<div class="line-uncovered">
<span class="line-number">134</span>                    return left_val == self.get_macro_value(right_val)
</div>
<div class="line-context">
<span class="line-number">135</span>                # If neither side is a known macro, both are undefined, so they're equal
</div>
<div class="line-context">
<span class="line-number">136</span>                else:
</div>
<div class="line-context">
<span class="line-number">137</span>                    return True  # Both undefined macros are considered equal
</div>
<div class="line-context">
<span class="line-number">138</span>
</div>
<div class="line-context">
<span class="line-number">139</span>            if "!=" in condition:
</div>
<div class="line-context">
<span class="line-number">140</span>                left, right = condition.split("!=", 1)
</div>
<div class="line-context">
<span class="line-number">141</span>                left_val = left.strip()
</div>
<div class="line-context">
<span class="line-number">142</span>                right_val = right.strip()
</div>
<div class="line-context">
<span class="line-number">143</span>
</div>
<div class="line-context">
<span class="line-number">144</span>                # If both sides are known macros, compare their values
</div>
</div>
<h4>Lines 140-142</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">130</span>                # If one side is a known macro, compare with the other side
</div>
<div class="line-context">
<span class="line-number">131</span>                elif left_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">132</span>                    return self.get_macro_value(left_val) == right_val
</div>
<div class="line-context">
<span class="line-number">133</span>                elif right_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">134</span>                    return left_val == self.get_macro_value(right_val)
</div>
<div class="line-context">
<span class="line-number">135</span>                # If neither side is a known macro, both are undefined, so they're equal
</div>
<div class="line-context">
<span class="line-number">136</span>                else:
</div>
<div class="line-context">
<span class="line-number">137</span>                    return True  # Both undefined macros are considered equal
</div>
<div class="line-context">
<span class="line-number">138</span>
</div>
<div class="line-context">
<span class="line-number">139</span>            if "!=" in condition:
</div>
<div class="line-uncovered">
<span class="line-number">140</span>                left, right = condition.split("!=", 1)
</div>
<div class="line-uncovered">
<span class="line-number">141</span>                left_val = left.strip()
</div>
<div class="line-uncovered">
<span class="line-number">142</span>                right_val = right.strip()
</div>
<div class="line-context">
<span class="line-number">143</span>
</div>
<div class="line-context">
<span class="line-number">144</span>                # If both sides are known macros, compare their values
</div>
<div class="line-context">
<span class="line-number">145</span>                if left_val in self.defined_macros and right_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">146</span>                    return self.get_macro_value(left_val) != self.get_macro_value(
</div>
<div class="line-context">
<span class="line-number">147</span>                        right_val
</div>
<div class="line-context">
<span class="line-number">148</span>                    )
</div>
<div class="line-context">
<span class="line-number">149</span>                # If one side is a known macro, compare with the other side
</div>
<div class="line-context">
<span class="line-number">150</span>                elif left_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">151</span>                    return self.get_macro_value(left_val) != right_val
</div>
<div class="line-context">
<span class="line-number">152</span>                elif right_val in self.defined_macros:
</div>
</div>
<h4>Lines 145-146</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">135</span>                # If neither side is a known macro, both are undefined, so they're equal
</div>
<div class="line-context">
<span class="line-number">136</span>                else:
</div>
<div class="line-context">
<span class="line-number">137</span>                    return True  # Both undefined macros are considered equal
</div>
<div class="line-context">
<span class="line-number">138</span>
</div>
<div class="line-context">
<span class="line-number">139</span>            if "!=" in condition:
</div>
<div class="line-context">
<span class="line-number">140</span>                left, right = condition.split("!=", 1)
</div>
<div class="line-context">
<span class="line-number">141</span>                left_val = left.strip()
</div>
<div class="line-context">
<span class="line-number">142</span>                right_val = right.strip()
</div>
<div class="line-context">
<span class="line-number">143</span>
</div>
<div class="line-context">
<span class="line-number">144</span>                # If both sides are known macros, compare their values
</div>
<div class="line-uncovered">
<span class="line-number">145</span>                if left_val in self.defined_macros and right_val in self.defined_macros:
</div>
<div class="line-uncovered">
<span class="line-number">146</span>                    return self.get_macro_value(left_val) != self.get_macro_value(
</div>
<div class="line-context">
<span class="line-number">147</span>                        right_val
</div>
<div class="line-context">
<span class="line-number">148</span>                    )
</div>
<div class="line-context">
<span class="line-number">149</span>                # If one side is a known macro, compare with the other side
</div>
<div class="line-context">
<span class="line-number">150</span>                elif left_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">151</span>                    return self.get_macro_value(left_val) != right_val
</div>
<div class="line-context">
<span class="line-number">152</span>                elif right_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">153</span>                    return left_val != self.get_macro_value(right_val)
</div>
<div class="line-context">
<span class="line-number">154</span>                # If neither side is a known macro, do string comparison
</div>
<div class="line-context">
<span class="line-number">155</span>                else:
</div>
<div class="line-context">
<span class="line-number">156</span>                    return left_val != right_val
</div>
</div>
<h4>Lines 150-153</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">140</span>                left, right = condition.split("!=", 1)
</div>
<div class="line-context">
<span class="line-number">141</span>                left_val = left.strip()
</div>
<div class="line-context">
<span class="line-number">142</span>                right_val = right.strip()
</div>
<div class="line-context">
<span class="line-number">143</span>
</div>
<div class="line-context">
<span class="line-number">144</span>                # If both sides are known macros, compare their values
</div>
<div class="line-context">
<span class="line-number">145</span>                if left_val in self.defined_macros and right_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">146</span>                    return self.get_macro_value(left_val) != self.get_macro_value(
</div>
<div class="line-context">
<span class="line-number">147</span>                        right_val
</div>
<div class="line-context">
<span class="line-number">148</span>                    )
</div>
<div class="line-context">
<span class="line-number">149</span>                # If one side is a known macro, compare with the other side
</div>
<div class="line-uncovered">
<span class="line-number">150</span>                elif left_val in self.defined_macros:
</div>
<div class="line-uncovered">
<span class="line-number">151</span>                    return self.get_macro_value(left_val) != right_val
</div>
<div class="line-uncovered">
<span class="line-number">152</span>                elif right_val in self.defined_macros:
</div>
<div class="line-uncovered">
<span class="line-number">153</span>                    return left_val != self.get_macro_value(right_val)
</div>
<div class="line-context">
<span class="line-number">154</span>                # If neither side is a known macro, do string comparison
</div>
<div class="line-context">
<span class="line-number">155</span>                else:
</div>
<div class="line-context">
<span class="line-number">156</span>                    return left_val != right_val
</div>
<div class="line-context">
<span class="line-number">157</span>
</div>
<div class="line-context">
<span class="line-number">158</span>            if ">" in condition:
</div>
<div class="line-context">
<span class="line-number">159</span>                left, right = condition.split(">", 1)
</div>
<div class="line-context">
<span class="line-number">160</span>                try:
</div>
<div class="line-context">
<span class="line-number">161</span>                    left_val = self._evaluate_operand(left.strip())
</div>
<div class="line-context">
<span class="line-number">162</span>                    right_val = self._evaluate_operand(right.strip())
</div>
<div class="line-context">
<span class="line-number">163</span>                    return float(left_val) > float(right_val)
</div>
</div>
<h4>Line 156</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">146</span>                    return self.get_macro_value(left_val) != self.get_macro_value(
</div>
<div class="line-context">
<span class="line-number">147</span>                        right_val
</div>
<div class="line-context">
<span class="line-number">148</span>                    )
</div>
<div class="line-context">
<span class="line-number">149</span>                # If one side is a known macro, compare with the other side
</div>
<div class="line-context">
<span class="line-number">150</span>                elif left_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">151</span>                    return self.get_macro_value(left_val) != right_val
</div>
<div class="line-context">
<span class="line-number">152</span>                elif right_val in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">153</span>                    return left_val != self.get_macro_value(right_val)
</div>
<div class="line-context">
<span class="line-number">154</span>                # If neither side is a known macro, do string comparison
</div>
<div class="line-context">
<span class="line-number">155</span>                else:
</div>
<div class="line-uncovered">
<span class="line-number">156</span>                    return left_val != right_val
</div>
<div class="line-context">
<span class="line-number">157</span>
</div>
<div class="line-context">
<span class="line-number">158</span>            if ">" in condition:
</div>
<div class="line-context">
<span class="line-number">159</span>                left, right = condition.split(">", 1)
</div>
<div class="line-context">
<span class="line-number">160</span>                try:
</div>
<div class="line-context">
<span class="line-number">161</span>                    left_val = self._evaluate_operand(left.strip())
</div>
<div class="line-context">
<span class="line-number">162</span>                    right_val = self._evaluate_operand(right.strip())
</div>
<div class="line-context">
<span class="line-number">163</span>                    return float(left_val) > float(right_val)
</div>
<div class="line-context">
<span class="line-number">164</span>                except ValueError:
</div>
<div class="line-context">
<span class="line-number">165</span>                    return False
</div>
<div class="line-context">
<span class="line-number">166</span>            if "<" in condition:
</div>
</div>
<h4>Lines 166-189</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">156</span>                    return left_val != right_val
</div>
<div class="line-context">
<span class="line-number">157</span>
</div>
<div class="line-context">
<span class="line-number">158</span>            if ">" in condition:
</div>
<div class="line-context">
<span class="line-number">159</span>                left, right = condition.split(">", 1)
</div>
<div class="line-context">
<span class="line-number">160</span>                try:
</div>
<div class="line-context">
<span class="line-number">161</span>                    left_val = self._evaluate_operand(left.strip())
</div>
<div class="line-context">
<span class="line-number">162</span>                    right_val = self._evaluate_operand(right.strip())
</div>
<div class="line-context">
<span class="line-number">163</span>                    return float(left_val) > float(right_val)
</div>
<div class="line-context">
<span class="line-number">164</span>                except ValueError:
</div>
<div class="line-context">
<span class="line-number">165</span>                    return False
</div>
<div class="line-uncovered">
<span class="line-number">166</span>            if "<" in condition:
</div>
<div class="line-uncovered">
<span class="line-number">167</span>                left, right = condition.split("<", 1)
</div>
<div class="line-uncovered">
<span class="line-number">168</span>                try:
</div>
<div class="line-uncovered">
<span class="line-number">169</span>                    left_val = self._evaluate_operand(left.strip())
</div>
<div class="line-uncovered">
<span class="line-number">170</span>                    right_val = self._evaluate_operand(right.strip())
</div>
<div class="line-uncovered">
<span class="line-number">171</span>                    return float(left_val) < float(right_val)
</div>
<div class="line-uncovered">
<span class="line-number">172</span>                except ValueError:
</div>
<div class="line-uncovered">
<span class="line-number">173</span>                    return False
</div>
<div class="line-uncovered">
<span class="line-number">174</span>            if ">=" in condition:
</div>
<div class="line-uncovered">
<span class="line-number">175</span>                left, right = condition.split(">=", 1)
</div>
<div class="line-uncovered">
<span class="line-number">176</span>                try:
</div>
<div class="line-uncovered">
<span class="line-number">177</span>                    left_val = self._evaluate_operand(left.strip())
</div>
<div class="line-uncovered">
<span class="line-number">178</span>                    right_val = self._evaluate_operand(right.strip())
</div>
<div class="line-uncovered">
<span class="line-number">179</span>                    return float(left_val) >= float(right_val)
</div>
<div class="line-uncovered">
<span class="line-number">180</span>                except ValueError:
</div>
<div class="line-uncovered">
<span class="line-number">181</span>                    return False
</div>
<div class="line-uncovered">
<span class="line-number">182</span>            if "<=" in condition:
</div>
<div class="line-uncovered">
<span class="line-number">183</span>                left, right = condition.split("<=", 1)
</div>
<div class="line-uncovered">
<span class="line-number">184</span>                try:
</div>
<div class="line-uncovered">
<span class="line-number">185</span>                    left_val = self._evaluate_operand(left.strip())
</div>
<div class="line-uncovered">
<span class="line-number">186</span>                    right_val = self._evaluate_operand(right.strip())
</div>
<div class="line-uncovered">
<span class="line-number">187</span>                    return float(left_val) <= float(right_val)
</div>
<div class="line-uncovered">
<span class="line-number">188</span>                except ValueError:
</div>
<div class="line-uncovered">
<span class="line-number">189</span>                    return False
</div>
<div class="line-context">
<span class="line-number">190</span>
</div>
<div class="line-context">
<span class="line-number">191</span>            # Handle logical operators
</div>
<div class="line-context">
<span class="line-number">192</span>            if "&&" in condition:
</div>
<div class="line-context">
<span class="line-number">193</span>                parts = condition.split("&&")
</div>
<div class="line-context">
<span class="line-number">194</span>                return all(
</div>
<div class="line-context">
<span class="line-number">195</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">196</span>                )
</div>
<div class="line-context">
<span class="line-number">197</span>            if "||" in condition:
</div>
<div class="line-context">
<span class="line-number">198</span>                parts = condition.split("||")
</div>
<div class="line-context">
<span class="line-number">199</span>                return any(
</div>
</div>
<h4>Lines 192-194</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">182</span>            if "<=" in condition:
</div>
<div class="line-context">
<span class="line-number">183</span>                left, right = condition.split("<=", 1)
</div>
<div class="line-context">
<span class="line-number">184</span>                try:
</div>
<div class="line-context">
<span class="line-number">185</span>                    left_val = self._evaluate_operand(left.strip())
</div>
<div class="line-context">
<span class="line-number">186</span>                    right_val = self._evaluate_operand(right.strip())
</div>
<div class="line-context">
<span class="line-number">187</span>                    return float(left_val) <= float(right_val)
</div>
<div class="line-context">
<span class="line-number">188</span>                except ValueError:
</div>
<div class="line-context">
<span class="line-number">189</span>                    return False
</div>
<div class="line-context">
<span class="line-number">190</span>
</div>
<div class="line-context">
<span class="line-number">191</span>            # Handle logical operators
</div>
<div class="line-uncovered">
<span class="line-number">192</span>            if "&&" in condition:
</div>
<div class="line-uncovered">
<span class="line-number">193</span>                parts = condition.split("&&")
</div>
<div class="line-uncovered">
<span class="line-number">194</span>                return all(
</div>
<div class="line-context">
<span class="line-number">195</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">196</span>                )
</div>
<div class="line-context">
<span class="line-number">197</span>            if "||" in condition:
</div>
<div class="line-context">
<span class="line-number">198</span>                parts = condition.split("||")
</div>
<div class="line-context">
<span class="line-number">199</span>                return any(
</div>
<div class="line-context">
<span class="line-number">200</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">201</span>                )
</div>
<div class="line-context">
<span class="line-number">202</span>            if "!" in condition:
</div>
<div class="line-context">
<span class="line-number">203</span>                # Simple negation
</div>
<div class="line-context">
<span class="line-number">204</span>                negated = condition.replace("!", "").strip()
</div>
</div>
<h4>Lines 197-199</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">187</span>                    return float(left_val) <= float(right_val)
</div>
<div class="line-context">
<span class="line-number">188</span>                except ValueError:
</div>
<div class="line-context">
<span class="line-number">189</span>                    return False
</div>
<div class="line-context">
<span class="line-number">190</span>
</div>
<div class="line-context">
<span class="line-number">191</span>            # Handle logical operators
</div>
<div class="line-context">
<span class="line-number">192</span>            if "&&" in condition:
</div>
<div class="line-context">
<span class="line-number">193</span>                parts = condition.split("&&")
</div>
<div class="line-context">
<span class="line-number">194</span>                return all(
</div>
<div class="line-context">
<span class="line-number">195</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">196</span>                )
</div>
<div class="line-uncovered">
<span class="line-number">197</span>            if "||" in condition:
</div>
<div class="line-uncovered">
<span class="line-number">198</span>                parts = condition.split("||")
</div>
<div class="line-uncovered">
<span class="line-number">199</span>                return any(
</div>
<div class="line-context">
<span class="line-number">200</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">201</span>                )
</div>
<div class="line-context">
<span class="line-number">202</span>            if "!" in condition:
</div>
<div class="line-context">
<span class="line-number">203</span>                # Simple negation
</div>
<div class="line-context">
<span class="line-number">204</span>                negated = condition.replace("!", "").strip()
</div>
<div class="line-context">
<span class="line-number">205</span>                return not self._evaluate_simple_expression(negated)
</div>
<div class="line-context">
<span class="line-number">206</span>
</div>
<div class="line-context">
<span class="line-number">207</span>            # If it's just a macro name, check if it's defined
</div>
<div class="line-context">
<span class="line-number">208</span>            if condition in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">209</span>                return True
</div>
</div>
<h4>Line 202</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">192</span>            if "&&" in condition:
</div>
<div class="line-context">
<span class="line-number">193</span>                parts = condition.split("&&")
</div>
<div class="line-context">
<span class="line-number">194</span>                return all(
</div>
<div class="line-context">
<span class="line-number">195</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">196</span>                )
</div>
<div class="line-context">
<span class="line-number">197</span>            if "||" in condition:
</div>
<div class="line-context">
<span class="line-number">198</span>                parts = condition.split("||")
</div>
<div class="line-context">
<span class="line-number">199</span>                return any(
</div>
<div class="line-context">
<span class="line-number">200</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">201</span>                )
</div>
<div class="line-uncovered">
<span class="line-number">202</span>            if "!" in condition:
</div>
<div class="line-context">
<span class="line-number">203</span>                # Simple negation
</div>
<div class="line-context">
<span class="line-number">204</span>                negated = condition.replace("!", "").strip()
</div>
<div class="line-context">
<span class="line-number">205</span>                return not self._evaluate_simple_expression(negated)
</div>
<div class="line-context">
<span class="line-number">206</span>
</div>
<div class="line-context">
<span class="line-number">207</span>            # If it's just a macro name, check if it's defined
</div>
<div class="line-context">
<span class="line-number">208</span>            if condition in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">209</span>                return True
</div>
<div class="line-context">
<span class="line-number">210</span>
</div>
<div class="line-context">
<span class="line-number">211</span>            # Try to evaluate as a number
</div>
<div class="line-context">
<span class="line-number">212</span>            try:
</div>
</div>
<h4>Lines 204-205</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">194</span>                return all(
</div>
<div class="line-context">
<span class="line-number">195</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">196</span>                )
</div>
<div class="line-context">
<span class="line-number">197</span>            if "||" in condition:
</div>
<div class="line-context">
<span class="line-number">198</span>                parts = condition.split("||")
</div>
<div class="line-context">
<span class="line-number">199</span>                return any(
</div>
<div class="line-context">
<span class="line-number">200</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">201</span>                )
</div>
<div class="line-context">
<span class="line-number">202</span>            if "!" in condition:
</div>
<div class="line-context">
<span class="line-number">203</span>                # Simple negation
</div>
<div class="line-uncovered">
<span class="line-number">204</span>                negated = condition.replace("!", "").strip()
</div>
<div class="line-uncovered">
<span class="line-number">205</span>                return not self._evaluate_simple_expression(negated)
</div>
<div class="line-context">
<span class="line-number">206</span>
</div>
<div class="line-context">
<span class="line-number">207</span>            # If it's just a macro name, check if it's defined
</div>
<div class="line-context">
<span class="line-number">208</span>            if condition in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">209</span>                return True
</div>
<div class="line-context">
<span class="line-number">210</span>
</div>
<div class="line-context">
<span class="line-number">211</span>            # Try to evaluate as a number
</div>
<div class="line-context">
<span class="line-number">212</span>            try:
</div>
<div class="line-context">
<span class="line-number">213</span>                return bool(int(condition))
</div>
<div class="line-context">
<span class="line-number">214</span>            except ValueError:
</div>
<div class="line-context">
<span class="line-number">215</span>                pass
</div>
</div>
<h4>Lines 208-209</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">198</span>                parts = condition.split("||")
</div>
<div class="line-context">
<span class="line-number">199</span>                return any(
</div>
<div class="line-context">
<span class="line-number">200</span>                    self._evaluate_simple_expression(part.strip()) for part in parts
</div>
<div class="line-context">
<span class="line-number">201</span>                )
</div>
<div class="line-context">
<span class="line-number">202</span>            if "!" in condition:
</div>
<div class="line-context">
<span class="line-number">203</span>                # Simple negation
</div>
<div class="line-context">
<span class="line-number">204</span>                negated = condition.replace("!", "").strip()
</div>
<div class="line-context">
<span class="line-number">205</span>                return not self._evaluate_simple_expression(negated)
</div>
<div class="line-context">
<span class="line-number">206</span>
</div>
<div class="line-context">
<span class="line-number">207</span>            # If it's just a macro name, check if it's defined
</div>
<div class="line-uncovered">
<span class="line-number">208</span>            if condition in self.defined_macros:
</div>
<div class="line-uncovered">
<span class="line-number">209</span>                return True
</div>
<div class="line-context">
<span class="line-number">210</span>
</div>
<div class="line-context">
<span class="line-number">211</span>            # Try to evaluate as a number
</div>
<div class="line-context">
<span class="line-number">212</span>            try:
</div>
<div class="line-context">
<span class="line-number">213</span>                return bool(int(condition))
</div>
<div class="line-context">
<span class="line-number">214</span>            except ValueError:
</div>
<div class="line-context">
<span class="line-number">215</span>                pass
</div>
<div class="line-context">
<span class="line-number">216</span>
</div>
<div class="line-context">
<span class="line-number">217</span>            # Default to True for unknown conditions (backward compatibility)
</div>
<div class="line-context">
<span class="line-number">218</span>            # This ensures existing tests continue to work
</div>
<div class="line-context">
<span class="line-number">219</span>            return True
</div>
</div>
<h4>Lines 212-215</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">202</span>            if "!" in condition:
</div>
<div class="line-context">
<span class="line-number">203</span>                # Simple negation
</div>
<div class="line-context">
<span class="line-number">204</span>                negated = condition.replace("!", "").strip()
</div>
<div class="line-context">
<span class="line-number">205</span>                return not self._evaluate_simple_expression(negated)
</div>
<div class="line-context">
<span class="line-number">206</span>
</div>
<div class="line-context">
<span class="line-number">207</span>            # If it's just a macro name, check if it's defined
</div>
<div class="line-context">
<span class="line-number">208</span>            if condition in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">209</span>                return True
</div>
<div class="line-context">
<span class="line-number">210</span>
</div>
<div class="line-context">
<span class="line-number">211</span>            # Try to evaluate as a number
</div>
<div class="line-uncovered">
<span class="line-number">212</span>            try:
</div>
<div class="line-uncovered">
<span class="line-number">213</span>                return bool(int(condition))
</div>
<div class="line-uncovered">
<span class="line-number">214</span>            except ValueError:
</div>
<div class="line-uncovered">
<span class="line-number">215</span>                pass
</div>
<div class="line-context">
<span class="line-number">216</span>
</div>
<div class="line-context">
<span class="line-number">217</span>            # Default to True for unknown conditions (backward compatibility)
</div>
<div class="line-context">
<span class="line-number">218</span>            # This ensures existing tests continue to work
</div>
<div class="line-context">
<span class="line-number">219</span>            return True
</div>
<div class="line-context">
<span class="line-number">220</span>
</div>
<div class="line-context">
<span class="line-number">221</span>        except ValueError as e:
</div>
<div class="line-context">
<span class="line-number">222</span>            self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">223</span>                "Error evaluating preprocessor condition '%s': %s", condition, e
</div>
<div class="line-context">
<span class="line-number">224</span>            )
</div>
<div class="line-context">
<span class="line-number">225</span>            # Default to True for unknown conditions (backward compatibility)
</div>
</div>
<h4>Line 219</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">209</span>                return True
</div>
<div class="line-context">
<span class="line-number">210</span>
</div>
<div class="line-context">
<span class="line-number">211</span>            # Try to evaluate as a number
</div>
<div class="line-context">
<span class="line-number">212</span>            try:
</div>
<div class="line-context">
<span class="line-number">213</span>                return bool(int(condition))
</div>
<div class="line-context">
<span class="line-number">214</span>            except ValueError:
</div>
<div class="line-context">
<span class="line-number">215</span>                pass
</div>
<div class="line-context">
<span class="line-number">216</span>
</div>
<div class="line-context">
<span class="line-number">217</span>            # Default to True for unknown conditions (backward compatibility)
</div>
<div class="line-context">
<span class="line-number">218</span>            # This ensures existing tests continue to work
</div>
<div class="line-uncovered">
<span class="line-number">219</span>            return True
</div>
<div class="line-context">
<span class="line-number">220</span>
</div>
<div class="line-context">
<span class="line-number">221</span>        except ValueError as e:
</div>
<div class="line-context">
<span class="line-number">222</span>            self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">223</span>                "Error evaluating preprocessor condition '%s': %s", condition, e
</div>
<div class="line-context">
<span class="line-number">224</span>            )
</div>
<div class="line-context">
<span class="line-number">225</span>            # Default to True for unknown conditions (backward compatibility)
</div>
<div class="line-context">
<span class="line-number">226</span>            return True
</div>
<div class="line-context">
<span class="line-number">227</span>
</div>
<div class="line-context">
<span class="line-number">228</span>    def _evaluate_operand(self, operand: str) -> str:
</div>
<div class="line-context">
<span class="line-number">229</span>        """Evaluate an operand, expanding macros if they are defined."""
</div>
</div>
<h4>Lines 221-222</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">211</span>            # Try to evaluate as a number
</div>
<div class="line-context">
<span class="line-number">212</span>            try:
</div>
<div class="line-context">
<span class="line-number">213</span>                return bool(int(condition))
</div>
<div class="line-context">
<span class="line-number">214</span>            except ValueError:
</div>
<div class="line-context">
<span class="line-number">215</span>                pass
</div>
<div class="line-context">
<span class="line-number">216</span>
</div>
<div class="line-context">
<span class="line-number">217</span>            # Default to True for unknown conditions (backward compatibility)
</div>
<div class="line-context">
<span class="line-number">218</span>            # This ensures existing tests continue to work
</div>
<div class="line-context">
<span class="line-number">219</span>            return True
</div>
<div class="line-context">
<span class="line-number">220</span>
</div>
<div class="line-uncovered">
<span class="line-number">221</span>        except ValueError as e:
</div>
<div class="line-uncovered">
<span class="line-number">222</span>            self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">223</span>                "Error evaluating preprocessor condition '%s': %s", condition, e
</div>
<div class="line-context">
<span class="line-number">224</span>            )
</div>
<div class="line-context">
<span class="line-number">225</span>            # Default to True for unknown conditions (backward compatibility)
</div>
<div class="line-context">
<span class="line-number">226</span>            return True
</div>
<div class="line-context">
<span class="line-number">227</span>
</div>
<div class="line-context">
<span class="line-number">228</span>    def _evaluate_operand(self, operand: str) -> str:
</div>
<div class="line-context">
<span class="line-number">229</span>        """Evaluate an operand, expanding macros if they are defined."""
</div>
<div class="line-context">
<span class="line-number">230</span>        operand = operand.strip()
</div>
<div class="line-context">
<span class="line-number">231</span>
</div>
<div class="line-context">
<span class="line-number">232</span>        # If it's a defined macro, return its value
</div>
</div>
<h4>Line 226</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">216</span>
</div>
<div class="line-context">
<span class="line-number">217</span>            # Default to True for unknown conditions (backward compatibility)
</div>
<div class="line-context">
<span class="line-number">218</span>            # This ensures existing tests continue to work
</div>
<div class="line-context">
<span class="line-number">219</span>            return True
</div>
<div class="line-context">
<span class="line-number">220</span>
</div>
<div class="line-context">
<span class="line-number">221</span>        except ValueError as e:
</div>
<div class="line-context">
<span class="line-number">222</span>            self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">223</span>                "Error evaluating preprocessor condition '%s': %s", condition, e
</div>
<div class="line-context">
<span class="line-number">224</span>            )
</div>
<div class="line-context">
<span class="line-number">225</span>            # Default to True for unknown conditions (backward compatibility)
</div>
<div class="line-uncovered">
<span class="line-number">226</span>            return True
</div>
<div class="line-context">
<span class="line-number">227</span>
</div>
<div class="line-context">
<span class="line-number">228</span>    def _evaluate_operand(self, operand: str) -> str:
</div>
<div class="line-context">
<span class="line-number">229</span>        """Evaluate an operand, expanding macros if they are defined."""
</div>
<div class="line-context">
<span class="line-number">230</span>        operand = operand.strip()
</div>
<div class="line-context">
<span class="line-number">231</span>
</div>
<div class="line-context">
<span class="line-number">232</span>        # If it's a defined macro, return its value
</div>
<div class="line-context">
<span class="line-number">233</span>        if operand in self.defined_macros:
</div>
<div class="line-context">
<span class="line-number">234</span>            return self.get_macro_value(operand)
</div>
<div class="line-context">
<span class="line-number">235</span>
</div>
<div class="line-context">
<span class="line-number">236</span>        # Otherwise, return the operand as-is
</div>
</div>
<h4>Line 234</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">224</span>            )
</div>
<div class="line-context">
<span class="line-number">225</span>            # Default to True for unknown conditions (backward compatibility)
</div>
<div class="line-context">
<span class="line-number">226</span>            return True
</div>
<div class="line-context">
<span class="line-number">227</span>
</div>
<div class="line-context">
<span class="line-number">228</span>    def _evaluate_operand(self, operand: str) -> str:
</div>
<div class="line-context">
<span class="line-number">229</span>        """Evaluate an operand, expanding macros if they are defined."""
</div>
<div class="line-context">
<span class="line-number">230</span>        operand = operand.strip()
</div>
<div class="line-context">
<span class="line-number">231</span>
</div>
<div class="line-context">
<span class="line-number">232</span>        # If it's a defined macro, return its value
</div>
<div class="line-context">
<span class="line-number">233</span>        if operand in self.defined_macros:
</div>
<div class="line-uncovered">
<span class="line-number">234</span>            return self.get_macro_value(operand)
</div>
<div class="line-context">
<span class="line-number">235</span>
</div>
<div class="line-context">
<span class="line-number">236</span>        # Otherwise, return the operand as-is
</div>
<div class="line-context">
<span class="line-number">237</span>        return operand
</div>
<div class="line-context">
<span class="line-number">238</span>
</div>
<div class="line-context">
<span class="line-number">239</span>    def parse_preprocessor_blocks(self, tokens: List[Token]) -> List[PreprocessorBlock]:
</div>
<div class="line-context">
<span class="line-number">240</span>        """Parse preprocessor blocks from tokens."""
</div>
<div class="line-context">
<span class="line-number">241</span>        blocks = []
</div>
<div class="line-context">
<span class="line-number">242</span>        stack = []
</div>
<div class="line-context">
<span class="line-number">243</span>
</div>
<div class="line-context">
<span class="line-number">244</span>        i = 0
</div>
</div>
<h4>Line 300</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">290</span>                        current_block.is_active = self._should_activate_block(
</div>
<div class="line-context">
<span class="line-number">291</span>                            directive, "", stack
</div>
<div class="line-context">
<span class="line-number">292</span>                        )
</div>
<div class="line-context">
<span class="line-number">293</span>
</div>
<div class="line-context">
<span class="line-number">294</span>                elif directive == PreprocessorDirective.ENDIF:
</div>
<div class="line-context">
<span class="line-number">295</span>                    if stack:
</div>
<div class="line-context">
<span class="line-number">296</span>                        # End current block
</div>
<div class="line-context">
<span class="line-number">297</span>                        current_block = stack.pop()
</div>
<div class="line-context">
<span class="line-number">298</span>                        current_block.end_token = i
</div>
<div class="line-context">
<span class="line-number">299</span>
</div>
<div class="line-uncovered">
<span class="line-number">300</span>                elif directive == PreprocessorDirective.DEFINE:
</div>
<div class="line-context">
<span class="line-number">301</span>                    # Handle #define
</div>
<div class="line-context">
<span class="line-number">302</span>                    macro_name, macro_value = self._parse_define(token.value)
</div>
<div class="line-context">
<span class="line-number">303</span>                    self.add_define(macro_name, macro_value)
</div>
<div class="line-context">
<span class="line-number">304</span>
</div>
<div class="line-context">
<span class="line-number">305</span>                elif directive == PreprocessorDirective.UNDEF:
</div>
<div class="line-context">
<span class="line-number">306</span>                    # Handle #undef
</div>
<div class="line-context">
<span class="line-number">307</span>                    macro_name = self._parse_undef(token.value)
</div>
<div class="line-context">
<span class="line-number">308</span>                    self.add_undef(macro_name)
</div>
<div class="line-context">
<span class="line-number">309</span>
</div>
<div class="line-context">
<span class="line-number">310</span>            i += 1
</div>
</div>
<h4>Lines 302-303</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">292</span>                        )
</div>
<div class="line-context">
<span class="line-number">293</span>
</div>
<div class="line-context">
<span class="line-number">294</span>                elif directive == PreprocessorDirective.ENDIF:
</div>
<div class="line-context">
<span class="line-number">295</span>                    if stack:
</div>
<div class="line-context">
<span class="line-number">296</span>                        # End current block
</div>
<div class="line-context">
<span class="line-number">297</span>                        current_block = stack.pop()
</div>
<div class="line-context">
<span class="line-number">298</span>                        current_block.end_token = i
</div>
<div class="line-context">
<span class="line-number">299</span>
</div>
<div class="line-context">
<span class="line-number">300</span>                elif directive == PreprocessorDirective.DEFINE:
</div>
<div class="line-context">
<span class="line-number">301</span>                    # Handle #define
</div>
<div class="line-uncovered">
<span class="line-number">302</span>                    macro_name, macro_value = self._parse_define(token.value)
</div>
<div class="line-uncovered">
<span class="line-number">303</span>                    self.add_define(macro_name, macro_value)
</div>
<div class="line-context">
<span class="line-number">304</span>
</div>
<div class="line-context">
<span class="line-number">305</span>                elif directive == PreprocessorDirective.UNDEF:
</div>
<div class="line-context">
<span class="line-number">306</span>                    # Handle #undef
</div>
<div class="line-context">
<span class="line-number">307</span>                    macro_name = self._parse_undef(token.value)
</div>
<div class="line-context">
<span class="line-number">308</span>                    self.add_undef(macro_name)
</div>
<div class="line-context">
<span class="line-number">309</span>
</div>
<div class="line-context">
<span class="line-number">310</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">311</span>
</div>
<div class="line-context">
<span class="line-number">312</span>        return blocks
</div>
<div class="line-context">
<span class="line-number">313</span>
</div>
</div>
<h4>Line 305</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">295</span>                    if stack:
</div>
<div class="line-context">
<span class="line-number">296</span>                        # End current block
</div>
<div class="line-context">
<span class="line-number">297</span>                        current_block = stack.pop()
</div>
<div class="line-context">
<span class="line-number">298</span>                        current_block.end_token = i
</div>
<div class="line-context">
<span class="line-number">299</span>
</div>
<div class="line-context">
<span class="line-number">300</span>                elif directive == PreprocessorDirective.DEFINE:
</div>
<div class="line-context">
<span class="line-number">301</span>                    # Handle #define
</div>
<div class="line-context">
<span class="line-number">302</span>                    macro_name, macro_value = self._parse_define(token.value)
</div>
<div class="line-context">
<span class="line-number">303</span>                    self.add_define(macro_name, macro_value)
</div>
<div class="line-context">
<span class="line-number">304</span>
</div>
<div class="line-uncovered">
<span class="line-number">305</span>                elif directive == PreprocessorDirective.UNDEF:
</div>
<div class="line-context">
<span class="line-number">306</span>                    # Handle #undef
</div>
<div class="line-context">
<span class="line-number">307</span>                    macro_name = self._parse_undef(token.value)
</div>
<div class="line-context">
<span class="line-number">308</span>                    self.add_undef(macro_name)
</div>
<div class="line-context">
<span class="line-number">309</span>
</div>
<div class="line-context">
<span class="line-number">310</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">311</span>
</div>
<div class="line-context">
<span class="line-number">312</span>        return blocks
</div>
<div class="line-context">
<span class="line-number">313</span>
</div>
<div class="line-context">
<span class="line-number">314</span>    def _parse_directive(self, value: str) -> PreprocessorDirective:
</div>
<div class="line-context">
<span class="line-number">315</span>        """Parse the directive type from a preprocessor token."""
</div>
</div>
<h4>Lines 307-308</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">297</span>                        current_block = stack.pop()
</div>
<div class="line-context">
<span class="line-number">298</span>                        current_block.end_token = i
</div>
<div class="line-context">
<span class="line-number">299</span>
</div>
<div class="line-context">
<span class="line-number">300</span>                elif directive == PreprocessorDirective.DEFINE:
</div>
<div class="line-context">
<span class="line-number">301</span>                    # Handle #define
</div>
<div class="line-context">
<span class="line-number">302</span>                    macro_name, macro_value = self._parse_define(token.value)
</div>
<div class="line-context">
<span class="line-number">303</span>                    self.add_define(macro_name, macro_value)
</div>
<div class="line-context">
<span class="line-number">304</span>
</div>
<div class="line-context">
<span class="line-number">305</span>                elif directive == PreprocessorDirective.UNDEF:
</div>
<div class="line-context">
<span class="line-number">306</span>                    # Handle #undef
</div>
<div class="line-uncovered">
<span class="line-number">307</span>                    macro_name = self._parse_undef(token.value)
</div>
<div class="line-uncovered">
<span class="line-number">308</span>                    self.add_undef(macro_name)
</div>
<div class="line-context">
<span class="line-number">309</span>
</div>
<div class="line-context">
<span class="line-number">310</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">311</span>
</div>
<div class="line-context">
<span class="line-number">312</span>        return blocks
</div>
<div class="line-context">
<span class="line-number">313</span>
</div>
<div class="line-context">
<span class="line-number">314</span>    def _parse_directive(self, value: str) -> PreprocessorDirective:
</div>
<div class="line-context">
<span class="line-number">315</span>        """Parse the directive type from a preprocessor token."""
</div>
<div class="line-context">
<span class="line-number">316</span>        value = value.strip()
</div>
<div class="line-context">
<span class="line-number">317</span>        if value.startswith("#ifdef"):
</div>
<div class="line-context">
<span class="line-number">318</span>            return PreprocessorDirective.IFDEF
</div>
</div>
<h4>Lines 329-332</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">319</span>        elif value.startswith("#ifndef"):
</div>
<div class="line-context">
<span class="line-number">320</span>            return PreprocessorDirective.IFNDEF
</div>
<div class="line-context">
<span class="line-number">321</span>        elif value.startswith("#if"):
</div>
<div class="line-context">
<span class="line-number">322</span>            return PreprocessorDirective.IF
</div>
<div class="line-context">
<span class="line-number">323</span>        elif value.startswith("#elif"):
</div>
<div class="line-context">
<span class="line-number">324</span>            return PreprocessorDirective.ELIF
</div>
<div class="line-context">
<span class="line-number">325</span>        elif value.startswith("#else"):
</div>
<div class="line-context">
<span class="line-number">326</span>            return PreprocessorDirective.ELSE
</div>
<div class="line-context">
<span class="line-number">327</span>        elif value.startswith("#endif"):
</div>
<div class="line-context">
<span class="line-number">328</span>            return PreprocessorDirective.ENDIF
</div>
<div class="line-uncovered">
<span class="line-number">329</span>        elif value.startswith("#define"):
</div>
<div class="line-uncovered">
<span class="line-number">330</span>            return PreprocessorDirective.DEFINE
</div>
<div class="line-uncovered">
<span class="line-number">331</span>        elif value.startswith("#undef"):
</div>
<div class="line-uncovered">
<span class="line-number">332</span>            return PreprocessorDirective.UNDEF
</div>
<div class="line-context">
<span class="line-number">333</span>        else:
</div>
<div class="line-context">
<span class="line-number">334</span>            return PreprocessorDirective.IF  # Default
</div>
<div class="line-context">
<span class="line-number">335</span>
</div>
<div class="line-context">
<span class="line-number">336</span>    def _extract_condition(self, value: str, directive: PreprocessorDirective) -> str:
</div>
<div class="line-context">
<span class="line-number">337</span>        """Extract the condition from a preprocessor directive."""
</div>
<div class="line-context">
<span class="line-number">338</span>        value = value.strip()
</div>
<div class="line-context">
<span class="line-number">339</span>
</div>
<div class="line-context">
<span class="line-number">340</span>        if directive == PreprocessorDirective.IFDEF:
</div>
<div class="line-context">
<span class="line-number">341</span>            match = re.search(r"#ifdef\s+([a-zA-Z_][a-zA-Z0-9_]*)", value)
</div>
<div class="line-context">
<span class="line-number">342</span>            return match.group(1) if match else ""
</div>
</div>
<h4>Line 334</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">324</span>            return PreprocessorDirective.ELIF
</div>
<div class="line-context">
<span class="line-number">325</span>        elif value.startswith("#else"):
</div>
<div class="line-context">
<span class="line-number">326</span>            return PreprocessorDirective.ELSE
</div>
<div class="line-context">
<span class="line-number">327</span>        elif value.startswith("#endif"):
</div>
<div class="line-context">
<span class="line-number">328</span>            return PreprocessorDirective.ENDIF
</div>
<div class="line-context">
<span class="line-number">329</span>        elif value.startswith("#define"):
</div>
<div class="line-context">
<span class="line-number">330</span>            return PreprocessorDirective.DEFINE
</div>
<div class="line-context">
<span class="line-number">331</span>        elif value.startswith("#undef"):
</div>
<div class="line-context">
<span class="line-number">332</span>            return PreprocessorDirective.UNDEF
</div>
<div class="line-context">
<span class="line-number">333</span>        else:
</div>
<div class="line-uncovered">
<span class="line-number">334</span>            return PreprocessorDirective.IF  # Default
</div>
<div class="line-context">
<span class="line-number">335</span>
</div>
<div class="line-context">
<span class="line-number">336</span>    def _extract_condition(self, value: str, directive: PreprocessorDirective) -> str:
</div>
<div class="line-context">
<span class="line-number">337</span>        """Extract the condition from a preprocessor directive."""
</div>
<div class="line-context">
<span class="line-number">338</span>        value = value.strip()
</div>
<div class="line-context">
<span class="line-number">339</span>
</div>
<div class="line-context">
<span class="line-number">340</span>        if directive == PreprocessorDirective.IFDEF:
</div>
<div class="line-context">
<span class="line-number">341</span>            match = re.search(r"#ifdef\s+([a-zA-Z_][a-zA-Z0-9_]*)", value)
</div>
<div class="line-context">
<span class="line-number">342</span>            return match.group(1) if match else ""
</div>
<div class="line-context">
<span class="line-number">343</span>        elif directive == PreprocessorDirective.IFNDEF:
</div>
<div class="line-context">
<span class="line-number">344</span>            match = re.search(r"#ifndef\s+([a-zA-Z_][a-zA-Z0-9_]*)", value)
</div>
</div>
<h4>Line 353</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">343</span>        elif directive == PreprocessorDirective.IFNDEF:
</div>
<div class="line-context">
<span class="line-number">344</span>            match = re.search(r"#ifndef\s+([a-zA-Z_][a-zA-Z0-9_]*)", value)
</div>
<div class="line-context">
<span class="line-number">345</span>            return match.group(1) if match else ""
</div>
<div class="line-context">
<span class="line-number">346</span>        elif directive == PreprocessorDirective.IF:
</div>
<div class="line-context">
<span class="line-number">347</span>            match = re.search(r"#if\s+(.+)", value)
</div>
<div class="line-context">
<span class="line-number">348</span>            return match.group(1).strip() if match else ""
</div>
<div class="line-context">
<span class="line-number">349</span>        elif directive == PreprocessorDirective.ELIF:
</div>
<div class="line-context">
<span class="line-number">350</span>            match = re.search(r"#elif\s+(.+)", value)
</div>
<div class="line-context">
<span class="line-number">351</span>            return match.group(1).strip() if match else ""
</div>
<div class="line-context">
<span class="line-number">352</span>        else:
</div>
<div class="line-uncovered">
<span class="line-number">353</span>            return ""
</div>
<div class="line-context">
<span class="line-number">354</span>
</div>
<div class="line-context">
<span class="line-number">355</span>    def _parse_define(self, value: str) -> Tuple[str, str]:
</div>
<div class="line-context">
<span class="line-number">356</span>        """Parse #define directive."""
</div>
<div class="line-context">
<span class="line-number">357</span>        value = value.strip()
</div>
<div class="line-context">
<span class="line-number">358</span>        match = re.search(r"#define\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*(.+)", value)
</div>
<div class="line-context">
<span class="line-number">359</span>        if match:
</div>
<div class="line-context">
<span class="line-number">360</span>            name = match.group(1)
</div>
<div class="line-context">
<span class="line-number">361</span>            macro_value = match.group(2).strip()
</div>
<div class="line-context">
<span class="line-number">362</span>            return name, macro_value
</div>
<div class="line-context">
<span class="line-number">363</span>        return "", ""
</div>
</div>
<h4>Lines 357-363</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">347</span>            match = re.search(r"#if\s+(.+)", value)
</div>
<div class="line-context">
<span class="line-number">348</span>            return match.group(1).strip() if match else ""
</div>
<div class="line-context">
<span class="line-number">349</span>        elif directive == PreprocessorDirective.ELIF:
</div>
<div class="line-context">
<span class="line-number">350</span>            match = re.search(r"#elif\s+(.+)", value)
</div>
<div class="line-context">
<span class="line-number">351</span>            return match.group(1).strip() if match else ""
</div>
<div class="line-context">
<span class="line-number">352</span>        else:
</div>
<div class="line-context">
<span class="line-number">353</span>            return ""
</div>
<div class="line-context">
<span class="line-number">354</span>
</div>
<div class="line-context">
<span class="line-number">355</span>    def _parse_define(self, value: str) -> Tuple[str, str]:
</div>
<div class="line-context">
<span class="line-number">356</span>        """Parse #define directive."""
</div>
<div class="line-uncovered">
<span class="line-number">357</span>        value = value.strip()
</div>
<div class="line-uncovered">
<span class="line-number">358</span>        match = re.search(r"#define\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*(.+)", value)
</div>
<div class="line-uncovered">
<span class="line-number">359</span>        if match:
</div>
<div class="line-uncovered">
<span class="line-number">360</span>            name = match.group(1)
</div>
<div class="line-uncovered">
<span class="line-number">361</span>            macro_value = match.group(2).strip()
</div>
<div class="line-uncovered">
<span class="line-number">362</span>            return name, macro_value
</div>
<div class="line-uncovered">
<span class="line-number">363</span>        return "", ""
</div>
<div class="line-context">
<span class="line-number">364</span>
</div>
<div class="line-context">
<span class="line-number">365</span>    def _parse_undef(self, value: str) -> str:
</div>
<div class="line-context">
<span class="line-number">366</span>        """Parse #undef directive."""
</div>
<div class="line-context">
<span class="line-number">367</span>        value = value.strip()
</div>
<div class="line-context">
<span class="line-number">368</span>        match = re.search(r"#undef\s+([a-zA-Z_][a-zA-Z0-9_]*)", value)
</div>
<div class="line-context">
<span class="line-number">369</span>        return match.group(1) if match else ""
</div>
<div class="line-context">
<span class="line-number">370</span>
</div>
<div class="line-context">
<span class="line-number">371</span>    def _should_activate_block(
</div>
<div class="line-context">
<span class="line-number">372</span>        self,
</div>
<div class="line-context">
<span class="line-number">373</span>        directive: PreprocessorDirective,
</div>
</div>
<h4>Lines 367-369</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">357</span>        value = value.strip()
</div>
<div class="line-context">
<span class="line-number">358</span>        match = re.search(r"#define\s+([a-zA-Z_][a-zA-Z0-9_]*)\s*(.+)", value)
</div>
<div class="line-context">
<span class="line-number">359</span>        if match:
</div>
<div class="line-context">
<span class="line-number">360</span>            name = match.group(1)
</div>
<div class="line-context">
<span class="line-number">361</span>            macro_value = match.group(2).strip()
</div>
<div class="line-context">
<span class="line-number">362</span>            return name, macro_value
</div>
<div class="line-context">
<span class="line-number">363</span>        return "", ""
</div>
<div class="line-context">
<span class="line-number">364</span>
</div>
<div class="line-context">
<span class="line-number">365</span>    def _parse_undef(self, value: str) -> str:
</div>
<div class="line-context">
<span class="line-number">366</span>        """Parse #undef directive."""
</div>
<div class="line-uncovered">
<span class="line-number">367</span>        value = value.strip()
</div>
<div class="line-uncovered">
<span class="line-number">368</span>        match = re.search(r"#undef\s+([a-zA-Z_][a-zA-Z0-9_]*)", value)
</div>
<div class="line-uncovered">
<span class="line-number">369</span>        return match.group(1) if match else ""
</div>
<div class="line-context">
<span class="line-number">370</span>
</div>
<div class="line-context">
<span class="line-number">371</span>    def _should_activate_block(
</div>
<div class="line-context">
<span class="line-number">372</span>        self,
</div>
<div class="line-context">
<span class="line-number">373</span>        directive: PreprocessorDirective,
</div>
<div class="line-context">
<span class="line-number">374</span>        condition: str,
</div>
<div class="line-context">
<span class="line-number">375</span>        stack: List[PreprocessorBlock],
</div>
<div class="line-context">
<span class="line-number">376</span>    ) -> bool:
</div>
<div class="line-context">
<span class="line-number">377</span>        """Determine if a block should be active based on its directive and condition."""
</div>
<div class="line-context">
<span class="line-number">378</span>        # Check if parent blocks are active
</div>
<div class="line-context">
<span class="line-number">379</span>        if stack and not stack[-1].is_active:
</div>
</div>
<h4>Lines 394-395</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">384</span>        elif directive == PreprocessorDirective.IFNDEF:
</div>
<div class="line-context">
<span class="line-number">385</span>            return not self.is_defined(condition)
</div>
<div class="line-context">
<span class="line-number">386</span>        elif directive == PreprocessorDirective.IF:
</div>
<div class="line-context">
<span class="line-number">387</span>            return self.evaluate_condition(condition)
</div>
<div class="line-context">
<span class="line-number">388</span>        elif directive == PreprocessorDirective.ELIF:
</div>
<div class="line-context">
<span class="line-number">389</span>            # For #elif, we need to check if no previous branch was taken
</div>
<div class="line-context">
<span class="line-number">390</span>            if stack:
</div>
<div class="line-context">
<span class="line-number">391</span>                parent = stack[-1]
</div>
<div class="line-context">
<span class="line-number">392</span>                # Check if any previous child was active
</div>
<div class="line-context">
<span class="line-number">393</span>                for child in parent.children:
</div>
<div class="line-uncovered">
<span class="line-number">394</span>                    if child.is_active:
</div>
<div class="line-uncovered">
<span class="line-number">395</span>                        return False
</div>
<div class="line-context">
<span class="line-number">396</span>                return self.evaluate_condition(condition)
</div>
<div class="line-context">
<span class="line-number">397</span>            return False
</div>
<div class="line-context">
<span class="line-number">398</span>        elif directive == PreprocessorDirective.ELSE:
</div>
<div class="line-context">
<span class="line-number">399</span>            # For #else, we need to check if no previous branch was taken
</div>
<div class="line-context">
<span class="line-number">400</span>            if stack:
</div>
<div class="line-context">
<span class="line-number">401</span>                parent = stack[-1]
</div>
<div class="line-context">
<span class="line-number">402</span>                # Check if any previous child was active
</div>
<div class="line-context">
<span class="line-number">403</span>                for child in parent.children:
</div>
<div class="line-context">
<span class="line-number">404</span>                    if child.is_active:
</div>
<div class="line-context">
<span class="line-number">405</span>                        return False
</div>
</div>
<h4>Line 397</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">387</span>            return self.evaluate_condition(condition)
</div>
<div class="line-context">
<span class="line-number">388</span>        elif directive == PreprocessorDirective.ELIF:
</div>
<div class="line-context">
<span class="line-number">389</span>            # For #elif, we need to check if no previous branch was taken
</div>
<div class="line-context">
<span class="line-number">390</span>            if stack:
</div>
<div class="line-context">
<span class="line-number">391</span>                parent = stack[-1]
</div>
<div class="line-context">
<span class="line-number">392</span>                # Check if any previous child was active
</div>
<div class="line-context">
<span class="line-number">393</span>                for child in parent.children:
</div>
<div class="line-context">
<span class="line-number">394</span>                    if child.is_active:
</div>
<div class="line-context">
<span class="line-number">395</span>                        return False
</div>
<div class="line-context">
<span class="line-number">396</span>                return self.evaluate_condition(condition)
</div>
<div class="line-uncovered">
<span class="line-number">397</span>            return False
</div>
<div class="line-context">
<span class="line-number">398</span>        elif directive == PreprocessorDirective.ELSE:
</div>
<div class="line-context">
<span class="line-number">399</span>            # For #else, we need to check if no previous branch was taken
</div>
<div class="line-context">
<span class="line-number">400</span>            if stack:
</div>
<div class="line-context">
<span class="line-number">401</span>                parent = stack[-1]
</div>
<div class="line-context">
<span class="line-number">402</span>                # Check if any previous child was active
</div>
<div class="line-context">
<span class="line-number">403</span>                for child in parent.children:
</div>
<div class="line-context">
<span class="line-number">404</span>                    if child.is_active:
</div>
<div class="line-context">
<span class="line-number">405</span>                        return False
</div>
<div class="line-context">
<span class="line-number">406</span>                return True
</div>
<div class="line-context">
<span class="line-number">407</span>            return False
</div>
</div>
<h4>Lines 404-405</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">394</span>                    if child.is_active:
</div>
<div class="line-context">
<span class="line-number">395</span>                        return False
</div>
<div class="line-context">
<span class="line-number">396</span>                return self.evaluate_condition(condition)
</div>
<div class="line-context">
<span class="line-number">397</span>            return False
</div>
<div class="line-context">
<span class="line-number">398</span>        elif directive == PreprocessorDirective.ELSE:
</div>
<div class="line-context">
<span class="line-number">399</span>            # For #else, we need to check if no previous branch was taken
</div>
<div class="line-context">
<span class="line-number">400</span>            if stack:
</div>
<div class="line-context">
<span class="line-number">401</span>                parent = stack[-1]
</div>
<div class="line-context">
<span class="line-number">402</span>                # Check if any previous child was active
</div>
<div class="line-context">
<span class="line-number">403</span>                for child in parent.children:
</div>
<div class="line-uncovered">
<span class="line-number">404</span>                    if child.is_active:
</div>
<div class="line-uncovered">
<span class="line-number">405</span>                        return False
</div>
<div class="line-context">
<span class="line-number">406</span>                return True
</div>
<div class="line-context">
<span class="line-number">407</span>            return False
</div>
<div class="line-context">
<span class="line-number">408</span>        else:
</div>
<div class="line-context">
<span class="line-number">409</span>            return False
</div>
<div class="line-context">
<span class="line-number">410</span>
</div>
<div class="line-context">
<span class="line-number">411</span>    def filter_tokens(self, tokens: List[Token]) -> List[Token]:
</div>
<div class="line-context">
<span class="line-number">412</span>        """Filter tokens based on preprocessor blocks, keeping only active content."""
</div>
<div class="line-context">
<span class="line-number">413</span>        blocks = self.parse_preprocessor_blocks(tokens)
</div>
<div class="line-context">
<span class="line-number">414</span>        filtered_tokens = []
</div>
<div class="line-context">
<span class="line-number">415</span>
</div>
</div>
<h4>Line 407</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">397</span>            return False
</div>
<div class="line-context">
<span class="line-number">398</span>        elif directive == PreprocessorDirective.ELSE:
</div>
<div class="line-context">
<span class="line-number">399</span>            # For #else, we need to check if no previous branch was taken
</div>
<div class="line-context">
<span class="line-number">400</span>            if stack:
</div>
<div class="line-context">
<span class="line-number">401</span>                parent = stack[-1]
</div>
<div class="line-context">
<span class="line-number">402</span>                # Check if any previous child was active
</div>
<div class="line-context">
<span class="line-number">403</span>                for child in parent.children:
</div>
<div class="line-context">
<span class="line-number">404</span>                    if child.is_active:
</div>
<div class="line-context">
<span class="line-number">405</span>                        return False
</div>
<div class="line-context">
<span class="line-number">406</span>                return True
</div>
<div class="line-uncovered">
<span class="line-number">407</span>            return False
</div>
<div class="line-context">
<span class="line-number">408</span>        else:
</div>
<div class="line-context">
<span class="line-number">409</span>            return False
</div>
<div class="line-context">
<span class="line-number">410</span>
</div>
<div class="line-context">
<span class="line-number">411</span>    def filter_tokens(self, tokens: List[Token]) -> List[Token]:
</div>
<div class="line-context">
<span class="line-number">412</span>        """Filter tokens based on preprocessor blocks, keeping only active content."""
</div>
<div class="line-context">
<span class="line-number">413</span>        blocks = self.parse_preprocessor_blocks(tokens)
</div>
<div class="line-context">
<span class="line-number">414</span>        filtered_tokens = []
</div>
<div class="line-context">
<span class="line-number">415</span>
</div>
<div class="line-context">
<span class="line-number">416</span>        i = 0
</div>
<div class="line-context">
<span class="line-number">417</span>        while i < len(tokens):
</div>
</div>
<h4>Line 409</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">399</span>            # For #else, we need to check if no previous branch was taken
</div>
<div class="line-context">
<span class="line-number">400</span>            if stack:
</div>
<div class="line-context">
<span class="line-number">401</span>                parent = stack[-1]
</div>
<div class="line-context">
<span class="line-number">402</span>                # Check if any previous child was active
</div>
<div class="line-context">
<span class="line-number">403</span>                for child in parent.children:
</div>
<div class="line-context">
<span class="line-number">404</span>                    if child.is_active:
</div>
<div class="line-context">
<span class="line-number">405</span>                        return False
</div>
<div class="line-context">
<span class="line-number">406</span>                return True
</div>
<div class="line-context">
<span class="line-number">407</span>            return False
</div>
<div class="line-context">
<span class="line-number">408</span>        else:
</div>
<div class="line-uncovered">
<span class="line-number">409</span>            return False
</div>
<div class="line-context">
<span class="line-number">410</span>
</div>
<div class="line-context">
<span class="line-number">411</span>    def filter_tokens(self, tokens: List[Token]) -> List[Token]:
</div>
<div class="line-context">
<span class="line-number">412</span>        """Filter tokens based on preprocessor blocks, keeping only active content."""
</div>
<div class="line-context">
<span class="line-number">413</span>        blocks = self.parse_preprocessor_blocks(tokens)
</div>
<div class="line-context">
<span class="line-number">414</span>        filtered_tokens = []
</div>
<div class="line-context">
<span class="line-number">415</span>
</div>
<div class="line-context">
<span class="line-number">416</span>        i = 0
</div>
<div class="line-context">
<span class="line-number">417</span>        while i < len(tokens):
</div>
<div class="line-context">
<span class="line-number">418</span>            token = tokens[i]
</div>
<div class="line-context">
<span class="line-number">419</span>
</div>
</div>
<h4>Lines 471-472</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">461</span>
</div>
<div class="line-context">
<span class="line-number">462</span>    def __init__(self):
</div>
<div class="line-context">
<span class="line-number">463</span>        self.evaluator = PreprocessorEvaluator()
</div>
<div class="line-context">
<span class="line-number">464</span>        self.logger = logging.getLogger(__name__)
</div>
<div class="line-context">
<span class="line-number">465</span>
</div>
<div class="line-context">
<span class="line-number">466</span>    def process_file(
</div>
<div class="line-context">
<span class="line-number">467</span>        self, tokens: List[Token], defines: Optional[Dict[str, str]] = None
</div>
<div class="line-context">
<span class="line-number">468</span>    ) -> List[Token]:
</div>
<div class="line-context">
<span class="line-number">469</span>        """Process a file's tokens through the preprocessor."""
</div>
<div class="line-context">
<span class="line-number">470</span>        if defines:
</div>
<div class="line-uncovered">
<span class="line-number">471</span>            for name, value in defines.items():
</div>
<div class="line-uncovered">
<span class="line-number">472</span>                self.evaluator.add_define(name, value)
</div>
<div class="line-context">
<span class="line-number">473</span>
</div>
<div class="line-context">
<span class="line-number">474</span>        # Filter tokens based on preprocessor directives
</div>
<div class="line-context">
<span class="line-number">475</span>        filtered_tokens = self.evaluator.filter_tokens(tokens)
</div>
<div class="line-context">
<span class="line-number">476</span>
</div>
<div class="line-context">
<span class="line-number">477</span>        self.logger.debug(
</div>
<div class="line-context">
<span class="line-number">478</span>            f"Preprocessor: {len(tokens)} tokens -> {len(filtered_tokens)} tokens"
</div>
<div class="line-context">
<span class="line-number">479</span>        )
</div>
<div class="line-context">
<span class="line-number">480</span>        return filtered_tokens
</div>
<div class="line-context">
<span class="line-number">481</span>
</div>
<div class="line-context">
<span class="line-number">482</span>    def add_defines_from_content(self, tokens: List[Token]):
</div>
</div>
<h4>Lines 488-491</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">478</span>            f"Preprocessor: {len(tokens)} tokens -> {len(filtered_tokens)} tokens"
</div>
<div class="line-context">
<span class="line-number">479</span>        )
</div>
<div class="line-context">
<span class="line-number">480</span>        return filtered_tokens
</div>
<div class="line-context">
<span class="line-number">481</span>
</div>
<div class="line-context">
<span class="line-number">482</span>    def add_defines_from_content(self, tokens: List[Token]):
</div>
<div class="line-context">
<span class="line-number">483</span>        """Extract #define directives from tokens and add them to the evaluator."""
</div>
<div class="line-context">
<span class="line-number">484</span>        for token in tokens:
</div>
<div class="line-context">
<span class="line-number">485</span>            if token.type == TokenType.PREPROCESSOR and token.value.startswith(
</div>
<div class="line-context">
<span class="line-number">486</span>                "#define"
</div>
<div class="line-context">
<span class="line-number">487</span>            ):
</div>
<div class="line-uncovered">
<span class="line-number">488</span>                name, value = self.evaluator._parse_define(token.value)
</div>
<div class="line-uncovered">
<span class="line-number">489</span>                if name:
</div>
<div class="line-uncovered">
<span class="line-number">490</span>                    self.evaluator.add_define(name, value)
</div>
<div class="line-uncovered">
<span class="line-number">491</span>                    self.logger.debug("Preprocessor: Added define %s = %s", name, value)
</div>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/main.py
<span class="coverage-info">53.61% (52/97 lines covered)</span>
</div>
<h4>Line 38</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 28</span>        format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",
</div>
<div class="line-context">
<span class="line-number"> 29</span>        handlers=[logging.StreamHandler(sys.stdout)],
</div>
<div class="line-context">
<span class="line-number"> 30</span>    )
</div>
<div class="line-context">
<span class="line-number"> 31</span>
</div>
<div class="line-context">
<span class="line-number"> 32</span>
</div>
<div class="line-context">
<span class="line-number"> 33</span>def load_config_from_path(config_path: str) -> dict:
</div>
<div class="line-context">
<span class="line-number"> 34</span>    path = Path(config_path)
</div>
<div class="line-context">
<span class="line-number"> 35</span>    if path.is_file():
</div>
<div class="line-context">
<span class="line-number"> 36</span>        with open(path, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number"> 37</span>            return json.load(f)
</div>
<div class="line-uncovered">
<span class="line-number"> 38</span>    elif path.is_dir():
</div>
<div class="line-context">
<span class="line-number"> 39</span>        # Merge all .json files in the folder
</div>
<div class="line-context">
<span class="line-number"> 40</span>        config = {}
</div>
<div class="line-context">
<span class="line-number"> 41</span>        for file in path.glob("*.json"):
</div>
<div class="line-context">
<span class="line-number"> 42</span>            with open(file, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number"> 43</span>                data = json.load(f)
</div>
<div class="line-context">
<span class="line-number"> 44</span>                config.update(data)
</div>
<div class="line-context">
<span class="line-number"> 45</span>        return config
</div>
<div class="line-context">
<span class="line-number"> 46</span>    else:
</div>
<div class="line-context">
<span class="line-number"> 47</span>        raise FileNotFoundError(f"Config path not found: {config_path}")
</div>
<div class="line-context">
<span class="line-number"> 48</span>
</div>
</div>
<h4>Lines 40-45</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 30</span>    )
</div>
<div class="line-context">
<span class="line-number"> 31</span>
</div>
<div class="line-context">
<span class="line-number"> 32</span>
</div>
<div class="line-context">
<span class="line-number"> 33</span>def load_config_from_path(config_path: str) -> dict:
</div>
<div class="line-context">
<span class="line-number"> 34</span>    path = Path(config_path)
</div>
<div class="line-context">
<span class="line-number"> 35</span>    if path.is_file():
</div>
<div class="line-context">
<span class="line-number"> 36</span>        with open(path, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number"> 37</span>            return json.load(f)
</div>
<div class="line-context">
<span class="line-number"> 38</span>    elif path.is_dir():
</div>
<div class="line-context">
<span class="line-number"> 39</span>        # Merge all .json files in the folder
</div>
<div class="line-uncovered">
<span class="line-number"> 40</span>        config = {}
</div>
<div class="line-uncovered">
<span class="line-number"> 41</span>        for file in path.glob("*.json"):
</div>
<div class="line-uncovered">
<span class="line-number"> 42</span>            with open(file, "r", encoding="utf-8") as f:
</div>
<div class="line-uncovered">
<span class="line-number"> 43</span>                data = json.load(f)
</div>
<div class="line-uncovered">
<span class="line-number"> 44</span>                config.update(data)
</div>
<div class="line-uncovered">
<span class="line-number"> 45</span>        return config
</div>
<div class="line-context">
<span class="line-number"> 46</span>    else:
</div>
<div class="line-context">
<span class="line-number"> 47</span>        raise FileNotFoundError(f"Config path not found: {config_path}")
</div>
<div class="line-context">
<span class="line-number"> 48</span>
</div>
<div class="line-context">
<span class="line-number"> 49</span>
</div>
<div class="line-context">
<span class="line-number"> 50</span>def main() -> int:
</div>
<div class="line-context">
<span class="line-number"> 51</span>    parser = argparse.ArgumentParser(
</div>
<div class="line-context">
<span class="line-number"> 52</span>        description="C to PlantUML Converter (Simplified CLI)",
</div>
<div class="line-context">
<span class="line-number"> 53</span>        formatter_class=argparse.RawDescriptionHelpFormatter,
</div>
<div class="line-context">
<span class="line-number"> 54</span>        epilog="""
</div>
<div class="line-context">
<span class="line-number"> 55</span>Usage:
</div>
</div>
<h4>Line 47</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 37</span>            return json.load(f)
</div>
<div class="line-context">
<span class="line-number"> 38</span>    elif path.is_dir():
</div>
<div class="line-context">
<span class="line-number"> 39</span>        # Merge all .json files in the folder
</div>
<div class="line-context">
<span class="line-number"> 40</span>        config = {}
</div>
<div class="line-context">
<span class="line-number"> 41</span>        for file in path.glob("*.json"):
</div>
<div class="line-context">
<span class="line-number"> 42</span>            with open(file, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number"> 43</span>                data = json.load(f)
</div>
<div class="line-context">
<span class="line-number"> 44</span>                config.update(data)
</div>
<div class="line-context">
<span class="line-number"> 45</span>        return config
</div>
<div class="line-context">
<span class="line-number"> 46</span>    else:
</div>
<div class="line-uncovered">
<span class="line-number"> 47</span>        raise FileNotFoundError(f"Config path not found: {config_path}")
</div>
<div class="line-context">
<span class="line-number"> 48</span>
</div>
<div class="line-context">
<span class="line-number"> 49</span>
</div>
<div class="line-context">
<span class="line-number"> 50</span>def main() -> int:
</div>
<div class="line-context">
<span class="line-number"> 51</span>    parser = argparse.ArgumentParser(
</div>
<div class="line-context">
<span class="line-number"> 52</span>        description="C to PlantUML Converter (Simplified CLI)",
</div>
<div class="line-context">
<span class="line-number"> 53</span>        formatter_class=argparse.RawDescriptionHelpFormatter,
</div>
<div class="line-context">
<span class="line-number"> 54</span>        epilog="""
</div>
<div class="line-context">
<span class="line-number"> 55</span>Usage:
</div>
<div class="line-context">
<span class="line-number"> 56</span>  %(prog)s --config config.json [parse|transform|generate]
</div>
<div class="line-context">
<span class="line-number"> 57</span>  %(prog)s config_folder [parse|transform|generate]
</div>
</div>
<h4>Line 85</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 75</span>    parser.add_argument(
</div>
<div class="line-context">
<span class="line-number"> 76</span>        "--verbose", "-v", action="store_true", help="Enable verbose output"
</div>
<div class="line-context">
<span class="line-number"> 77</span>    )
</div>
<div class="line-context">
<span class="line-number"> 78</span>    args = parser.parse_args()
</div>
<div class="line-context">
<span class="line-number"> 79</span>
</div>
<div class="line-context">
<span class="line-number"> 80</span>    setup_logging(args.verbose)
</div>
<div class="line-context">
<span class="line-number"> 81</span>
</div>
<div class="line-context">
<span class="line-number"> 82</span>    # Determine config path
</div>
<div class="line-context">
<span class="line-number"> 83</span>    config_path = args.config
</div>
<div class="line-context">
<span class="line-number"> 84</span>    if config_path is None:
</div>
<div class="line-uncovered">
<span class="line-number"> 85</span>        config_path = os.getcwd()
</div>
<div class="line-context">
<span class="line-number"> 86</span>
</div>
<div class="line-context">
<span class="line-number"> 87</span>    logging.info("Using config: %s", config_path)
</div>
<div class="line-context">
<span class="line-number"> 88</span>
</div>
<div class="line-context">
<span class="line-number"> 89</span>    # Load config
</div>
<div class="line-context">
<span class="line-number"> 90</span>    try:
</div>
<div class="line-context">
<span class="line-number"> 91</span>        config_data = load_config_from_path(config_path)
</div>
<div class="line-context">
<span class="line-number"> 92</span>        config = Config(**config_data)
</div>
<div class="line-context">
<span class="line-number"> 93</span>    except Exception as e:
</div>
<div class="line-context">
<span class="line-number"> 94</span>        logging.error("Failed to load configuration: %s", e)
</div>
<div class="line-context">
<span class="line-number"> 95</span>        return 1
</div>
</div>
<h4>Lines 93-95</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 83</span>    config_path = args.config
</div>
<div class="line-context">
<span class="line-number"> 84</span>    if config_path is None:
</div>
<div class="line-context">
<span class="line-number"> 85</span>        config_path = os.getcwd()
</div>
<div class="line-context">
<span class="line-number"> 86</span>
</div>
<div class="line-context">
<span class="line-number"> 87</span>    logging.info("Using config: %s", config_path)
</div>
<div class="line-context">
<span class="line-number"> 88</span>
</div>
<div class="line-context">
<span class="line-number"> 89</span>    # Load config
</div>
<div class="line-context">
<span class="line-number"> 90</span>    try:
</div>
<div class="line-context">
<span class="line-number"> 91</span>        config_data = load_config_from_path(config_path)
</div>
<div class="line-context">
<span class="line-number"> 92</span>        config = Config(**config_data)
</div>
<div class="line-uncovered">
<span class="line-number"> 93</span>    except Exception as e:
</div>
<div class="line-uncovered">
<span class="line-number"> 94</span>        logging.error("Failed to load configuration: %s", e)
</div>
<div class="line-uncovered">
<span class="line-number"> 95</span>        return 1
</div>
<div class="line-context">
<span class="line-number"> 96</span>
</div>
<div class="line-context">
<span class="line-number"> 97</span>    # Determine output folder from config, default to ./output
</div>
<div class="line-context">
<span class="line-number"> 98</span>    output_folder = getattr(config, "output_dir", None) or os.path.join(
</div>
<div class="line-context">
<span class="line-number"> 99</span>        os.getcwd(), "output"
</div>
<div class="line-context">
<span class="line-number">100</span>    )
</div>
<div class="line-context">
<span class="line-number">101</span>    output_folder = os.path.abspath(output_folder)
</div>
<div class="line-context">
<span class="line-number">102</span>    os.makedirs(output_folder, exist_ok=True)
</div>
<div class="line-context">
<span class="line-number">103</span>    logging.info("Output folder: %s", output_folder)
</div>
<div class="line-context">
<span class="line-number">104</span>
</div>
<div class="line-context">
<span class="line-number">105</span>    model_file = os.path.join(output_folder, "model.json")
</div>
</div>
<h4>Lines 110-111</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">100</span>    )
</div>
<div class="line-context">
<span class="line-number">101</span>    output_folder = os.path.abspath(output_folder)
</div>
<div class="line-context">
<span class="line-number">102</span>    os.makedirs(output_folder, exist_ok=True)
</div>
<div class="line-context">
<span class="line-number">103</span>    logging.info("Output folder: %s", output_folder)
</div>
<div class="line-context">
<span class="line-number">104</span>
</div>
<div class="line-context">
<span class="line-number">105</span>    model_file = os.path.join(output_folder, "model.json")
</div>
<div class="line-context">
<span class="line-number">106</span>    transformed_model_file = os.path.join(output_folder, "model_transformed.json")
</div>
<div class="line-context">
<span class="line-number">107</span>
</div>
<div class="line-context">
<span class="line-number">108</span>    # Parse command
</div>
<div class="line-context">
<span class="line-number">109</span>    if args.command == "parse":
</div>
<div class="line-uncovered">
<span class="line-number">110</span>        try:
</div>
<div class="line-uncovered">
<span class="line-number">111</span>            parser_obj = Parser()
</div>
<div class="line-context">
<span class="line-number">112</span>            # Use the refactored parse function that handles both single and multiple source folders
</div>
<div class="line-context">
<span class="line-number">113</span>            parser_obj.parse(
</div>
<div class="line-context">
<span class="line-number">114</span>                project_root=config.source_folders,
</div>
<div class="line-context">
<span class="line-number">115</span>                output_file=model_file,
</div>
<div class="line-context">
<span class="line-number">116</span>                recursive_search=getattr(config, "recursive_search", True),
</div>
<div class="line-context">
<span class="line-number">117</span>                config=config,
</div>
<div class="line-context">
<span class="line-number">118</span>            )
</div>
<div class="line-context">
<span class="line-number">119</span>            logging.info("Model saved to: %s", model_file)
</div>
<div class="line-context">
<span class="line-number">120</span>            return 0
</div>
<div class="line-context">
<span class="line-number">121</span>        except (OSError, ValueError, RuntimeError) as e:
</div>
</div>
<h4>Line 113</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">103</span>    logging.info("Output folder: %s", output_folder)
</div>
<div class="line-context">
<span class="line-number">104</span>
</div>
<div class="line-context">
<span class="line-number">105</span>    model_file = os.path.join(output_folder, "model.json")
</div>
<div class="line-context">
<span class="line-number">106</span>    transformed_model_file = os.path.join(output_folder, "model_transformed.json")
</div>
<div class="line-context">
<span class="line-number">107</span>
</div>
<div class="line-context">
<span class="line-number">108</span>    # Parse command
</div>
<div class="line-context">
<span class="line-number">109</span>    if args.command == "parse":
</div>
<div class="line-context">
<span class="line-number">110</span>        try:
</div>
<div class="line-context">
<span class="line-number">111</span>            parser_obj = Parser()
</div>
<div class="line-context">
<span class="line-number">112</span>            # Use the refactored parse function that handles both single and multiple source folders
</div>
<div class="line-uncovered">
<span class="line-number">113</span>            parser_obj.parse(
</div>
<div class="line-context">
<span class="line-number">114</span>                project_root=config.source_folders,
</div>
<div class="line-context">
<span class="line-number">115</span>                output_file=model_file,
</div>
<div class="line-context">
<span class="line-number">116</span>                recursive_search=getattr(config, "recursive_search", True),
</div>
<div class="line-context">
<span class="line-number">117</span>                config=config,
</div>
<div class="line-context">
<span class="line-number">118</span>            )
</div>
<div class="line-context">
<span class="line-number">119</span>            logging.info("Model saved to: %s", model_file)
</div>
<div class="line-context">
<span class="line-number">120</span>            return 0
</div>
<div class="line-context">
<span class="line-number">121</span>        except (OSError, ValueError, RuntimeError) as e:
</div>
<div class="line-context">
<span class="line-number">122</span>            logging.error("Error during parsing: %s", e)
</div>
<div class="line-context">
<span class="line-number">123</span>            return 1
</div>
</div>
<h4>Lines 119-123</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">109</span>    if args.command == "parse":
</div>
<div class="line-context">
<span class="line-number">110</span>        try:
</div>
<div class="line-context">
<span class="line-number">111</span>            parser_obj = Parser()
</div>
<div class="line-context">
<span class="line-number">112</span>            # Use the refactored parse function that handles both single and multiple source folders
</div>
<div class="line-context">
<span class="line-number">113</span>            parser_obj.parse(
</div>
<div class="line-context">
<span class="line-number">114</span>                project_root=config.source_folders,
</div>
<div class="line-context">
<span class="line-number">115</span>                output_file=model_file,
</div>
<div class="line-context">
<span class="line-number">116</span>                recursive_search=getattr(config, "recursive_search", True),
</div>
<div class="line-context">
<span class="line-number">117</span>                config=config,
</div>
<div class="line-context">
<span class="line-number">118</span>            )
</div>
<div class="line-uncovered">
<span class="line-number">119</span>            logging.info("Model saved to: %s", model_file)
</div>
<div class="line-uncovered">
<span class="line-number">120</span>            return 0
</div>
<div class="line-uncovered">
<span class="line-number">121</span>        except (OSError, ValueError, RuntimeError) as e:
</div>
<div class="line-uncovered">
<span class="line-number">122</span>            logging.error("Error during parsing: %s", e)
</div>
<div class="line-uncovered">
<span class="line-number">123</span>            return 1
</div>
<div class="line-context">
<span class="line-number">124</span>
</div>
<div class="line-context">
<span class="line-number">125</span>    # Transform command
</div>
<div class="line-context">
<span class="line-number">126</span>    if args.command == "transform":
</div>
<div class="line-context">
<span class="line-number">127</span>        try:
</div>
<div class="line-context">
<span class="line-number">128</span>            transformer = Transformer()
</div>
<div class="line-context">
<span class="line-number">129</span>            transformer.transform(
</div>
<div class="line-context">
<span class="line-number">130</span>                model_file=model_file,
</div>
<div class="line-context">
<span class="line-number">131</span>                config_file=(
</div>
<div class="line-context">
<span class="line-number">132</span>                    config_path
</div>
<div class="line-context">
<span class="line-number">133</span>                    if Path(config_path).is_file()
</div>
</div>
<h4>Lines 127-129</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">117</span>                config=config,
</div>
<div class="line-context">
<span class="line-number">118</span>            )
</div>
<div class="line-context">
<span class="line-number">119</span>            logging.info("Model saved to: %s", model_file)
</div>
<div class="line-context">
<span class="line-number">120</span>            return 0
</div>
<div class="line-context">
<span class="line-number">121</span>        except (OSError, ValueError, RuntimeError) as e:
</div>
<div class="line-context">
<span class="line-number">122</span>            logging.error("Error during parsing: %s", e)
</div>
<div class="line-context">
<span class="line-number">123</span>            return 1
</div>
<div class="line-context">
<span class="line-number">124</span>
</div>
<div class="line-context">
<span class="line-number">125</span>    # Transform command
</div>
<div class="line-context">
<span class="line-number">126</span>    if args.command == "transform":
</div>
<div class="line-uncovered">
<span class="line-number">127</span>        try:
</div>
<div class="line-uncovered">
<span class="line-number">128</span>            transformer = Transformer()
</div>
<div class="line-uncovered">
<span class="line-number">129</span>            transformer.transform(
</div>
<div class="line-context">
<span class="line-number">130</span>                model_file=model_file,
</div>
<div class="line-context">
<span class="line-number">131</span>                config_file=(
</div>
<div class="line-context">
<span class="line-number">132</span>                    config_path
</div>
<div class="line-context">
<span class="line-number">133</span>                    if Path(config_path).is_file()
</div>
<div class="line-context">
<span class="line-number">134</span>                    else str(list(Path(config_path).glob("*.json"))[0])
</div>
<div class="line-context">
<span class="line-number">135</span>                ),
</div>
<div class="line-context">
<span class="line-number">136</span>                output_file=transformed_model_file,
</div>
<div class="line-context">
<span class="line-number">137</span>            )
</div>
<div class="line-context">
<span class="line-number">138</span>            logging.info("Transformed model saved to: %s", transformed_model_file)
</div>
<div class="line-context">
<span class="line-number">139</span>            return 0
</div>
</div>
<h4>Lines 138-142</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">128</span>            transformer = Transformer()
</div>
<div class="line-context">
<span class="line-number">129</span>            transformer.transform(
</div>
<div class="line-context">
<span class="line-number">130</span>                model_file=model_file,
</div>
<div class="line-context">
<span class="line-number">131</span>                config_file=(
</div>
<div class="line-context">
<span class="line-number">132</span>                    config_path
</div>
<div class="line-context">
<span class="line-number">133</span>                    if Path(config_path).is_file()
</div>
<div class="line-context">
<span class="line-number">134</span>                    else str(list(Path(config_path).glob("*.json"))[0])
</div>
<div class="line-context">
<span class="line-number">135</span>                ),
</div>
<div class="line-context">
<span class="line-number">136</span>                output_file=transformed_model_file,
</div>
<div class="line-context">
<span class="line-number">137</span>            )
</div>
<div class="line-uncovered">
<span class="line-number">138</span>            logging.info("Transformed model saved to: %s", transformed_model_file)
</div>
<div class="line-uncovered">
<span class="line-number">139</span>            return 0
</div>
<div class="line-uncovered">
<span class="line-number">140</span>        except (OSError, ValueError, RuntimeError) as e:
</div>
<div class="line-uncovered">
<span class="line-number">141</span>            logging.error("Error during transformation: %s", e)
</div>
<div class="line-uncovered">
<span class="line-number">142</span>            return 1
</div>
<div class="line-context">
<span class="line-number">143</span>
</div>
<div class="line-context">
<span class="line-number">144</span>    # Generate command
</div>
<div class="line-context">
<span class="line-number">145</span>    if args.command == "generate":
</div>
<div class="line-context">
<span class="line-number">146</span>        try:
</div>
<div class="line-context">
<span class="line-number">147</span>            generator = Generator()
</div>
<div class="line-context">
<span class="line-number">148</span>            # Prefer transformed model, else fallback to model.json
</div>
<div class="line-context">
<span class="line-number">149</span>            if os.path.exists(transformed_model_file):
</div>
<div class="line-context">
<span class="line-number">150</span>                model_to_use = transformed_model_file
</div>
<div class="line-context">
<span class="line-number">151</span>            elif os.path.exists(model_file):
</div>
<div class="line-context">
<span class="line-number">152</span>                model_to_use = model_file
</div>
</div>
<h4>Lines 146-147</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">136</span>                output_file=transformed_model_file,
</div>
<div class="line-context">
<span class="line-number">137</span>            )
</div>
<div class="line-context">
<span class="line-number">138</span>            logging.info("Transformed model saved to: %s", transformed_model_file)
</div>
<div class="line-context">
<span class="line-number">139</span>            return 0
</div>
<div class="line-context">
<span class="line-number">140</span>        except (OSError, ValueError, RuntimeError) as e:
</div>
<div class="line-context">
<span class="line-number">141</span>            logging.error("Error during transformation: %s", e)
</div>
<div class="line-context">
<span class="line-number">142</span>            return 1
</div>
<div class="line-context">
<span class="line-number">143</span>
</div>
<div class="line-context">
<span class="line-number">144</span>    # Generate command
</div>
<div class="line-context">
<span class="line-number">145</span>    if args.command == "generate":
</div>
<div class="line-uncovered">
<span class="line-number">146</span>        try:
</div>
<div class="line-uncovered">
<span class="line-number">147</span>            generator = Generator()
</div>
<div class="line-context">
<span class="line-number">148</span>            # Prefer transformed model, else fallback to model.json
</div>
<div class="line-context">
<span class="line-number">149</span>            if os.path.exists(transformed_model_file):
</div>
<div class="line-context">
<span class="line-number">150</span>                model_to_use = transformed_model_file
</div>
<div class="line-context">
<span class="line-number">151</span>            elif os.path.exists(model_file):
</div>
<div class="line-context">
<span class="line-number">152</span>                model_to_use = model_file
</div>
<div class="line-context">
<span class="line-number">153</span>            else:
</div>
<div class="line-context">
<span class="line-number">154</span>                logging.error("No model file found for generation.")
</div>
<div class="line-context">
<span class="line-number">155</span>                return 1
</div>
<div class="line-context">
<span class="line-number">156</span>            generator.generate(
</div>
<div class="line-context">
<span class="line-number">157</span>                model_file=model_to_use,
</div>
</div>
<h4>Lines 149-152</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">139</span>            return 0
</div>
<div class="line-context">
<span class="line-number">140</span>        except (OSError, ValueError, RuntimeError) as e:
</div>
<div class="line-context">
<span class="line-number">141</span>            logging.error("Error during transformation: %s", e)
</div>
<div class="line-context">
<span class="line-number">142</span>            return 1
</div>
<div class="line-context">
<span class="line-number">143</span>
</div>
<div class="line-context">
<span class="line-number">144</span>    # Generate command
</div>
<div class="line-context">
<span class="line-number">145</span>    if args.command == "generate":
</div>
<div class="line-context">
<span class="line-number">146</span>        try:
</div>
<div class="line-context">
<span class="line-number">147</span>            generator = Generator()
</div>
<div class="line-context">
<span class="line-number">148</span>            # Prefer transformed model, else fallback to model.json
</div>
<div class="line-uncovered">
<span class="line-number">149</span>            if os.path.exists(transformed_model_file):
</div>
<div class="line-uncovered">
<span class="line-number">150</span>                model_to_use = transformed_model_file
</div>
<div class="line-uncovered">
<span class="line-number">151</span>            elif os.path.exists(model_file):
</div>
<div class="line-uncovered">
<span class="line-number">152</span>                model_to_use = model_file
</div>
<div class="line-context">
<span class="line-number">153</span>            else:
</div>
<div class="line-context">
<span class="line-number">154</span>                logging.error("No model file found for generation.")
</div>
<div class="line-context">
<span class="line-number">155</span>                return 1
</div>
<div class="line-context">
<span class="line-number">156</span>            generator.generate(
</div>
<div class="line-context">
<span class="line-number">157</span>                model_file=model_to_use,
</div>
<div class="line-context">
<span class="line-number">158</span>                output_dir=output_folder,
</div>
<div class="line-context">
<span class="line-number">159</span>                include_depth=getattr(config, "include_depth", 1),
</div>
<div class="line-context">
<span class="line-number">160</span>            )
</div>
<div class="line-context">
<span class="line-number">161</span>            logging.info("PlantUML generation complete! Output in: %s", output_folder)
</div>
<div class="line-context">
<span class="line-number">162</span>            return 0
</div>
</div>
<h4>Lines 154-156</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">144</span>    # Generate command
</div>
<div class="line-context">
<span class="line-number">145</span>    if args.command == "generate":
</div>
<div class="line-context">
<span class="line-number">146</span>        try:
</div>
<div class="line-context">
<span class="line-number">147</span>            generator = Generator()
</div>
<div class="line-context">
<span class="line-number">148</span>            # Prefer transformed model, else fallback to model.json
</div>
<div class="line-context">
<span class="line-number">149</span>            if os.path.exists(transformed_model_file):
</div>
<div class="line-context">
<span class="line-number">150</span>                model_to_use = transformed_model_file
</div>
<div class="line-context">
<span class="line-number">151</span>            elif os.path.exists(model_file):
</div>
<div class="line-context">
<span class="line-number">152</span>                model_to_use = model_file
</div>
<div class="line-context">
<span class="line-number">153</span>            else:
</div>
<div class="line-uncovered">
<span class="line-number">154</span>                logging.error("No model file found for generation.")
</div>
<div class="line-uncovered">
<span class="line-number">155</span>                return 1
</div>
<div class="line-uncovered">
<span class="line-number">156</span>            generator.generate(
</div>
<div class="line-context">
<span class="line-number">157</span>                model_file=model_to_use,
</div>
<div class="line-context">
<span class="line-number">158</span>                output_dir=output_folder,
</div>
<div class="line-context">
<span class="line-number">159</span>                include_depth=getattr(config, "include_depth", 1),
</div>
<div class="line-context">
<span class="line-number">160</span>            )
</div>
<div class="line-context">
<span class="line-number">161</span>            logging.info("PlantUML generation complete! Output in: %s", output_folder)
</div>
<div class="line-context">
<span class="line-number">162</span>            return 0
</div>
<div class="line-context">
<span class="line-number">163</span>        except (OSError, ValueError, RuntimeError) as e:
</div>
<div class="line-context">
<span class="line-number">164</span>            logging.error("Error generating PlantUML: %s", e)
</div>
<div class="line-context">
<span class="line-number">165</span>            return 1
</div>
<div class="line-context">
<span class="line-number">166</span>
</div>
</div>
<h4>Lines 161-165</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">151</span>            elif os.path.exists(model_file):
</div>
<div class="line-context">
<span class="line-number">152</span>                model_to_use = model_file
</div>
<div class="line-context">
<span class="line-number">153</span>            else:
</div>
<div class="line-context">
<span class="line-number">154</span>                logging.error("No model file found for generation.")
</div>
<div class="line-context">
<span class="line-number">155</span>                return 1
</div>
<div class="line-context">
<span class="line-number">156</span>            generator.generate(
</div>
<div class="line-context">
<span class="line-number">157</span>                model_file=model_to_use,
</div>
<div class="line-context">
<span class="line-number">158</span>                output_dir=output_folder,
</div>
<div class="line-context">
<span class="line-number">159</span>                include_depth=getattr(config, "include_depth", 1),
</div>
<div class="line-context">
<span class="line-number">160</span>            )
</div>
<div class="line-uncovered">
<span class="line-number">161</span>            logging.info("PlantUML generation complete! Output in: %s", output_folder)
</div>
<div class="line-uncovered">
<span class="line-number">162</span>            return 0
</div>
<div class="line-uncovered">
<span class="line-number">163</span>        except (OSError, ValueError, RuntimeError) as e:
</div>
<div class="line-uncovered">
<span class="line-number">164</span>            logging.error("Error generating PlantUML: %s", e)
</div>
<div class="line-uncovered">
<span class="line-number">165</span>            return 1
</div>
<div class="line-context">
<span class="line-number">166</span>
</div>
<div class="line-context">
<span class="line-number">167</span>    # Default: full workflow
</div>
<div class="line-context">
<span class="line-number">168</span>    try:
</div>
<div class="line-context">
<span class="line-number">169</span>        # Step 1: Parse
</div>
<div class="line-context">
<span class="line-number">170</span>        parser_obj = Parser()
</div>
<div class="line-context">
<span class="line-number">171</span>        # Use the refactored parse function that handles both single and multiple source folders
</div>
<div class="line-context">
<span class="line-number">172</span>        parser_obj.parse(
</div>
<div class="line-context">
<span class="line-number">173</span>            project_root=config.source_folders,
</div>
<div class="line-context">
<span class="line-number">174</span>            output_file=model_file,
</div>
<div class="line-context">
<span class="line-number">175</span>            recursive_search=getattr(config, "recursive_search", True),
</div>
</div>
<h4>Lines 201-203</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">191</span>        # Step 3: Generate
</div>
<div class="line-context">
<span class="line-number">192</span>        generator = Generator()
</div>
<div class="line-context">
<span class="line-number">193</span>        generator.generate(
</div>
<div class="line-context">
<span class="line-number">194</span>            model_file=transformed_model_file,
</div>
<div class="line-context">
<span class="line-number">195</span>            output_dir=output_folder,
</div>
<div class="line-context">
<span class="line-number">196</span>            include_depth=getattr(config, "include_depth", 1),
</div>
<div class="line-context">
<span class="line-number">197</span>        )
</div>
<div class="line-context">
<span class="line-number">198</span>        logging.info("PlantUML generation complete! Output in: %s", output_folder)
</div>
<div class="line-context">
<span class="line-number">199</span>        logging.info("Complete workflow finished successfully!")
</div>
<div class="line-context">
<span class="line-number">200</span>        return 0
</div>
<div class="line-uncovered">
<span class="line-number">201</span>    except (OSError, ValueError, RuntimeError) as e:
</div>
<div class="line-uncovered">
<span class="line-number">202</span>        logging.error("Error in workflow: %s", e)
</div>
<div class="line-uncovered">
<span class="line-number">203</span>        return 1
</div>
<div class="line-context">
<span class="line-number">204</span>
</div>
<div class="line-context">
<span class="line-number">205</span>
</div>
<div class="line-context">
<span class="line-number">206</span>if __name__ == "__main__":
</div>
<div class="line-context">
<span class="line-number">207</span>    sys.exit(main())
</div>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/verifier.py
<span class="coverage-info">84.17% (117/139 lines covered)</span>
</div>
<h4>Line 67</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 57</span>        if not model.project_root or not model.project_root.strip():
</div>
<div class="line-context">
<span class="line-number"> 58</span>            self.issues.append("Project root is empty or whitespace")
</div>
<div class="line-context">
<span class="line-number"> 59</span>
</div>
<div class="line-context">
<span class="line-number"> 60</span>        if not model.files:
</div>
<div class="line-context">
<span class="line-number"> 61</span>            self.issues.append("No files found in project")
</div>
<div class="line-context">
<span class="line-number"> 62</span>
</div>
<div class="line-context">
<span class="line-number"> 63</span>    def _verify_file(self, file_path: str, file_model: FileModel) -> None:
</div>
<div class="line-context">
<span class="line-number"> 64</span>        """Verify a single file model"""
</div>
<div class="line-context">
<span class="line-number"> 65</span>        # Verify file-level data
</div>
<div class="line-context">
<span class="line-number"> 66</span>        if not file_model.file_path or not file_model.file_path.strip():
</div>
<div class="line-uncovered">
<span class="line-number"> 67</span>            self.issues.append(f"File path is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number"> 68</span>
</div>
<div class="line-context">
<span class="line-number"> 69</span>        if not file_model.relative_path or not file_model.relative_path.strip():
</div>
<div class="line-context">
<span class="line-number"> 70</span>            self.issues.append(f"Relative path is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number"> 71</span>
</div>
<div class="line-context">
<span class="line-number"> 72</span>        # Verify structs
</div>
<div class="line-context">
<span class="line-number"> 73</span>        for struct_name, struct in file_model.structs.items():
</div>
<div class="line-context">
<span class="line-number"> 74</span>            self._verify_struct(file_path, struct_name, struct)
</div>
<div class="line-context">
<span class="line-number"> 75</span>
</div>
<div class="line-context">
<span class="line-number"> 76</span>        # Verify enums
</div>
<div class="line-context">
<span class="line-number"> 77</span>        for enum_name, enum in file_model.enums.items():
</div>
</div>
<h4>Line 70</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 60</span>        if not model.files:
</div>
<div class="line-context">
<span class="line-number"> 61</span>            self.issues.append("No files found in project")
</div>
<div class="line-context">
<span class="line-number"> 62</span>
</div>
<div class="line-context">
<span class="line-number"> 63</span>    def _verify_file(self, file_path: str, file_model: FileModel) -> None:
</div>
<div class="line-context">
<span class="line-number"> 64</span>        """Verify a single file model"""
</div>
<div class="line-context">
<span class="line-number"> 65</span>        # Verify file-level data
</div>
<div class="line-context">
<span class="line-number"> 66</span>        if not file_model.file_path or not file_model.file_path.strip():
</div>
<div class="line-context">
<span class="line-number"> 67</span>            self.issues.append(f"File path is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number"> 68</span>
</div>
<div class="line-context">
<span class="line-number"> 69</span>        if not file_model.relative_path or not file_model.relative_path.strip():
</div>
<div class="line-uncovered">
<span class="line-number"> 70</span>            self.issues.append(f"Relative path is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number"> 71</span>
</div>
<div class="line-context">
<span class="line-number"> 72</span>        # Verify structs
</div>
<div class="line-context">
<span class="line-number"> 73</span>        for struct_name, struct in file_model.structs.items():
</div>
<div class="line-context">
<span class="line-number"> 74</span>            self._verify_struct(file_path, struct_name, struct)
</div>
<div class="line-context">
<span class="line-number"> 75</span>
</div>
<div class="line-context">
<span class="line-number"> 76</span>        # Verify enums
</div>
<div class="line-context">
<span class="line-number"> 77</span>        for enum_name, enum in file_model.enums.items():
</div>
<div class="line-context">
<span class="line-number"> 78</span>            self._verify_enum(file_path, enum_name, enum)
</div>
<div class="line-context">
<span class="line-number"> 79</span>
</div>
<div class="line-context">
<span class="line-number"> 80</span>        # Verify unions
</div>
</div>
<h4>Line 111</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">101</span>        if not struct.name or not struct.name.strip():
</div>
<div class="line-context">
<span class="line-number">102</span>            self.issues.append(f"Struct name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">103</span>
</div>
<div class="line-context">
<span class="line-number">104</span>        # Verify fields
</div>
<div class="line-context">
<span class="line-number">105</span>        for field in struct.fields:
</div>
<div class="line-context">
<span class="line-number">106</span>            self._verify_field(file_path, f"struct {struct_name}", field)
</div>
<div class="line-context">
<span class="line-number">107</span>
</div>
<div class="line-context">
<span class="line-number">108</span>    def _verify_enum(self, file_path: str, enum_name: str, enum: Enum) -> None:
</div>
<div class="line-context">
<span class="line-number">109</span>        """Verify an enum definition"""
</div>
<div class="line-context">
<span class="line-number">110</span>        if not self._is_valid_identifier(enum_name):
</div>
<div class="line-uncovered">
<span class="line-number">111</span>            self.issues.append(f"Invalid enum name '{enum_name}' in {file_path}")
</div>
<div class="line-context">
<span class="line-number">112</span>
</div>
<div class="line-context">
<span class="line-number">113</span>        if not enum.name or not enum.name.strip():
</div>
<div class="line-context">
<span class="line-number">114</span>            self.issues.append(f"Enum name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">115</span>
</div>
<div class="line-context">
<span class="line-number">116</span>        # Verify enum values
</div>
<div class="line-context">
<span class="line-number">117</span>        for enum_value in enum.values:
</div>
<div class="line-context">
<span class="line-number">118</span>            if not enum_value.name or not enum_value.name.strip():
</div>
<div class="line-context">
<span class="line-number">119</span>                self.issues.append(
</div>
<div class="line-context">
<span class="line-number">120</span>                    f"Enum value name is empty in enum {enum_name} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">121</span>                )
</div>
</div>
<h4>Line 114</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">104</span>        # Verify fields
</div>
<div class="line-context">
<span class="line-number">105</span>        for field in struct.fields:
</div>
<div class="line-context">
<span class="line-number">106</span>            self._verify_field(file_path, f"struct {struct_name}", field)
</div>
<div class="line-context">
<span class="line-number">107</span>
</div>
<div class="line-context">
<span class="line-number">108</span>    def _verify_enum(self, file_path: str, enum_name: str, enum: Enum) -> None:
</div>
<div class="line-context">
<span class="line-number">109</span>        """Verify an enum definition"""
</div>
<div class="line-context">
<span class="line-number">110</span>        if not self._is_valid_identifier(enum_name):
</div>
<div class="line-context">
<span class="line-number">111</span>            self.issues.append(f"Invalid enum name '{enum_name}' in {file_path}")
</div>
<div class="line-context">
<span class="line-number">112</span>
</div>
<div class="line-context">
<span class="line-number">113</span>        if not enum.name or not enum.name.strip():
</div>
<div class="line-uncovered">
<span class="line-number">114</span>            self.issues.append(f"Enum name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">115</span>
</div>
<div class="line-context">
<span class="line-number">116</span>        # Verify enum values
</div>
<div class="line-context">
<span class="line-number">117</span>        for enum_value in enum.values:
</div>
<div class="line-context">
<span class="line-number">118</span>            if not enum_value.name or not enum_value.name.strip():
</div>
<div class="line-context">
<span class="line-number">119</span>                self.issues.append(
</div>
<div class="line-context">
<span class="line-number">120</span>                    f"Enum value name is empty in enum {enum_name} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">121</span>                )
</div>
<div class="line-context">
<span class="line-number">122</span>            elif not self._is_valid_identifier(enum_value.name):
</div>
<div class="line-context">
<span class="line-number">123</span>                self.issues.append(
</div>
<div class="line-context">
<span class="line-number">124</span>                    f"Invalid enum value name '{enum_value.name}' in enum {enum_name} in {file_path}"
</div>
</div>
<h4>Line 119</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">109</span>        """Verify an enum definition"""
</div>
<div class="line-context">
<span class="line-number">110</span>        if not self._is_valid_identifier(enum_name):
</div>
<div class="line-context">
<span class="line-number">111</span>            self.issues.append(f"Invalid enum name '{enum_name}' in {file_path}")
</div>
<div class="line-context">
<span class="line-number">112</span>
</div>
<div class="line-context">
<span class="line-number">113</span>        if not enum.name or not enum.name.strip():
</div>
<div class="line-context">
<span class="line-number">114</span>            self.issues.append(f"Enum name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">115</span>
</div>
<div class="line-context">
<span class="line-number">116</span>        # Verify enum values
</div>
<div class="line-context">
<span class="line-number">117</span>        for enum_value in enum.values:
</div>
<div class="line-context">
<span class="line-number">118</span>            if not enum_value.name or not enum_value.name.strip():
</div>
<div class="line-uncovered">
<span class="line-number">119</span>                self.issues.append(
</div>
<div class="line-context">
<span class="line-number">120</span>                    f"Enum value name is empty in enum {enum_name} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">121</span>                )
</div>
<div class="line-context">
<span class="line-number">122</span>            elif not self._is_valid_identifier(enum_value.name):
</div>
<div class="line-context">
<span class="line-number">123</span>                self.issues.append(
</div>
<div class="line-context">
<span class="line-number">124</span>                    f"Invalid enum value name '{enum_value.name}' in enum {enum_name} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">125</span>                )
</div>
<div class="line-context">
<span class="line-number">126</span>
</div>
<div class="line-context">
<span class="line-number">127</span>    def _verify_union(self, file_path: str, union_name: str, union: Union) -> None:
</div>
<div class="line-context">
<span class="line-number">128</span>        """Verify a union definition"""
</div>
<div class="line-context">
<span class="line-number">129</span>        if not self._is_valid_identifier(union_name):
</div>
</div>
<h4>Line 123</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">113</span>        if not enum.name or not enum.name.strip():
</div>
<div class="line-context">
<span class="line-number">114</span>            self.issues.append(f"Enum name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">115</span>
</div>
<div class="line-context">
<span class="line-number">116</span>        # Verify enum values
</div>
<div class="line-context">
<span class="line-number">117</span>        for enum_value in enum.values:
</div>
<div class="line-context">
<span class="line-number">118</span>            if not enum_value.name or not enum_value.name.strip():
</div>
<div class="line-context">
<span class="line-number">119</span>                self.issues.append(
</div>
<div class="line-context">
<span class="line-number">120</span>                    f"Enum value name is empty in enum {enum_name} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">121</span>                )
</div>
<div class="line-context">
<span class="line-number">122</span>            elif not self._is_valid_identifier(enum_value.name):
</div>
<div class="line-uncovered">
<span class="line-number">123</span>                self.issues.append(
</div>
<div class="line-context">
<span class="line-number">124</span>                    f"Invalid enum value name '{enum_value.name}' in enum {enum_name} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">125</span>                )
</div>
<div class="line-context">
<span class="line-number">126</span>
</div>
<div class="line-context">
<span class="line-number">127</span>    def _verify_union(self, file_path: str, union_name: str, union: Union) -> None:
</div>
<div class="line-context">
<span class="line-number">128</span>        """Verify a union definition"""
</div>
<div class="line-context">
<span class="line-number">129</span>        if not self._is_valid_identifier(union_name):
</div>
<div class="line-context">
<span class="line-number">130</span>            self.issues.append(f"Invalid union name '{union_name}' in {file_path}")
</div>
<div class="line-context">
<span class="line-number">131</span>
</div>
<div class="line-context">
<span class="line-number">132</span>        if not union.name or not union.name.strip():
</div>
<div class="line-context">
<span class="line-number">133</span>            self.issues.append(f"Union name is empty in {file_path}")
</div>
</div>
<h4>Line 130</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">120</span>                    f"Enum value name is empty in enum {enum_name} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">121</span>                )
</div>
<div class="line-context">
<span class="line-number">122</span>            elif not self._is_valid_identifier(enum_value.name):
</div>
<div class="line-context">
<span class="line-number">123</span>                self.issues.append(
</div>
<div class="line-context">
<span class="line-number">124</span>                    f"Invalid enum value name '{enum_value.name}' in enum {enum_name} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">125</span>                )
</div>
<div class="line-context">
<span class="line-number">126</span>
</div>
<div class="line-context">
<span class="line-number">127</span>    def _verify_union(self, file_path: str, union_name: str, union: Union) -> None:
</div>
<div class="line-context">
<span class="line-number">128</span>        """Verify a union definition"""
</div>
<div class="line-context">
<span class="line-number">129</span>        if not self._is_valid_identifier(union_name):
</div>
<div class="line-uncovered">
<span class="line-number">130</span>            self.issues.append(f"Invalid union name '{union_name}' in {file_path}")
</div>
<div class="line-context">
<span class="line-number">131</span>
</div>
<div class="line-context">
<span class="line-number">132</span>        if not union.name or not union.name.strip():
</div>
<div class="line-context">
<span class="line-number">133</span>            self.issues.append(f"Union name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">134</span>
</div>
<div class="line-context">
<span class="line-number">135</span>        # Verify fields
</div>
<div class="line-context">
<span class="line-number">136</span>        for field in union.fields:
</div>
<div class="line-context">
<span class="line-number">137</span>            self._verify_field(file_path, f"union {union_name}", field)
</div>
<div class="line-context">
<span class="line-number">138</span>
</div>
<div class="line-context">
<span class="line-number">139</span>    def _verify_function(self, file_path: str, function: Function) -> None:
</div>
<div class="line-context">
<span class="line-number">140</span>        """Verify a function definition"""
</div>
</div>
<h4>Line 133</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">123</span>                self.issues.append(
</div>
<div class="line-context">
<span class="line-number">124</span>                    f"Invalid enum value name '{enum_value.name}' in enum {enum_name} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">125</span>                )
</div>
<div class="line-context">
<span class="line-number">126</span>
</div>
<div class="line-context">
<span class="line-number">127</span>    def _verify_union(self, file_path: str, union_name: str, union: Union) -> None:
</div>
<div class="line-context">
<span class="line-number">128</span>        """Verify a union definition"""
</div>
<div class="line-context">
<span class="line-number">129</span>        if not self._is_valid_identifier(union_name):
</div>
<div class="line-context">
<span class="line-number">130</span>            self.issues.append(f"Invalid union name '{union_name}' in {file_path}")
</div>
<div class="line-context">
<span class="line-number">131</span>
</div>
<div class="line-context">
<span class="line-number">132</span>        if not union.name or not union.name.strip():
</div>
<div class="line-uncovered">
<span class="line-number">133</span>            self.issues.append(f"Union name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">134</span>
</div>
<div class="line-context">
<span class="line-number">135</span>        # Verify fields
</div>
<div class="line-context">
<span class="line-number">136</span>        for field in union.fields:
</div>
<div class="line-context">
<span class="line-number">137</span>            self._verify_field(file_path, f"union {union_name}", field)
</div>
<div class="line-context">
<span class="line-number">138</span>
</div>
<div class="line-context">
<span class="line-number">139</span>    def _verify_function(self, file_path: str, function: Function) -> None:
</div>
<div class="line-context">
<span class="line-number">140</span>        """Verify a function definition"""
</div>
<div class="line-context">
<span class="line-number">141</span>        if not function.name or not function.name.strip():
</div>
<div class="line-context">
<span class="line-number">142</span>            self.issues.append(f"Function name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">143</span>        elif not self._is_valid_identifier(function.name):
</div>
</div>
<h4>Line 142</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">132</span>        if not union.name or not union.name.strip():
</div>
<div class="line-context">
<span class="line-number">133</span>            self.issues.append(f"Union name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">134</span>
</div>
<div class="line-context">
<span class="line-number">135</span>        # Verify fields
</div>
<div class="line-context">
<span class="line-number">136</span>        for field in union.fields:
</div>
<div class="line-context">
<span class="line-number">137</span>            self._verify_field(file_path, f"union {union_name}", field)
</div>
<div class="line-context">
<span class="line-number">138</span>
</div>
<div class="line-context">
<span class="line-number">139</span>    def _verify_function(self, file_path: str, function: Function) -> None:
</div>
<div class="line-context">
<span class="line-number">140</span>        """Verify a function definition"""
</div>
<div class="line-context">
<span class="line-number">141</span>        if not function.name or not function.name.strip():
</div>
<div class="line-uncovered">
<span class="line-number">142</span>            self.issues.append(f"Function name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">143</span>        elif not self._is_valid_identifier(function.name):
</div>
<div class="line-context">
<span class="line-number">144</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">145</span>                f"Invalid function name '{function.name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">146</span>            )
</div>
<div class="line-context">
<span class="line-number">147</span>
</div>
<div class="line-context">
<span class="line-number">148</span>        if not function.return_type or not function.return_type.strip():
</div>
<div class="line-context">
<span class="line-number">149</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">150</span>                f"Function return type is empty for '{function.name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">151</span>            )
</div>
<div class="line-context">
<span class="line-number">152</span>
</div>
</div>
<h4>Line 144</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">134</span>
</div>
<div class="line-context">
<span class="line-number">135</span>        # Verify fields
</div>
<div class="line-context">
<span class="line-number">136</span>        for field in union.fields:
</div>
<div class="line-context">
<span class="line-number">137</span>            self._verify_field(file_path, f"union {union_name}", field)
</div>
<div class="line-context">
<span class="line-number">138</span>
</div>
<div class="line-context">
<span class="line-number">139</span>    def _verify_function(self, file_path: str, function: Function) -> None:
</div>
<div class="line-context">
<span class="line-number">140</span>        """Verify a function definition"""
</div>
<div class="line-context">
<span class="line-number">141</span>        if not function.name or not function.name.strip():
</div>
<div class="line-context">
<span class="line-number">142</span>            self.issues.append(f"Function name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">143</span>        elif not self._is_valid_identifier(function.name):
</div>
<div class="line-uncovered">
<span class="line-number">144</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">145</span>                f"Invalid function name '{function.name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">146</span>            )
</div>
<div class="line-context">
<span class="line-number">147</span>
</div>
<div class="line-context">
<span class="line-number">148</span>        if not function.return_type or not function.return_type.strip():
</div>
<div class="line-context">
<span class="line-number">149</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">150</span>                f"Function return type is empty for '{function.name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">151</span>            )
</div>
<div class="line-context">
<span class="line-number">152</span>
</div>
<div class="line-context">
<span class="line-number">153</span>        # Verify parameters (skip variadic parameter '...')
</div>
<div class="line-context">
<span class="line-number">154</span>        for param in function.parameters:
</div>
</div>
<h4>Line 149</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">139</span>    def _verify_function(self, file_path: str, function: Function) -> None:
</div>
<div class="line-context">
<span class="line-number">140</span>        """Verify a function definition"""
</div>
<div class="line-context">
<span class="line-number">141</span>        if not function.name or not function.name.strip():
</div>
<div class="line-context">
<span class="line-number">142</span>            self.issues.append(f"Function name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">143</span>        elif not self._is_valid_identifier(function.name):
</div>
<div class="line-context">
<span class="line-number">144</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">145</span>                f"Invalid function name '{function.name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">146</span>            )
</div>
<div class="line-context">
<span class="line-number">147</span>
</div>
<div class="line-context">
<span class="line-number">148</span>        if not function.return_type or not function.return_type.strip():
</div>
<div class="line-uncovered">
<span class="line-number">149</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">150</span>                f"Function return type is empty for '{function.name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">151</span>            )
</div>
<div class="line-context">
<span class="line-number">152</span>
</div>
<div class="line-context">
<span class="line-number">153</span>        # Verify parameters (skip variadic parameter '...')
</div>
<div class="line-context">
<span class="line-number">154</span>        for param in function.parameters:
</div>
<div class="line-context">
<span class="line-number">155</span>            if param.name == "...":  # Skip variadic parameter
</div>
<div class="line-context">
<span class="line-number">156</span>                continue
</div>
<div class="line-context">
<span class="line-number">157</span>            self._verify_field(file_path, f"function {function.name}", param)
</div>
<div class="line-context">
<span class="line-number">158</span>
</div>
<div class="line-context">
<span class="line-number">159</span>    def _verify_global(self, file_path: str, global_var: Field) -> None:
</div>
</div>
<h4>Line 166</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">156</span>                continue
</div>
<div class="line-context">
<span class="line-number">157</span>            self._verify_field(file_path, f"function {function.name}", param)
</div>
<div class="line-context">
<span class="line-number">158</span>
</div>
<div class="line-context">
<span class="line-number">159</span>    def _verify_global(self, file_path: str, global_var: Field) -> None:
</div>
<div class="line-context">
<span class="line-number">160</span>        """Verify a global variable"""
</div>
<div class="line-context">
<span class="line-number">161</span>        self._verify_field(file_path, "global", global_var)
</div>
<div class="line-context">
<span class="line-number">162</span>
</div>
<div class="line-context">
<span class="line-number">163</span>    def _verify_alias(self, file_path: str, alias_name: str, alias: Alias) -> None:
</div>
<div class="line-context">
<span class="line-number">164</span>        """Verify a type alias (typedef)"""
</div>
<div class="line-context">
<span class="line-number">165</span>        if not self._is_valid_identifier(alias_name):
</div>
<div class="line-uncovered">
<span class="line-number">166</span>            self.issues.append(f"Invalid alias name '{alias_name}' in {file_path}")
</div>
<div class="line-context">
<span class="line-number">167</span>
</div>
<div class="line-context">
<span class="line-number">168</span>        if not alias.name or not alias.name.strip():
</div>
<div class="line-context">
<span class="line-number">169</span>            self.issues.append(f"Alias name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">170</span>
</div>
<div class="line-context">
<span class="line-number">171</span>        if not alias.original_type or not alias.original_type.strip():
</div>
<div class="line-context">
<span class="line-number">172</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">173</span>                f"Alias original type is empty for '{alias_name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">174</span>            )
</div>
<div class="line-context">
<span class="line-number">175</span>
</div>
<div class="line-context">
<span class="line-number">176</span>    def _verify_field(self, file_path: str, context: str, field: Field) -> None:
</div>
</div>
<h4>Line 169</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">159</span>    def _verify_global(self, file_path: str, global_var: Field) -> None:
</div>
<div class="line-context">
<span class="line-number">160</span>        """Verify a global variable"""
</div>
<div class="line-context">
<span class="line-number">161</span>        self._verify_field(file_path, "global", global_var)
</div>
<div class="line-context">
<span class="line-number">162</span>
</div>
<div class="line-context">
<span class="line-number">163</span>    def _verify_alias(self, file_path: str, alias_name: str, alias: Alias) -> None:
</div>
<div class="line-context">
<span class="line-number">164</span>        """Verify a type alias (typedef)"""
</div>
<div class="line-context">
<span class="line-number">165</span>        if not self._is_valid_identifier(alias_name):
</div>
<div class="line-context">
<span class="line-number">166</span>            self.issues.append(f"Invalid alias name '{alias_name}' in {file_path}")
</div>
<div class="line-context">
<span class="line-number">167</span>
</div>
<div class="line-context">
<span class="line-number">168</span>        if not alias.name or not alias.name.strip():
</div>
<div class="line-uncovered">
<span class="line-number">169</span>            self.issues.append(f"Alias name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">170</span>
</div>
<div class="line-context">
<span class="line-number">171</span>        if not alias.original_type or not alias.original_type.strip():
</div>
<div class="line-context">
<span class="line-number">172</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">173</span>                f"Alias original type is empty for '{alias_name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">174</span>            )
</div>
<div class="line-context">
<span class="line-number">175</span>
</div>
<div class="line-context">
<span class="line-number">176</span>    def _verify_field(self, file_path: str, context: str, field: Field) -> None:
</div>
<div class="line-context">
<span class="line-number">177</span>        """Verify a field (struct field, function parameter, global variable)"""
</div>
<div class="line-context">
<span class="line-number">178</span>        # Check for invalid names
</div>
<div class="line-context">
<span class="line-number">179</span>        if not field.name or not field.name.strip():
</div>
</div>
<h4>Line 172</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">162</span>
</div>
<div class="line-context">
<span class="line-number">163</span>    def _verify_alias(self, file_path: str, alias_name: str, alias: Alias) -> None:
</div>
<div class="line-context">
<span class="line-number">164</span>        """Verify a type alias (typedef)"""
</div>
<div class="line-context">
<span class="line-number">165</span>        if not self._is_valid_identifier(alias_name):
</div>
<div class="line-context">
<span class="line-number">166</span>            self.issues.append(f"Invalid alias name '{alias_name}' in {file_path}")
</div>
<div class="line-context">
<span class="line-number">167</span>
</div>
<div class="line-context">
<span class="line-number">168</span>        if not alias.name or not alias.name.strip():
</div>
<div class="line-context">
<span class="line-number">169</span>            self.issues.append(f"Alias name is empty in {file_path}")
</div>
<div class="line-context">
<span class="line-number">170</span>
</div>
<div class="line-context">
<span class="line-number">171</span>        if not alias.original_type or not alias.original_type.strip():
</div>
<div class="line-uncovered">
<span class="line-number">172</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">173</span>                f"Alias original type is empty for '{alias_name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">174</span>            )
</div>
<div class="line-context">
<span class="line-number">175</span>
</div>
<div class="line-context">
<span class="line-number">176</span>    def _verify_field(self, file_path: str, context: str, field: Field) -> None:
</div>
<div class="line-context">
<span class="line-number">177</span>        """Verify a field (struct field, function parameter, global variable)"""
</div>
<div class="line-context">
<span class="line-number">178</span>        # Check for invalid names
</div>
<div class="line-context">
<span class="line-number">179</span>        if not field.name or not field.name.strip():
</div>
<div class="line-context">
<span class="line-number">180</span>            self.issues.append(f"Field name is empty in {context} in {file_path}")
</div>
<div class="line-context">
<span class="line-number">181</span>        elif not self._is_valid_identifier(field.name):
</div>
<div class="line-context">
<span class="line-number">182</span>            self.issues.append(
</div>
</div>
<h4>Line 180</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">170</span>
</div>
<div class="line-context">
<span class="line-number">171</span>        if not alias.original_type or not alias.original_type.strip():
</div>
<div class="line-context">
<span class="line-number">172</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">173</span>                f"Alias original type is empty for '{alias_name}' in {file_path}"
</div>
<div class="line-context">
<span class="line-number">174</span>            )
</div>
<div class="line-context">
<span class="line-number">175</span>
</div>
<div class="line-context">
<span class="line-number">176</span>    def _verify_field(self, file_path: str, context: str, field: Field) -> None:
</div>
<div class="line-context">
<span class="line-number">177</span>        """Verify a field (struct field, function parameter, global variable)"""
</div>
<div class="line-context">
<span class="line-number">178</span>        # Check for invalid names
</div>
<div class="line-context">
<span class="line-number">179</span>        if not field.name or not field.name.strip():
</div>
<div class="line-uncovered">
<span class="line-number">180</span>            self.issues.append(f"Field name is empty in {context} in {file_path}")
</div>
<div class="line-context">
<span class="line-number">181</span>        elif not self._is_valid_identifier(field.name):
</div>
<div class="line-context">
<span class="line-number">182</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">183</span>                f"Invalid field name '{field.name}' in {context} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">184</span>            )
</div>
<div class="line-context">
<span class="line-number">185</span>
</div>
<div class="line-context">
<span class="line-number">186</span>        # Check for invalid types
</div>
<div class="line-context">
<span class="line-number">187</span>        if not field.type or not field.type.strip():
</div>
<div class="line-context">
<span class="line-number">188</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">189</span>                f"Field type is empty for '{field.name}' in {context} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">190</span>            )
</div>
</div>
<h4>Line 188</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">178</span>        # Check for invalid names
</div>
<div class="line-context">
<span class="line-number">179</span>        if not field.name or not field.name.strip():
</div>
<div class="line-context">
<span class="line-number">180</span>            self.issues.append(f"Field name is empty in {context} in {file_path}")
</div>
<div class="line-context">
<span class="line-number">181</span>        elif not self._is_valid_identifier(field.name):
</div>
<div class="line-context">
<span class="line-number">182</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">183</span>                f"Invalid field name '{field.name}' in {context} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">184</span>            )
</div>
<div class="line-context">
<span class="line-number">185</span>
</div>
<div class="line-context">
<span class="line-number">186</span>        # Check for invalid types
</div>
<div class="line-context">
<span class="line-number">187</span>        if not field.type or not field.type.strip():
</div>
<div class="line-uncovered">
<span class="line-number">188</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">189</span>                f"Field type is empty for '{field.name}' in {context} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">190</span>            )
</div>
<div class="line-context">
<span class="line-number">191</span>        elif self._is_suspicious_type(field.type):
</div>
<div class="line-context">
<span class="line-number">192</span>            self.issues.append(
</div>
<div class="line-context">
<span class="line-number">193</span>                f"Suspicious field type '{field.type}' for '{field.name}' in {context} in {file_path}"
</div>
<div class="line-context">
<span class="line-number">194</span>            )
</div>
<div class="line-context">
<span class="line-number">195</span>
</div>
<div class="line-context">
<span class="line-number">196</span>        # Check for suspicious values
</div>
<div class="line-context">
<span class="line-number">197</span>        if field.value and self._is_suspicious_value(field.value):
</div>
<div class="line-context">
<span class="line-number">198</span>            self.issues.append(
</div>
</div>
<h4>Line 213</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">203</span>        """Check if a name is a valid C identifier"""
</div>
<div class="line-context">
<span class="line-number">204</span>        if not name or not name.strip():
</div>
<div class="line-context">
<span class="line-number">205</span>            return False
</div>
<div class="line-context">
<span class="line-number">206</span>
</div>
<div class="line-context">
<span class="line-number">207</span>        # C identifier rules: start with letter or underscore, then letters, digits, or underscores
</div>
<div class="line-context">
<span class="line-number">208</span>        return bool(re.match(r"^[a-zA-Z_][a-zA-Z0-9_]*$", name.strip()))
</div>
<div class="line-context">
<span class="line-number">209</span>
</div>
<div class="line-context">
<span class="line-number">210</span>    def _is_suspicious_type(self, type_str: str) -> bool:
</div>
<div class="line-context">
<span class="line-number">211</span>        """Check if a type string looks suspicious"""
</div>
<div class="line-context">
<span class="line-number">212</span>        if not type_str or not type_str.strip():
</div>
<div class="line-uncovered">
<span class="line-number">213</span>            return True
</div>
<div class="line-context">
<span class="line-number">214</span>
</div>
<div class="line-context">
<span class="line-number">215</span>        type_str = type_str.strip()
</div>
<div class="line-context">
<span class="line-number">216</span>
</div>
<div class="line-context">
<span class="line-number">217</span>        # Check for obvious parsing errors
</div>
<div class="line-context">
<span class="line-number">218</span>        suspicious_patterns = [
</div>
<div class="line-context">
<span class="line-number">219</span>            r"^[\[\]\{\}\(\)\s\\\n]+$",  # Only brackets, spaces, backslashes, newlines
</div>
<div class="line-context">
<span class="line-number">220</span>            r"^[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]+$",  # Mostly brackets and whitespace
</div>
<div class="line-context">
<span class="line-number">221</span>            r"^[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]*$",  # All brackets and whitespace
</div>
<div class="line-context">
<span class="line-number">222</span>            r"^[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]*$",  # Excessive brackets/whitespace
</div>
<div class="line-context">
<span class="line-number">223</span>        ]
</div>
</div>
<h4>Line 227</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">217</span>        # Check for obvious parsing errors
</div>
<div class="line-context">
<span class="line-number">218</span>        suspicious_patterns = [
</div>
<div class="line-context">
<span class="line-number">219</span>            r"^[\[\]\{\}\(\)\s\\\n]+$",  # Only brackets, spaces, backslashes, newlines
</div>
<div class="line-context">
<span class="line-number">220</span>            r"^[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]+$",  # Mostly brackets and whitespace
</div>
<div class="line-context">
<span class="line-number">221</span>            r"^[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]*$",  # All brackets and whitespace
</div>
<div class="line-context">
<span class="line-number">222</span>            r"^[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]*$",  # Excessive brackets/whitespace
</div>
<div class="line-context">
<span class="line-number">223</span>        ]
</div>
<div class="line-context">
<span class="line-number">224</span>
</div>
<div class="line-context">
<span class="line-number">225</span>        for pattern in suspicious_patterns:
</div>
<div class="line-context">
<span class="line-number">226</span>            if re.match(pattern, type_str):
</div>
<div class="line-uncovered">
<span class="line-number">227</span>                return True
</div>
<div class="line-context">
<span class="line-number">228</span>
</div>
<div class="line-context">
<span class="line-number">229</span>        # Check for unbalanced brackets
</div>
<div class="line-context">
<span class="line-number">230</span>        if self._has_unbalanced_brackets(type_str):
</div>
<div class="line-context">
<span class="line-number">231</span>            return True
</div>
<div class="line-context">
<span class="line-number">232</span>
</div>
<div class="line-context">
<span class="line-number">233</span>        # Check for excessive newlines or backslashes
</div>
<div class="line-context">
<span class="line-number">234</span>        if type_str.count("\n") > 5 or type_str.count("\\") > 10:
</div>
<div class="line-context">
<span class="line-number">235</span>            return True
</div>
<div class="line-context">
<span class="line-number">236</span>
</div>
<div class="line-context">
<span class="line-number">237</span>        return False
</div>
</div>
<h4>Line 235</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">225</span>        for pattern in suspicious_patterns:
</div>
<div class="line-context">
<span class="line-number">226</span>            if re.match(pattern, type_str):
</div>
<div class="line-context">
<span class="line-number">227</span>                return True
</div>
<div class="line-context">
<span class="line-number">228</span>
</div>
<div class="line-context">
<span class="line-number">229</span>        # Check for unbalanced brackets
</div>
<div class="line-context">
<span class="line-number">230</span>        if self._has_unbalanced_brackets(type_str):
</div>
<div class="line-context">
<span class="line-number">231</span>            return True
</div>
<div class="line-context">
<span class="line-number">232</span>
</div>
<div class="line-context">
<span class="line-number">233</span>        # Check for excessive newlines or backslashes
</div>
<div class="line-context">
<span class="line-number">234</span>        if type_str.count("\n") > 5 or type_str.count("\\") > 10:
</div>
<div class="line-uncovered">
<span class="line-number">235</span>            return True
</div>
<div class="line-context">
<span class="line-number">236</span>
</div>
<div class="line-context">
<span class="line-number">237</span>        return False
</div>
<div class="line-context">
<span class="line-number">238</span>
</div>
<div class="line-context">
<span class="line-number">239</span>    def _is_suspicious_value(self, value: str) -> bool:
</div>
<div class="line-context">
<span class="line-number">240</span>        """Check if a value string looks suspicious"""
</div>
<div class="line-context">
<span class="line-number">241</span>        if not value or not value.strip():
</div>
<div class="line-context">
<span class="line-number">242</span>            return True
</div>
<div class="line-context">
<span class="line-number">243</span>
</div>
<div class="line-context">
<span class="line-number">244</span>        value = value.strip()
</div>
<div class="line-context">
<span class="line-number">245</span>
</div>
</div>
<h4>Line 242</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">232</span>
</div>
<div class="line-context">
<span class="line-number">233</span>        # Check for excessive newlines or backslashes
</div>
<div class="line-context">
<span class="line-number">234</span>        if type_str.count("\n") > 5 or type_str.count("\\") > 10:
</div>
<div class="line-context">
<span class="line-number">235</span>            return True
</div>
<div class="line-context">
<span class="line-number">236</span>
</div>
<div class="line-context">
<span class="line-number">237</span>        return False
</div>
<div class="line-context">
<span class="line-number">238</span>
</div>
<div class="line-context">
<span class="line-number">239</span>    def _is_suspicious_value(self, value: str) -> bool:
</div>
<div class="line-context">
<span class="line-number">240</span>        """Check if a value string looks suspicious"""
</div>
<div class="line-context">
<span class="line-number">241</span>        if not value or not value.strip():
</div>
<div class="line-uncovered">
<span class="line-number">242</span>            return True
</div>
<div class="line-context">
<span class="line-number">243</span>
</div>
<div class="line-context">
<span class="line-number">244</span>        value = value.strip()
</div>
<div class="line-context">
<span class="line-number">245</span>
</div>
<div class="line-context">
<span class="line-number">246</span>        # Check for obvious parsing errors
</div>
<div class="line-context">
<span class="line-number">247</span>        suspicious_patterns = [
</div>
<div class="line-context">
<span class="line-number">248</span>            r"^[\[\]\{\}\(\)\s\\\n]+$",  # Only brackets, spaces, backslashes, newlines
</div>
<div class="line-context">
<span class="line-number">249</span>            r"^[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]+$",  # Mostly brackets and whitespace
</div>
<div class="line-context">
<span class="line-number">250</span>        ]
</div>
<div class="line-context">
<span class="line-number">251</span>
</div>
<div class="line-context">
<span class="line-number">252</span>        for pattern in suspicious_patterns:
</div>
</div>
<h4>Line 254</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">244</span>        value = value.strip()
</div>
<div class="line-context">
<span class="line-number">245</span>
</div>
<div class="line-context">
<span class="line-number">246</span>        # Check for obvious parsing errors
</div>
<div class="line-context">
<span class="line-number">247</span>        suspicious_patterns = [
</div>
<div class="line-context">
<span class="line-number">248</span>            r"^[\[\]\{\}\(\)\s\\\n]+$",  # Only brackets, spaces, backslashes, newlines
</div>
<div class="line-context">
<span class="line-number">249</span>            r"^[\[\]\{\}\(\)\s\\\n]*[\[\]\{\}\(\)\s\\\n]+$",  # Mostly brackets and whitespace
</div>
<div class="line-context">
<span class="line-number">250</span>        ]
</div>
<div class="line-context">
<span class="line-number">251</span>
</div>
<div class="line-context">
<span class="line-number">252</span>        for pattern in suspicious_patterns:
</div>
<div class="line-context">
<span class="line-number">253</span>            if re.match(pattern, value):
</div>
<div class="line-uncovered">
<span class="line-number">254</span>                return True
</div>
<div class="line-context">
<span class="line-number">255</span>
</div>
<div class="line-context">
<span class="line-number">256</span>        # Check for unbalanced brackets
</div>
<div class="line-context">
<span class="line-number">257</span>        if self._has_unbalanced_brackets(value):
</div>
<div class="line-context">
<span class="line-number">258</span>            return True
</div>
<div class="line-context">
<span class="line-number">259</span>
</div>
<div class="line-context">
<span class="line-number">260</span>        # Check for excessive newlines or backslashes
</div>
<div class="line-context">
<span class="line-number">261</span>        if value.count("\n") > 3 or value.count("\\") > 5:
</div>
<div class="line-context">
<span class="line-number">262</span>            return True
</div>
<div class="line-context">
<span class="line-number">263</span>
</div>
<div class="line-context">
<span class="line-number">264</span>        return False
</div>
</div>
<h4>Line 262</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">252</span>        for pattern in suspicious_patterns:
</div>
<div class="line-context">
<span class="line-number">253</span>            if re.match(pattern, value):
</div>
<div class="line-context">
<span class="line-number">254</span>                return True
</div>
<div class="line-context">
<span class="line-number">255</span>
</div>
<div class="line-context">
<span class="line-number">256</span>        # Check for unbalanced brackets
</div>
<div class="line-context">
<span class="line-number">257</span>        if self._has_unbalanced_brackets(value):
</div>
<div class="line-context">
<span class="line-number">258</span>            return True
</div>
<div class="line-context">
<span class="line-number">259</span>
</div>
<div class="line-context">
<span class="line-number">260</span>        # Check for excessive newlines or backslashes
</div>
<div class="line-context">
<span class="line-number">261</span>        if value.count("\n") > 3 or value.count("\\") > 5:
</div>
<div class="line-uncovered">
<span class="line-number">262</span>            return True
</div>
<div class="line-context">
<span class="line-number">263</span>
</div>
<div class="line-context">
<span class="line-number">264</span>        return False
</div>
<div class="line-context">
<span class="line-number">265</span>
</div>
<div class="line-context">
<span class="line-number">266</span>    def _has_unbalanced_brackets(self, text: str) -> bool:
</div>
<div class="line-context">
<span class="line-number">267</span>        """Check if text has unbalanced brackets"""
</div>
<div class="line-context">
<span class="line-number">268</span>        stack = []
</div>
<div class="line-context">
<span class="line-number">269</span>        bracket_pairs = {")": "(", "]": "[", "}": "{"}
</div>
<div class="line-context">
<span class="line-number">270</span>
</div>
<div class="line-context">
<span class="line-number">271</span>        for char in text:
</div>
<div class="line-context">
<span class="line-number">272</span>            if char in "([{":
</div>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/config.py
<span class="coverage-info">89.00% (178/200 lines covered)</span>
</div>
<h4>Line 54</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 44</span>    def __init__(self, *args, **kwargs):
</div>
<div class="line-context">
<span class="line-number"> 45</span>        """Initialize configuration with keyword arguments or a single dict"""
</div>
<div class="line-context">
<span class="line-number"> 46</span>        # Initialize logger
</div>
<div class="line-context">
<span class="line-number"> 47</span>        self.logger = logging.getLogger(__name__)
</div>
<div class="line-context">
<span class="line-number"> 48</span>
</div>
<div class="line-context">
<span class="line-number"> 49</span>        # Initialize with default values first
</div>
<div class="line-context">
<span class="line-number"> 50</span>        object.__init__(self)
</div>
<div class="line-context">
<span class="line-number"> 51</span>
</div>
<div class="line-context">
<span class="line-number"> 52</span>        # Ensure all dataclass fields are initialized with defaults
</div>
<div class="line-context">
<span class="line-number"> 53</span>        if not hasattr(self, "project_name"):
</div>
<div class="line-uncovered">
<span class="line-number"> 54</span>            self.project_name = "Unknown_Project"
</div>
<div class="line-context">
<span class="line-number"> 55</span>        if not hasattr(self, "source_folders"):
</div>
<div class="line-context">
<span class="line-number"> 56</span>            self.source_folders = []
</div>
<div class="line-context">
<span class="line-number"> 57</span>        if not hasattr(self, "output_dir"):
</div>
<div class="line-context">
<span class="line-number"> 58</span>            self.output_dir = "./output"
</div>
<div class="line-context">
<span class="line-number"> 59</span>        if not hasattr(self, "model_output_path"):
</div>
<div class="line-context">
<span class="line-number"> 60</span>            self.model_output_path = "model.json"
</div>
<div class="line-context">
<span class="line-number"> 61</span>        if not hasattr(self, "recursive_search"):
</div>
<div class="line-context">
<span class="line-number"> 62</span>            self.recursive_search = True
</div>
<div class="line-context">
<span class="line-number"> 63</span>        if not hasattr(self, "include_depth"):
</div>
<div class="line-context">
<span class="line-number"> 64</span>            self.include_depth = 1
</div>
</div>
<h4>Line 58</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 48</span>
</div>
<div class="line-context">
<span class="line-number"> 49</span>        # Initialize with default values first
</div>
<div class="line-context">
<span class="line-number"> 50</span>        object.__init__(self)
</div>
<div class="line-context">
<span class="line-number"> 51</span>
</div>
<div class="line-context">
<span class="line-number"> 52</span>        # Ensure all dataclass fields are initialized with defaults
</div>
<div class="line-context">
<span class="line-number"> 53</span>        if not hasattr(self, "project_name"):
</div>
<div class="line-context">
<span class="line-number"> 54</span>            self.project_name = "Unknown_Project"
</div>
<div class="line-context">
<span class="line-number"> 55</span>        if not hasattr(self, "source_folders"):
</div>
<div class="line-context">
<span class="line-number"> 56</span>            self.source_folders = []
</div>
<div class="line-context">
<span class="line-number"> 57</span>        if not hasattr(self, "output_dir"):
</div>
<div class="line-uncovered">
<span class="line-number"> 58</span>            self.output_dir = "./output"
</div>
<div class="line-context">
<span class="line-number"> 59</span>        if not hasattr(self, "model_output_path"):
</div>
<div class="line-context">
<span class="line-number"> 60</span>            self.model_output_path = "model.json"
</div>
<div class="line-context">
<span class="line-number"> 61</span>        if not hasattr(self, "recursive_search"):
</div>
<div class="line-context">
<span class="line-number"> 62</span>            self.recursive_search = True
</div>
<div class="line-context">
<span class="line-number"> 63</span>        if not hasattr(self, "include_depth"):
</div>
<div class="line-context">
<span class="line-number"> 64</span>            self.include_depth = 1
</div>
<div class="line-context">
<span class="line-number"> 65</span>        if not hasattr(self, "file_filters"):
</div>
<div class="line-context">
<span class="line-number"> 66</span>            self.file_filters = {}
</div>
<div class="line-context">
<span class="line-number"> 67</span>        if not hasattr(self, "element_filters"):
</div>
<div class="line-context">
<span class="line-number"> 68</span>            self.element_filters = {}
</div>
</div>
<h4>Line 60</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 50</span>        object.__init__(self)
</div>
<div class="line-context">
<span class="line-number"> 51</span>
</div>
<div class="line-context">
<span class="line-number"> 52</span>        # Ensure all dataclass fields are initialized with defaults
</div>
<div class="line-context">
<span class="line-number"> 53</span>        if not hasattr(self, "project_name"):
</div>
<div class="line-context">
<span class="line-number"> 54</span>            self.project_name = "Unknown_Project"
</div>
<div class="line-context">
<span class="line-number"> 55</span>        if not hasattr(self, "source_folders"):
</div>
<div class="line-context">
<span class="line-number"> 56</span>            self.source_folders = []
</div>
<div class="line-context">
<span class="line-number"> 57</span>        if not hasattr(self, "output_dir"):
</div>
<div class="line-context">
<span class="line-number"> 58</span>            self.output_dir = "./output"
</div>
<div class="line-context">
<span class="line-number"> 59</span>        if not hasattr(self, "model_output_path"):
</div>
<div class="line-uncovered">
<span class="line-number"> 60</span>            self.model_output_path = "model.json"
</div>
<div class="line-context">
<span class="line-number"> 61</span>        if not hasattr(self, "recursive_search"):
</div>
<div class="line-context">
<span class="line-number"> 62</span>            self.recursive_search = True
</div>
<div class="line-context">
<span class="line-number"> 63</span>        if not hasattr(self, "include_depth"):
</div>
<div class="line-context">
<span class="line-number"> 64</span>            self.include_depth = 1
</div>
<div class="line-context">
<span class="line-number"> 65</span>        if not hasattr(self, "file_filters"):
</div>
<div class="line-context">
<span class="line-number"> 66</span>            self.file_filters = {}
</div>
<div class="line-context">
<span class="line-number"> 67</span>        if not hasattr(self, "element_filters"):
</div>
<div class="line-context">
<span class="line-number"> 68</span>            self.element_filters = {}
</div>
<div class="line-context">
<span class="line-number"> 69</span>        if not hasattr(self, "transformations"):
</div>
<div class="line-context">
<span class="line-number"> 70</span>            self.transformations = {}
</div>
</div>
<h4>Line 62</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 52</span>        # Ensure all dataclass fields are initialized with defaults
</div>
<div class="line-context">
<span class="line-number"> 53</span>        if not hasattr(self, "project_name"):
</div>
<div class="line-context">
<span class="line-number"> 54</span>            self.project_name = "Unknown_Project"
</div>
<div class="line-context">
<span class="line-number"> 55</span>        if not hasattr(self, "source_folders"):
</div>
<div class="line-context">
<span class="line-number"> 56</span>            self.source_folders = []
</div>
<div class="line-context">
<span class="line-number"> 57</span>        if not hasattr(self, "output_dir"):
</div>
<div class="line-context">
<span class="line-number"> 58</span>            self.output_dir = "./output"
</div>
<div class="line-context">
<span class="line-number"> 59</span>        if not hasattr(self, "model_output_path"):
</div>
<div class="line-context">
<span class="line-number"> 60</span>            self.model_output_path = "model.json"
</div>
<div class="line-context">
<span class="line-number"> 61</span>        if not hasattr(self, "recursive_search"):
</div>
<div class="line-uncovered">
<span class="line-number"> 62</span>            self.recursive_search = True
</div>
<div class="line-context">
<span class="line-number"> 63</span>        if not hasattr(self, "include_depth"):
</div>
<div class="line-context">
<span class="line-number"> 64</span>            self.include_depth = 1
</div>
<div class="line-context">
<span class="line-number"> 65</span>        if not hasattr(self, "file_filters"):
</div>
<div class="line-context">
<span class="line-number"> 66</span>            self.file_filters = {}
</div>
<div class="line-context">
<span class="line-number"> 67</span>        if not hasattr(self, "element_filters"):
</div>
<div class="line-context">
<span class="line-number"> 68</span>            self.element_filters = {}
</div>
<div class="line-context">
<span class="line-number"> 69</span>        if not hasattr(self, "transformations"):
</div>
<div class="line-context">
<span class="line-number"> 70</span>            self.transformations = {}
</div>
<div class="line-context">
<span class="line-number"> 71</span>        if not hasattr(self, "file_include_patterns"):
</div>
<div class="line-context">
<span class="line-number"> 72</span>            self.file_include_patterns = []
</div>
</div>
<h4>Line 64</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 54</span>            self.project_name = "Unknown_Project"
</div>
<div class="line-context">
<span class="line-number"> 55</span>        if not hasattr(self, "source_folders"):
</div>
<div class="line-context">
<span class="line-number"> 56</span>            self.source_folders = []
</div>
<div class="line-context">
<span class="line-number"> 57</span>        if not hasattr(self, "output_dir"):
</div>
<div class="line-context">
<span class="line-number"> 58</span>            self.output_dir = "./output"
</div>
<div class="line-context">
<span class="line-number"> 59</span>        if not hasattr(self, "model_output_path"):
</div>
<div class="line-context">
<span class="line-number"> 60</span>            self.model_output_path = "model.json"
</div>
<div class="line-context">
<span class="line-number"> 61</span>        if not hasattr(self, "recursive_search"):
</div>
<div class="line-context">
<span class="line-number"> 62</span>            self.recursive_search = True
</div>
<div class="line-context">
<span class="line-number"> 63</span>        if not hasattr(self, "include_depth"):
</div>
<div class="line-uncovered">
<span class="line-number"> 64</span>            self.include_depth = 1
</div>
<div class="line-context">
<span class="line-number"> 65</span>        if not hasattr(self, "file_filters"):
</div>
<div class="line-context">
<span class="line-number"> 66</span>            self.file_filters = {}
</div>
<div class="line-context">
<span class="line-number"> 67</span>        if not hasattr(self, "element_filters"):
</div>
<div class="line-context">
<span class="line-number"> 68</span>            self.element_filters = {}
</div>
<div class="line-context">
<span class="line-number"> 69</span>        if not hasattr(self, "transformations"):
</div>
<div class="line-context">
<span class="line-number"> 70</span>            self.transformations = {}
</div>
<div class="line-context">
<span class="line-number"> 71</span>        if not hasattr(self, "file_include_patterns"):
</div>
<div class="line-context">
<span class="line-number"> 72</span>            self.file_include_patterns = []
</div>
<div class="line-context">
<span class="line-number"> 73</span>        if not hasattr(self, "file_exclude_patterns"):
</div>
<div class="line-context">
<span class="line-number"> 74</span>            self.file_exclude_patterns = []
</div>
</div>
<h4>Lines 89-92</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 79</span>
</div>
<div class="line-context">
<span class="line-number"> 80</span>        if len(args) == 1 and isinstance(args[0], dict):
</div>
<div class="line-context">
<span class="line-number"> 81</span>            # Handle case where a single dict is passed as positional argument
</div>
<div class="line-context">
<span class="line-number"> 82</span>            data = args[0]
</div>
<div class="line-context">
<span class="line-number"> 83</span>            # Set attributes manually
</div>
<div class="line-context">
<span class="line-number"> 84</span>            for key, value in data.items():
</div>
<div class="line-context">
<span class="line-number"> 85</span>                if hasattr(self, key):
</div>
<div class="line-context">
<span class="line-number"> 86</span>                    setattr(self, key, value)
</div>
<div class="line-context">
<span class="line-number"> 87</span>        elif len(kwargs) == 1 and isinstance(next(iter(kwargs.values())), dict):
</div>
<div class="line-context">
<span class="line-number"> 88</span>            # Handle case where a single dict is passed as keyword argument
</div>
<div class="line-uncovered">
<span class="line-number"> 89</span>            data = next(iter(kwargs.values()))
</div>
<div class="line-uncovered">
<span class="line-number"> 90</span>            for key, value in data.items():
</div>
<div class="line-uncovered">
<span class="line-number"> 91</span>                if hasattr(self, key):
</div>
<div class="line-uncovered">
<span class="line-number"> 92</span>                    setattr(self, key, value)
</div>
<div class="line-context">
<span class="line-number"> 93</span>        else:
</div>
<div class="line-context">
<span class="line-number"> 94</span>            # Handle normal keyword arguments
</div>
<div class="line-context">
<span class="line-number"> 95</span>            for key, value in kwargs.items():
</div>
<div class="line-context">
<span class="line-number"> 96</span>                if hasattr(self, key):
</div>
<div class="line-context">
<span class="line-number"> 97</span>                    setattr(self, key, value)
</div>
<div class="line-context">
<span class="line-number"> 98</span>
</div>
<div class="line-context">
<span class="line-number"> 99</span>        # Compile patterns after initialization
</div>
<div class="line-context">
<span class="line-number">100</span>        self._compile_patterns()
</div>
<div class="line-context">
<span class="line-number">101</span>
</div>
<div class="line-context">
<span class="line-number">102</span>    def __post_init__(self):
</div>
</div>
<h4>Line 104</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number"> 94</span>            # Handle normal keyword arguments
</div>
<div class="line-context">
<span class="line-number"> 95</span>            for key, value in kwargs.items():
</div>
<div class="line-context">
<span class="line-number"> 96</span>                if hasattr(self, key):
</div>
<div class="line-context">
<span class="line-number"> 97</span>                    setattr(self, key, value)
</div>
<div class="line-context">
<span class="line-number"> 98</span>
</div>
<div class="line-context">
<span class="line-number"> 99</span>        # Compile patterns after initialization
</div>
<div class="line-context">
<span class="line-number">100</span>        self._compile_patterns()
</div>
<div class="line-context">
<span class="line-number">101</span>
</div>
<div class="line-context">
<span class="line-number">102</span>    def __post_init__(self):
</div>
<div class="line-context">
<span class="line-number">103</span>        """Compile regex patterns after initialization"""
</div>
<div class="line-uncovered">
<span class="line-number">104</span>        self._compile_patterns()
</div>
<div class="line-context">
<span class="line-number">105</span>
</div>
<div class="line-context">
<span class="line-number">106</span>    def _compile_patterns(self):
</div>
<div class="line-context">
<span class="line-number">107</span>        """Compile regex patterns for filtering"""
</div>
<div class="line-context">
<span class="line-number">108</span>        # Compile file filter patterns with error handling
</div>
<div class="line-context">
<span class="line-number">109</span>        self.file_include_patterns = []
</div>
<div class="line-context">
<span class="line-number">110</span>        for pattern in self.file_filters.get("include", []):
</div>
<div class="line-context">
<span class="line-number">111</span>            try:
</div>
<div class="line-context">
<span class="line-number">112</span>                self.file_include_patterns.append(re.compile(pattern))
</div>
<div class="line-context">
<span class="line-number">113</span>            except re.error as e:
</div>
<div class="line-context">
<span class="line-number">114</span>                self.logger.warning("Invalid include pattern '%s': %s", pattern, e)
</div>
</div>
<h4>Lines 148-149</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">138</span>                        "Invalid %s include pattern '%s': %s", element_type, pattern, e
</div>
<div class="line-context">
<span class="line-number">139</span>                    )
</div>
<div class="line-context">
<span class="line-number">140</span>                    # Skip invalid patterns
</div>
<div class="line-context">
<span class="line-number">141</span>
</div>
<div class="line-context">
<span class="line-number">142</span>            self.element_exclude_patterns[element_type] = []
</div>
<div class="line-context">
<span class="line-number">143</span>            for pattern in filters.get("exclude", []):
</div>
<div class="line-context">
<span class="line-number">144</span>                try:
</div>
<div class="line-context">
<span class="line-number">145</span>                    self.element_exclude_patterns[element_type].append(
</div>
<div class="line-context">
<span class="line-number">146</span>                        re.compile(pattern)
</div>
<div class="line-context">
<span class="line-number">147</span>                    )
</div>
<div class="line-uncovered">
<span class="line-number">148</span>                except re.error as e:
</div>
<div class="line-uncovered">
<span class="line-number">149</span>                    self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">150</span>                        "Invalid %s exclude pattern '%s': %s", element_type, pattern, e
</div>
<div class="line-context">
<span class="line-number">151</span>                    )
</div>
<div class="line-context">
<span class="line-number">152</span>                    # Skip invalid patterns
</div>
<div class="line-context">
<span class="line-number">153</span>
</div>
<div class="line-context">
<span class="line-number">154</span>    @classmethod
</div>
<div class="line-context">
<span class="line-number">155</span>    def load(cls, config_file: str) -> "Config":
</div>
<div class="line-context">
<span class="line-number">156</span>        """Load configuration from JSON file"""
</div>
<div class="line-context">
<span class="line-number">157</span>        if not Path(config_file).exists():
</div>
<div class="line-context">
<span class="line-number">158</span>            raise FileNotFoundError(f"Configuration file not found: {config_file}")
</div>
<div class="line-context">
<span class="line-number">159</span>
</div>
</div>
<h4>Line 158</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">148</span>                except re.error as e:
</div>
<div class="line-context">
<span class="line-number">149</span>                    self.logger.warning(
</div>
<div class="line-context">
<span class="line-number">150</span>                        "Invalid %s exclude pattern '%s': %s", element_type, pattern, e
</div>
<div class="line-context">
<span class="line-number">151</span>                    )
</div>
<div class="line-context">
<span class="line-number">152</span>                    # Skip invalid patterns
</div>
<div class="line-context">
<span class="line-number">153</span>
</div>
<div class="line-context">
<span class="line-number">154</span>    @classmethod
</div>
<div class="line-context">
<span class="line-number">155</span>    def load(cls, config_file: str) -> "Config":
</div>
<div class="line-context">
<span class="line-number">156</span>        """Load configuration from JSON file"""
</div>
<div class="line-context">
<span class="line-number">157</span>        if not Path(config_file).exists():
</div>
<div class="line-uncovered">
<span class="line-number">158</span>            raise FileNotFoundError(f"Configuration file not found: {config_file}")
</div>
<div class="line-context">
<span class="line-number">159</span>
</div>
<div class="line-context">
<span class="line-number">160</span>        try:
</div>
<div class="line-context">
<span class="line-number">161</span>            with open(config_file, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number">162</span>                data = json.load(f)
</div>
<div class="line-context">
<span class="line-number">163</span>
</div>
<div class="line-context">
<span class="line-number">164</span>            # Handle backward compatibility: project_roots -> source_folders
</div>
<div class="line-context">
<span class="line-number">165</span>            if "project_roots" in data and "source_folders" not in data:
</div>
<div class="line-context">
<span class="line-number">166</span>                data["source_folders"] = data.pop("project_roots")
</div>
<div class="line-context">
<span class="line-number">167</span>
</div>
<div class="line-context">
<span class="line-number">168</span>            # Validate required fields
</div>
</div>
<h4>Line 166</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">156</span>        """Load configuration from JSON file"""
</div>
<div class="line-context">
<span class="line-number">157</span>        if not Path(config_file).exists():
</div>
<div class="line-context">
<span class="line-number">158</span>            raise FileNotFoundError(f"Configuration file not found: {config_file}")
</div>
<div class="line-context">
<span class="line-number">159</span>
</div>
<div class="line-context">
<span class="line-number">160</span>        try:
</div>
<div class="line-context">
<span class="line-number">161</span>            with open(config_file, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number">162</span>                data = json.load(f)
</div>
<div class="line-context">
<span class="line-number">163</span>
</div>
<div class="line-context">
<span class="line-number">164</span>            # Handle backward compatibility: project_roots -> source_folders
</div>
<div class="line-context">
<span class="line-number">165</span>            if "project_roots" in data and "source_folders" not in data:
</div>
<div class="line-uncovered">
<span class="line-number">166</span>                data["source_folders"] = data.pop("project_roots")
</div>
<div class="line-context">
<span class="line-number">167</span>
</div>
<div class="line-context">
<span class="line-number">168</span>            # Validate required fields
</div>
<div class="line-context">
<span class="line-number">169</span>            if "source_folders" not in data:
</div>
<div class="line-context">
<span class="line-number">170</span>                raise ValueError("Configuration must contain 'source_folders' field")
</div>
<div class="line-context">
<span class="line-number">171</span>
</div>
<div class="line-context">
<span class="line-number">172</span>            if not isinstance(data["source_folders"], list):
</div>
<div class="line-context">
<span class="line-number">173</span>                raise ValueError("'source_folders' must be a list")
</div>
<div class="line-context">
<span class="line-number">174</span>
</div>
<div class="line-context">
<span class="line-number">175</span>            return cls(**data)
</div>
<div class="line-context">
<span class="line-number">176</span>
</div>
</div>
<h4>Line 170</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">160</span>        try:
</div>
<div class="line-context">
<span class="line-number">161</span>            with open(config_file, "r", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number">162</span>                data = json.load(f)
</div>
<div class="line-context">
<span class="line-number">163</span>
</div>
<div class="line-context">
<span class="line-number">164</span>            # Handle backward compatibility: project_roots -> source_folders
</div>
<div class="line-context">
<span class="line-number">165</span>            if "project_roots" in data and "source_folders" not in data:
</div>
<div class="line-context">
<span class="line-number">166</span>                data["source_folders"] = data.pop("project_roots")
</div>
<div class="line-context">
<span class="line-number">167</span>
</div>
<div class="line-context">
<span class="line-number">168</span>            # Validate required fields
</div>
<div class="line-context">
<span class="line-number">169</span>            if "source_folders" not in data:
</div>
<div class="line-uncovered">
<span class="line-number">170</span>                raise ValueError("Configuration must contain 'source_folders' field")
</div>
<div class="line-context">
<span class="line-number">171</span>
</div>
<div class="line-context">
<span class="line-number">172</span>            if not isinstance(data["source_folders"], list):
</div>
<div class="line-context">
<span class="line-number">173</span>                raise ValueError("'source_folders' must be a list")
</div>
<div class="line-context">
<span class="line-number">174</span>
</div>
<div class="line-context">
<span class="line-number">175</span>            return cls(**data)
</div>
<div class="line-context">
<span class="line-number">176</span>
</div>
<div class="line-context">
<span class="line-number">177</span>        except Exception as e:
</div>
<div class="line-context">
<span class="line-number">178</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number">179</span>                f"Failed to load configuration from {config_file}: {e}"
</div>
<div class="line-context">
<span class="line-number">180</span>            ) from e
</div>
</div>
<h4>Lines 199-200</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">189</span>            "recursive_search": self.recursive_search,
</div>
<div class="line-context">
<span class="line-number">190</span>            "include_depth": self.include_depth,
</div>
<div class="line-context">
<span class="line-number">191</span>            "file_filters": self.file_filters,
</div>
<div class="line-context">
<span class="line-number">192</span>            "element_filters": self.element_filters,
</div>
<div class="line-context">
<span class="line-number">193</span>            "transformations": self.transformations,
</div>
<div class="line-context">
<span class="line-number">194</span>        }
</div>
<div class="line-context">
<span class="line-number">195</span>
</div>
<div class="line-context">
<span class="line-number">196</span>        try:
</div>
<div class="line-context">
<span class="line-number">197</span>            with open(config_file, "w", encoding="utf-8") as f:
</div>
<div class="line-context">
<span class="line-number">198</span>                json.dump(data, f, indent=2, ensure_ascii=False)
</div>
<div class="line-uncovered">
<span class="line-number">199</span>        except Exception as e:
</div>
<div class="line-uncovered">
<span class="line-number">200</span>            raise ValueError(
</div>
<div class="line-context">
<span class="line-number">201</span>                f"Failed to save configuration to {config_file}: {e}"
</div>
<div class="line-context">
<span class="line-number">202</span>            ) from e
</div>
<div class="line-context">
<span class="line-number">203</span>
</div>
<div class="line-context">
<span class="line-number">204</span>    def has_filters(self) -> bool:
</div>
<div class="line-context">
<span class="line-number">205</span>        """Check if configuration has any filters defined"""
</div>
<div class="line-context">
<span class="line-number">206</span>        return bool(self.file_filters or self.element_filters)
</div>
<div class="line-context">
<span class="line-number">207</span>
</div>
<div class="line-context">
<span class="line-number">208</span>    def _should_include_file(self, file_path: str) -> bool:
</div>
<div class="line-context">
<span class="line-number">209</span>        """Check if a file should be included based on filters"""
</div>
<div class="line-context">
<span class="line-number">210</span>        # Check exclude patterns first
</div>
</div>
<h4>Line 260</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">250</span>            )
</div>
<div class="line-context">
<span class="line-number">251</span>
</div>
<div class="line-context">
<span class="line-number">252</span>        # Filter enums
</div>
<div class="line-context">
<span class="line-number">253</span>        if "enums" in self.element_filters:
</div>
<div class="line-context">
<span class="line-number">254</span>            filtered_model.enums = self._filter_dict(
</div>
<div class="line-context">
<span class="line-number">255</span>                filtered_model.enums, self.element_filters["enums"]
</div>
<div class="line-context">
<span class="line-number">256</span>            )
</div>
<div class="line-context">
<span class="line-number">257</span>
</div>
<div class="line-context">
<span class="line-number">258</span>        # Filter unions
</div>
<div class="line-context">
<span class="line-number">259</span>        if "unions" in self.element_filters:
</div>
<div class="line-uncovered">
<span class="line-number">260</span>            filtered_model.unions = self._filter_dict(
</div>
<div class="line-context">
<span class="line-number">261</span>                filtered_model.unions, self.element_filters["unions"]
</div>
<div class="line-context">
<span class="line-number">262</span>            )
</div>
<div class="line-context">
<span class="line-number">263</span>
</div>
<div class="line-context">
<span class="line-number">264</span>        # Filter functions
</div>
<div class="line-context">
<span class="line-number">265</span>        if "functions" in self.element_filters:
</div>
<div class="line-context">
<span class="line-number">266</span>            filtered_model.functions = self._filter_list(
</div>
<div class="line-context">
<span class="line-number">267</span>                filtered_model.functions,
</div>
<div class="line-context">
<span class="line-number">268</span>                self.element_filters["functions"],
</div>
<div class="line-context">
<span class="line-number">269</span>                key=lambda f: f.name,
</div>
<div class="line-context">
<span class="line-number">270</span>            )
</div>
</div>
<h4>Lines 361-362</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">351</span>                    if pattern.search(name):
</div>
<div class="line-context">
<span class="line-number">352</span>                        should_include = True
</div>
<div class="line-context">
<span class="line-number">353</span>                        break
</div>
<div class="line-context">
<span class="line-number">354</span>                if not should_include:
</div>
<div class="line-context">
<span class="line-number">355</span>                    continue
</div>
<div class="line-context">
<span class="line-number">356</span>
</div>
<div class="line-context">
<span class="line-number">357</span>            # Check exclude patterns
</div>
<div class="line-context">
<span class="line-number">358</span>            should_exclude = False
</div>
<div class="line-context">
<span class="line-number">359</span>            for pattern in exclude_patterns:
</div>
<div class="line-context">
<span class="line-number">360</span>                if pattern.search(name):
</div>
<div class="line-uncovered">
<span class="line-number">361</span>                    should_exclude = True
</div>
<div class="line-uncovered">
<span class="line-number">362</span>                    break
</div>
<div class="line-context">
<span class="line-number">363</span>            if should_exclude:
</div>
<div class="line-context">
<span class="line-number">364</span>                continue
</div>
<div class="line-context">
<span class="line-number">365</span>
</div>
<div class="line-context">
<span class="line-number">366</span>            filtered_items.append(item)
</div>
<div class="line-context">
<span class="line-number">367</span>
</div>
<div class="line-context">
<span class="line-number">368</span>        return filtered_items
</div>
<div class="line-context">
<span class="line-number">369</span>
</div>
<div class="line-context">
<span class="line-number">370</span>    def get_summary(self) -> Dict[str, Any]:
</div>
<div class="line-context">
<span class="line-number">371</span>        """Get a summary of the configuration"""
</div>
<div class="line-context">
<span class="line-number">372</span>        return {
</div>
</div>
<h4>Line 364</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">354</span>                if not should_include:
</div>
<div class="line-context">
<span class="line-number">355</span>                    continue
</div>
<div class="line-context">
<span class="line-number">356</span>
</div>
<div class="line-context">
<span class="line-number">357</span>            # Check exclude patterns
</div>
<div class="line-context">
<span class="line-number">358</span>            should_exclude = False
</div>
<div class="line-context">
<span class="line-number">359</span>            for pattern in exclude_patterns:
</div>
<div class="line-context">
<span class="line-number">360</span>                if pattern.search(name):
</div>
<div class="line-context">
<span class="line-number">361</span>                    should_exclude = True
</div>
<div class="line-context">
<span class="line-number">362</span>                    break
</div>
<div class="line-context">
<span class="line-number">363</span>            if should_exclude:
</div>
<div class="line-uncovered">
<span class="line-number">364</span>                continue
</div>
<div class="line-context">
<span class="line-number">365</span>
</div>
<div class="line-context">
<span class="line-number">366</span>            filtered_items.append(item)
</div>
<div class="line-context">
<span class="line-number">367</span>
</div>
<div class="line-context">
<span class="line-number">368</span>        return filtered_items
</div>
<div class="line-context">
<span class="line-number">369</span>
</div>
<div class="line-context">
<span class="line-number">370</span>    def get_summary(self) -> Dict[str, Any]:
</div>
<div class="line-context">
<span class="line-number">371</span>        """Get a summary of the configuration"""
</div>
<div class="line-context">
<span class="line-number">372</span>        return {
</div>
<div class="line-context">
<span class="line-number">373</span>            "project_name": self.project_name,
</div>
<div class="line-context">
<span class="line-number">374</span>            "source_folders": self.source_folders,
</div>
</div>
<h4>Line 386</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">376</span>            "recursive_search": self.recursive_search,
</div>
<div class="line-context">
<span class="line-number">377</span>            "include_depth": self.include_depth,
</div>
<div class="line-context">
<span class="line-number">378</span>            "has_file_filters": bool(self.file_filters),
</div>
<div class="line-context">
<span class="line-number">379</span>            "has_element_filters": bool(self.element_filters),
</div>
<div class="line-context">
<span class="line-number">380</span>            "has_transformations": bool(self.transformations),
</div>
<div class="line-context">
<span class="line-number">381</span>        }
</div>
<div class="line-context">
<span class="line-number">382</span>
</div>
<div class="line-context">
<span class="line-number">383</span>    def __eq__(self, other: Any) -> bool:
</div>
<div class="line-context">
<span class="line-number">384</span>        """Check if two configurations are equal"""
</div>
<div class="line-context">
<span class="line-number">385</span>        if not isinstance(other, Config):
</div>
<div class="line-uncovered">
<span class="line-number">386</span>            return False
</div>
<div class="line-context">
<span class="line-number">387</span>
</div>
<div class="line-context">
<span class="line-number">388</span>        return (
</div>
<div class="line-context">
<span class="line-number">389</span>            self.project_name == other.project_name
</div>
<div class="line-context">
<span class="line-number">390</span>            and self.source_folders == other.source_folders
</div>
<div class="line-context">
<span class="line-number">391</span>            and self.output_dir == other.output_dir
</div>
<div class="line-context">
<span class="line-number">392</span>            and self.model_output_path == other.model_output_path
</div>
<div class="line-context">
<span class="line-number">393</span>            and self.recursive_search == other.recursive_search
</div>
<div class="line-context">
<span class="line-number">394</span>            and self.include_depth == other.include_depth
</div>
<div class="line-context">
<span class="line-number">395</span>            and self.file_filters == other.file_filters
</div>
<div class="line-context">
<span class="line-number">396</span>            and self.element_filters == other.element_filters
</div>
</div>
</div>
<div class="file-section">
<div class="file-header">
üìÅ /workspace/c_to_plantuml/parser_tokenizer.py
<span class="coverage-info">88.75% (576/649 lines covered)</span>
</div>
<h4>Line 222</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">212</span>                    multiline_comment_start_col = line_tokens[-1].column
</div>
<div class="line-context">
<span class="line-number">213</span>                    tokens.extend(line_tokens[:-1])
</div>
<div class="line-context">
<span class="line-number">214</span>                else:
</div>
<div class="line-context">
<span class="line-number">215</span>                    tokens.extend(line_tokens)
</div>
<div class="line-context">
<span class="line-number">216</span>
</div>
<div class="line-context">
<span class="line-number">217</span>            if line_num < total_lines:
</div>
<div class="line-context">
<span class="line-number">218</span>                tokens.append(Token(TokenType.NEWLINE, "\n", line_num, len(line)))
</div>
<div class="line-context">
<span class="line-number">219</span>            line_num += 1
</div>
<div class="line-context">
<span class="line-number">220</span>
</div>
<div class="line-context">
<span class="line-number">221</span>        if in_multiline_string:
</div>
<div class="line-uncovered">
<span class="line-number">222</span>            tokens.append(
</div>
<div class="line-context">
<span class="line-number">223</span>                Token(
</div>
<div class="line-context">
<span class="line-number">224</span>                    TokenType.STRING,
</div>
<div class="line-context">
<span class="line-number">225</span>                    multiline_string_value,
</div>
<div class="line-context">
<span class="line-number">226</span>                    multiline_string_start_line,
</div>
<div class="line-context">
<span class="line-number">227</span>                    multiline_string_start_col,
</div>
<div class="line-context">
<span class="line-number">228</span>                )
</div>
<div class="line-context">
<span class="line-number">229</span>            )
</div>
<div class="line-context">
<span class="line-number">230</span>        if in_multiline_comment:
</div>
<div class="line-context">
<span class="line-number">231</span>            tokens.append(
</div>
<div class="line-context">
<span class="line-number">232</span>                Token(
</div>
</div>
<h4>Line 231</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">221</span>        if in_multiline_string:
</div>
<div class="line-context">
<span class="line-number">222</span>            tokens.append(
</div>
<div class="line-context">
<span class="line-number">223</span>                Token(
</div>
<div class="line-context">
<span class="line-number">224</span>                    TokenType.STRING,
</div>
<div class="line-context">
<span class="line-number">225</span>                    multiline_string_value,
</div>
<div class="line-context">
<span class="line-number">226</span>                    multiline_string_start_line,
</div>
<div class="line-context">
<span class="line-number">227</span>                    multiline_string_start_col,
</div>
<div class="line-context">
<span class="line-number">228</span>                )
</div>
<div class="line-context">
<span class="line-number">229</span>            )
</div>
<div class="line-context">
<span class="line-number">230</span>        if in_multiline_comment:
</div>
<div class="line-uncovered">
<span class="line-number">231</span>            tokens.append(
</div>
<div class="line-context">
<span class="line-number">232</span>                Token(
</div>
<div class="line-context">
<span class="line-number">233</span>                    TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">234</span>                    multiline_comment_value,
</div>
<div class="line-context">
<span class="line-number">235</span>                    multiline_comment_start_line,
</div>
<div class="line-context">
<span class="line-number">236</span>                    multiline_comment_start_col,
</div>
<div class="line-context">
<span class="line-number">237</span>                )
</div>
<div class="line-context">
<span class="line-number">238</span>            )
</div>
<div class="line-context">
<span class="line-number">239</span>
</div>
<div class="line-context">
<span class="line-number">240</span>        # Post-process tokens to merge multi-line macros
</div>
<div class="line-context">
<span class="line-number">241</span>        tokens = self._merge_multiline_macros(tokens, lines)
</div>
</div>
<h4>Line 309</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">299</span>                or (
</div>
<div class="line-context">
<span class="line-number">300</span>                    pos > 0
</div>
<div class="line-context">
<span class="line-number">301</span>                    and line[pos - 1] in ["L", "u", "U", "R"]
</div>
<div class="line-context">
<span class="line-number">302</span>                    and line[pos] == '"'
</div>
<div class="line-context">
<span class="line-number">303</span>                )
</div>
<div class="line-context">
<span class="line-number">304</span>                or (pos > 1 and line[pos - 2 : pos] == "u8" and line[pos] == '"')
</div>
<div class="line-context">
<span class="line-number">305</span>            ):
</div>
<div class="line-context">
<span class="line-number">306</span>                # Handle string literals with possible prefixes
</div>
<div class="line-context">
<span class="line-number">307</span>                string_start = pos
</div>
<div class="line-context">
<span class="line-number">308</span>                if line[pos - 2 : pos] == "u8":
</div>
<div class="line-uncovered">
<span class="line-number">309</span>                    string_start -= 2
</div>
<div class="line-context">
<span class="line-number">310</span>                elif line[pos - 1] in ["L", "u", "U", "R"]:
</div>
<div class="line-context">
<span class="line-number">311</span>                    string_start -= 1
</div>
<div class="line-context">
<span class="line-number">312</span>                pos += 1  # Skip opening quote
</div>
<div class="line-context">
<span class="line-number">313</span>                while pos < len(line):
</div>
<div class="line-context">
<span class="line-number">314</span>                    if line[pos] == '"':
</div>
<div class="line-context">
<span class="line-number">315</span>                        # Found closing quote
</div>
<div class="line-context">
<span class="line-number">316</span>                        string_text = line[string_start : pos + 1]
</div>
<div class="line-context">
<span class="line-number">317</span>                        tokens.append(
</div>
<div class="line-context">
<span class="line-number">318</span>                            Token(TokenType.STRING, string_text, line_num, string_start)
</div>
<div class="line-context">
<span class="line-number">319</span>                        )
</div>
</div>
<h4>Line 311</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">301</span>                    and line[pos - 1] in ["L", "u", "U", "R"]
</div>
<div class="line-context">
<span class="line-number">302</span>                    and line[pos] == '"'
</div>
<div class="line-context">
<span class="line-number">303</span>                )
</div>
<div class="line-context">
<span class="line-number">304</span>                or (pos > 1 and line[pos - 2 : pos] == "u8" and line[pos] == '"')
</div>
<div class="line-context">
<span class="line-number">305</span>            ):
</div>
<div class="line-context">
<span class="line-number">306</span>                # Handle string literals with possible prefixes
</div>
<div class="line-context">
<span class="line-number">307</span>                string_start = pos
</div>
<div class="line-context">
<span class="line-number">308</span>                if line[pos - 2 : pos] == "u8":
</div>
<div class="line-context">
<span class="line-number">309</span>                    string_start -= 2
</div>
<div class="line-context">
<span class="line-number">310</span>                elif line[pos - 1] in ["L", "u", "U", "R"]:
</div>
<div class="line-uncovered">
<span class="line-number">311</span>                    string_start -= 1
</div>
<div class="line-context">
<span class="line-number">312</span>                pos += 1  # Skip opening quote
</div>
<div class="line-context">
<span class="line-number">313</span>                while pos < len(line):
</div>
<div class="line-context">
<span class="line-number">314</span>                    if line[pos] == '"':
</div>
<div class="line-context">
<span class="line-number">315</span>                        # Found closing quote
</div>
<div class="line-context">
<span class="line-number">316</span>                        string_text = line[string_start : pos + 1]
</div>
<div class="line-context">
<span class="line-number">317</span>                        tokens.append(
</div>
<div class="line-context">
<span class="line-number">318</span>                            Token(TokenType.STRING, string_text, line_num, string_start)
</div>
<div class="line-context">
<span class="line-number">319</span>                        )
</div>
<div class="line-context">
<span class="line-number">320</span>                        pos += 1
</div>
<div class="line-context">
<span class="line-number">321</span>                        break
</div>
</div>
<h4>Lines 413-414</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">403</span>    ) -> List[Token]:
</div>
<div class="line-context">
<span class="line-number">404</span>        """Merge multi-line macro tokens that span multiple lines with backslashes"""
</div>
<div class="line-context">
<span class="line-number">405</span>        merged_tokens = []
</div>
<div class="line-context">
<span class="line-number">406</span>        i = 0
</div>
<div class="line-context">
<span class="line-number">407</span>
</div>
<div class="line-context">
<span class="line-number">408</span>        while i < len(tokens):
</div>
<div class="line-context">
<span class="line-number">409</span>            token = tokens[i]
</div>
<div class="line-context">
<span class="line-number">410</span>
</div>
<div class="line-context">
<span class="line-number">411</span>            if token.type == TokenType.DEFINE and token.value.rstrip().endswith("\\"):
</div>
<div class="line-context">
<span class="line-number">412</span>                # Found a multi-line macro, merge with subsequent lines
</div>
<div class="line-uncovered">
<span class="line-number">413</span>                macro_content = token.value
</div>
<div class="line-uncovered">
<span class="line-number">414</span>                current_line = token.line
</div>
<div class="line-context">
<span class="line-number">415</span>
</div>
<div class="line-context">
<span class="line-number">416</span>                # Continue merging lines until we find one that doesn't end with backslash
</div>
<div class="line-context">
<span class="line-number">417</span>                while macro_content.rstrip().endswith("\\"):
</div>
<div class="line-context">
<span class="line-number">418</span>                    # Remove the backslash and add a newline
</div>
<div class="line-context">
<span class="line-number">419</span>                    macro_content = macro_content.rstrip()[:-1] + "\n"
</div>
<div class="line-context">
<span class="line-number">420</span>                    current_line += 1
</div>
<div class="line-context">
<span class="line-number">421</span>
</div>
<div class="line-context">
<span class="line-number">422</span>                    # Find the next line content
</div>
<div class="line-context">
<span class="line-number">423</span>                    if current_line <= len(lines):
</div>
<div class="line-context">
<span class="line-number">424</span>                        next_line = lines[current_line - 1]
</div>
</div>
<h4>Line 417</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">407</span>
</div>
<div class="line-context">
<span class="line-number">408</span>        while i < len(tokens):
</div>
<div class="line-context">
<span class="line-number">409</span>            token = tokens[i]
</div>
<div class="line-context">
<span class="line-number">410</span>
</div>
<div class="line-context">
<span class="line-number">411</span>            if token.type == TokenType.DEFINE and token.value.rstrip().endswith("\\"):
</div>
<div class="line-context">
<span class="line-number">412</span>                # Found a multi-line macro, merge with subsequent lines
</div>
<div class="line-context">
<span class="line-number">413</span>                macro_content = token.value
</div>
<div class="line-context">
<span class="line-number">414</span>                current_line = token.line
</div>
<div class="line-context">
<span class="line-number">415</span>
</div>
<div class="line-context">
<span class="line-number">416</span>                # Continue merging lines until we find one that doesn't end with backslash
</div>
<div class="line-uncovered">
<span class="line-number">417</span>                while macro_content.rstrip().endswith("\\"):
</div>
<div class="line-context">
<span class="line-number">418</span>                    # Remove the backslash and add a newline
</div>
<div class="line-context">
<span class="line-number">419</span>                    macro_content = macro_content.rstrip()[:-1] + "\n"
</div>
<div class="line-context">
<span class="line-number">420</span>                    current_line += 1
</div>
<div class="line-context">
<span class="line-number">421</span>
</div>
<div class="line-context">
<span class="line-number">422</span>                    # Find the next line content
</div>
<div class="line-context">
<span class="line-number">423</span>                    if current_line <= len(lines):
</div>
<div class="line-context">
<span class="line-number">424</span>                        next_line = lines[current_line - 1]
</div>
<div class="line-context">
<span class="line-number">425</span>                        macro_content += next_line
</div>
<div class="line-context">
<span class="line-number">426</span>                    else:
</div>
<div class="line-context">
<span class="line-number">427</span>                        break
</div>
</div>
<h4>Lines 419-420</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">409</span>            token = tokens[i]
</div>
<div class="line-context">
<span class="line-number">410</span>
</div>
<div class="line-context">
<span class="line-number">411</span>            if token.type == TokenType.DEFINE and token.value.rstrip().endswith("\\"):
</div>
<div class="line-context">
<span class="line-number">412</span>                # Found a multi-line macro, merge with subsequent lines
</div>
<div class="line-context">
<span class="line-number">413</span>                macro_content = token.value
</div>
<div class="line-context">
<span class="line-number">414</span>                current_line = token.line
</div>
<div class="line-context">
<span class="line-number">415</span>
</div>
<div class="line-context">
<span class="line-number">416</span>                # Continue merging lines until we find one that doesn't end with backslash
</div>
<div class="line-context">
<span class="line-number">417</span>                while macro_content.rstrip().endswith("\\"):
</div>
<div class="line-context">
<span class="line-number">418</span>                    # Remove the backslash and add a newline
</div>
<div class="line-uncovered">
<span class="line-number">419</span>                    macro_content = macro_content.rstrip()[:-1] + "\n"
</div>
<div class="line-uncovered">
<span class="line-number">420</span>                    current_line += 1
</div>
<div class="line-context">
<span class="line-number">421</span>
</div>
<div class="line-context">
<span class="line-number">422</span>                    # Find the next line content
</div>
<div class="line-context">
<span class="line-number">423</span>                    if current_line <= len(lines):
</div>
<div class="line-context">
<span class="line-number">424</span>                        next_line = lines[current_line - 1]
</div>
<div class="line-context">
<span class="line-number">425</span>                        macro_content += next_line
</div>
<div class="line-context">
<span class="line-number">426</span>                    else:
</div>
<div class="line-context">
<span class="line-number">427</span>                        break
</div>
<div class="line-context">
<span class="line-number">428</span>
</div>
<div class="line-context">
<span class="line-number">429</span>                # Create a new token with the merged content
</div>
<div class="line-context">
<span class="line-number">430</span>                merged_tokens.append(
</div>
</div>
<h4>Lines 423-425</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">413</span>                macro_content = token.value
</div>
<div class="line-context">
<span class="line-number">414</span>                current_line = token.line
</div>
<div class="line-context">
<span class="line-number">415</span>
</div>
<div class="line-context">
<span class="line-number">416</span>                # Continue merging lines until we find one that doesn't end with backslash
</div>
<div class="line-context">
<span class="line-number">417</span>                while macro_content.rstrip().endswith("\\"):
</div>
<div class="line-context">
<span class="line-number">418</span>                    # Remove the backslash and add a newline
</div>
<div class="line-context">
<span class="line-number">419</span>                    macro_content = macro_content.rstrip()[:-1] + "\n"
</div>
<div class="line-context">
<span class="line-number">420</span>                    current_line += 1
</div>
<div class="line-context">
<span class="line-number">421</span>
</div>
<div class="line-context">
<span class="line-number">422</span>                    # Find the next line content
</div>
<div class="line-uncovered">
<span class="line-number">423</span>                    if current_line <= len(lines):
</div>
<div class="line-uncovered">
<span class="line-number">424</span>                        next_line = lines[current_line - 1]
</div>
<div class="line-uncovered">
<span class="line-number">425</span>                        macro_content += next_line
</div>
<div class="line-context">
<span class="line-number">426</span>                    else:
</div>
<div class="line-context">
<span class="line-number">427</span>                        break
</div>
<div class="line-context">
<span class="line-number">428</span>
</div>
<div class="line-context">
<span class="line-number">429</span>                # Create a new token with the merged content
</div>
<div class="line-context">
<span class="line-number">430</span>                merged_tokens.append(
</div>
<div class="line-context">
<span class="line-number">431</span>                    Token(TokenType.DEFINE, macro_content, token.line, token.column)
</div>
<div class="line-context">
<span class="line-number">432</span>                )
</div>
<div class="line-context">
<span class="line-number">433</span>            else:
</div>
<div class="line-context">
<span class="line-number">434</span>                merged_tokens.append(token)
</div>
<div class="line-context">
<span class="line-number">435</span>
</div>
</div>
<h4>Line 427</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">417</span>                while macro_content.rstrip().endswith("\\"):
</div>
<div class="line-context">
<span class="line-number">418</span>                    # Remove the backslash and add a newline
</div>
<div class="line-context">
<span class="line-number">419</span>                    macro_content = macro_content.rstrip()[:-1] + "\n"
</div>
<div class="line-context">
<span class="line-number">420</span>                    current_line += 1
</div>
<div class="line-context">
<span class="line-number">421</span>
</div>
<div class="line-context">
<span class="line-number">422</span>                    # Find the next line content
</div>
<div class="line-context">
<span class="line-number">423</span>                    if current_line <= len(lines):
</div>
<div class="line-context">
<span class="line-number">424</span>                        next_line = lines[current_line - 1]
</div>
<div class="line-context">
<span class="line-number">425</span>                        macro_content += next_line
</div>
<div class="line-context">
<span class="line-number">426</span>                    else:
</div>
<div class="line-uncovered">
<span class="line-number">427</span>                        break
</div>
<div class="line-context">
<span class="line-number">428</span>
</div>
<div class="line-context">
<span class="line-number">429</span>                # Create a new token with the merged content
</div>
<div class="line-context">
<span class="line-number">430</span>                merged_tokens.append(
</div>
<div class="line-context">
<span class="line-number">431</span>                    Token(TokenType.DEFINE, macro_content, token.line, token.column)
</div>
<div class="line-context">
<span class="line-number">432</span>                )
</div>
<div class="line-context">
<span class="line-number">433</span>            else:
</div>
<div class="line-context">
<span class="line-number">434</span>                merged_tokens.append(token)
</div>
<div class="line-context">
<span class="line-number">435</span>
</div>
<div class="line-context">
<span class="line-number">436</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">437</span>
</div>
</div>
<h4>Line 430</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">420</span>                    current_line += 1
</div>
<div class="line-context">
<span class="line-number">421</span>
</div>
<div class="line-context">
<span class="line-number">422</span>                    # Find the next line content
</div>
<div class="line-context">
<span class="line-number">423</span>                    if current_line <= len(lines):
</div>
<div class="line-context">
<span class="line-number">424</span>                        next_line = lines[current_line - 1]
</div>
<div class="line-context">
<span class="line-number">425</span>                        macro_content += next_line
</div>
<div class="line-context">
<span class="line-number">426</span>                    else:
</div>
<div class="line-context">
<span class="line-number">427</span>                        break
</div>
<div class="line-context">
<span class="line-number">428</span>
</div>
<div class="line-context">
<span class="line-number">429</span>                # Create a new token with the merged content
</div>
<div class="line-uncovered">
<span class="line-number">430</span>                merged_tokens.append(
</div>
<div class="line-context">
<span class="line-number">431</span>                    Token(TokenType.DEFINE, macro_content, token.line, token.column)
</div>
<div class="line-context">
<span class="line-number">432</span>                )
</div>
<div class="line-context">
<span class="line-number">433</span>            else:
</div>
<div class="line-context">
<span class="line-number">434</span>                merged_tokens.append(token)
</div>
<div class="line-context">
<span class="line-number">435</span>
</div>
<div class="line-context">
<span class="line-number">436</span>            i += 1
</div>
<div class="line-context">
<span class="line-number">437</span>
</div>
<div class="line-context">
<span class="line-number">438</span>        return merged_tokens
</div>
<div class="line-context">
<span class="line-number">439</span>
</div>
<div class="line-context">
<span class="line-number">440</span>
</div>
</div>
<h4>Lines 532-533</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">522</span>                self.pos += 1
</div>
<div class="line-context">
<span class="line-number">523</span>
</div>
<div class="line-context">
<span class="line-number">524</span>        return unions
</div>
<div class="line-context">
<span class="line-number">525</span>
</div>
<div class="line-context">
<span class="line-number">526</span>    def _current_token_is(self, token_type: TokenType) -> bool:
</div>
<div class="line-context">
<span class="line-number">527</span>        """Check if current token is of specified type"""
</div>
<div class="line-context">
<span class="line-number">528</span>        return self.pos < len(self.tokens) and self.tokens[self.pos].type == token_type
</div>
<div class="line-context">
<span class="line-number">529</span>
</div>
<div class="line-context">
<span class="line-number">530</span>    def _peek_token(self, offset: int = 1) -> Optional[Token]:
</div>
<div class="line-context">
<span class="line-number">531</span>        """Peek at token at current position + offset"""
</div>
<div class="line-uncovered">
<span class="line-number">532</span>        peek_pos = self.pos + offset
</div>
<div class="line-uncovered">
<span class="line-number">533</span>        return self.tokens[peek_pos] if peek_pos < len(self.tokens) else None
</div>
<div class="line-context">
<span class="line-number">534</span>
</div>
<div class="line-context">
<span class="line-number">535</span>    def _advance(self) -> Optional[Token]:
</div>
<div class="line-context">
<span class="line-number">536</span>        """Advance to next token and return current"""
</div>
<div class="line-context">
<span class="line-number">537</span>        if self.pos < len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">538</span>            token = self.tokens[self.pos]
</div>
<div class="line-context">
<span class="line-number">539</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">540</span>            return token
</div>
<div class="line-context">
<span class="line-number">541</span>        return None
</div>
<div class="line-context">
<span class="line-number">542</span>
</div>
<div class="line-context">
<span class="line-number">543</span>    def _find_matching_brace(self, start_pos: int) -> Optional[int]:
</div>
</div>
<h4>Line 541</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">531</span>        """Peek at token at current position + offset"""
</div>
<div class="line-context">
<span class="line-number">532</span>        peek_pos = self.pos + offset
</div>
<div class="line-context">
<span class="line-number">533</span>        return self.tokens[peek_pos] if peek_pos < len(self.tokens) else None
</div>
<div class="line-context">
<span class="line-number">534</span>
</div>
<div class="line-context">
<span class="line-number">535</span>    def _advance(self) -> Optional[Token]:
</div>
<div class="line-context">
<span class="line-number">536</span>        """Advance to next token and return current"""
</div>
<div class="line-context">
<span class="line-number">537</span>        if self.pos < len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">538</span>            token = self.tokens[self.pos]
</div>
<div class="line-context">
<span class="line-number">539</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">540</span>            return token
</div>
<div class="line-uncovered">
<span class="line-number">541</span>        return None
</div>
<div class="line-context">
<span class="line-number">542</span>
</div>
<div class="line-context">
<span class="line-number">543</span>    def _find_matching_brace(self, start_pos: int) -> Optional[int]:
</div>
<div class="line-context">
<span class="line-number">544</span>        """Find matching closing brace starting from open brace position"""
</div>
<div class="line-context">
<span class="line-number">545</span>        if (
</div>
<div class="line-context">
<span class="line-number">546</span>            start_pos >= len(self.tokens)
</div>
<div class="line-context">
<span class="line-number">547</span>            or self.tokens[start_pos].type != TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">548</span>        ):
</div>
<div class="line-context">
<span class="line-number">549</span>            return None
</div>
<div class="line-context">
<span class="line-number">550</span>
</div>
<div class="line-context">
<span class="line-number">551</span>        depth = 1
</div>
</div>
<h4>Line 549</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">539</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">540</span>            return token
</div>
<div class="line-context">
<span class="line-number">541</span>        return None
</div>
<div class="line-context">
<span class="line-number">542</span>
</div>
<div class="line-context">
<span class="line-number">543</span>    def _find_matching_brace(self, start_pos: int) -> Optional[int]:
</div>
<div class="line-context">
<span class="line-number">544</span>        """Find matching closing brace starting from open brace position"""
</div>
<div class="line-context">
<span class="line-number">545</span>        if (
</div>
<div class="line-context">
<span class="line-number">546</span>            start_pos >= len(self.tokens)
</div>
<div class="line-context">
<span class="line-number">547</span>            or self.tokens[start_pos].type != TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">548</span>        ):
</div>
<div class="line-uncovered">
<span class="line-number">549</span>            return None
</div>
<div class="line-context">
<span class="line-number">550</span>
</div>
<div class="line-context">
<span class="line-number">551</span>        depth = 1
</div>
<div class="line-context">
<span class="line-number">552</span>        pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">553</span>
</div>
<div class="line-context">
<span class="line-number">554</span>        while pos < len(self.tokens) and depth > 0:
</div>
<div class="line-context">
<span class="line-number">555</span>            if self.tokens[pos].type == TokenType.LBRACE:
</div>
<div class="line-context">
<span class="line-number">556</span>                depth += 1
</div>
<div class="line-context">
<span class="line-number">557</span>            elif self.tokens[pos].type == TokenType.RBRACE:
</div>
<div class="line-context">
<span class="line-number">558</span>                depth -= 1
</div>
<div class="line-context">
<span class="line-number">559</span>            pos += 1
</div>
</div>
<h4>Line 569</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">559</span>            pos += 1
</div>
<div class="line-context">
<span class="line-number">560</span>
</div>
<div class="line-context">
<span class="line-number">561</span>        return pos - 1 if depth == 0 else None
</div>
<div class="line-context">
<span class="line-number">562</span>
</div>
<div class="line-context">
<span class="line-number">563</span>    def _parse_struct(self) -> Optional[Tuple[int, int, str]]:
</div>
<div class="line-context">
<span class="line-number">564</span>        """Parse struct definition starting at current position"""
</div>
<div class="line-context">
<span class="line-number">565</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">566</span>
</div>
<div class="line-context">
<span class="line-number">567</span>        # Consume 'struct' keyword
</div>
<div class="line-context">
<span class="line-number">568</span>        if not self._current_token_is(TokenType.STRUCT):
</div>
<div class="line-uncovered">
<span class="line-number">569</span>            return None
</div>
<div class="line-context">
<span class="line-number">570</span>        self._advance()
</div>
<div class="line-context">
<span class="line-number">571</span>
</div>
<div class="line-context">
<span class="line-number">572</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">573</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">574</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">575</span>        ):
</div>
<div class="line-context">
<span class="line-number">576</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">577</span>
</div>
<div class="line-context">
<span class="line-number">578</span>        # Get struct tag name (optional for anonymous structs)
</div>
<div class="line-context">
<span class="line-number">579</span>        struct_tag = ""
</div>
</div>
<h4>Line 597</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">587</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">588</span>
</div>
<div class="line-context">
<span class="line-number">589</span>        if not self._current_token_is(TokenType.LBRACE):
</div>
<div class="line-context">
<span class="line-number">590</span>            return None
</div>
<div class="line-context">
<span class="line-number">591</span>
</div>
<div class="line-context">
<span class="line-number">592</span>        # Find matching closing brace
</div>
<div class="line-context">
<span class="line-number">593</span>        brace_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">594</span>        end_brace_pos = self._find_matching_brace(brace_pos)
</div>
<div class="line-context">
<span class="line-number">595</span>
</div>
<div class="line-context">
<span class="line-number">596</span>        if end_brace_pos is None:
</div>
<div class="line-uncovered">
<span class="line-number">597</span>            return None
</div>
<div class="line-context">
<span class="line-number">598</span>
</div>
<div class="line-context">
<span class="line-number">599</span>        # Look for struct name after closing brace
</div>
<div class="line-context">
<span class="line-number">600</span>        name_pos = end_brace_pos + 1
</div>
<div class="line-context">
<span class="line-number">601</span>        struct_name = struct_tag  # Default to tag name
</div>
<div class="line-context">
<span class="line-number">602</span>
</div>
<div class="line-context">
<span class="line-number">603</span>        # Check if this is a typedef struct by looking backwards
</div>
<div class="line-context">
<span class="line-number">604</span>        is_typedef = False
</div>
<div class="line-context">
<span class="line-number">605</span>        check_pos = start_pos - 1
</div>
<div class="line-context">
<span class="line-number">606</span>        while check_pos >= 0:
</div>
<div class="line-context">
<span class="line-number">607</span>            if self.tokens[check_pos].type == TokenType.TYPEDEF:
</div>
</div>
<h4>Line 654</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">644</span>
</div>
<div class="line-context">
<span class="line-number">645</span>        end_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">646</span>        return (start_pos, end_pos, struct_name)
</div>
<div class="line-context">
<span class="line-number">647</span>
</div>
<div class="line-context">
<span class="line-number">648</span>    def _parse_typedef_struct(self) -> Optional[Tuple[int, int, str]]:
</div>
<div class="line-context">
<span class="line-number">649</span>        """Parse typedef struct definition"""
</div>
<div class="line-context">
<span class="line-number">650</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">651</span>
</div>
<div class="line-context">
<span class="line-number">652</span>        # Consume 'typedef'
</div>
<div class="line-context">
<span class="line-number">653</span>        if not self._current_token_is(TokenType.TYPEDEF):
</div>
<div class="line-uncovered">
<span class="line-number">654</span>            return None
</div>
<div class="line-context">
<span class="line-number">655</span>        self._advance()
</div>
<div class="line-context">
<span class="line-number">656</span>
</div>
<div class="line-context">
<span class="line-number">657</span>        # Look for 'struct'
</div>
<div class="line-context">
<span class="line-number">658</span>        if not self._current_token_is(TokenType.STRUCT):
</div>
<div class="line-context">
<span class="line-number">659</span>            # Not a typedef struct, reset position
</div>
<div class="line-context">
<span class="line-number">660</span>            self.pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">661</span>            return None
</div>
<div class="line-context">
<span class="line-number">662</span>
</div>
<div class="line-context">
<span class="line-number">663</span>        # Skip 'struct'
</div>
<div class="line-context">
<span class="line-number">664</span>        self._advance()
</div>
</div>
<h4>Line 670</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">660</span>            self.pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">661</span>            return None
</div>
<div class="line-context">
<span class="line-number">662</span>
</div>
<div class="line-context">
<span class="line-number">663</span>        # Skip 'struct'
</div>
<div class="line-context">
<span class="line-number">664</span>        self._advance()
</div>
<div class="line-context">
<span class="line-number">665</span>
</div>
<div class="line-context">
<span class="line-number">666</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">667</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">668</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">669</span>        ):
</div>
<div class="line-uncovered">
<span class="line-number">670</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">671</span>
</div>
<div class="line-context">
<span class="line-number">672</span>        # Get struct tag name (optional)
</div>
<div class="line-context">
<span class="line-number">673</span>        struct_tag = ""
</div>
<div class="line-context">
<span class="line-number">674</span>        if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-context">
<span class="line-number">675</span>            struct_tag = self._advance().value
</div>
<div class="line-context">
<span class="line-number">676</span>
</div>
<div class="line-context">
<span class="line-number">677</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">678</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">679</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">680</span>        ):
</div>
</div>
<h4>Line 681</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">671</span>
</div>
<div class="line-context">
<span class="line-number">672</span>        # Get struct tag name (optional)
</div>
<div class="line-context">
<span class="line-number">673</span>        struct_tag = ""
</div>
<div class="line-context">
<span class="line-number">674</span>        if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-context">
<span class="line-number">675</span>            struct_tag = self._advance().value
</div>
<div class="line-context">
<span class="line-number">676</span>
</div>
<div class="line-context">
<span class="line-number">677</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">678</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">679</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">680</span>        ):
</div>
<div class="line-uncovered">
<span class="line-number">681</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">682</span>
</div>
<div class="line-context">
<span class="line-number">683</span>        # Check if this is a forward declaration (no braces)
</div>
<div class="line-context">
<span class="line-number">684</span>        if not self._current_token_is(TokenType.LBRACE):
</div>
<div class="line-context">
<span class="line-number">685</span>            # This is a forward declaration like "typedef struct Node* NodePtr;"
</div>
<div class="line-context">
<span class="line-number">686</span>            # Not a struct definition, so skip it
</div>
<div class="line-context">
<span class="line-number">687</span>            self.pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">688</span>            return None
</div>
<div class="line-context">
<span class="line-number">689</span>
</div>
<div class="line-context">
<span class="line-number">690</span>        # Find matching closing brace
</div>
<div class="line-context">
<span class="line-number">691</span>        end_brace_pos = self._find_matching_brace(self.pos)
</div>
</div>
<h4>Lines 693-694</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">683</span>        # Check if this is a forward declaration (no braces)
</div>
<div class="line-context">
<span class="line-number">684</span>        if not self._current_token_is(TokenType.LBRACE):
</div>
<div class="line-context">
<span class="line-number">685</span>            # This is a forward declaration like "typedef struct Node* NodePtr;"
</div>
<div class="line-context">
<span class="line-number">686</span>            # Not a struct definition, so skip it
</div>
<div class="line-context">
<span class="line-number">687</span>            self.pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">688</span>            return None
</div>
<div class="line-context">
<span class="line-number">689</span>
</div>
<div class="line-context">
<span class="line-number">690</span>        # Find matching closing brace
</div>
<div class="line-context">
<span class="line-number">691</span>        end_brace_pos = self._find_matching_brace(self.pos)
</div>
<div class="line-context">
<span class="line-number">692</span>        if end_brace_pos is None:
</div>
<div class="line-uncovered">
<span class="line-number">693</span>            self.pos = start_pos + 1
</div>
<div class="line-uncovered">
<span class="line-number">694</span>            return None
</div>
<div class="line-context">
<span class="line-number">695</span>
</div>
<div class="line-context">
<span class="line-number">696</span>        # Look for typedef name after closing brace
</div>
<div class="line-context">
<span class="line-number">697</span>        typedef_name = ""
</div>
<div class="line-context">
<span class="line-number">698</span>        name_pos = end_brace_pos + 1
</div>
<div class="line-context">
<span class="line-number">699</span>        while name_pos < len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">700</span>            if self.tokens[name_pos].type == TokenType.IDENTIFIER:
</div>
<div class="line-context">
<span class="line-number">701</span>                typedef_name = self.tokens[name_pos].value
</div>
<div class="line-context">
<span class="line-number">702</span>                break
</div>
<div class="line-context">
<span class="line-number">703</span>            elif self.tokens[name_pos].type == TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">704</span>                break
</div>
</div>
<h4>Lines 703-705</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">693</span>            self.pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">694</span>            return None
</div>
<div class="line-context">
<span class="line-number">695</span>
</div>
<div class="line-context">
<span class="line-number">696</span>        # Look for typedef name after closing brace
</div>
<div class="line-context">
<span class="line-number">697</span>        typedef_name = ""
</div>
<div class="line-context">
<span class="line-number">698</span>        name_pos = end_brace_pos + 1
</div>
<div class="line-context">
<span class="line-number">699</span>        while name_pos < len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">700</span>            if self.tokens[name_pos].type == TokenType.IDENTIFIER:
</div>
<div class="line-context">
<span class="line-number">701</span>                typedef_name = self.tokens[name_pos].value
</div>
<div class="line-context">
<span class="line-number">702</span>                break
</div>
<div class="line-uncovered">
<span class="line-number">703</span>            elif self.tokens[name_pos].type == TokenType.SEMICOLON:
</div>
<div class="line-uncovered">
<span class="line-number">704</span>                break
</div>
<div class="line-uncovered">
<span class="line-number">705</span>            name_pos += 1
</div>
<div class="line-context">
<span class="line-number">706</span>
</div>
<div class="line-context">
<span class="line-number">707</span>        # Find semicolon
</div>
<div class="line-context">
<span class="line-number">708</span>        while (
</div>
<div class="line-context">
<span class="line-number">709</span>            name_pos < len(self.tokens)
</div>
<div class="line-context">
<span class="line-number">710</span>            and not self.tokens[name_pos].type == TokenType.SEMICOLON
</div>
<div class="line-context">
<span class="line-number">711</span>        ):
</div>
<div class="line-context">
<span class="line-number">712</span>            name_pos += 1
</div>
<div class="line-context">
<span class="line-number">713</span>
</div>
<div class="line-context">
<span class="line-number">714</span>        end_pos = name_pos
</div>
<div class="line-context">
<span class="line-number">715</span>        return (start_pos, end_pos, typedef_name)
</div>
</div>
<h4>Line 723</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">713</span>
</div>
<div class="line-context">
<span class="line-number">714</span>        end_pos = name_pos
</div>
<div class="line-context">
<span class="line-number">715</span>        return (start_pos, end_pos, typedef_name)
</div>
<div class="line-context">
<span class="line-number">716</span>
</div>
<div class="line-context">
<span class="line-number">717</span>    def _parse_enum(self) -> Optional[Tuple[int, int, str]]:
</div>
<div class="line-context">
<span class="line-number">718</span>        """Parse enum definition starting at current position"""
</div>
<div class="line-context">
<span class="line-number">719</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">720</span>
</div>
<div class="line-context">
<span class="line-number">721</span>        # Consume 'enum' keyword
</div>
<div class="line-context">
<span class="line-number">722</span>        if not self._current_token_is(TokenType.ENUM):
</div>
<div class="line-uncovered">
<span class="line-number">723</span>            return None
</div>
<div class="line-context">
<span class="line-number">724</span>        self._advance()
</div>
<div class="line-context">
<span class="line-number">725</span>
</div>
<div class="line-context">
<span class="line-number">726</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">727</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">728</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">729</span>        ):
</div>
<div class="line-context">
<span class="line-number">730</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">731</span>
</div>
<div class="line-context">
<span class="line-number">732</span>        # Get enum tag name (optional for anonymous enums)
</div>
<div class="line-context">
<span class="line-number">733</span>        enum_tag = ""
</div>
</div>
<h4>Line 751</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">741</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">742</span>
</div>
<div class="line-context">
<span class="line-number">743</span>        if not self._current_token_is(TokenType.LBRACE):
</div>
<div class="line-context">
<span class="line-number">744</span>            return None
</div>
<div class="line-context">
<span class="line-number">745</span>
</div>
<div class="line-context">
<span class="line-number">746</span>        # Find matching closing brace
</div>
<div class="line-context">
<span class="line-number">747</span>        brace_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">748</span>        end_brace_pos = self._find_matching_brace(brace_pos)
</div>
<div class="line-context">
<span class="line-number">749</span>
</div>
<div class="line-context">
<span class="line-number">750</span>        if end_brace_pos is None:
</div>
<div class="line-uncovered">
<span class="line-number">751</span>            return None
</div>
<div class="line-context">
<span class="line-number">752</span>
</div>
<div class="line-context">
<span class="line-number">753</span>        # Look for enum name after closing brace
</div>
<div class="line-context">
<span class="line-number">754</span>        name_pos = end_brace_pos + 1
</div>
<div class="line-context">
<span class="line-number">755</span>        enum_name = enum_tag  # Default to tag name
</div>
<div class="line-context">
<span class="line-number">756</span>
</div>
<div class="line-context">
<span class="line-number">757</span>        # Check if this is a typedef enum by looking backwards
</div>
<div class="line-context">
<span class="line-number">758</span>        is_typedef = False
</div>
<div class="line-context">
<span class="line-number">759</span>        check_pos = start_pos - 1
</div>
<div class="line-context">
<span class="line-number">760</span>        while check_pos >= 0:
</div>
<div class="line-context">
<span class="line-number">761</span>            if self.tokens[check_pos].type == TokenType.TYPEDEF:
</div>
</div>
<h4>Line 779</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">769</span>                break
</div>
<div class="line-context">
<span class="line-number">770</span>            check_pos -= 1
</div>
<div class="line-context">
<span class="line-number">771</span>
</div>
<div class="line-context">
<span class="line-number">772</span>        if is_typedef:
</div>
<div class="line-context">
<span class="line-number">773</span>            # For typedef enum, look for the typedef name after the closing brace
</div>
<div class="line-context">
<span class="line-number">774</span>            while name_pos < len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">775</span>                if self.tokens[name_pos].type == TokenType.IDENTIFIER:
</div>
<div class="line-context">
<span class="line-number">776</span>                    enum_name = self.tokens[name_pos].value
</div>
<div class="line-context">
<span class="line-number">777</span>                    break
</div>
<div class="line-context">
<span class="line-number">778</span>                elif self.tokens[name_pos].type == TokenType.SEMICOLON:
</div>
<div class="line-uncovered">
<span class="line-number">779</span>                    break
</div>
<div class="line-context">
<span class="line-number">780</span>                name_pos += 1
</div>
<div class="line-context">
<span class="line-number">781</span>        elif not enum_tag:
</div>
<div class="line-context">
<span class="line-number">782</span>            # Anonymous enum - check if there's a variable name after the brace
</div>
<div class="line-context">
<span class="line-number">783</span>            while name_pos < len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">784</span>                if self.tokens[name_pos].type == TokenType.IDENTIFIER:
</div>
<div class="line-context">
<span class="line-number">785</span>                    # This is a variable name, not an enum name
</div>
<div class="line-context">
<span class="line-number">786</span>                    enum_name = ""
</div>
<div class="line-context">
<span class="line-number">787</span>                    break
</div>
<div class="line-context">
<span class="line-number">788</span>                elif self.tokens[name_pos].type == TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">789</span>                    break
</div>
</div>
<h4>Lines 788-790</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">778</span>                elif self.tokens[name_pos].type == TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">779</span>                    break
</div>
<div class="line-context">
<span class="line-number">780</span>                name_pos += 1
</div>
<div class="line-context">
<span class="line-number">781</span>        elif not enum_tag:
</div>
<div class="line-context">
<span class="line-number">782</span>            # Anonymous enum - check if there's a variable name after the brace
</div>
<div class="line-context">
<span class="line-number">783</span>            while name_pos < len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">784</span>                if self.tokens[name_pos].type == TokenType.IDENTIFIER:
</div>
<div class="line-context">
<span class="line-number">785</span>                    # This is a variable name, not an enum name
</div>
<div class="line-context">
<span class="line-number">786</span>                    enum_name = ""
</div>
<div class="line-context">
<span class="line-number">787</span>                    break
</div>
<div class="line-uncovered">
<span class="line-number">788</span>                elif self.tokens[name_pos].type == TokenType.SEMICOLON:
</div>
<div class="line-uncovered">
<span class="line-number">789</span>                    break
</div>
<div class="line-uncovered">
<span class="line-number">790</span>                name_pos += 1
</div>
<div class="line-context">
<span class="line-number">791</span>
</div>
<div class="line-context">
<span class="line-number">792</span>        # Find semicolon
</div>
<div class="line-context">
<span class="line-number">793</span>        self.pos = end_brace_pos + 1
</div>
<div class="line-context">
<span class="line-number">794</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">795</span>            TokenType.SEMICOLON
</div>
<div class="line-context">
<span class="line-number">796</span>        ):
</div>
<div class="line-context">
<span class="line-number">797</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">798</span>
</div>
<div class="line-context">
<span class="line-number">799</span>        end_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">800</span>        return (start_pos, end_pos, enum_name)
</div>
</div>
<h4>Line 808</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">798</span>
</div>
<div class="line-context">
<span class="line-number">799</span>        end_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">800</span>        return (start_pos, end_pos, enum_name)
</div>
<div class="line-context">
<span class="line-number">801</span>
</div>
<div class="line-context">
<span class="line-number">802</span>    def _parse_typedef_enum(self) -> Optional[Tuple[int, int, str]]:
</div>
<div class="line-context">
<span class="line-number">803</span>        """Parse typedef enum definition"""
</div>
<div class="line-context">
<span class="line-number">804</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">805</span>
</div>
<div class="line-context">
<span class="line-number">806</span>        # Consume 'typedef'
</div>
<div class="line-context">
<span class="line-number">807</span>        if not self._current_token_is(TokenType.TYPEDEF):
</div>
<div class="line-uncovered">
<span class="line-number">808</span>            return None
</div>
<div class="line-context">
<span class="line-number">809</span>        self._advance()
</div>
<div class="line-context">
<span class="line-number">810</span>
</div>
<div class="line-context">
<span class="line-number">811</span>        # Look for 'enum'
</div>
<div class="line-context">
<span class="line-number">812</span>        if not self._current_token_is(TokenType.ENUM):
</div>
<div class="line-context">
<span class="line-number">813</span>            # Not a typedef enum, reset position
</div>
<div class="line-context">
<span class="line-number">814</span>            self.pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">815</span>            return None
</div>
<div class="line-context">
<span class="line-number">816</span>
</div>
<div class="line-context">
<span class="line-number">817</span>        # Parse the enum part - this will return the tag name (e.g., StatusEnum_tag)
</div>
<div class="line-context">
<span class="line-number">818</span>        enum_info = self._parse_enum()
</div>
</div>
<h4>Lines 820-821</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">810</span>
</div>
<div class="line-context">
<span class="line-number">811</span>        # Look for 'enum'
</div>
<div class="line-context">
<span class="line-number">812</span>        if not self._current_token_is(TokenType.ENUM):
</div>
<div class="line-context">
<span class="line-number">813</span>            # Not a typedef enum, reset position
</div>
<div class="line-context">
<span class="line-number">814</span>            self.pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">815</span>            return None
</div>
<div class="line-context">
<span class="line-number">816</span>
</div>
<div class="line-context">
<span class="line-number">817</span>        # Parse the enum part - this will return the tag name (e.g., StatusEnum_tag)
</div>
<div class="line-context">
<span class="line-number">818</span>        enum_info = self._parse_enum()
</div>
<div class="line-context">
<span class="line-number">819</span>        if not enum_info:
</div>
<div class="line-uncovered">
<span class="line-number">820</span>            self.pos = start_pos + 1
</div>
<div class="line-uncovered">
<span class="line-number">821</span>            return None
</div>
<div class="line-context">
<span class="line-number">822</span>
</div>
<div class="line-context">
<span class="line-number">823</span>        # For typedef enums, we want to return the tag name, not the typedef name
</div>
<div class="line-context">
<span class="line-number">824</span>        # The typedef name will be handled separately in the parser
</div>
<div class="line-context">
<span class="line-number">825</span>        return enum_info
</div>
<div class="line-context">
<span class="line-number">826</span>
</div>
<div class="line-context">
<span class="line-number">827</span>    def _parse_function(self) -> Optional[Tuple[int, int, str, str, bool]]:
</div>
<div class="line-context">
<span class="line-number">828</span>        """Parse function declaration/definition
</div>
<div class="line-context">
<span class="line-number">829</span>
</div>
<div class="line-context">
<span class="line-number">830</span>        Returns:
</div>
<div class="line-context">
<span class="line-number">831</span>            Tuple of (start_pos, end_pos, func_name, return_type, is_declaration)
</div>
</div>
<h4>Line 946</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">936</span>            if self.pos - start_pos > 50:
</div>
<div class="line-context">
<span class="line-number">937</span>                break
</div>
<div class="line-context">
<span class="line-number">938</span>
</div>
<div class="line-context">
<span class="line-number">939</span>        # Reset position if no function found
</div>
<div class="line-context">
<span class="line-number">940</span>        self.pos = start_pos + 1
</div>
<div class="line-context">
<span class="line-number">941</span>        return None
</div>
<div class="line-context">
<span class="line-number">942</span>
</div>
<div class="line-context">
<span class="line-number">943</span>    def _is_function_declaration(self, end_pos: int) -> bool:
</div>
<div class="line-context">
<span class="line-number">944</span>        """Check if the function at end_pos is a declaration (ends with ;) or definition (ends with })"""
</div>
<div class="line-context">
<span class="line-number">945</span>        if end_pos >= len(self.tokens):
</div>
<div class="line-uncovered">
<span class="line-number">946</span>            return False
</div>
<div class="line-context">
<span class="line-number">947</span>
</div>
<div class="line-context">
<span class="line-number">948</span>        # Look backwards from end_pos to find the last significant token
</div>
<div class="line-context">
<span class="line-number">949</span>        pos = end_pos
</div>
<div class="line-context">
<span class="line-number">950</span>        while pos >= 0:
</div>
<div class="line-context">
<span class="line-number">951</span>            token_type = self.tokens[pos].type
</div>
<div class="line-context">
<span class="line-number">952</span>            if token_type not in [
</div>
<div class="line-context">
<span class="line-number">953</span>                TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">954</span>                TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">955</span>                TokenType.NEWLINE,
</div>
<div class="line-context">
<span class="line-number">956</span>            ]:
</div>
</div>
<h4>Line 958</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">948</span>        # Look backwards from end_pos to find the last significant token
</div>
<div class="line-context">
<span class="line-number">949</span>        pos = end_pos
</div>
<div class="line-context">
<span class="line-number">950</span>        while pos >= 0:
</div>
<div class="line-context">
<span class="line-number">951</span>            token_type = self.tokens[pos].type
</div>
<div class="line-context">
<span class="line-number">952</span>            if token_type not in [
</div>
<div class="line-context">
<span class="line-number">953</span>                TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">954</span>                TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">955</span>                TokenType.NEWLINE,
</div>
<div class="line-context">
<span class="line-number">956</span>            ]:
</div>
<div class="line-context">
<span class="line-number">957</span>                return token_type == TokenType.SEMICOLON
</div>
<div class="line-uncovered">
<span class="line-number">958</span>            pos -= 1
</div>
<div class="line-context">
<span class="line-number">959</span>
</div>
<div class="line-context">
<span class="line-number">960</span>        return False
</div>
<div class="line-context">
<span class="line-number">961</span>
</div>
<div class="line-context">
<span class="line-number">962</span>    def _find_function_end(self, start_pos: int) -> Optional[int]:
</div>
<div class="line-context">
<span class="line-number">963</span>        """Find end of function declaration or definition"""
</div>
<div class="line-context">
<span class="line-number">964</span>        pos = start_pos
</div>
<div class="line-context">
<span class="line-number">965</span>
</div>
<div class="line-context">
<span class="line-number">966</span>        # Find matching closing parenthesis
</div>
<div class="line-context">
<span class="line-number">967</span>        if pos >= len(self.tokens) or self.tokens[pos].type != TokenType.LPAREN:
</div>
<div class="line-context">
<span class="line-number">968</span>            return None
</div>
</div>
<h4>Line 960</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">950</span>        while pos >= 0:
</div>
<div class="line-context">
<span class="line-number">951</span>            token_type = self.tokens[pos].type
</div>
<div class="line-context">
<span class="line-number">952</span>            if token_type not in [
</div>
<div class="line-context">
<span class="line-number">953</span>                TokenType.WHITESPACE,
</div>
<div class="line-context">
<span class="line-number">954</span>                TokenType.COMMENT,
</div>
<div class="line-context">
<span class="line-number">955</span>                TokenType.NEWLINE,
</div>
<div class="line-context">
<span class="line-number">956</span>            ]:
</div>
<div class="line-context">
<span class="line-number">957</span>                return token_type == TokenType.SEMICOLON
</div>
<div class="line-context">
<span class="line-number">958</span>            pos -= 1
</div>
<div class="line-context">
<span class="line-number">959</span>
</div>
<div class="line-uncovered">
<span class="line-number">960</span>        return False
</div>
<div class="line-context">
<span class="line-number">961</span>
</div>
<div class="line-context">
<span class="line-number">962</span>    def _find_function_end(self, start_pos: int) -> Optional[int]:
</div>
<div class="line-context">
<span class="line-number">963</span>        """Find end of function declaration or definition"""
</div>
<div class="line-context">
<span class="line-number">964</span>        pos = start_pos
</div>
<div class="line-context">
<span class="line-number">965</span>
</div>
<div class="line-context">
<span class="line-number">966</span>        # Find matching closing parenthesis
</div>
<div class="line-context">
<span class="line-number">967</span>        if pos >= len(self.tokens) or self.tokens[pos].type != TokenType.LPAREN:
</div>
<div class="line-context">
<span class="line-number">968</span>            return None
</div>
<div class="line-context">
<span class="line-number">969</span>
</div>
<div class="line-context">
<span class="line-number">970</span>        depth = 1
</div>
</div>
<h4>Line 968</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">958</span>            pos -= 1
</div>
<div class="line-context">
<span class="line-number">959</span>
</div>
<div class="line-context">
<span class="line-number">960</span>        return False
</div>
<div class="line-context">
<span class="line-number">961</span>
</div>
<div class="line-context">
<span class="line-number">962</span>    def _find_function_end(self, start_pos: int) -> Optional[int]:
</div>
<div class="line-context">
<span class="line-number">963</span>        """Find end of function declaration or definition"""
</div>
<div class="line-context">
<span class="line-number">964</span>        pos = start_pos
</div>
<div class="line-context">
<span class="line-number">965</span>
</div>
<div class="line-context">
<span class="line-number">966</span>        # Find matching closing parenthesis
</div>
<div class="line-context">
<span class="line-number">967</span>        if pos >= len(self.tokens) or self.tokens[pos].type != TokenType.LPAREN:
</div>
<div class="line-uncovered">
<span class="line-number">968</span>            return None
</div>
<div class="line-context">
<span class="line-number">969</span>
</div>
<div class="line-context">
<span class="line-number">970</span>        depth = 1
</div>
<div class="line-context">
<span class="line-number">971</span>        pos += 1
</div>
<div class="line-context">
<span class="line-number">972</span>
</div>
<div class="line-context">
<span class="line-number">973</span>        while pos < len(self.tokens) and depth > 0:
</div>
<div class="line-context">
<span class="line-number">974</span>            if self.tokens[pos].type == TokenType.LPAREN:
</div>
<div class="line-context">
<span class="line-number">975</span>                depth += 1
</div>
<div class="line-context">
<span class="line-number">976</span>            elif self.tokens[pos].type == TokenType.RPAREN:
</div>
<div class="line-context">
<span class="line-number">977</span>                depth -= 1
</div>
<div class="line-context">
<span class="line-number">978</span>            pos += 1
</div>
</div>
<h4>Line 993</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">983</span>        # Now look for either ; (declaration) or { (definition)
</div>
<div class="line-context">
<span class="line-number">984</span>        while pos < len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">985</span>            if self.tokens[pos].type == TokenType.SEMICOLON:
</div>
<div class="line-context">
<span class="line-number">986</span>                return pos
</div>
<div class="line-context">
<span class="line-number">987</span>            elif self.tokens[pos].type == TokenType.LBRACE:
</div>
<div class="line-context">
<span class="line-number">988</span>                # Function definition - find matching brace
</div>
<div class="line-context">
<span class="line-number">989</span>                end_brace = self._find_matching_brace(pos)
</div>
<div class="line-context">
<span class="line-number">990</span>                return end_brace if end_brace else pos
</div>
<div class="line-context">
<span class="line-number">991</span>            pos += 1
</div>
<div class="line-context">
<span class="line-number">992</span>
</div>
<div class="line-uncovered">
<span class="line-number">993</span>        return None
</div>
<div class="line-context">
<span class="line-number">994</span>
</div>
<div class="line-context">
<span class="line-number">995</span>    def _parse_union(self) -> Optional[Tuple[int, int, str]]:
</div>
<div class="line-context">
<span class="line-number">996</span>        """Parse union definition"""
</div>
<div class="line-context">
<span class="line-number">997</span>        if not self._current_token_is(TokenType.UNION):
</div>
<div class="line-context">
<span class="line-number">998</span>            return None
</div>
<div class="line-context">
<span class="line-number">999</span>
</div>
<div class="line-context">
<span class="line-number">1000</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">1001</span>        self._advance()  # Consumes 'union'
</div>
<div class="line-context">
<span class="line-number">1002</span>
</div>
<div class="line-context">
<span class="line-number">1003</span>        # Skip whitespace
</div>
</div>
<h4>Line 998</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">988</span>                # Function definition - find matching brace
</div>
<div class="line-context">
<span class="line-number">989</span>                end_brace = self._find_matching_brace(pos)
</div>
<div class="line-context">
<span class="line-number">990</span>                return end_brace if end_brace else pos
</div>
<div class="line-context">
<span class="line-number">991</span>            pos += 1
</div>
<div class="line-context">
<span class="line-number">992</span>
</div>
<div class="line-context">
<span class="line-number">993</span>        return None
</div>
<div class="line-context">
<span class="line-number">994</span>
</div>
<div class="line-context">
<span class="line-number">995</span>    def _parse_union(self) -> Optional[Tuple[int, int, str]]:
</div>
<div class="line-context">
<span class="line-number">996</span>        """Parse union definition"""
</div>
<div class="line-context">
<span class="line-number">997</span>        if not self._current_token_is(TokenType.UNION):
</div>
<div class="line-uncovered">
<span class="line-number">998</span>            return None
</div>
<div class="line-context">
<span class="line-number">999</span>
</div>
<div class="line-context">
<span class="line-number">1000</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">1001</span>        self._advance()  # Consumes 'union'
</div>
<div class="line-context">
<span class="line-number">1002</span>
</div>
<div class="line-context">
<span class="line-number">1003</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">1004</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1005</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">1006</span>        ):
</div>
<div class="line-context">
<span class="line-number">1007</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1008</span>
</div>
</div>
<h4>Line 1007</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">997</span>        if not self._current_token_is(TokenType.UNION):
</div>
<div class="line-context">
<span class="line-number">998</span>            return None
</div>
<div class="line-context">
<span class="line-number">999</span>
</div>
<div class="line-context">
<span class="line-number">1000</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">1001</span>        self._advance()  # Consumes 'union'
</div>
<div class="line-context">
<span class="line-number">1002</span>
</div>
<div class="line-context">
<span class="line-number">1003</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">1004</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1005</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">1006</span>        ):
</div>
<div class="line-uncovered">
<span class="line-number">1007</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1008</span>
</div>
<div class="line-context">
<span class="line-number">1009</span>        # Get union tag name (optional for anonymous unions)
</div>
<div class="line-context">
<span class="line-number">1010</span>        union_tag = ""
</div>
<div class="line-context">
<span class="line-number">1011</span>        if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-context">
<span class="line-number">1012</span>            union_tag = self._advance().value
</div>
<div class="line-context">
<span class="line-number">1013</span>
</div>
<div class="line-context">
<span class="line-number">1014</span>        # Find opening brace
</div>
<div class="line-context">
<span class="line-number">1015</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1016</span>            TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1017</span>        ):
</div>
</div>
<h4>Line 1026</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1016</span>            TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1017</span>        ):
</div>
<div class="line-context">
<span class="line-number">1018</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1019</span>
</div>
<div class="line-context">
<span class="line-number">1020</span>        if self.pos >= len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">1021</span>            return None
</div>
<div class="line-context">
<span class="line-number">1022</span>
</div>
<div class="line-context">
<span class="line-number">1023</span>        # Find matching closing brace
</div>
<div class="line-context">
<span class="line-number">1024</span>        end_pos = self._find_matching_brace(self.pos)
</div>
<div class="line-context">
<span class="line-number">1025</span>        if end_pos is None:
</div>
<div class="line-uncovered">
<span class="line-number">1026</span>            return None
</div>
<div class="line-context">
<span class="line-number">1027</span>
</div>
<div class="line-context">
<span class="line-number">1028</span>        # Look for union name after closing brace (for typedefs or named unions)
</div>
<div class="line-context">
<span class="line-number">1029</span>        union_name = union_tag  # Default to tag name
</div>
<div class="line-context">
<span class="line-number">1030</span>
</div>
<div class="line-context">
<span class="line-number">1031</span>        # Skip to semicolon
</div>
<div class="line-context">
<span class="line-number">1032</span>        self.pos = end_pos + 1
</div>
<div class="line-context">
<span class="line-number">1033</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1034</span>            TokenType.SEMICOLON
</div>
<div class="line-context">
<span class="line-number">1035</span>        ):
</div>
<div class="line-context">
<span class="line-number">1036</span>            if self._current_token_is(TokenType.IDENTIFIER):
</div>
</div>
<h4>Lines 1036-1039</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1026</span>            return None
</div>
<div class="line-context">
<span class="line-number">1027</span>
</div>
<div class="line-context">
<span class="line-number">1028</span>        # Look for union name after closing brace (for typedefs or named unions)
</div>
<div class="line-context">
<span class="line-number">1029</span>        union_name = union_tag  # Default to tag name
</div>
<div class="line-context">
<span class="line-number">1030</span>
</div>
<div class="line-context">
<span class="line-number">1031</span>        # Skip to semicolon
</div>
<div class="line-context">
<span class="line-number">1032</span>        self.pos = end_pos + 1
</div>
<div class="line-context">
<span class="line-number">1033</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1034</span>            TokenType.SEMICOLON
</div>
<div class="line-context">
<span class="line-number">1035</span>        ):
</div>
<div class="line-uncovered">
<span class="line-number">1036</span>            if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-uncovered">
<span class="line-number">1037</span>                union_name = self._advance().value
</div>
<div class="line-uncovered">
<span class="line-number">1038</span>                break
</div>
<div class="line-uncovered">
<span class="line-number">1039</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1040</span>
</div>
<div class="line-context">
<span class="line-number">1041</span>        return (start_pos, end_pos, union_name)
</div>
<div class="line-context">
<span class="line-number">1042</span>
</div>
<div class="line-context">
<span class="line-number">1043</span>    def _parse_typedef_union(self) -> Optional[Tuple[int, int, str]]:
</div>
<div class="line-context">
<span class="line-number">1044</span>        """Parse typedef union definition"""
</div>
<div class="line-context">
<span class="line-number">1045</span>        if not self._current_token_is(TokenType.TYPEDEF):
</div>
<div class="line-context">
<span class="line-number">1046</span>            return None
</div>
<div class="line-context">
<span class="line-number">1047</span>
</div>
<div class="line-context">
<span class="line-number">1048</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">1049</span>        self._advance()  # Consumes 'typedef'
</div>
</div>
<h4>Line 1046</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1036</span>            if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-context">
<span class="line-number">1037</span>                union_name = self._advance().value
</div>
<div class="line-context">
<span class="line-number">1038</span>                break
</div>
<div class="line-context">
<span class="line-number">1039</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1040</span>
</div>
<div class="line-context">
<span class="line-number">1041</span>        return (start_pos, end_pos, union_name)
</div>
<div class="line-context">
<span class="line-number">1042</span>
</div>
<div class="line-context">
<span class="line-number">1043</span>    def _parse_typedef_union(self) -> Optional[Tuple[int, int, str]]:
</div>
<div class="line-context">
<span class="line-number">1044</span>        """Parse typedef union definition"""
</div>
<div class="line-context">
<span class="line-number">1045</span>        if not self._current_token_is(TokenType.TYPEDEF):
</div>
<div class="line-uncovered">
<span class="line-number">1046</span>            return None
</div>
<div class="line-context">
<span class="line-number">1047</span>
</div>
<div class="line-context">
<span class="line-number">1048</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">1049</span>        self._advance()  # Consumes 'typedef'
</div>
<div class="line-context">
<span class="line-number">1050</span>
</div>
<div class="line-context">
<span class="line-number">1051</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">1052</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1053</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">1054</span>        ):
</div>
<div class="line-context">
<span class="line-number">1055</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1056</span>
</div>
</div>
<h4>Line 1055</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1045</span>        if not self._current_token_is(TokenType.TYPEDEF):
</div>
<div class="line-context">
<span class="line-number">1046</span>            return None
</div>
<div class="line-context">
<span class="line-number">1047</span>
</div>
<div class="line-context">
<span class="line-number">1048</span>        start_pos = self.pos
</div>
<div class="line-context">
<span class="line-number">1049</span>        self._advance()  # Consumes 'typedef'
</div>
<div class="line-context">
<span class="line-number">1050</span>
</div>
<div class="line-context">
<span class="line-number">1051</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">1052</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1053</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">1054</span>        ):
</div>
<div class="line-uncovered">
<span class="line-number">1055</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1056</span>
</div>
<div class="line-context">
<span class="line-number">1057</span>        # Check if next token is 'union'
</div>
<div class="line-context">
<span class="line-number">1058</span>        if not self._current_token_is(TokenType.UNION):
</div>
<div class="line-context">
<span class="line-number">1059</span>            return None
</div>
<div class="line-context">
<span class="line-number">1060</span>
</div>
<div class="line-context">
<span class="line-number">1061</span>        self._advance()  # Consumes 'union'
</div>
<div class="line-context">
<span class="line-number">1062</span>
</div>
<div class="line-context">
<span class="line-number">1063</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">1064</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1065</span>            TokenType.WHITESPACE
</div>
</div>
<h4>Line 1067</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1057</span>        # Check if next token is 'union'
</div>
<div class="line-context">
<span class="line-number">1058</span>        if not self._current_token_is(TokenType.UNION):
</div>
<div class="line-context">
<span class="line-number">1059</span>            return None
</div>
<div class="line-context">
<span class="line-number">1060</span>
</div>
<div class="line-context">
<span class="line-number">1061</span>        self._advance()  # Consumes 'union'
</div>
<div class="line-context">
<span class="line-number">1062</span>
</div>
<div class="line-context">
<span class="line-number">1063</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">1064</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1065</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">1066</span>        ):
</div>
<div class="line-uncovered">
<span class="line-number">1067</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1068</span>
</div>
<div class="line-context">
<span class="line-number">1069</span>        # Get union tag name (optional)
</div>
<div class="line-context">
<span class="line-number">1070</span>        union_tag = ""
</div>
<div class="line-context">
<span class="line-number">1071</span>        if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-context">
<span class="line-number">1072</span>            union_tag = self._advance().value
</div>
<div class="line-context">
<span class="line-number">1073</span>
</div>
<div class="line-context">
<span class="line-number">1074</span>        # Find opening brace
</div>
<div class="line-context">
<span class="line-number">1075</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1076</span>            TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1077</span>        ):
</div>
</div>
<h4>Line 1072</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1062</span>
</div>
<div class="line-context">
<span class="line-number">1063</span>        # Skip whitespace
</div>
<div class="line-context">
<span class="line-number">1064</span>        while self.pos < len(self.tokens) and self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1065</span>            TokenType.WHITESPACE
</div>
<div class="line-context">
<span class="line-number">1066</span>        ):
</div>
<div class="line-context">
<span class="line-number">1067</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1068</span>
</div>
<div class="line-context">
<span class="line-number">1069</span>        # Get union tag name (optional)
</div>
<div class="line-context">
<span class="line-number">1070</span>        union_tag = ""
</div>
<div class="line-context">
<span class="line-number">1071</span>        if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-uncovered">
<span class="line-number">1072</span>            union_tag = self._advance().value
</div>
<div class="line-context">
<span class="line-number">1073</span>
</div>
<div class="line-context">
<span class="line-number">1074</span>        # Find opening brace
</div>
<div class="line-context">
<span class="line-number">1075</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1076</span>            TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1077</span>        ):
</div>
<div class="line-context">
<span class="line-number">1078</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1079</span>
</div>
<div class="line-context">
<span class="line-number">1080</span>        if self.pos >= len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">1081</span>            return None
</div>
<div class="line-context">
<span class="line-number">1082</span>
</div>
</div>
<h4>Line 1078</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1068</span>
</div>
<div class="line-context">
<span class="line-number">1069</span>        # Get union tag name (optional)
</div>
<div class="line-context">
<span class="line-number">1070</span>        union_tag = ""
</div>
<div class="line-context">
<span class="line-number">1071</span>        if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-context">
<span class="line-number">1072</span>            union_tag = self._advance().value
</div>
<div class="line-context">
<span class="line-number">1073</span>
</div>
<div class="line-context">
<span class="line-number">1074</span>        # Find opening brace
</div>
<div class="line-context">
<span class="line-number">1075</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1076</span>            TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1077</span>        ):
</div>
<div class="line-uncovered">
<span class="line-number">1078</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1079</span>
</div>
<div class="line-context">
<span class="line-number">1080</span>        if self.pos >= len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">1081</span>            return None
</div>
<div class="line-context">
<span class="line-number">1082</span>
</div>
<div class="line-context">
<span class="line-number">1083</span>        # Find matching closing brace
</div>
<div class="line-context">
<span class="line-number">1084</span>        end_pos = self._find_matching_brace(self.pos)
</div>
<div class="line-context">
<span class="line-number">1085</span>        if end_pos is None:
</div>
<div class="line-context">
<span class="line-number">1086</span>            return None
</div>
<div class="line-context">
<span class="line-number">1087</span>
</div>
<div class="line-context">
<span class="line-number">1088</span>        # Look for typedef name after closing brace
</div>
</div>
<h4>Line 1081</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1071</span>        if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-context">
<span class="line-number">1072</span>            union_tag = self._advance().value
</div>
<div class="line-context">
<span class="line-number">1073</span>
</div>
<div class="line-context">
<span class="line-number">1074</span>        # Find opening brace
</div>
<div class="line-context">
<span class="line-number">1075</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1076</span>            TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1077</span>        ):
</div>
<div class="line-context">
<span class="line-number">1078</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1079</span>
</div>
<div class="line-context">
<span class="line-number">1080</span>        if self.pos >= len(self.tokens):
</div>
<div class="line-uncovered">
<span class="line-number">1081</span>            return None
</div>
<div class="line-context">
<span class="line-number">1082</span>
</div>
<div class="line-context">
<span class="line-number">1083</span>        # Find matching closing brace
</div>
<div class="line-context">
<span class="line-number">1084</span>        end_pos = self._find_matching_brace(self.pos)
</div>
<div class="line-context">
<span class="line-number">1085</span>        if end_pos is None:
</div>
<div class="line-context">
<span class="line-number">1086</span>            return None
</div>
<div class="line-context">
<span class="line-number">1087</span>
</div>
<div class="line-context">
<span class="line-number">1088</span>        # Look for typedef name after closing brace
</div>
<div class="line-context">
<span class="line-number">1089</span>        typedef_name = ""
</div>
<div class="line-context">
<span class="line-number">1090</span>        self.pos = end_pos + 1
</div>
<div class="line-context">
<span class="line-number">1091</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
</div>
<h4>Line 1086</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1076</span>            TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1077</span>        ):
</div>
<div class="line-context">
<span class="line-number">1078</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1079</span>
</div>
<div class="line-context">
<span class="line-number">1080</span>        if self.pos >= len(self.tokens):
</div>
<div class="line-context">
<span class="line-number">1081</span>            return None
</div>
<div class="line-context">
<span class="line-number">1082</span>
</div>
<div class="line-context">
<span class="line-number">1083</span>        # Find matching closing brace
</div>
<div class="line-context">
<span class="line-number">1084</span>        end_pos = self._find_matching_brace(self.pos)
</div>
<div class="line-context">
<span class="line-number">1085</span>        if end_pos is None:
</div>
<div class="line-uncovered">
<span class="line-number">1086</span>            return None
</div>
<div class="line-context">
<span class="line-number">1087</span>
</div>
<div class="line-context">
<span class="line-number">1088</span>        # Look for typedef name after closing brace
</div>
<div class="line-context">
<span class="line-number">1089</span>        typedef_name = ""
</div>
<div class="line-context">
<span class="line-number">1090</span>        self.pos = end_pos + 1
</div>
<div class="line-context">
<span class="line-number">1091</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1092</span>            TokenType.SEMICOLON
</div>
<div class="line-context">
<span class="line-number">1093</span>        ):
</div>
<div class="line-context">
<span class="line-number">1094</span>            if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-context">
<span class="line-number">1095</span>                typedef_name = self._advance().value
</div>
<div class="line-context">
<span class="line-number">1096</span>                break
</div>
</div>
<h4>Line 1097</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1087</span>
</div>
<div class="line-context">
<span class="line-number">1088</span>        # Look for typedef name after closing brace
</div>
<div class="line-context">
<span class="line-number">1089</span>        typedef_name = ""
</div>
<div class="line-context">
<span class="line-number">1090</span>        self.pos = end_pos + 1
</div>
<div class="line-context">
<span class="line-number">1091</span>        while self.pos < len(self.tokens) and not self._current_token_is(
</div>
<div class="line-context">
<span class="line-number">1092</span>            TokenType.SEMICOLON
</div>
<div class="line-context">
<span class="line-number">1093</span>        ):
</div>
<div class="line-context">
<span class="line-number">1094</span>            if self._current_token_is(TokenType.IDENTIFIER):
</div>
<div class="line-context">
<span class="line-number">1095</span>                typedef_name = self._advance().value
</div>
<div class="line-context">
<span class="line-number">1096</span>                break
</div>
<div class="line-uncovered">
<span class="line-number">1097</span>            self.pos += 1
</div>
<div class="line-context">
<span class="line-number">1098</span>
</div>
<div class="line-context">
<span class="line-number">1099</span>        return (start_pos, end_pos, typedef_name)
</div>
<div class="line-context">
<span class="line-number">1100</span>
</div>
<div class="line-context">
<span class="line-number">1101</span>
</div>
<div class="line-context">
<span class="line-number">1102</span>def extract_token_range(tokens: List[Token], start: int, end: int) -> str:
</div>
<div class="line-context">
<span class="line-number">1103</span>    """Extract raw text from token range, excluding whitespace, comments, and newlines"""
</div>
<div class="line-context">
<span class="line-number">1104</span>    if start >= len(tokens) or end >= len(tokens) or start > end:
</div>
<div class="line-context">
<span class="line-number">1105</span>        return ""
</div>
<div class="line-context">
<span class="line-number">1106</span>    return " ".join(
</div>
<div class="line-context">
<span class="line-number">1107</span>        token.value
</div>
</div>
<h4>Line 1126</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1116</span>) -> List[Tuple[str, str]]:
</div>
<div class="line-context">
<span class="line-number">1117</span>    """Extract field information from struct token range
</div>
<div class="line-context">
<span class="line-number">1118</span>    Returns:
</div>
<div class="line-context">
<span class="line-number">1119</span>        List of tuples (field_name, field_type)
</div>
<div class="line-context">
<span class="line-number">1120</span>    """
</div>
<div class="line-context">
<span class="line-number">1121</span>    fields = []
</div>
<div class="line-context">
<span class="line-number">1122</span>    pos = struct_start
</div>
<div class="line-context">
<span class="line-number">1123</span>    while pos <= struct_end and tokens[pos].type != TokenType.LBRACE:
</div>
<div class="line-context">
<span class="line-number">1124</span>        pos += 1
</div>
<div class="line-context">
<span class="line-number">1125</span>    if pos > struct_end:
</div>
<div class="line-uncovered">
<span class="line-number">1126</span>        return fields
</div>
<div class="line-context">
<span class="line-number">1127</span>    pos += 1  # Skip opening brace
</div>
<div class="line-context">
<span class="line-number">1128</span>
</div>
<div class="line-context">
<span class="line-number">1129</span>    # Find the closing brace position
</div>
<div class="line-context">
<span class="line-number">1130</span>    closing_brace_pos = pos
</div>
<div class="line-context">
<span class="line-number">1131</span>    while (
</div>
<div class="line-context">
<span class="line-number">1132</span>        closing_brace_pos <= struct_end
</div>
<div class="line-context">
<span class="line-number">1133</span>        and tokens[closing_brace_pos].type != TokenType.RBRACE
</div>
<div class="line-context">
<span class="line-number">1134</span>    ):
</div>
<div class="line-context">
<span class="line-number">1135</span>        closing_brace_pos += 1
</div>
<div class="line-context">
<span class="line-number">1136</span>
</div>
</div>
<h4>Line 1155</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1145</span>        # Parse field from collected tokens
</div>
<div class="line-context">
<span class="line-number">1146</span>        if len(field_tokens) >= 2:
</div>
<div class="line-context">
<span class="line-number">1147</span>            # Check if this is a nested struct field
</div>
<div class="line-context">
<span class="line-number">1148</span>            if (
</div>
<div class="line-context">
<span class="line-number">1149</span>                len(field_tokens) >= 3
</div>
<div class="line-context">
<span class="line-number">1150</span>                and field_tokens[0].type == TokenType.STRUCT
</div>
<div class="line-context">
<span class="line-number">1151</span>                and field_tokens[1].type == TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1152</span>            ):
</div>
<div class="line-context">
<span class="line-number">1153</span>                # This is a nested anonymous struct
</div>
<div class="line-context">
<span class="line-number">1154</span>                # Find the struct name (last token before semicolon)
</div>
<div class="line-uncovered">
<span class="line-number">1155</span>                field_name = field_tokens[-1].value
</div>
<div class="line-context">
<span class="line-number">1156</span>                # Create a simplified type representation for nested struct
</div>
<div class="line-context">
<span class="line-number">1157</span>                field_type = "struct { ... }"
</div>
<div class="line-context">
<span class="line-number">1158</span>                if (
</div>
<div class="line-context">
<span class="line-number">1159</span>                    field_name
</div>
<div class="line-context">
<span class="line-number">1160</span>                    and field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1161</span>                    and field_name not in ["[", "]", ";", "}"]
</div>
<div class="line-context">
<span class="line-number">1162</span>                ):
</div>
<div class="line-context">
<span class="line-number">1163</span>                    stripped_name = field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1164</span>                    if stripped_name:
</div>
<div class="line-context">
<span class="line-number">1165</span>                        fields.append((stripped_name, field_type))
</div>
</div>
<h4>Lines 1157-1158</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1147</span>            # Check if this is a nested struct field
</div>
<div class="line-context">
<span class="line-number">1148</span>            if (
</div>
<div class="line-context">
<span class="line-number">1149</span>                len(field_tokens) >= 3
</div>
<div class="line-context">
<span class="line-number">1150</span>                and field_tokens[0].type == TokenType.STRUCT
</div>
<div class="line-context">
<span class="line-number">1151</span>                and field_tokens[1].type == TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1152</span>            ):
</div>
<div class="line-context">
<span class="line-number">1153</span>                # This is a nested anonymous struct
</div>
<div class="line-context">
<span class="line-number">1154</span>                # Find the struct name (last token before semicolon)
</div>
<div class="line-context">
<span class="line-number">1155</span>                field_name = field_tokens[-1].value
</div>
<div class="line-context">
<span class="line-number">1156</span>                # Create a simplified type representation for nested struct
</div>
<div class="line-uncovered">
<span class="line-number">1157</span>                field_type = "struct { ... }"
</div>
<div class="line-uncovered">
<span class="line-number">1158</span>                if (
</div>
<div class="line-context">
<span class="line-number">1159</span>                    field_name
</div>
<div class="line-context">
<span class="line-number">1160</span>                    and field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1161</span>                    and field_name not in ["[", "]", ";", "}"]
</div>
<div class="line-context">
<span class="line-number">1162</span>                ):
</div>
<div class="line-context">
<span class="line-number">1163</span>                    stripped_name = field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1164</span>                    if stripped_name:
</div>
<div class="line-context">
<span class="line-number">1165</span>                        fields.append((stripped_name, field_type))
</div>
<div class="line-context">
<span class="line-number">1166</span>                        # Skip parsing the nested struct's fields as separate fields
</div>
<div class="line-context">
<span class="line-number">1167</span>                        continue
</div>
<div class="line-context">
<span class="line-number">1168</span>            # Check if this is a nested struct field with more complex structure
</div>
</div>
<h4>Lines 1163-1165</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1153</span>                # This is a nested anonymous struct
</div>
<div class="line-context">
<span class="line-number">1154</span>                # Find the struct name (last token before semicolon)
</div>
<div class="line-context">
<span class="line-number">1155</span>                field_name = field_tokens[-1].value
</div>
<div class="line-context">
<span class="line-number">1156</span>                # Create a simplified type representation for nested struct
</div>
<div class="line-context">
<span class="line-number">1157</span>                field_type = "struct { ... }"
</div>
<div class="line-context">
<span class="line-number">1158</span>                if (
</div>
<div class="line-context">
<span class="line-number">1159</span>                    field_name
</div>
<div class="line-context">
<span class="line-number">1160</span>                    and field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1161</span>                    and field_name not in ["[", "]", ";", "}"]
</div>
<div class="line-context">
<span class="line-number">1162</span>                ):
</div>
<div class="line-uncovered">
<span class="line-number">1163</span>                    stripped_name = field_name.strip()
</div>
<div class="line-uncovered">
<span class="line-number">1164</span>                    if stripped_name:
</div>
<div class="line-uncovered">
<span class="line-number">1165</span>                        fields.append((stripped_name, field_type))
</div>
<div class="line-context">
<span class="line-number">1166</span>                        # Skip parsing the nested struct's fields as separate fields
</div>
<div class="line-context">
<span class="line-number">1167</span>                        continue
</div>
<div class="line-context">
<span class="line-number">1168</span>            # Check if this is a nested struct field with more complex structure
</div>
<div class="line-context">
<span class="line-number">1169</span>            elif (
</div>
<div class="line-context">
<span class="line-number">1170</span>                len(field_tokens) >= 4
</div>
<div class="line-context">
<span class="line-number">1171</span>                and field_tokens[0].type == TokenType.STRUCT
</div>
<div class="line-context">
<span class="line-number">1172</span>                and field_tokens[1].type == TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1173</span>                and field_tokens[-1].type == TokenType.IDENTIFIER
</div>
<div class="line-context">
<span class="line-number">1174</span>            ):
</div>
<div class="line-context">
<span class="line-number">1175</span>                # This is a nested anonymous struct with a name
</div>
</div>
<h4>Line 1167</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1157</span>                field_type = "struct { ... }"
</div>
<div class="line-context">
<span class="line-number">1158</span>                if (
</div>
<div class="line-context">
<span class="line-number">1159</span>                    field_name
</div>
<div class="line-context">
<span class="line-number">1160</span>                    and field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1161</span>                    and field_name not in ["[", "]", ";", "}"]
</div>
<div class="line-context">
<span class="line-number">1162</span>                ):
</div>
<div class="line-context">
<span class="line-number">1163</span>                    stripped_name = field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1164</span>                    if stripped_name:
</div>
<div class="line-context">
<span class="line-number">1165</span>                        fields.append((stripped_name, field_type))
</div>
<div class="line-context">
<span class="line-number">1166</span>                        # Skip parsing the nested struct's fields as separate fields
</div>
<div class="line-uncovered">
<span class="line-number">1167</span>                        continue
</div>
<div class="line-context">
<span class="line-number">1168</span>            # Check if this is a nested struct field with more complex structure
</div>
<div class="line-context">
<span class="line-number">1169</span>            elif (
</div>
<div class="line-context">
<span class="line-number">1170</span>                len(field_tokens) >= 4
</div>
<div class="line-context">
<span class="line-number">1171</span>                and field_tokens[0].type == TokenType.STRUCT
</div>
<div class="line-context">
<span class="line-number">1172</span>                and field_tokens[1].type == TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1173</span>                and field_tokens[-1].type == TokenType.IDENTIFIER
</div>
<div class="line-context">
<span class="line-number">1174</span>            ):
</div>
<div class="line-context">
<span class="line-number">1175</span>                # This is a nested anonymous struct with a name
</div>
<div class="line-context">
<span class="line-number">1176</span>                field_name = field_tokens[-1].value
</div>
<div class="line-context">
<span class="line-number">1177</span>                field_type = "struct { ... }"
</div>
</div>
<h4>Lines 1176-1178</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1166</span>                        # Skip parsing the nested struct's fields as separate fields
</div>
<div class="line-context">
<span class="line-number">1167</span>                        continue
</div>
<div class="line-context">
<span class="line-number">1168</span>            # Check if this is a nested struct field with more complex structure
</div>
<div class="line-context">
<span class="line-number">1169</span>            elif (
</div>
<div class="line-context">
<span class="line-number">1170</span>                len(field_tokens) >= 4
</div>
<div class="line-context">
<span class="line-number">1171</span>                and field_tokens[0].type == TokenType.STRUCT
</div>
<div class="line-context">
<span class="line-number">1172</span>                and field_tokens[1].type == TokenType.LBRACE
</div>
<div class="line-context">
<span class="line-number">1173</span>                and field_tokens[-1].type == TokenType.IDENTIFIER
</div>
<div class="line-context">
<span class="line-number">1174</span>            ):
</div>
<div class="line-context">
<span class="line-number">1175</span>                # This is a nested anonymous struct with a name
</div>
<div class="line-uncovered">
<span class="line-number">1176</span>                field_name = field_tokens[-1].value
</div>
<div class="line-uncovered">
<span class="line-number">1177</span>                field_type = "struct { ... }"
</div>
<div class="line-uncovered">
<span class="line-number">1178</span>                if (
</div>
<div class="line-context">
<span class="line-number">1179</span>                    field_name
</div>
<div class="line-context">
<span class="line-number">1180</span>                    and field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1181</span>                    and field_name not in ["[", "]", ";", "}"]
</div>
<div class="line-context">
<span class="line-number">1182</span>                ):
</div>
<div class="line-context">
<span class="line-number">1183</span>                    stripped_name = field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1184</span>                    if stripped_name:
</div>
<div class="line-context">
<span class="line-number">1185</span>                        fields.append((stripped_name, field_type))
</div>
<div class="line-context">
<span class="line-number">1186</span>                        # Skip parsing the nested struct's fields as separate fields
</div>
<div class="line-context">
<span class="line-number">1187</span>                        continue
</div>
<div class="line-context">
<span class="line-number">1188</span>            # Array field: type name [ size ]
</div>
</div>
<h4>Lines 1183-1185</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1173</span>                and field_tokens[-1].type == TokenType.IDENTIFIER
</div>
<div class="line-context">
<span class="line-number">1174</span>            ):
</div>
<div class="line-context">
<span class="line-number">1175</span>                # This is a nested anonymous struct with a name
</div>
<div class="line-context">
<span class="line-number">1176</span>                field_name = field_tokens[-1].value
</div>
<div class="line-context">
<span class="line-number">1177</span>                field_type = "struct { ... }"
</div>
<div class="line-context">
<span class="line-number">1178</span>                if (
</div>
<div class="line-context">
<span class="line-number">1179</span>                    field_name
</div>
<div class="line-context">
<span class="line-number">1180</span>                    and field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1181</span>                    and field_name not in ["[", "]", ";", "}"]
</div>
<div class="line-context">
<span class="line-number">1182</span>                ):
</div>
<div class="line-uncovered">
<span class="line-number">1183</span>                    stripped_name = field_name.strip()
</div>
<div class="line-uncovered">
<span class="line-number">1184</span>                    if stripped_name:
</div>
<div class="line-uncovered">
<span class="line-number">1185</span>                        fields.append((stripped_name, field_type))
</div>
<div class="line-context">
<span class="line-number">1186</span>                        # Skip parsing the nested struct's fields as separate fields
</div>
<div class="line-context">
<span class="line-number">1187</span>                        continue
</div>
<div class="line-context">
<span class="line-number">1188</span>            # Array field: type name [ size ]
</div>
<div class="line-context">
<span class="line-number">1189</span>            elif (
</div>
<div class="line-context">
<span class="line-number">1190</span>                len(field_tokens) >= 4
</div>
<div class="line-context">
<span class="line-number">1191</span>                and field_tokens[-3].type == TokenType.LBRACKET
</div>
<div class="line-context">
<span class="line-number">1192</span>                and field_tokens[-1].type == TokenType.RBRACKET
</div>
<div class="line-context">
<span class="line-number">1193</span>            ):
</div>
<div class="line-context">
<span class="line-number">1194</span>                field_name = field_tokens[-4].value
</div>
<div class="line-context">
<span class="line-number">1195</span>                # Fix: Put the size inside the brackets, not before them
</div>
</div>
<h4>Line 1187</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1177</span>                field_type = "struct { ... }"
</div>
<div class="line-context">
<span class="line-number">1178</span>                if (
</div>
<div class="line-context">
<span class="line-number">1179</span>                    field_name
</div>
<div class="line-context">
<span class="line-number">1180</span>                    and field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1181</span>                    and field_name not in ["[", "]", ";", "}"]
</div>
<div class="line-context">
<span class="line-number">1182</span>                ):
</div>
<div class="line-context">
<span class="line-number">1183</span>                    stripped_name = field_name.strip()
</div>
<div class="line-context">
<span class="line-number">1184</span>                    if stripped_name:
</div>
<div class="line-context">
<span class="line-number">1185</span>                        fields.append((stripped_name, field_type))
</div>
<div class="line-context">
<span class="line-number">1186</span>                        # Skip parsing the nested struct's fields as separate fields
</div>
<div class="line-uncovered">
<span class="line-number">1187</span>                        continue
</div>
<div class="line-context">
<span class="line-number">1188</span>            # Array field: type name [ size ]
</div>
<div class="line-context">
<span class="line-number">1189</span>            elif (
</div>
<div class="line-context">
<span class="line-number">1190</span>                len(field_tokens) >= 4
</div>
<div class="line-context">
<span class="line-number">1191</span>                and field_tokens[-3].type == TokenType.LBRACKET
</div>
<div class="line-context">
<span class="line-number">1192</span>                and field_tokens[-1].type == TokenType.RBRACKET
</div>
<div class="line-context">
<span class="line-number">1193</span>            ):
</div>
<div class="line-context">
<span class="line-number">1194</span>                field_name = field_tokens[-4].value
</div>
<div class="line-context">
<span class="line-number">1195</span>                # Fix: Put the size inside the brackets, not before them
</div>
<div class="line-context">
<span class="line-number">1196</span>                field_type = (
</div>
<div class="line-context">
<span class="line-number">1197</span>                    " ".join(t.value for t in field_tokens[:-4])
</div>
</div>
<h4>Line 1240</h4>
<div class="code-block">
<div class="line-context">
<span class="line-number">1230</span>    return fields
</div>
<div class="line-context">
<span class="line-number">1231</span>
</div>
<div class="line-context">
<span class="line-number">1232</span>
</div>
<div class="line-context">
<span class="line-number">1233</span>def find_enum_values(tokens: List[Token], enum_start: int, enum_end: int) -> List[str]:
</div>
<div class="line-context">
<span class="line-number">1234</span>    """Extract enum values from enum token range"""
</div>
<div class="line-context">
<span class="line-number">1235</span>    values = []
</div>
<div class="line-context">
<span class="line-number">1236</span>    pos = enum_start
</div>
<div class="line-context">
<span class="line-number">1237</span>    while pos <= enum_end and tokens[pos].type != TokenType.LBRACE:
</div>
<div class="line-context">
<span class="line-number">1238</span>        pos += 1
</div>
<div class="line-context">
<span class="line-number">1239</span>    if pos > enum_end:
</div>
<div class="line-uncovered">
<span class="line-number">1240</span>        return values
</div>
<div class="line-context">
<span class="line-number">1241</span>    pos += 1  # Skip opening brace
</div>
<div class="line-context">
<span class="line-number">1242</span>    current_value = []
</div>
<div class="line-context">
<span class="line-number">1243</span>    while pos <= enum_end and tokens[pos].type != TokenType.RBRACE:
</div>
<div class="line-context">
<span class="line-number">1244</span>        token = tokens[pos]
</div>
<div class="line-context">
<span class="line-number">1245</span>        if token.type == TokenType.COMMA:
</div>
<div class="line-context">
<span class="line-number">1246</span>            if current_value:
</div>
<div class="line-context">
<span class="line-number">1247</span>                filtered_value = [
</div>
<div class="line-context">
<span class="line-number">1248</span>                    t
</div>
<div class="line-context">
<span class="line-number">1249</span>                    for t in current_value
</div>
<div class="line-context">
<span class="line-number">1250</span>                    if t.type not in [TokenType.WHITESPACE, TokenType.COMMENT]
</div>
</div>
</div>
<div class="recommendations">
<h3>üí° Recommendations</h3>
<ul>
<li><strong>Focus on low coverage files:</strong>
<ul>
<li>/workspace/c_to_plantuml/main.py: 53.61% coverage (45 missing lines)</li>
<li>/workspace/c_to_plantuml/utils.py: 61.19% coverage (26 missing lines)</li>
<li>/workspace/c_to_plantuml/preprocessor.py: 65.76% coverage (101 missing lines)</li>
</ul></li>
<li><strong>Add edge case tests:</strong> Many uncovered lines appear to be error handling and edge cases</li>
<li><strong>Test command-line interface:</strong> The main function and argument parsing are largely uncovered</li>
</ul>
</div>
<a href="summary.html" class="back-link">‚Üê Back to Test Summary</a>

    </div>
    <div class="footer">
        <p>Generated by Test Report System</p>
    </div>
</body>
</html>